var tap=require("tap"),child_process=require("child_process"),pattern="test/a/!(symlink)/**",bashResults=require("./bash-results.json"),patterns=Object.keys(bashResults),glob=require("../"),Glob=glob.Glob,path=require("path");process.chdir(path.resolve(__dirname,".."));function alphasort(d,c){d=d.toLowerCase();c=c.toLowerCase();return d>c?1:d<c?-1:0}function cleanResults(a){return a.map(function(b){return b.replace(/\/+/g,"/").replace(/\/$/,"")}).sort(alphasort).reduce(function(c,b){if(b!==c[c.length-1]){c.push(b)}return c},[]).sort(alphasort).map(function(b){return(process.platform!=="win32")?b:b.replace(/^[a-zA-Z]:\\\\/,"/").replace(/\\/g,"/")})}var globResults=[];tap.test("use a Glob object, and pause/resume it",function(c){var e=new Glob(pattern),b=false,a=[],d=bashResults[pattern];e.on("pause",function(){console.error("pause")});e.on("resume",function(){console.error("resume")});e.on("match",function(f){c.notOk(e.paused,"must not be paused");globResults.push(f);e.pause();c.ok(e.paused,"must be paused");setTimeout(e.resume.bind(e),10)});e.on("end",function(f){c.pass("reached glob end");globResults=cleanResults(globResults);f=cleanResults(f);c.deepEqual(f,globResults,"end event matches should be the same as match events");c.deepEqual(f,d,"glob matches should be the same as bash results");c.end()})});