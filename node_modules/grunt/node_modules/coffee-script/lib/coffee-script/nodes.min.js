(function(){var R,g,z,u,al,af,e,ai,aj,Q,b,r,K,an,S,T,k,a,C,t,L,h,n,V,H,j,m,ac,U,Y,f,ah,W,c,ak,D,M,F,J,i,ae,P,B,G,d,aa,ab,O,E,x,ag,y,ad,s,N,A,X,q,l,o,I,Z,w,am={}.hasOwnProperty,p=function(ar,ap){for(var ao in ap){if(am.call(ap,ao)){ar[ao]=ap[ao]}}function aq(){this.constructor=ar}aq.prototype=ap.prototype;ar.prototype=new aq();ar.__super__=ap.prototype;return ar},v=[].indexOf||function(aq){for(var ap=0,ao=this.length;ap<ao;ap++){if(ap in this&&this[ap]===aq){return ap}}return -1};J=require("./scope").Scope;Z=require("./lexer"),c=Z.RESERVED,F=Z.STRICT_PROSCRIBED;w=require("./helpers"),ag=w.compact,N=w.flatten,s=w.extend,X=w.merge,y=w.del,l=w.starts,ad=w.ends,A=w.last;exports.extend=s;x=function(){return true};U=function(){return false};G=function(){return this};ac=function(){this.negated=!this.negated;return this};exports.Base=u=(function(){function ao(){}ao.prototype.compile=function(ar,ap){var aq;ar=s({},ar);if(ap){ar.level=ap}aq=this.unfoldSoak(ar)||this;aq.tab=ar.indent;if(ar.level===H||!aq.isStatement(ar)){return aq.compileNode(ar)}else{return aq.compileClosure(ar)}};ao.prototype.compileClosure=function(ap){if(this.jumps()){throw SyntaxError("cannot use a pure statement in an expression.")}ap.sharedScope=true;return ai.wrap(this).compileNode(ap)};ao.prototype.cache=function(at,au,ap){var ar,aq;if(!this.isComplex()){ar=au?this.compile(at,au):this;return[ar,ar]}else{ar=new j(ap||at.scope.freeVariable("ref"));aq=new z(ar,this);if(au){return[aq.compile(at,au),ar.value]}else{return[aq,ar]}}};ao.prototype.compileLoopReference=function(at,ap){var ar,aq;ar=aq=this.compile(at,h);if(!((-Infinity<+ar&&+ar<Infinity)||an.test(ar)&&at.scope.check(ar,true))){ar=""+(aq=at.scope.freeVariable(ap))+" = "+ar}return[ar,aq]};ao.prototype.makeReturn=function(ap){var aq;aq=this.unwrapAll();if(ap){return new af(new j(""+ap+".push"),[aq])}else{return new D(aq)}};ao.prototype.contains=function(ap){var aq;aq=false;this.traverseChildren(false,function(ar){if(ap(ar)){aq=true;return false}});return aq};ao.prototype.containsType=function(ap){return this instanceof ap||this.contains(function(aq){return aq instanceof ap})};ao.prototype.lastNonComment=function(aq){var ap;ap=aq.length;while(ap--){if(!(aq[ap] instanceof Q)){return aq[ap]}}return null};ao.prototype.toString=function(ar,aq){var ap;if(ar==null){ar=""}if(aq==null){aq=this.constructor.name}ap="\n"+ar+aq;if(this.soak){ap+="?"}this.eachChild(function(at){return ap+=at.toString(ar+B)});return ap};ao.prototype.eachChild=function(at){var ax,aq,aw,av,ay,ap,au,ar;if(!this.children){return this}au=this.children;for(aw=0,ay=au.length;aw<ay;aw++){ax=au[aw];if(this[ax]){ar=N([this[ax]]);for(av=0,ap=ar.length;av<ap;av++){aq=ar[av];if(at(aq)===false){return this}}}}return this};ao.prototype.traverseChildren=function(aq,ap){return this.eachChild(function(ar){if(ap(ar)===false){return false}return ar.traverseChildren(aq,ap)})};ao.prototype.invert=function(){return new f("!",this)};ao.prototype.unwrapAll=function(){var ap;ap=this;while(ap!==(ap=ap.unwrap())){continue}return ap};ao.prototype.children=[];ao.prototype.isStatement=U;ao.prototype.jumps=U;ao.prototype.isComplex=x;ao.prototype.isChainable=U;ao.prototype.isAssignable=U;ao.prototype.unwrap=G;ao.prototype.unfoldSoak=U;ao.prototype.assigns=U;return ao})();exports.Block=al=(function(ap){p(ao,ap);function ao(aq){this.expressions=ag(N(aq||[]))}ao.prototype.children=["expressions"];ao.prototype.push=function(aq){this.expressions.push(aq);return this};ao.prototype.pop=function(){return this.expressions.pop()};ao.prototype.unshift=function(aq){this.expressions.unshift(aq);return this};ao.prototype.unwrap=function(){if(this.expressions.length===1){return this.expressions[0]}else{return this}};ao.prototype.isEmpty=function(){return !this.expressions.length};ao.prototype.isStatement=function(au){var at,ar,aq,av;av=this.expressions;for(ar=0,aq=av.length;ar<aq;ar++){at=av[ar];if(at.isStatement(au)){return true}}return false};ao.prototype.jumps=function(au){var at,ar,aq,av;av=this.expressions;for(ar=0,aq=av.length;ar<aq;ar++){at=av[ar];if(at.jumps(au)){return at}}};ao.prototype.makeReturn=function(ar){var at,aq;aq=this.expressions.length;while(aq--){at=this.expressions[aq];if(!(at instanceof Q)){this.expressions[aq]=at.makeReturn(ar);if(at instanceof D&&!at.expression){this.expressions.splice(aq,1)}break}}return this};ao.prototype.compile=function(aq,ar){if(aq==null){aq={}}if(aq.scope){return ao.__super__.compile.call(this,aq,ar)}else{return this.compileRoot(aq)}};ao.prototype.compileNode=function(ax){var au,ar,at,aw,av,aq,ay;this.tab=ax.indent;aw=ax.level===H;ar=[];ay=this.expressions;for(av=0,aq=ay.length;av<aq;av++){at=ay[av];at=at.unwrapAll();at=at.unfoldSoak(ax)||at;if(at instanceof ao){ar.push(at.compileNode(ax))}else{if(aw){at.front=true;au=at.compile(ax);if(!at.isStatement(ax)){au=""+this.tab+au+";";if(at instanceof j){au=""+au+"\n"}}ar.push(au)}else{ar.push(at.compile(ax,h))}}}if(aw){if(this.spaced){return"\n"+(ar.join("\n\n"))+"\n"}else{return ar.join("\n")}}au=ar.join(", ")||"void 0";if(ar.length>1&&ax.level>=h){return"("+au+")"}else{return au}};ao.prototype.compileRoot=function(ax){var av,aw,ar,au,aq,at;ax.indent=ax.bare?"":B;ax.scope=new J(null,this,null);ax.level=H;this.spaced=true;au="";if(!ax.bare){aq=(function(){var aA,az,aB,ay;aB=this.expressions;ay=[];for(ar=aA=0,az=aB.length;aA<az;ar=++aA){aw=aB[ar];if(!(aw.unwrap() instanceof Q)){break}ay.push(aw)}return ay}).call(this);at=this.expressions.slice(aq.length);this.expressions=aq;if(aq.length){au=""+(this.compileNode(X(ax,{indent:""})))+"\n"}this.expressions=at}av=this.compileWithDeclarations(ax);if(ax.bare){return av}return""+au+"(function() {\n"+av+"\n}).call(this);\n"};ao.prototype.compileWithDeclarations=function(ar){var aB,aq,aD,ay,aA,aE,at,aF,aw,az,aC,ax,av,au;aq=aE="";ax=this.expressions;for(aA=az=0,aC=ax.length;az<aC;aA=++az){ay=ax[aA];ay=ay.unwrap();if(!(ay instanceof Q||ay instanceof j)){break}}ar=X(ar,{level:H});if(aA){at=this.expressions.splice(aA,9000000000);av=[this.spaced,false],aw=av[0],this.spaced=av[1];au=[this.compileNode(ar),aw],aq=au[0],this.spaced=au[1];this.expressions=at}aE=this.compileNode(ar);aF=ar.scope;if(aF.expressions===this){aD=ar.scope.hasDeclarations();aB=aF.hasAssignments;if(aD||aB){if(aA){aq+="\n"}aq+=""+this.tab+"var ";if(aD){aq+=aF.declaredVariables().join(", ")}if(aB){if(aD){aq+=",\n"+(this.tab+B)}aq+=aF.assignedVariables().join(",\n"+(this.tab+B))}aq+=";\n"}}return aq+aE};ao.wrap=function(aq){if(aq.length===1&&aq[0] instanceof ao){return aq[0]}return new ao(aq)};return ao})(u);exports.Literal=j=(function(ap){p(ao,ap);function ao(aq){this.value=aq}ao.prototype.makeReturn=function(){if(this.isStatement()){return this}else{return ao.__super__.makeReturn.apply(this,arguments)}};ao.prototype.isAssignable=function(){return an.test(this.value)};ao.prototype.isStatement=function(){var aq;return(aq=this.value)==="break"||aq==="continue"||aq==="debugger"};ao.prototype.isComplex=U;ao.prototype.assigns=function(aq){return aq===this.value};ao.prototype.jumps=function(aq){if(this.value==="break"&&!((aq!=null?aq.loop:void 0)||(aq!=null?aq.block:void 0))){return this}if(this.value==="continue"&&!(aq!=null?aq.loop:void 0)){return this}};ao.prototype.compileNode=function(ar){var aq,at;aq=this.value==="this"?((at=ar.scope.method)!=null?at.bound:void 0)?ar.scope.method.context:this.value:this.value.reserved?'"'+this.value+'"':this.value;if(this.isStatement()){return""+this.tab+aq+";"}else{return aq}};ao.prototype.toString=function(){return' "'+this.value+'"'};return ao})(u);exports.Undefined=(function(ao){p(ap,ao);function ap(){return ap.__super__.constructor.apply(this,arguments)}ap.prototype.isAssignable=U;ap.prototype.isComplex=U;ap.prototype.compileNode=function(aq){if(aq.level>=t){return"(void 0)"}else{return"void 0"}};return ap})(u);exports.Null=(function(ao){p(ap,ao);function ap(){return ap.__super__.constructor.apply(this,arguments)}ap.prototype.isAssignable=U;ap.prototype.isComplex=U;ap.prototype.compileNode=function(){return"null"};return ap})(u);exports.Bool=(function(ao){p(ap,ao);ap.prototype.isAssignable=U;ap.prototype.isComplex=U;ap.prototype.compileNode=function(){return this.val};function ap(aq){this.val=aq}return ap})(u);exports.Return=D=(function(ap){p(ao,ap);function ao(aq){if(aq&&!aq.unwrap().isUndefined){this.expression=aq}}ao.prototype.children=["expression"];ao.prototype.isStatement=x;ao.prototype.makeReturn=G;ao.prototype.jumps=G;ao.prototype.compile=function(ar,au){var aq,at;aq=(at=this.expression)!=null?at.makeReturn():void 0;if(aq&&!(aq instanceof ao)){return aq.compile(ar,au)}else{return ao.__super__.compile.call(this,ar,au)}};ao.prototype.compileNode=function(aq){return this.tab+("return"+[this.expression?" "+(this.expression.compile(aq,V)):void 0]+";")};return ao})(u);exports.Value=O=(function(ap){p(ao,ap);function ao(at,ar,aq){if(!ar&&at instanceof ao){return at}this.base=at;this.properties=ar||[];if(aq){this[aq]=true}return this}ao.prototype.children=["base","properties"];ao.prototype.add=function(aq){this.properties=this.properties.concat(aq);return this};ao.prototype.hasProperties=function(){return !!this.properties.length};ao.prototype.isArray=function(){return !this.properties.length&&this.base instanceof g};ao.prototype.isComplex=function(){return this.hasProperties()||this.base.isComplex()};ao.prototype.isAssignable=function(){return this.hasProperties()||this.base.isAssignable()};ao.prototype.isSimpleNumber=function(){return this.base instanceof j&&M.test(this.base.value)};ao.prototype.isString=function(){return this.base instanceof j&&T.test(this.base.value)};ao.prototype.isAtomic=function(){var ar,at,aq,au;au=this.properties.concat(this.base);for(at=0,aq=au.length;at<aq;at++){ar=au[at];if(ar.soak||ar instanceof af){return false}}return true};ao.prototype.isStatement=function(aq){return !this.properties.length&&this.base.isStatement(aq)};ao.prototype.assigns=function(aq){return !this.properties.length&&this.base.assigns(aq)};ao.prototype.jumps=function(aq){return !this.properties.length&&this.base.jumps(aq)};ao.prototype.isObject=function(aq){if(this.properties.length){return false}return(this.base instanceof Y)&&(!aq||this.base.generated)};ao.prototype.isSplice=function(){return A(this.properties) instanceof i};ao.prototype.unwrap=function(){if(this.properties.length){return this}else{return this.base}};ao.prototype.cacheReference=function(av){var at,au,aq,ar;aq=A(this.properties);if(this.properties.length<2&&!this.base.isComplex()&&!(aq!=null?aq.isComplex():void 0)){return[this,this]}at=new ao(this.base,this.properties.slice(0,-1));if(at.isComplex()){au=new j(av.scope.freeVariable("base"));at=new ao(new W(new z(au,at)))}if(!aq){return[at,au]}if(aq.isComplex()){ar=new j(av.scope.freeVariable("name"));aq=new C(new z(ar,aq.index));ar=new C(ar)}return[at.add(aq),new ao(au||at.base,[ar||aq])]};ao.prototype.compileNode=function(av){var at,aw,ar,au,aq;this.base.front=this.front;ar=this.properties;at=this.base.compile(av,ar.length?t:null);if((this.base instanceof W||ar.length)&&M.test(at)){at=""+at+"."}for(au=0,aq=ar.length;au<aq;au++){aw=ar[au];at+=aw.compile(av)}return at};ao.prototype.unfoldSoak=function(ar){var aq,at=this;if(this.unfoldedSoak!=null){return this.unfoldedSoak}aq=(function(){var av,aA,aB,au,aw,az,ay,aC,ax;if(aB=at.base.unfoldSoak(ar)){Array.prototype.push.apply(aB.body.properties,at.properties);return aB}ax=at.properties;for(aA=ay=0,aC=ax.length;ay<aC;aA=++ay){au=ax[aA];if(!au.soak){continue}au.soak=false;av=new ao(at.base,at.properties.slice(0,aA));az=new ao(at.base,at.properties.slice(aA));if(av.isComplex()){aw=new j(ar.scope.freeVariable("ref"));av=new W(new z(aw,av));az.base=aw}return new k(new b(av),az,{soak:true})}return null})();return this.unfoldedSoak=aq||false};return ao})(u);exports.Comment=Q=(function(ao){p(ap,ao);function ap(aq){this.comment=aq}ap.prototype.isStatement=x;ap.prototype.makeReturn=G;ap.prototype.compileNode=function(ar,at){var aq;aq="/*"+q(this.comment,this.tab)+("\n"+this.tab+"*/\n");if((at||ar.level)===H){aq=ar.indent+aq}return aq};return ap})(u);exports.Call=af=(function(ap){p(ao,ap);function ao(at,ar,aq){this.args=ar!=null?ar:[];this.soak=aq;this.isNew=false;this.isSuper=at==="super";this.variable=this.isSuper?null:at}ao.prototype.children=["variable","args"];ao.prototype.newInstance=function(){var aq,ar;aq=((ar=this.variable)!=null?ar.base:void 0)||this.variable;if(aq instanceof ao&&!aq.isNew){aq.newInstance()}else{this.isNew=true}return this};ao.prototype.superReference=function(at){var aq,au,ar;au=at.scope.namedMethod();if(!au){throw SyntaxError("cannot call super outside of a function.")}ar=au.name;if(ar==null){throw SyntaxError("cannot call super on an anonymous function.")}if(au.klass){aq=[new R(new j("__super__"))];if(au["static"]){aq.push(new R(new j("constructor")))}aq.push(new R(new j(ar)));return(new O(new j(au.klass),aq)).compile(at)}else{return""+ar+".__super__.constructor"}};ao.prototype.superThis=function(aq){var ar;ar=aq.scope.method;return(ar&&!ar.klass&&ar.context)||"this"};ao.prototype.unfoldSoak=function(aq){var aA,ax,at,ay,av,aw,az,au,ar;if(this.soak){if(this.variable){if(ax=o(aq,this,"variable")){return ax}au=new O(this.variable).cacheReference(aq),at=au[0],av=au[1]}else{at=new j(this.superReference(aq));av=new O(at)}av=new ao(av,this.args);av.isNew=this.isNew;at=new j("typeof "+(at.compile(aq))+' === "function"');return new k(at,new O(av),{soak:true})}aA=this;ay=[];while(true){if(aA.variable instanceof ao){ay.push(aA);aA=aA.variable;continue}if(!(aA.variable instanceof O)){break}ay.push(aA);if(!((aA=aA.variable.base) instanceof ao)){break}}ar=ay.reverse();for(aw=0,az=ar.length;aw<az;aw++){aA=ar[aw];if(ax){if(aA.variable instanceof ao){aA.variable=ax}else{aA.variable.base=ax}}ax=o(aq,aA,"variable")}return ax};ao.prototype.filterImplicitObjects=function(az){var au,ar,ay,aq,aA,ax,aw,aB,at,av;ar=[];for(ax=0,aB=az.length;ax<aB;ax++){au=az[ax];if(!((typeof au.isObject==="function"?au.isObject():void 0)&&au.base.generated)){ar.push(au);continue}ay=null;av=au.base.properties;for(aw=0,at=av.length;aw<at;aw++){aq=av[aw];if(aq instanceof z||aq instanceof Q){if(!ay){ar.push(ay=new Y(aA=[],true))}aA.push(aq)}else{ar.push(aq);ay=null}}}return ar};ao.prototype.compileNode=function(au){var aq,ar,at,av;if((av=this.variable)!=null){av.front=this.front}if(at=ae.compileSplattedArray(au,this.args,true)){return this.compileSplat(au,at)}ar=this.filterImplicitObjects(this.args);ar=((function(){var ay,ax,aw;aw=[];for(ay=0,ax=ar.length;ay<ax;ay++){aq=ar[ay];aw.push(aq.compile(au,h))}return aw})()).join(", ");if(this.isSuper){return this.superReference(au)+(".call("+(this.superThis(au))+(ar&&", "+ar)+")")}else{return(this.isNew?"new ":"")+this.variable.compile(au,t)+("("+ar+")")}};ao.prototype.compileSuper=function(aq,ar){return""+(this.superReference(ar))+".call("+(this.superThis(ar))+(aq.length?", ":"")+aq+")"};ao.prototype.compileSplat=function(ax,au){var aw,aq,at,ar,av;if(this.isSuper){return""+(this.superReference(ax))+".apply("+(this.superThis(ax))+", "+au+")"}if(this.isNew){at=this.tab+B;return"(function(func, args, ctor) {\n"+at+"ctor.prototype = func.prototype;\n"+at+"var child = new ctor, result = func.apply(child, args), t = typeof result;\n"+at+'return t == "object" || t == "function" ? result || child : child;\n'+this.tab+"})("+(this.variable.compile(ax,h))+", "+au+", function(){})"}aw=new O(this.variable);if((ar=aw.properties.pop())&&aw.isComplex()){av=ax.scope.freeVariable("ref");aq="("+av+" = "+(aw.compile(ax,h))+")"+(ar.compile(ax))}else{aq=aw.compile(ax,t);if(M.test(aq)){aq="("+aq+")"}if(ar){av=aq;aq+=ar.compile(ax)}else{av="null"}}return""+aq+".apply("+av+", "+au+")"};return ao})(u);exports.Extends=r=(function(ap){p(ao,ap);function ao(ar,aq){this.child=ar;this.parent=aq}ao.prototype.children=["child","parent"];ao.prototype.compile=function(aq){return new af(new O(new j(I("extends"))),[this.child,this.parent]).compile(aq)};return ao})(u);exports.Access=R=(function(ao){p(ap,ao);function ap(ar,aq){this.name=ar;this.name.asKey=true;this.soak=aq==="soak"}ap.prototype.children=["name"];ap.prototype.compile=function(ar){var aq;aq=this.name.compile(ar);if(an.test(aq)){return"."+aq}else{return"["+aq+"]"}};ap.prototype.isComplex=U;return ap})(u);exports.Index=C=(function(ao){p(ap,ao);function ap(aq){this.index=aq}ap.prototype.children=["index"];ap.prototype.compile=function(aq){return"["+(this.index.compile(aq,V))+"]"};ap.prototype.isComplex=function(){return this.index.isComplex()};return ap})(u);exports.Range=ak=(function(ao){p(ap,ao);ap.prototype.children=["from","to"];function ap(at,ar,aq){this.from=at;this.to=ar;this.exclusive=aq==="exclusive";this.equals=this.exclusive?"":"="}ap.prototype.compileVariables=function(av){var aq,aw,au,at,ar;av=X(av,{top:true});aw=this.from.cache(av,h),this.fromC=aw[0],this.fromVar=aw[1];au=this.to.cache(av,h),this.toC=au[0],this.toVar=au[1];if(aq=y(av,"step")){at=aq.cache(av,h),this.step=at[0],this.stepVar=at[1]}ar=[this.fromVar.match(M),this.toVar.match(M)],this.fromNum=ar[0],this.toNum=ar[1];if(this.stepVar){return this.stepNum=this.stepVar.match(M)}};ap.prototype.compileNode=function(ar){var az,aD,aB,aq,aC,ay,aE,aw,av,aF,aA,ax,au,at;if(!this.fromVar){this.compileVariables(ar)}if(!ar.index){return this.compileArray(ar)}aE=this.fromNum&&this.toNum;aC=y(ar,"index");ay=y(ar,"name");av=ay&&ay!==aC;ax=""+aC+" = "+this.fromC;if(this.toC!==this.toVar){ax+=", "+this.toC}if(this.step!==this.stepVar){ax+=", "+this.step}au=[""+aC+" <"+this.equals,""+aC+" >"+this.equals],aw=au[0],aq=au[1];aD=this.stepNum?+this.stepNum>0?""+aw+" "+this.toVar:""+aq+" "+this.toVar:aE?((at=[+this.fromNum,+this.toNum],aB=at[0],aA=at[1],at),aB<=aA?""+aw+" "+aA:""+aq+" "+aA):(az=""+this.fromVar+" <= "+this.toVar,""+az+" ? "+aw+" "+this.toVar+" : "+aq+" "+this.toVar);aF=this.stepVar?""+aC+" += "+this.stepVar:aE?av?aB<=aA?"++"+aC:"--"+aC:aB<=aA?""+aC+"++":""+aC+"--":av?""+az+" ? ++"+aC+" : --"+aC:""+az+" ? "+aC+"++ : "+aC+"--";if(av){ax=""+ay+" = "+ax}if(av){aF=""+ay+" = "+aF}return""+ax+"; "+aD+"; "+aF};ap.prototype.compileArray=function(aq){var aC,aA,aD,ar,ay,aG,aE,av,az,aF,aB,ax,au,at,aw;if(this.fromNum&&this.toNum&&Math.abs(this.fromNum-this.toNum)<=20){az=(function(){aw=[];for(var aH=au=+this.fromNum,aI=+this.toNum;au<=aI?aH<=aI:aH>=aI;au<=aI?aH++:aH--){aw.push(aH)}return aw}).apply(this);if(this.exclusive){az.pop()}return"["+(az.join(", "))+"]"}aG=this.tab+B;ay=aq.scope.freeVariable("i");aF=aq.scope.freeVariable("results");av="\n"+aG+aF+" = [];";if(this.fromNum&&this.toNum){aq.index=ay;aA=this.compileNode(aq)}else{aB=(""+ay+" = "+this.fromC)+(this.toC!==this.toVar?", "+this.toC:"");aD=""+this.fromVar+" <= "+this.toVar;aA="var "+aB+"; "+aD+" ? "+ay+" <"+this.equals+" "+this.toVar+" : "+ay+" >"+this.equals+" "+this.toVar+"; "+aD+" ? "+ay+"++ : "+ay+"--"}aE="{ "+aF+".push("+ay+"); }\n"+aG+"return "+aF+";\n"+aq.indent;ar=function(aH){return aH!=null?aH.contains(function(aI){return aI instanceof j&&aI.value==="arguments"&&!aI.asKey}):void 0};if(ar(this.from)||ar(this.to)){aC=", arguments"}return"(function() {"+av+"\n"+aG+"for ("+aA+")"+aE+"}).apply(this"+(aC!=null?aC:"")+")"};return ap})(u);exports.Slice=i=(function(ap){p(ao,ap);ao.prototype.children=["range"];function ao(aq){this.range=aq;ao.__super__.constructor.call(this)}ao.prototype.compileNode=function(au){var at,ax,aq,aw,ar,av;av=this.range,aw=av.to,ax=av.from;aq=ax&&ax.compile(au,V)||"0";at=aw&&aw.compile(au,V);if(aw&&!(!this.range.exclusive&&+at===-1)){ar=", "+(this.range.exclusive?at:M.test(at)?""+(+at+1):(at=aw.compile(au,t),""+at+" + 1 || 9e9"))}return".slice("+aq+(ar||"")+")"};return ao})(u);exports.Obj=Y=(function(ap){p(ao,ap);function ao(ar,aq){this.generated=aq!=null?aq:false;this.objects=this.properties=ar||[]}ao.prototype.children=["properties"];ao.prototype.compileNode=function(at){var aC,aH,av,au,aw,ax,aB,aq,aD,aG,aE,aA,az,aF,ar,ay;aE=this.properties;aG=[];ay=this.properties;for(aA=0,aF=ay.length;aA<aF;aA++){aq=ay[aA];if(aq.isComplex()){aq=aq.variable}if(aq!=null){aD=aq.unwrapAll().value.toString();if(v.call(aG,aD)>=0){throw SyntaxError('multiple object literal properties named "'+aD+'"')}aG.push(aD)}}if(!aE.length){return(this.front?"({})":"{}")}if(this.generated){for(az=0,ar=aE.length;az<ar;az++){ax=aE[az];if(ax instanceof O){throw new Error("cannot have an implicit value in an implicit object")}}}aH=at.indent+=B;aw=this.lastNonComment(this.properties);aE=(function(){var aK,aI,aJ;aJ=[];for(aC=aK=0,aI=aE.length;aK<aI;aC=++aK){aq=aE[aC];au=aC===aE.length-1?"":aq===aw||aq instanceof Q?"\n":",\n";av=aq instanceof Q?"":aH;if(aq instanceof O&&aq["this"]){aq=new z(aq.properties[0].name,aq,"object")}if(!(aq instanceof Q)){if(!(aq instanceof z)){aq=new z(aq,aq,"object")}(aq.variable.base||aq.variable).asKey=true}aJ.push(av+aq.compile(at,H)+au)}return aJ})();aE=aE.join("");aB="{"+(aE&&"\n"+aE+"\n"+this.tab)+"}";if(this.front){return"("+aB+")"}else{return aB}};ao.prototype.assigns=function(ar){var av,at,aq,au;au=this.properties;for(at=0,aq=au.length;at<aq;at++){av=au[at];if(av.assigns(ar)){return true}}return false};return ao})(u);exports.Arr=g=(function(ao){p(ap,ao);function ap(aq){this.objects=aq||[]}ap.prototype.children=["objects"];ap.prototype.filterImplicitObjects=af.prototype.filterImplicitObjects;ap.prototype.compileNode=function(au){var aq,ar,at;if(!this.objects.length){return"[]"}au.indent+=B;at=this.filterImplicitObjects(this.objects);if(aq=ae.compileSplattedArray(au,at)){return aq}aq=((function(){var ax,aw,av;av=[];for(ax=0,aw=at.length;ax<aw;ax++){ar=at[ax];av.push(ar.compile(au,h))}return av})()).join(", ");if(aq.indexOf("\n")>=0){return"[\n"+au.indent+aq+"\n"+this.tab+"]"}else{return"["+aq+"]"}};ap.prototype.assigns=function(ar){var au,at,aq,av;av=this.objects;for(at=0,aq=av.length;at<aq;at++){au=av[at];if(au.assigns(ar)){return true}}return false};return ap})(u);exports.Class=e=(function(ap){p(ao,ap);function ao(ar,at,aq){this.variable=ar;this.parent=at;this.body=aq!=null?aq:new al;this.boundFuncs=[];this.body.classBody=true}ao.prototype.children=["variable","parent","body"];ao.prototype.determineName=function(){var aq,ar;if(!this.variable){return null}aq=(ar=A(this.variable.properties))?ar instanceof R&&ar.name.value:this.variable.base.value;if(v.call(F,aq)>=0){throw SyntaxError("variable name may not be "+aq)}return aq&&(aq=an.test(aq)&&aq)};ao.prototype.setContext=function(aq){return this.body.traverseChildren(false,function(ar){if(ar.classBody){return false}if(ar instanceof j&&ar.value==="this"){return ar.value=aq}else{if(ar instanceof aj){ar.klass=aq;if(ar.bound){return ar.context=aq}}}})};ao.prototype.addBoundFunctions=function(aw){var au,at,av,ar,ax,aq;if(this.boundFuncs.length){ax=this.boundFuncs;aq=[];for(av=0,ar=ax.length;av<ar;av++){au=ax[av];at=(new O(new j("this"),[new R(au)])).compile(aw);aq.push(this.ctor.body.unshift(new j(""+at+" = "+(I("bind"))+"("+at+", this)")))}return aq}};ao.prototype.addProperties=function(av,ar,ay){var aq,aw,ax,au,at;at=av.base.properties.slice(0);ax=(function(){var az;az=[];while(aq=at.shift()){if(aq instanceof z){aw=aq.variable.base;delete aq.context;au=aq.value;if(aw.value==="constructor"){if(this.ctor){throw new Error("cannot define more than one constructor in a class")}if(au.bound){throw new Error("cannot define a constructor as a bound function")}if(au instanceof aj){aq=this.ctor=au}else{this.externalCtor=ay.scope.freeVariable("class");aq=new z(new j(this.externalCtor),au)}}else{if(aq.variable["this"]){au["static"]=true;if(au.bound){au.context=ar}}else{aq.variable=new O(new j(ar),[new R(new j("prototype")),new R(aw)]);if(au instanceof aj&&au.bound){this.boundFuncs.push(aw);au.bound=false}}}}az.push(aq)}return az}).call(this);return ag(ax)};ao.prototype.walkBody=function(aq,ar){var at=this;return this.traverseChildren(false,function(aA){var ay,av,aw,ax,au,az;if(aA instanceof ao){return false}if(aA instanceof al){az=ay=aA.expressions;for(av=ax=0,au=az.length;ax<au;av=++ax){aw=az[av];if(aw instanceof O&&aw.isObject(true)){ay[av]=at.addProperties(aw,aq,ar)}}return aA.expressions=ay=N(ay)}})};ao.prototype.hoistDirectivePrologue=function(){var at,aq,ar;aq=0;at=this.body.expressions;while((ar=at[aq])&&ar instanceof Q||ar instanceof O&&ar.isString()){++aq}return this.directives=at.splice(0,aq)};ao.prototype.ensureConstructor=function(aq){if(!this.ctor){this.ctor=new aj;if(this.parent){this.ctor.body.push(new j(""+aq+".__super__.constructor.apply(this, arguments)"))}if(this.externalCtor){this.ctor.body.push(new j(""+this.externalCtor+".apply(this, arguments)"))}this.ctor.body.makeReturn();this.body.expressions.unshift(this.ctor)}this.ctor.ctor=this.ctor.name=aq;this.ctor.klass=null;return this.ctor.noReturn=true};ao.prototype.compileNode=function(ax){var av,ar,aq,at,au,aw,ay;ar=this.determineName();au=ar||"_Class";if(au.reserved){au="_"+au}at=new j(au);this.hoistDirectivePrologue();this.setContext(au);this.walkBody(au,ax);this.ensureConstructor(au);this.body.spaced=true;if(!(this.ctor instanceof aj)){this.body.expressions.unshift(this.ctor)}this.body.expressions.push(at);(ay=this.body.expressions).unshift.apply(ay,this.directives);this.addBoundFunctions(ax);av=ai.wrap(this.body);if(this.parent){this.superClass=new j(ax.scope.freeVariable("super",false));this.body.expressions.unshift(new r(at,this.superClass));av.args.push(this.parent);aw=av.variable.params||av.variable.base.params;aw.push(new ah(this.superClass))}aq=new W(av,true);if(this.variable){aq=new z(this.variable,aq)}return aq.compile(ax)};return ao})(u);exports.Assign=z=(function(ao){p(ap,ao);function ap(au,aw,av,at){var ar,aq,ax;this.variable=au;this.value=aw;this.context=av;this.param=at&&at.param;this.subpattern=at&&at.subpattern;ar=(ax=(aq=this.variable.unwrapAll().value),v.call(F,ax)>=0);if(ar&&this.context!=="object"){throw SyntaxError('variable name may not be "'+aq+'"')}}ap.prototype.children=["variable","value"];ap.prototype.isStatement=function(aq){return(aq!=null?aq.level:void 0)===H&&(this.context!=null)&&v.call(this.context,"?")>=0};ap.prototype.assigns=function(aq){return this[this.context==="object"?"value":"variable"].assigns(aq)};ap.prototype.unfoldSoak=function(aq){return o(aq,this,"variable")};ap.prototype.compileNode=function(at){var aA,az,aq,av,ay,ax,aw,au,ar;if(aA=this.variable instanceof O){if(this.variable.isArray()||this.variable.isObject()){return this.compilePatternMatch(at)}if(this.variable.isSplice()){return this.compileSplice(at)}if((ax=this.context)==="||="||ax==="&&="||ax==="?="){return this.compileConditional(at)}}aq=this.variable.compile(at,h);if(!this.context){if(!(ay=this.variable.unwrapAll()).isAssignable()){throw SyntaxError('"'+(this.variable.compile(at))+'" cannot be assigned.')}if(!(typeof ay.hasProperties==="function"?ay.hasProperties():void 0)){if(this.param){at.scope.add(aq,"var")}else{at.scope.find(aq)}}}if(this.value instanceof aj&&(az=m.exec(aq))){if(az[1]){this.value.klass=az[1]}this.value.name=(aw=(au=(ar=az[2])!=null?ar:az[3])!=null?au:az[4])!=null?aw:az[5]}av=this.value.compile(at,h);if(this.context==="object"){return""+aq+": "+av}av=aq+(" "+(this.context||"=")+" ")+av;if(at.level<=h){return av}else{return"("+av+")"}};ap.prototype.compilePatternMatch=function(aL){var aA,aF,au,aN,aJ,aE,aG,aS,aH,at,aC,aB,aI,aP,aK,aR,aM,aD,ay,aO,az,ax,aw,av,ar,aq,aQ;aK=aL.level===H;aM=this.value;at=this.variable.base.objects;if(!(aC=at.length)){au=aM.compile(aL);if(aL.level>=n){return"("+au+")"}else{return au}}aE=this.variable.isObject();if(aK&&aC===1&&!((aH=at[0]) instanceof ae)){if(aH instanceof ap){az=aH,(ax=az.variable,aJ=ax.base),aH=az.value}else{if(aH.base instanceof W){aw=new O(aH.unwrapAll()).cacheReference(aL),aH=aw[0],aJ=aw[1]}else{aJ=aE?aH["this"]?aH.properties[0].name:aH:new j(0)}}aA=an.test(aJ.unwrap().value||0);aM=new O(aM);aM.properties.push(new (aA?R:C)(aJ));if(av=aH.unwrap().value,v.call(c,av)>=0){throw new SyntaxError("assignment to a reserved word: "+(aH.compile(aL))+" = "+(aM.compile(aL)))}return new ap(aH,aM,null,{param:this.param}).compile(aL,H)}aD=aM.compile(aL,h);aF=[];aP=false;if(!an.test(aD)||this.variable.assigns(aD)){aF.push(""+(aB=aL.scope.freeVariable("ref"))+" = "+aD);aD=aB}for(aN=ay=0,aO=at.length;ay<aO;aN=++ay){aH=at[aN];aJ=aN;if(aE){if(aH instanceof ap){ar=aH,(aq=ar.variable,aJ=aq.base),aH=ar.value}else{if(aH.base instanceof W){aQ=new O(aH.unwrapAll()).cacheReference(aL),aH=aQ[0],aJ=aQ[1]}else{aJ=aH["this"]?aH.properties[0].name:aH}}}if(!aP&&aH instanceof ae){aS=aH.name.unwrap().value;aH=aH.unwrap();aR=""+aC+" <= "+aD+".length ? "+(I("slice"))+".call("+aD+", "+aN;if(aI=aC-aN-1){aG=aL.scope.freeVariable("i");aR+=", "+aG+" = "+aD+".length - "+aI+") : ("+aG+" = "+aN+", [])"}else{aR+=") : []"}aR=new j(aR);aP=""+aG+"++"}else{aS=aH.unwrap().value;if(aH instanceof ae){aH=aH.name.compile(aL);throw new SyntaxError("multiple splats are disallowed in an assignment: "+aH+"...")}if(typeof aJ==="number"){aJ=new j(aP||aJ);aA=false}else{aA=aE&&an.test(aJ.unwrap().value||0)}aR=new O(new j(aD),[new (aA?R:C)(aJ)])}if((aS!=null)&&v.call(c,aS)>=0){throw new SyntaxError("assignment to a reserved word: "+(aH.compile(aL))+" = "+(aR.compile(aL)))}aF.push(new ap(aH,aR,null,{param:this.param,subpattern:true}).compile(aL,h))}if(!(aK||this.subpattern)){aF.push(aD)}au=aF.join(", ");if(aL.level<h){return au}else{return"("+au+")"}};ap.prototype.compileConditional=function(at){var ar,aq,au;au=this.variable.cacheReference(at),ar=au[0],aq=au[1];if(!ar.properties.length&&ar.base instanceof j&&ar.base.value!=="this"&&!at.scope.check(ar.base.value)){throw new Error('the variable "'+ar.base.value+"\" can't be assigned with "+this.context+" because it has not been defined.")}if(v.call(this.context,"?")>=0){at.isExistentialEquals=true}return new f(this.context.slice(0,-1),ar,new ap(aq,this.value,"=")).compile(at)};ap.prototype.compileSplice=function(au){var at,ar,aC,aw,az,aq,aD,aA,aB,ay,ax,av;ay=this.variable.properties.pop().range,aC=ay.from,aD=ay.to,ar=ay.exclusive;aq=this.variable.compile(au);ax=(aC!=null?aC.cache(au,n):void 0)||["0","0"],aw=ax[0],az=ax[1];if(aD){if((aC!=null?aC.isSimpleNumber():void 0)&&aD.isSimpleNumber()){aD=+aD.compile(au)-+az;if(!ar){aD+=1}}else{aD=aD.compile(au,t)+" - "+az;if(!ar){aD+=" + 1"}}}else{aD="9e9"}av=this.value.cache(au,h),aA=av[0],aB=av[1];at="[].splice.apply("+aq+", ["+aw+", "+aD+"].concat("+aA+")), "+aB;if(au.level>H){return"("+at+")"}else{return at}};return ap})(u);exports.Code=aj=(function(ap){p(ao,ap);function ao(at,ar,aq){this.params=at||[];this.body=ar||new al;this.bound=aq==="boundfunc";if(this.bound){this.context="_this"}}ao.prototype.children=["params","body"];ao.prototype.isStatement=function(){return !!this.ctor};ao.prototype.jumps=U;ao.prototype.compileNode=function(aJ){var ax,aH,aM,aK,at,aY,aI,aG,aO,aF,au,aL,aX,aT,aD,aB,az,aw,aR,aU,aS,aQ,aP,aN,ar,aW,aE,aC,aA,ay,av,aq,aV;aJ.scope=new J(aJ.scope,this.body,this);aJ.scope.shared=y(aJ,"sharedScope");aJ.indent+=B;delete aJ.bare;delete aJ.isExistentialEquals;aO=[];aH=[];aE=this.paramNames();for(aD=0,aR=aE.length;aD<aR;aD++){aY=aE[aD];if(!aJ.scope.check(aY)){aJ.scope.parameter(aY)}}aC=this.params;for(aB=0,aU=aC.length;aB<aU;aB++){aG=aC[aB];if(!aG.splat){continue}aA=this.params;for(az=0,aS=aA.length;az<aS;az++){aI=aA[az].name;if(aI["this"]){aI=aI.properties[0].name}if(aI.value){aJ.scope.add(aI.value,"var",true)}}au=new z(new O(new g((function(){var a0,a2,a1,aZ;a1=this.params;aZ=[];for(a0=0,a2=a1.length;a0<a2;a0++){aI=a1[a0];aZ.push(aI.asReference(aJ))}return aZ}).call(this))),new O(new j("arguments")));break}ay=this.params;for(aw=0,aQ=ay.length;aw<aQ;aw++){aG=ay[aw];if(aG.isComplex()){aX=aF=aG.asReference(aJ);if(aG.value){aX=new f("?",aF,aG.value)}aH.push(new z(new O(aG.name),aX,"=",{param:true}))}else{aF=aG;if(aG.value){at=new j(aF.name.value+" == null");aX=new z(new O(aG.name),aG.value,"=");aH.push(new k(at,aX))}}if(!au){aO.push(aF)}}aT=this.body.isEmpty();if(au){aH.unshift(au)}if(aH.length){(av=this.body.expressions).unshift.apply(av,aH)}for(aM=ar=0,aP=aO.length;ar<aP;aM=++ar){aI=aO[aM];aJ.scope.parameter(aO[aM]=aI.compile(aJ))}aL=[];aq=this.paramNames();for(aW=0,aN=aq.length;aW<aN;aW++){aY=aq[aW];if(v.call(aL,aY)>=0){throw SyntaxError("multiple parameters named '"+aY+"'")}aL.push(aY)}if(!(aT||this.noReturn)){this.body.makeReturn()}if(this.bound){if((aV=aJ.scope.parent.method)!=null?aV.bound:void 0){this.bound=this.context=aJ.scope.parent.method.context}else{if(!this["static"]){aJ.scope.parent.assign("_this","this")}}}aK=aJ.indent;ax="function";if(this.ctor){ax+=" "+this.name}ax+="("+aO.join(", ")+") {";if(!this.body.isEmpty()){ax+="\n"+(this.body.compileWithDeclarations(aJ))+"\n"+this.tab}ax+="}";if(this.ctor){return this.tab+ax}if(this.front||(aJ.level>=t)){return"("+ax+")"}else{return ax}};ao.prototype.paramNames=function(){var at,au,ar,aq,av;at=[];av=this.params;for(ar=0,aq=av.length;ar<aq;ar++){au=av[ar];at.push.apply(at,au.names())}return at};ao.prototype.traverseChildren=function(ar,aq){if(ar){return ao.__super__.traverseChildren.call(this,ar,aq)}};return ao})(u);exports.Param=ah=(function(ap){p(ao,ap);function ao(aq,ar,au){var at;this.name=aq;this.value=ar;this.splat=au;if(at=(aq=this.name.unwrapAll().value),v.call(F,at)>=0){throw SyntaxError('parameter name "'+aq+'" is not allowed')}}ao.prototype.children=["name","value"];ao.prototype.compile=function(aq){return this.name.compile(aq,h)};ao.prototype.asReference=function(ar){var aq;if(this.reference){return this.reference}aq=this.name;if(aq["this"]){aq=aq.properties[0].name;if(aq.value.reserved){aq=new j(ar.scope.freeVariable(aq.value))}}else{if(aq.isComplex()){aq=new j(ar.scope.freeVariable("arg"))}}aq=new O(aq);if(this.splat){aq=new ae(aq)}return this.reference=aq};ao.prototype.isComplex=function(){return this.name.isComplex()};ao.prototype.names=function(ar){var ax,av,au,at,aq,aw;if(ar==null){ar=this.name}ax=function(az){var ay;ay=az.properties[0].name.value;if(ay.reserved){return[]}else{return[ay]}};if(ar instanceof j){return[ar.value]}if(ar instanceof O){return ax(ar)}av=[];aw=ar.objects;for(at=0,aq=aw.length;at<aq;at++){au=aw[at];if(au instanceof z){av.push(au.value.unwrap().value)}else{if(au instanceof ae){av.push(au.name.unwrap().value)}else{if(au instanceof O){if(au.isArray()||au.isObject()){av.push.apply(av,this.names(au.base))}else{if(au["this"]){av.push.apply(av,ax(au))}else{av.push(au.base.value)}}}else{throw SyntaxError("illegal parameter "+(au.compile()))}}}}return av};return ao})(u);exports.Splat=ae=(function(ap){p(ao,ap);ao.prototype.children=["name"];ao.prototype.isAssignable=x;function ao(aq){this.name=aq.compile?aq:new j(aq)}ao.prototype.assigns=function(aq){return this.name.assigns(aq)};ao.prototype.compile=function(aq){if(this.index!=null){return this.compileParam(aq)}else{return this.name.compile(aq)}};ao.prototype.unwrap=function(){return this.name};ao.compileSplattedArray=function(at,ay,aB){var az,aq,ar,aw,ax,au,av,aA;ax=-1;while((au=ay[++ax])&&!(au instanceof ao)){continue}if(ax>=ay.length){return""}if(ay.length===1){ar=ay[0].compile(at,h);if(aB){return ar}return""+(I("slice"))+".call("+ar+")"}az=ay.slice(ax);for(aw=av=0,aA=az.length;av<aA;aw=++av){au=az[aw];ar=au.compile(at,h);az[aw]=au instanceof ao?""+(I("slice"))+".call("+ar+")":"["+ar+"]"}if(ax===0){return az[0]+(".concat("+(az.slice(1).join(", "))+")")}aq=(function(){var aE,aD,aF,aC;aF=ay.slice(0,ax);aC=[];for(aE=0,aD=aF.length;aE<aD;aE++){au=aF[aE];aC.push(au.compile(at,h))}return aC})();return"["+(aq.join(", "))+"].concat("+(az.join(", "))+")"};return ao})(u);exports.While=E=(function(ap){p(ao,ap);function ao(ar,aq){this.condition=(aq!=null?aq.invert:void 0)?ar.invert():ar;this.guard=aq!=null?aq.guard:void 0}ao.prototype.children=["condition","guard","body"];ao.prototype.isStatement=x;ao.prototype.makeReturn=function(aq){if(aq){return ao.__super__.makeReturn.apply(this,arguments)}else{this.returns=!this.jumps({loop:true});return this}};ao.prototype.addBody=function(aq){this.body=aq;return this};ao.prototype.jumps=function(){var at,ar,au,aq;at=this.body.expressions;if(!at.length){return false}for(au=0,aq=at.length;au<aq;au++){ar=at[au];if(ar.jumps({loop:true})){return ar}}return false};ao.prototype.compileNode=function(au){var aq,at,ar,av;au.indent+=B;av="";aq=this.body;if(aq.isEmpty()){aq=""}else{if(this.returns){aq.makeReturn(ar=au.scope.freeVariable("results"));av=""+this.tab+ar+" = [];\n"}if(this.guard){if(aq.expressions.length>1){aq.expressions.unshift(new k((new W(this.guard)).invert(),new j("continue")))}else{if(this.guard){aq=al.wrap([new k(this.guard,aq)])}}}aq="\n"+(aq.compile(au,H))+"\n"+this.tab}at=av+this.tab+("while ("+(this.condition.compile(au,V))+") {"+aq+"}");if(this.returns){at+="\n"+this.tab+"return "+ar+";"}return at};return ao})(u);exports.Op=f=(function(aq){var ar,ap;p(ao,aq);function ao(aw,av,at,au){if(aw==="in"){return new a(av,at)}if(aw==="do"){return this.generateDo(av)}if(aw==="new"){if(av instanceof af&&!av["do"]&&!av.isNew){return av.newInstance()}if(av instanceof aj&&av.bound||av["do"]){av=new W(av)}}this.operator=ar[aw]||aw;this.first=av;this.second=at;this.flip=!!au;return this}ar={"==":"===","!=":"!==",of:"in"};ap={"!==":"===","===":"!=="};ao.prototype.children=["first","second"];ao.prototype.isSimpleNumber=U;ao.prototype.isUnary=function(){return !this.second};ao.prototype.isComplex=function(){var at;return !(this.isUnary()&&((at=this.operator)==="+"||at==="-"))||this.first.isComplex()};ao.prototype.isChainable=function(){var at;return(at=this.operator)==="<"||at===">"||at===">="||at==="<="||at==="==="||at==="!=="};ao.prototype.invert=function(){var au,av,at,ax,aw;if(this.isChainable()&&this.first.isChainable()){au=true;av=this;while(av&&av.operator){au&&(au=av.operator in ap);av=av.first}if(!au){return new W(this).invert()}av=this;while(av&&av.operator){av.invert=!av.invert;av.operator=ap[av.operator];av=av.first}return this}else{if(ax=ap[this.operator]){this.operator=ax;if(this.first.unwrap() instanceof ao){this.first.invert()}return this}else{if(this.second){return new W(this).invert()}else{if(this.operator==="!"&&(at=this.first.unwrap()) instanceof ao&&((aw=at.operator)==="!"||aw==="in"||aw==="instanceof")){return at}else{return new ao("!",this)}}}}};ao.prototype.unfoldSoak=function(at){var au;return((au=this.operator)==="++"||au==="--"||au==="delete")&&o(at,this,"first")};ao.prototype.generateDo=function(ax){var aB,av,au,ay,at,az,aA,aw;ay=[];av=ax instanceof z&&(at=ax.value.unwrap()) instanceof aj?at:ax;aw=av.params||[];for(az=0,aA=aw.length;az<aA;az++){au=aw[az];if(au.value){ay.push(au.value);delete au.value}else{ay.push(au)}}aB=new af(ax,ay);aB["do"]=true;return aB};ao.prototype.compileNode=function(aw){var au,at,ax,av;at=this.isChainable()&&this.first.isChainable();if(!at){this.first.front=this.front}if(this.operator==="delete"&&aw.scope.check(this.first.unwrapAll().value)){throw SyntaxError("delete operand may not be argument or var")}if(((ax=this.operator)==="--"||ax==="++")&&(av=this.first.unwrapAll().value,v.call(F,av)>=0)){throw SyntaxError("prefix increment/decrement may not have eval or arguments operand")}if(this.isUnary()){return this.compileUnary(aw)}if(at){return this.compileChain(aw)}if(this.operator==="?"){return this.compileExistence(aw)}au=this.first.compile(aw,n)+" "+this.operator+" "+this.second.compile(aw,n);if(aw.level<=n){return au}else{return"("+au+")"}};ao.prototype.compileChain=function(aw){var au,at,av,ax;ax=this.first.second.cache(aw),this.first.second=ax[0],av=ax[1];at=this.first.compile(aw,n);au=""+at+" "+(this.invert?"&&":"||")+" "+(av.compile(aw))+" "+this.operator+" "+(this.second.compile(aw,n));return"("+au+")"};ao.prototype.compileExistence=function(av){var at,au;if(this.first.isComplex()){au=new j(av.scope.freeVariable("ref"));at=new W(new z(au,this.first))}else{at=this.first;au=at}return new k(new b(at),au,{type:"if"}).addElse(this.second).compile(av)};ao.prototype.compileUnary=function(av){var aw,au,at;if(av.level>=t){return(new W(this)).compile(av)}au=[aw=this.operator];at=aw==="+"||aw==="-";if((aw==="new"||aw==="typeof"||aw==="delete")||at&&this.first instanceof ao&&this.first.operator===aw){au.push(" ")}if((at&&this.first instanceof ao)||(aw==="new"&&this.first.isStatement(av))){this.first=new W(this.first)}au.push(this.first.compile(av,n));if(this.flip){au.reverse()}return au.join("")};ao.prototype.toString=function(at){return ao.__super__.toString.call(this,at,this.constructor.name+" "+this.operator)};return ao})(u);exports.In=a=(function(ap){p(ao,ap);function ao(aq,ar){this.object=aq;this.array=ar}ao.prototype.children=["object","array"];ao.prototype.invert=ac;ao.prototype.compileNode=function(av){var at,au,ar,aq,aw;if(this.array instanceof O&&this.array.isArray()){aw=this.array.base.objects;for(ar=0,aq=aw.length;ar<aq;ar++){au=aw[ar];if(!(au instanceof ae)){continue}at=true;break}if(!at){return this.compileOrTest(av)}}return this.compileLoopTest(av)};ao.prototype.compileOrTest=function(ar){var az,ay,ax,aA,at,aq,au,aw,av;if(this.array.base.objects.length===0){return""+(!!this.negated)}aw=this.object.cache(ar,n),aq=aw[0],at=aw[1];av=this.negated?[" !== "," && "]:[" === "," || "],az=av[0],ay=av[1];au=(function(){var aD,aC,aE,aB;aE=this.array.base.objects;aB=[];for(ax=aD=0,aC=aE.length;aD<aC;ax=++aD){aA=aE[ax];aB.push((ax?at:aq)+az+aA.compile(ar,t))}return aB}).call(this);au=au.join(ay);if(ar.level<n){return au}else{return"("+au+")"}};ao.prototype.compileLoopTest=function(au){var at,ar,aq,av;av=this.object.cache(au,h),aq=av[0],ar=av[1];at=I("indexOf")+(".call("+(this.array.compile(au,h))+", "+ar+") ")+(this.negated?"< 0":">= 0");if(aq===ar){return at}at=aq+", "+at;if(au.level<h){return at}else{return"("+at+")"}};ao.prototype.toString=function(aq){return ao.__super__.toString.call(this,aq,this.constructor.name+(this.negated?"!":""))};return ao})(u);exports.Try=aa=(function(ap){p(ao,ap);function ao(ar,aq,at,au){this.attempt=ar;this.error=aq;this.recovery=at;this.ensure=au}ao.prototype.children=["attempt","recovery","ensure"];ao.prototype.isStatement=x;ao.prototype.jumps=function(aq){var ar;return this.attempt.jumps(aq)||((ar=this.recovery)!=null?ar.jumps(aq):void 0)};ao.prototype.makeReturn=function(aq){if(this.attempt){this.attempt=this.attempt.makeReturn(aq)}if(this.recovery){this.recovery=this.recovery.makeReturn(aq)}return this};ao.prototype.compileNode=function(av){var aq,au,ar,at;av.indent+=B;ar=this.error?" ("+(this.error.compile(av))+") ":" ";at=this.attempt.compile(av,H);aq=(function(){var aw;if(this.recovery){if(aw=this.error.value,v.call(F,aw)>=0){throw SyntaxError('catch variable may not be "'+this.error.value+'"')}if(!av.scope.check(this.error.value)){av.scope.add(this.error.value,"param")}return" catch"+ar+"{\n"+(this.recovery.compile(av,H))+"\n"+this.tab+"}"}else{if(!(this.ensure||this.recovery)){return" catch (_error) {}"}}}).call(this);au=this.ensure?" finally {\n"+(this.ensure.compile(av,H))+"\n"+this.tab+"}":"";return""+this.tab+"try {\n"+at+"\n"+this.tab+"}"+(aq||"")+au};return ao})(u);exports.Throw=d=(function(ap){p(ao,ap);function ao(aq){this.expression=aq}ao.prototype.children=["expression"];ao.prototype.isStatement=x;ao.prototype.jumps=U;ao.prototype.makeReturn=G;ao.prototype.compileNode=function(aq){return this.tab+("throw "+(this.expression.compile(aq))+";")};return ao})(u);exports.Existence=b=(function(ao){p(ap,ao);function ap(aq){this.expression=aq}ap.prototype.children=["expression"];ap.prototype.invert=ac;ap.prototype.compileNode=function(au){var at,aq,ar,av;this.expression.front=this.front;ar=this.expression.compile(au,n);if(an.test(ar)&&!au.scope.check(ar)){av=this.negated?["===","||"]:["!==","&&"],at=av[0],aq=av[1];ar="typeof "+ar+" "+at+' "undefined" '+aq+" "+ar+" "+at+" null"}else{ar=""+ar+" "+(this.negated?"==":"!=")+" null"}if(au.level<=L){return ar}else{return"("+ar+")"}};return ap})(u);exports.Parens=W=(function(ap){p(ao,ap);function ao(aq){this.body=aq}ao.prototype.children=["body"];ao.prototype.unwrap=function(){return this.body};ao.prototype.isComplex=function(){return this.body.isComplex()};ao.prototype.compileNode=function(au){var aq,ar,at;at=this.body.unwrap();if(at instanceof O&&at.isAtomic()){at.front=this.front;return at.compile(au)}ar=at.compile(au,V);aq=au.level<n&&(at instanceof f||at instanceof af||(at instanceof K&&at.returns));if(aq){return ar}else{return"("+ar+")"}};return ao})(u);exports.For=K=(function(ap){p(ao,ap);function ao(aq,ar){var at;this.source=ar.source,this.guard=ar.guard,this.step=ar.step,this.name=ar.name,this.index=ar.index;this.body=al.wrap([aq]);this.own=!!ar.own;this.object=!!ar.object;if(this.object){at=[this.index,this.name],this.name=at[0],this.index=at[1]}if(this.index instanceof O){throw SyntaxError("index cannot be a pattern matching expression")}this.range=this.source instanceof O&&this.source.base instanceof ak&&!this.source.properties.length;this.pattern=this.name instanceof O;if(this.range&&this.index){throw SyntaxError("indexes do not apply to range loops")}if(this.range&&this.pattern){throw SyntaxError("cannot pattern match over range loops")}this.returns=false}ao.prototype.children=["body","source","guard","step"];ao.prototype.compileNode=function(aE){var aB,at,av,aD,az,aA,ay,aC,aJ,aI,aw,aO,aQ,aH,au,aK,aN,aL,aq,aF,ax,aG,aP,aM,ar;aB=al.wrap([this.body]);aw=(ar=A(aB.expressions))!=null?ar.jumps():void 0;if(aw&&aw instanceof D){this.returns=false}aF=this.range?this.source.base:this.source;aq=aE.scope;aQ=this.name&&this.name.compile(aE,h);ay=this.index&&this.index.compile(aE,h);if(aQ&&!this.pattern){aq.find(aQ)}if(ay){aq.find(ay)}if(this.returns){aL=aq.freeVariable("results")}aC=(this.object&&ay)||aq.freeVariable("i");aJ=(this.range&&aQ)||ay||aC;aI=aJ!==aC?""+aJ+" = ":"";if(this.step&&!this.range){aG=aq.freeVariable("step")}if(this.pattern){aQ=aC}aM="";az="";at="";aA=this.tab+B;if(this.range){av=aF.compile(X(aE,{index:aC,name:aQ,step:this.step}))}else{aP=this.source.compile(aE,h);if((aQ||this.own)&&!an.test(aP)){at=""+this.tab+(au=aq.freeVariable("ref"))+" = "+aP+";\n";aP=au}if(aQ&&!this.pattern){aH=""+aQ+" = "+aP+"["+aJ+"]"}if(!this.object){aO=aq.freeVariable("len");aD=""+aI+aC+" = 0, "+aO+" = "+aP+".length";if(this.step){aD+=", "+aG+" = "+(this.step.compile(aE,n))}ax=""+aI+(this.step?""+aC+" += "+aG:(aJ!==aC?"++"+aC:""+aC+"++"));av=""+aD+"; "+aC+" < "+aO+"; "+ax}}if(this.returns){aK=""+this.tab+aL+" = [];\n";aN="\n"+this.tab+"return "+aL+";";aB.makeReturn(aL)}if(this.guard){if(aB.expressions.length>1){aB.expressions.unshift(new k((new W(this.guard)).invert(),new j("continue")))}else{if(this.guard){aB=al.wrap([new k(this.guard,aB)])}}}if(this.pattern){aB.expressions.unshift(new z(this.name,new j(""+aP+"["+aJ+"]")))}at+=this.pluckDirectCall(aE,aB);if(aH){aM="\n"+aA+aH+";"}if(this.object){av=""+aJ+" in "+aP;if(this.own){az="\n"+aA+"if (!"+(I("hasProp"))+".call("+aP+", "+aJ+")) continue;"}}aB=aB.compile(X(aE,{indent:aA}),H);if(aB){aB="\n"+aB+"\n"}return""+at+(aK||"")+this.tab+"for ("+av+") {"+az+aM+aB+this.tab+"}"+(aN||"")};ao.prototype.pluckDirectCall=function(av,aD){var at,aC,aG,aE,aH,ay,ax,aB,aF,aA,az,aw,au,ar,aq;aC="";aA=aD.expressions;for(aH=aB=0,aF=aA.length;aB<aF;aH=++aB){aG=aA[aH];aG=aG.unwrapAll();if(!(aG instanceof af)){continue}ax=aG.variable.unwrapAll();if(!((ax instanceof aj)||(ax instanceof O&&((az=ax.base)!=null?az.unwrapAll():void 0) instanceof aj&&ax.properties.length===1&&((aw=(au=ax.properties[0].name)!=null?au.value:void 0)==="call"||aw==="apply")))){continue}aE=((ar=ax.base)!=null?ar.unwrapAll():void 0)||ax;ay=new j(av.scope.freeVariable("fn"));at=new O(ay);if(ax.base){aq=[at,ax],ax.base=aq[0],at=aq[1]}aD.expressions[aH]=new af(at,aG.args);aC+=this.tab+new z(ay,aE).compile(av,H)+";\n"}return aC};return ao})(E);exports.Switch=P=(function(ap){p(ao,ap);function ao(ar,at,aq){this.subject=ar;this.cases=at;this.otherwise=aq}ao.prototype.children=["subject","cases","otherwise"];ao.prototype.isStatement=x;ao.prototype.jumps=function(ax){var aw,ar,at,aq,ay,av,au;if(ax==null){ax={block:true}}ay=this.cases;for(at=0,aq=ay.length;at<aq;at++){av=ay[at],ar=av[0],aw=av[1];if(aw.jumps(ax)){return aw}}return(au=this.otherwise)!=null?au.jumps(ax):void 0};ao.prototype.makeReturn=function(ar){var av,at,aq,aw,au;aw=this.cases;for(at=0,aq=aw.length;at<aq;at++){av=aw[at];av[1].makeReturn(ar)}if(ar){this.otherwise||(this.otherwise=new al([new j("void 0")]))}if((au=this.otherwise)!=null){au.makeReturn(ar)}return this};ao.prototype.compileNode=function(aF){var aB,aE,aq,aD,az,ax,aG,aC,aA,av,at,aH,aI,ay,aw,au,ar;aC=aF.indent+B;aA=aF.indent=aC+B;aq=this.tab+("switch ("+(((ay=this.subject)!=null?ay.compile(aF,V):void 0)||false)+") {\n");aw=this.cases;for(aG=av=0,aH=aw.length;av<aH;aG=++av){au=aw[aG],az=au[0],aB=au[1];ar=N([az]);for(at=0,aI=ar.length;at<aI;at++){aD=ar[at];if(!this.subject){aD=aD.invert()}aq+=aC+("case "+(aD.compile(aF,V))+":\n")}if(aE=aB.compile(aF,H)){aq+=aE+"\n"}if(aG===this.cases.length-1&&!this.otherwise){break}ax=this.lastNonComment(aB.expressions);if(ax instanceof D||(ax instanceof j&&ax.jumps()&&ax.value!=="debugger")){continue}aq+=aA+"break;\n"}if(this.otherwise&&this.otherwise.expressions.length){aq+=aC+("default:\n"+(this.otherwise.compile(aF,H))+"\n")}return aq+this.tab+"}"};return ao})(u);exports.If=k=(function(ao){p(ap,ao);function ap(at,aq,ar){this.body=aq;if(ar==null){ar={}}this.condition=ar.type==="unless"?at.invert():at;this.elseBody=null;this.isChain=false;this.soak=ar.soak}ap.prototype.children=["condition","body","elseBody"];ap.prototype.bodyNode=function(){var aq;return(aq=this.body)!=null?aq.unwrap():void 0};ap.prototype.elseBodyNode=function(){var aq;return(aq=this.elseBody)!=null?aq.unwrap():void 0};ap.prototype.addElse=function(aq){if(this.isChain){this.elseBodyNode().addElse(aq)}else{this.isChain=aq instanceof ap;this.elseBody=this.ensureBlock(aq)}return this};ap.prototype.isStatement=function(aq){var ar;return(aq!=null?aq.level:void 0)===H||this.bodyNode().isStatement(aq)||((ar=this.elseBodyNode())!=null?ar.isStatement(aq):void 0)};ap.prototype.jumps=function(aq){var ar;return this.body.jumps(aq)||((ar=this.elseBody)!=null?ar.jumps(aq):void 0)};ap.prototype.compileNode=function(aq){if(this.isStatement(aq)){return this.compileStatement(aq)}else{return this.compileExpression(aq)}};ap.prototype.makeReturn=function(aq){if(aq){this.elseBody||(this.elseBody=new al([new j("void 0")]))}this.body&&(this.body=new al([this.body.makeReturn(aq)]));this.elseBody&&(this.elseBody=new al([this.elseBody.makeReturn(aq)]));return this};ap.prototype.ensureBlock=function(aq){if(aq instanceof al){return aq}else{return new al([aq])}};ap.prototype.compileStatement=function(av){var aq,aw,at,au,ar;aw=y(av,"chainChild");au=y(av,"isExistentialEquals");if(au){return new ap(this.condition.invert(),this.elseBodyNode(),{type:"if"}).compile(av)}at=this.condition.compile(av,V);av.indent+=B;aq=this.ensureBlock(this.body);ar="if ("+at+") {\n"+(aq.compile(av))+"\n"+this.tab+"}";if(!aw){ar=this.tab+ar}if(!this.elseBody){return ar}return ar+" else "+(this.isChain?(av.indent=this.tab,av.chainChild=true,this.elseBody.unwrap().compile(av,H)):"{\n"+(this.elseBody.compile(av,H))+"\n"+this.tab+"}")};ap.prototype.compileExpression=function(av){var au,aq,at,ar;ar=this.condition.compile(av,L);aq=this.bodyNode().compile(av,h);au=this.elseBodyNode()?this.elseBodyNode().compile(av,h):"void 0";at=""+ar+" ? "+aq+" : "+au;if(av.level>=L){return"("+at+")"}else{return at}};ap.prototype.unfoldSoak=function(){return this.soak&&this};return ap})(u);ai={wrap:function(aw,av,ao){var ar,at,au,aq,ap;if(aw.jumps()){return aw}au=new aj([],al.wrap([aw]));ar=[];if((aq=aw.contains(this.literalArgs))||aw.contains(this.literalThis)){ap=new j(aq?"apply":"call");ar=[new j("this")];if(aq){ar.push(new j("arguments"))}au=new O(au,[new R(ap)])}au.noReturn=ao;at=new af(au,ar);if(av){return al.wrap([at])}else{return at}},literalArgs:function(ao){return ao instanceof j&&ao.value==="arguments"&&!ao.asKey},literalThis:function(ao){return(ao instanceof j&&ao.value==="this"&&!ao.asKey)||(ao instanceof aj&&ao.bound)||(ao instanceof af&&ao.isSuper)}};o=function(ar,aq,ap){var ao;if(!(ao=aq[ap].unfoldSoak(ar))){return}aq[ap]=ao.body;ao.body=new O(aq);return ao};ab={"extends":function(){return"function(child, parent) { for (var key in parent) { if ("+(I("hasProp"))+".call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; }"},bind:function(){return"function(fn, me){ return function(){ return fn.apply(me, arguments); }; }"},indexOf:function(){return"[].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; }"},hasProp:function(){return"{}.hasOwnProperty"},slice:function(){return"[].slice"}};H=1;V=2;h=3;L=4;n=5;t=6;B="  ";S="[$A-Za-z_\\x7f-\\uffff][$\\w\\x7f-\\uffff]*";an=RegExp("^"+S+"$");M=/^[+-]?\d+$/;m=RegExp("^(?:("+S+")\\.prototype(?:\\.("+S+")|\\[(\"(?:[^\\\\\"\\r\\n]|\\\\.)*\"|'(?:[^\\\\'\\r\\n]|\\\\.)*')\\]|\\[(0x[\\da-fA-F]+|\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\]))|("+S+")$");T=/^['"]/;I=function(ao){var ap;ap="__"+ao;J.root.assign(ap,ab[ao]());return ap};q=function(ap,ao){ap=ap.replace(/\n/g,"$&"+ao);return ap.replace(/\s+$/,"")}}).call(this);