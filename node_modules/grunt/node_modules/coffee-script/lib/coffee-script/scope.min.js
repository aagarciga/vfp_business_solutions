(function(){var a,d,b,c;c=require("./helpers"),d=c.extend,b=c.last;exports.Scope=a=(function(){e.root=null;function e(f,g,h){this.parent=f;this.expressions=g;this.method=h;this.variables=[{name:"arguments",type:"arguments"}];this.positions={};if(!this.parent){e.root=this}}e.prototype.add=function(g,h,f){if(this.shared&&!f){return this.parent.add(g,h,f)}if(Object.prototype.hasOwnProperty.call(this.positions,g)){return this.variables[this.positions[g]].type=h}else{return this.positions[g]=this.variables.push({name:g,type:h})-1}};e.prototype.namedMethod=function(){if(this.method.name||!this.parent){return this.method}return this.parent.namedMethod()};e.prototype.find=function(f){if(this.check(f)){return true}this.add(f,"var");return false};e.prototype.parameter=function(f){if(this.shared&&this.parent.check(f,true)){return}return this.add(f,"param")};e.prototype.check=function(g){var f;return !!(this.type(g)||((f=this.parent)!=null?f.check(g):void 0))};e.prototype.temporary=function(g,f){if(g.length>1){return"_"+g+(f>1?f-1:"")}else{return"_"+(f+parseInt(g,36)).toString(36).replace(/\d/g,"a")}};e.prototype.type=function(i){var h,j,g,f;f=this.variables;for(j=0,g=f.length;j<g;j++){h=f[j];if(h.name===i){return h.type}}return null};e.prototype.freeVariable=function(i,g){var h,f;if(g==null){g=true}h=0;while(this.check((f=this.temporary(i,h)))){h++}if(g){this.add(f,"var",true)}return f};e.prototype.assign=function(f,g){this.add(f,{value:g,assigned:true},true);return this.hasAssignments=true};e.prototype.hasDeclarations=function(){return !!this.declaredVariables().length};e.prototype.declaredVariables=function(){var j,k,h,i,g,f;j=[];k=[];f=this.variables;for(i=0,g=f.length;i<g;i++){h=f[i];if(h.type==="var"){(h.name.charAt(0)==="_"?k:j).push(h.name)}}return j.sort().concat(k.sort())};e.prototype.assignedVariables=function(){var i,j,h,f,g;f=this.variables;g=[];for(j=0,h=f.length;j<h;j++){i=f[j];if(i.type.assigned){g.push(""+i.name+" = "+i.type.value)}}return g};return e})()}).call(this);