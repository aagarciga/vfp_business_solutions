(function(){var j,h,c,f,b,k,e,m,i,l,a,g,d;f=require("fs");l=require("path");b=require("./helpers");i=require("./optparse");j=require("./coffee-script");d={};m={};g=[];e=null;b.extend(global,{task:function(n,o,q){var p;if(!q){p=[o,q],q=p[0],o=p[1]}return d[n]={name:n,description:o,action:q}},option:function(p,n,o){return g.push([p,n,o])},invoke:function(n){if(!d[n]){k(n)}return d[n].action(m)}});exports.run=function(){var n,q,s,p,r,o;global.__originalDirname=f.realpathSync(".");process.chdir(h(__originalDirname));q=process.argv.slice(2);j.run(f.readFileSync("Cakefile").toString(),{filename:"Cakefile"});e=new i.OptionParser(g);if(!q.length){return a()}try{m=e.parse(q)}catch(t){return c(""+t)}r=m["arguments"];o=[];for(s=0,p=r.length;s<p;s++){n=r[s];o.push(invoke(n))}return o};a=function(){var q,s,p,r,o,n;r=l.relative||l.resolve;q=l.join(r(__originalDirname,process.cwd()),"Cakefile");console.log(""+q+" defines the following tasks:\n");for(p in d){n=d[p];o=20-p.length;o=o>0?Array(o+1).join(" "):"";s=n.description?"# "+n.description:"";console.log("cake "+p+o+" "+s)}if(g.length){return console.log(e.help())}};c=function(n){console.error(n+"\n");console.log('To see a list of all tasks/options, run "cake"');return process.exit(1)};k=function(n){return c("No such task: "+n)};h=function(n){var o;if(l.existsSync(l.join(n,"Cakefile"))){return n}o=l.normalize(l.join(n,".."));if(o!==n){return h(o)}throw new Error("Cakefile not found in "+(process.cwd()))}}).call(this);