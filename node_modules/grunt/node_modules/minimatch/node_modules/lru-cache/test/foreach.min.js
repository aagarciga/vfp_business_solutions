var test=require("tap").test;var LRU=require("../");test("forEach",function(d){var b=new LRU(5);for(var c=0;c<10;c++){b.set(c.toString(),c.toString(2))}var c=9;b.forEach(function(g,f,e){d.equal(e,b);d.equal(f,c.toString());d.equal(g,c.toString(2));c-=1});b.get(6);b.get(8);var a=[8,6,9,7,5];var c=0;b.forEach(function(h,g,e){var f=a[c++];d.equal(e,b);d.equal(g,f.toString());d.equal(h,f.toString(2))});d.equal(c,a.length);d.end()});test("keys() and values()",function(c){var a=new LRU(5);for(var b=0;b<10;b++){a.set(b.toString(),b.toString(2))}c.similar(a.keys(),["9","8","7","6","5"]);c.similar(a.values(),["1001","1000","111","110","101"]);a.get(6);a.get(8);c.similar(a.keys(),["8","6","9","7","5"]);c.similar(a.values(),["1000","110","1001","111","101"]);c.end()});test("all entries are iterated over",function(c){var a=new LRU(5);for(var b=0;b<10;b++){a.set(b.toString(),b.toString(2))}var b=0;a.forEach(function(f,e,d){if(b>0){d.del(e)}b+=1});c.equal(b,5);c.equal(a.keys().length,1);c.end()});test("all stale entries are removed",function(c){var a=new LRU({max:5,maxAge:-5,stale:true});for(var b=0;b<10;b++){a.set(b.toString(),b.toString(2))}var b=0;a.forEach(function(){b+=1});c.equal(b,5);c.equal(a.keys().length,0);c.end()});test("expires",function(d){var b=new LRU({max:10,maxAge:50});for(var c=0;c<10;c++){b.set(c.toString(),c.toString(2),((c%2)?25:undefined))}var c=0;var a=[8,6,4,2,0];setTimeout(function(){b.forEach(function(h,g,e){var f=a[c++];d.equal(e,b);d.equal(g,f.toString());d.equal(h,f.toString(2))});d.equal(c,a.length);setTimeout(function(){var e=0;b.forEach(function(h,g,f){e++});d.equal(0,e);d.end()},25)},26)});