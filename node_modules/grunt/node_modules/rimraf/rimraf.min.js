module.exports=rimraf;rimraf.sync=rimrafSync;var assert=require("assert");var path=require("path");var fs=require("fs");var timeout=0;exports.EMFILE_MAX=1000;exports.BUSYTRIES_MAX=3;var isWindows=(process.platform==="win32");function defaults(b){var a=["unlink","chmod","stat","rmdir","readdir"];a.forEach(function(c){b[c]=b[c]||fs[c];c=c+"Sync";b[c]=b[c]||fs[c]})}function rimraf(e,d,b){if(typeof d==="function"){b=d;d={}}assert(e);assert(d);assert(typeof b==="function");defaults(d);if(!b){throw new Error("No callback passed to rimraf()")}var a=0;rimraf_(e,d,function c(g){if(g){if(isWindows&&(g.code==="EBUSY"||g.code==="ENOTEMPTY")&&a<exports.BUSYTRIES_MAX){a++;var f=a*100;return setTimeout(function(){rimraf_(e,d,c)},f)}if(g.code==="EMFILE"&&timeout<exports.EMFILE_MAX){return setTimeout(function(){rimraf_(e,d,c)},timeout++)}if(g.code==="ENOENT"){g=null}}timeout=0;b(g)})}function rimraf_(c,b,a){assert(c);assert(b);assert(typeof a==="function");b.unlink(c,function(d){if(d){if(d.code==="ENOENT"){return a(null)}if(d.code==="EPERM"){return(isWindows)?fixWinEPERM(c,b,d,a):rmdir(c,b,d,a)}if(d.code==="EISDIR"){return rmdir(c,b,d,a)}}return a(d)})}function fixWinEPERM(c,b,d,a){assert(c);assert(b);assert(typeof a==="function");if(d){assert(d instanceof Error)}b.chmod(c,666,function(e){if(e){a(e.code==="ENOENT"?null:d)}else{b.stat(c,function(f,g){if(f){a(f.code==="ENOENT"?null:d)}else{if(g.isDirectory()){rmdir(c,b,d,a)}else{b.unlink(c,a)}}})}})}function fixWinEPERMSync(e,b,f){assert(e);assert(b);if(f){assert(f instanceof Error)}try{b.chmodSync(e,666)}catch(d){if(d.code==="ENOENT"){return}else{throw f}}try{var c=b.statSync(e)}catch(a){if(a.code==="ENOENT"){return}else{throw f}}if(c.isDirectory()){rmdirSync(e,b,f)}else{b.unlinkSync(e)}}function rmdir(d,c,b,a){assert(d);assert(c);if(b){assert(b instanceof Error)}assert(typeof a==="function");c.rmdir(d,function(e){if(e&&(e.code==="ENOTEMPTY"||e.code==="EEXIST"||e.code==="EPERM")){rmkids(d,c,a)}else{if(e&&e.code==="ENOTDIR"){a(b)}else{a(e)}}})}function rmkids(c,b,a){assert(c);assert(b);assert(typeof a==="function");b.readdir(c,function(g,d){if(g){return a(g)}var f=d.length;if(f===0){return b.rmdir(c,a)}var e;d.forEach(function(h){rimraf(path.join(c,h),b,function(i){if(e){return}if(i){return a(e=i)}if(--f===0){b.rmdir(c,a)}})})})}function rimrafSync(b,a){a=a||{};defaults(a);assert(b);assert(a);try{a.unlinkSync(b)}catch(c){if(c.code==="ENOENT"){return}if(c.code==="EPERM"){return isWindows?fixWinEPERMSync(b,a,c):rmdirSync(b,a,c)}if(c.code!=="EISDIR"){throw c}rmdirSync(b,a,c)}}function rmdirSync(c,b,a){assert(c);assert(b);if(a){assert(a instanceof Error)}try{b.rmdirSync(c)}catch(d){if(d.code==="ENOENT"){return}if(d.code==="ENOTDIR"){throw a}if(d.code==="ENOTEMPTY"||d.code==="EEXIST"||d.code==="EPERM"){rmkidsSync(c,b)}}}function rmkidsSync(b,a){assert(b);assert(a);a.readdirSync(b).forEach(function(c){rimrafSync(path.join(b,c),a)});a.rmdirSync(b,a)};