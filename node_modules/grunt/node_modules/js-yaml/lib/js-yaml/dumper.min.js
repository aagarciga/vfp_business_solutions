"use strict";var common=require("./common");var NIL=common.NIL;var YAMLException=require("./exception");var DEFAULT_SCHEMA=require("./schema/default");var SAFE_SCHEMA=require("./schema/safe");var _hasOwnProperty=Object.prototype.hasOwnProperty;var CHAR_TAB=9;var CHAR_LINE_FEED=10;var CHAR_CARRIAGE_RETURN=13;var CHAR_SPACE=32;var CHAR_EXCLAMATION=33;var CHAR_DOUBLE_QUOTE=34;var CHAR_SHARP=35;var CHAR_PERCENT=37;var CHAR_AMPERSAND=38;var CHAR_SINGLE_QUOTE=39;var CHAR_ASTERISK=42;var CHAR_COMMA=44;var CHAR_MINUS=45;var CHAR_COLON=58;var CHAR_GREATER_THAN=62;var CHAR_QUESTION=63;var CHAR_COMMERCIAL_AT=64;var CHAR_LEFT_SQUARE_BRACKET=91;var CHAR_RIGHT_SQUARE_BRACKET=93;var CHAR_GRAVE_ACCENT=96;var CHAR_LEFT_CURLY_BRACKET=123;var CHAR_VERTICAL_LINE=124;var CHAR_RIGHT_CURLY_BRACKET=125;var ESCAPE_SEQUENCES={};ESCAPE_SEQUENCES[0]="\\0";ESCAPE_SEQUENCES[7]="\\a";ESCAPE_SEQUENCES[8]="\\b";ESCAPE_SEQUENCES[9]="\\t";ESCAPE_SEQUENCES[10]="\\n";ESCAPE_SEQUENCES[11]="\\v";ESCAPE_SEQUENCES[12]="\\f";ESCAPE_SEQUENCES[13]="\\r";ESCAPE_SEQUENCES[27]="\\e";ESCAPE_SEQUENCES[34]='\\"';ESCAPE_SEQUENCES[92]="\\\\";ESCAPE_SEQUENCES[133]="\\N";ESCAPE_SEQUENCES[160]="\\_";ESCAPE_SEQUENCES[8232]="\\L";ESCAPE_SEQUENCES[8233]="\\P";function kindOf(a){var b=typeof a;if(null===a){return"null"}else{if("number"===b){return 0===a%1?"integer":"float"}else{if("object"===b&&Array.isArray(a)){return"array"}else{return b}}}}function compileStyleMap(d,a){var h,g,e,c,i,b,f;if(null===a){return{}}h={};g=Object.keys(a);for(e=0,c=g.length;e<c;e+=1){i=g[e];b=String(a[i]);if("!!"===i.slice(0,2)){i="tag:yaml.org,2002:"+i.slice(2)}f=d.compiledTypeMap[i];if(f&&f.dumper){if(_hasOwnProperty.call(f.dumper.styleAliases,b)){b=f.dumper.styleAliases[b]}}h[i]=b}return h}function encodeHex(d){var a,c,b;a=d.toString(16).toUpperCase();if(d<=255){c="x";b=2}else{if(d<=65535){c="u";b=4}else{if(d<=4294967295){c="U";b=8}else{throw new YAMLException("code point within a string may not be greater than 0xFFFFFFFF")}}}return"\\"+c+common.repeat("0",b-a.length)+a}function dump(i,a){a=a||{};var l=a.schema||DEFAULT_SCHEMA,h=Math.max(1,(a.indent||2)),o=(common.isNothing(a.flowLevel)?-1:a.flowLevel),q=compileStyleMap(l,a.styles||null),m=l.compiledImplicit,b=l.compiledExplicit,c,t,g;function r(u){return"\n"+common.repeat(" ",h*u)}function k(v){var u,x,w;for(u=0,x=m.length;u<x;u+=1){w=m[u];if(null!==w.loader&&NIL!==w.loader.resolver(v,false)){return true}}return false}function p(x){var v,w,u,y,z;g="";v=false;w=0;if(0===x.length||CHAR_SPACE===x.charCodeAt(0)||CHAR_SPACE===x.charCodeAt(x.length-1)){v=true}for(u=0,y=x.length;u<y;u+=1){z=x.charCodeAt(u);if(!v){if(CHAR_TAB===z||CHAR_LINE_FEED===z||CHAR_CARRIAGE_RETURN===z||CHAR_COMMA===z||CHAR_LEFT_SQUARE_BRACKET===z||CHAR_RIGHT_SQUARE_BRACKET===z||CHAR_LEFT_CURLY_BRACKET===z||CHAR_RIGHT_CURLY_BRACKET===z||CHAR_SHARP===z||CHAR_AMPERSAND===z||CHAR_ASTERISK===z||CHAR_EXCLAMATION===z||CHAR_VERTICAL_LINE===z||CHAR_GREATER_THAN===z||CHAR_SINGLE_QUOTE===z||CHAR_DOUBLE_QUOTE===z||CHAR_PERCENT===z||CHAR_COMMERCIAL_AT===z||CHAR_GRAVE_ACCENT===z||CHAR_QUESTION===z||CHAR_COLON===z||CHAR_MINUS===z){v=true}}if(ESCAPE_SEQUENCES[z]||!((32<=z&&z<=126)||(133===z)||(160<=z&&z<=55295)||(57344<=z&&z<=65533)||(65536<=z&&z<=1114111))){g+=x.slice(w,u);g+=ESCAPE_SEQUENCES[z]||encodeHex(z);w=u+1;v=true}}if(w<u){g+=x.slice(w,u)}if(!v&&k(g)){v=true}if(v){g='"'+g+'"'}}function n(z,w){var x="",u=t,v,y;for(v=0,y=w.length;v<y;v+=1){if(0!==v){x+=", "}d(z,w[v],false,false);x+=g}t=u;g="["+x+"]"}function s(A,w,z){var x="",u=t,v,y;for(v=0,y=w.length;v<y;v+=1){if(!z||0!==v){x+=r(A)}d(A+1,w[v],true,true);x+="- "+g}t=u;g=x}function j(u,x){var y="",w=t,A=Object.keys(x),z,v,C,B;for(z=0,v=A.length;z<v;z+=1){if(0!==z){y+=", "}C=A[z];B=x[C];d(u,C,false,false);if(g.length>1024){y+="? "}y+=g+": ";d(u,B,false,false);y+=g}t=w;g="{"+y+"}"}function e(u,x,C){var y="",w=t,B=Object.keys(x),A,v,E,D,z;for(A=0,v=B.length;A<v;A+=1){if(!C||0!==A){y+=r(u)}E=B[A];D=x[E];d(u+1,E,true,true);z=(null!==t&&"?"!==t&&g.length<=1024);if(z){y+="? "}y+=g;if(z){y+=r(u)}d(u+1,D,true,z);y+=": "+g}t=w;g=y}function f(w,u){var x,B,v,A,z,y;B=u?b:m;c=kindOf(w);for(v=0,A=B.length;v<A;v+=1){z=B[v];if((null!==z.dumper)&&(null===z.dumper.kind||c===z.dumper.kind)&&(null===z.dumper.instanceOf||w instanceof z.dumper.instanceOf)&&(null===z.dumper.predicate||z.dumper.predicate(w))){t=u?z.tag:"?";if(null!==z.dumper.representer){y=q[z.tag]||z.dumper.defaultStyle;if("function"===typeof z.dumper.representer){x=z.dumper.representer(w,y)}else{if(_hasOwnProperty.call(z.dumper.representer,y)){x=z.dumper.representer[y](w,y)}else{throw new YAMLException("!<"+z.tag+'> tag resolver accepts not "'+y+'" style')}}if(NIL!==x){c=kindOf(x);g=x}else{if(u){throw new YAMLException("cannot represent an object of !<"+z.tag+"> type")}else{continue}}}return true}}return false}function d(x,u,w,v){t=null;g=u;if(!f(u,false)){f(u,true)}if(w){w=(0>o||o>x)}if((null!==t&&"?"!==t)||(2!==h&&x>0)){v=false}if("object"===c){if(w&&(0!==Object.keys(g).length)){e(x,g,v)}else{j(x,g)}}else{if("array"===c){if(w&&(0!==g.length)){s(x,g,v)}else{n(x,g)}}else{if("string"===c){if("?"!==t){p(g)}}else{throw new YAMLException("unacceptabe kind of an object to dump ("+c+")")}}}if(null!==t&&"?"!==t){g="!<"+t+"> "+g}}d(0,i,true,true);return g+"\n"}function safeDump(a,b){return dump(a,common.extend({schema:SAFE_SCHEMA},b))}module.exports.dump=dump;module.exports.safeDump=safeDump;