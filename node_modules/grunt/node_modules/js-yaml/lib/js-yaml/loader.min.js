"use strict";var common=require("./common");var YAMLException=require("./exception");var Mark=require("./mark");var NIL=common.NIL;var SAFE_SCHEMA=require("./schema/safe");var DEFAULT_SCHEMA=require("./schema/default");var _hasOwnProperty=Object.prototype.hasOwnProperty;var KIND_STRING="string";var KIND_ARRAY="array";var KIND_OBJECT="object";var CONTEXT_FLOW_IN=1;var CONTEXT_FLOW_OUT=2;var CONTEXT_BLOCK_IN=3;var CONTEXT_BLOCK_OUT=4;var CHOMPING_CLIP=1;var CHOMPING_STRIP=2;var CHOMPING_KEEP=3;var CHAR_TAB=9;var CHAR_LINE_FEED=10;var CHAR_CARRIAGE_RETURN=13;var CHAR_SPACE=32;var CHAR_EXCLAMATION=33;var CHAR_DOUBLE_QUOTE=34;var CHAR_SHARP=35;var CHAR_PERCENT=37;var CHAR_AMPERSAND=38;var CHAR_SINGLE_QUOTE=39;var CHAR_ASTERISK=42;var CHAR_PLUS=43;var CHAR_COMMA=44;var CHAR_MINUS=45;var CHAR_DOT=46;var CHAR_SLASH=47;var CHAR_DIGIT_ZERO=48;var CHAR_DIGIT_ONE=49;var CHAR_DIGIT_NINE=57;var CHAR_COLON=58;var CHAR_LESS_THAN=60;var CHAR_GREATER_THAN=62;var CHAR_QUESTION=63;var CHAR_COMMERCIAL_AT=64;var CHAR_CAPITAL_A=65;var CHAR_CAPITAL_F=70;var CHAR_CAPITAL_L=76;var CHAR_CAPITAL_N=78;var CHAR_CAPITAL_P=80;var CHAR_CAPITAL_U=85;var CHAR_LEFT_SQUARE_BRACKET=91;var CHAR_BACKSLASH=92;var CHAR_RIGHT_SQUARE_BRACKET=93;var CHAR_UNDERSCORE=95;var CHAR_GRAVE_ACCENT=96;var CHAR_SMALL_A=97;var CHAR_SMALL_B=98;var CHAR_SMALL_E=101;var CHAR_SMALL_F=102;var CHAR_SMALL_N=110;var CHAR_SMALL_R=114;var CHAR_SMALL_T=116;var CHAR_SMALL_U=117;var CHAR_SMALL_V=118;var CHAR_SMALL_X=120;var CHAR_LEFT_CURLY_BRACKET=123;var CHAR_VERTICAL_LINE=124;var CHAR_RIGHT_CURLY_BRACKET=125;var SIMPLE_ESCAPE_SEQUENCES={};SIMPLE_ESCAPE_SEQUENCES[CHAR_DIGIT_ZERO]="\x00";SIMPLE_ESCAPE_SEQUENCES[CHAR_SMALL_A]="\x07";SIMPLE_ESCAPE_SEQUENCES[CHAR_SMALL_B]="\x08";SIMPLE_ESCAPE_SEQUENCES[CHAR_SMALL_T]="\x09";SIMPLE_ESCAPE_SEQUENCES[CHAR_TAB]="\x09";SIMPLE_ESCAPE_SEQUENCES[CHAR_SMALL_N]="\x0A";SIMPLE_ESCAPE_SEQUENCES[CHAR_SMALL_V]="\x0B";SIMPLE_ESCAPE_SEQUENCES[CHAR_SMALL_F]="\x0C";SIMPLE_ESCAPE_SEQUENCES[CHAR_SMALL_R]="\x0D";SIMPLE_ESCAPE_SEQUENCES[CHAR_SMALL_E]="\x1B";SIMPLE_ESCAPE_SEQUENCES[CHAR_SPACE]=" ";SIMPLE_ESCAPE_SEQUENCES[CHAR_DOUBLE_QUOTE]="\x22";SIMPLE_ESCAPE_SEQUENCES[CHAR_SLASH]="/";SIMPLE_ESCAPE_SEQUENCES[CHAR_BACKSLASH]="\x5C";SIMPLE_ESCAPE_SEQUENCES[CHAR_CAPITAL_N]="\x85";SIMPLE_ESCAPE_SEQUENCES[CHAR_UNDERSCORE]="\xA0";SIMPLE_ESCAPE_SEQUENCES[CHAR_CAPITAL_L]="\u2028";SIMPLE_ESCAPE_SEQUENCES[CHAR_CAPITAL_P]="\u2029";var HEXADECIMAL_ESCAPE_SEQUENCES={};HEXADECIMAL_ESCAPE_SEQUENCES[CHAR_SMALL_X]=2;HEXADECIMAL_ESCAPE_SEQUENCES[CHAR_SMALL_U]=4;HEXADECIMAL_ESCAPE_SEQUENCES[CHAR_CAPITAL_U]=8;var PATTERN_NON_PRINTABLE=/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F-\x84\x86-\x9F\uD800-\uDFFF\uFFFE\uFFFF]/;var PATTERN_NON_ASCII_LINE_BREAKS=/[\x85\u2028\u2029]/;var PATTERN_FLOW_INDICATORS=/[,\[\]\{\}]/;var PATTERN_TAG_HANDLE=/^(?:!|!!|![a-z\-]+!)$/i;var PATTERN_TAG_URI=/^(?:!|[^,\[\]\{\}])(?:%[0-9a-f]{2}|[0-9a-z\-#;\/\?:@&=\+\$,_\.!~\*'\(\)\[\]])*$/i;function loadAll(b,u,t){t=t||{};var y=t.filename||null,B=t.schema||DEFAULT_SCHEMA,q=t.resolve||true,o=t.validate||true,D=t.strict||false,w=t.legacy||false,T={},H=B.compiledImplicit,G=B.compiledTypeMap,n=b.length,F=0,i=0,Q=0,J=0,R=b.charCodeAt(F),S,x,M,v,K,h,I,p;function s(Y){return new YAMLException(Y,new Mark(y,b,F,i,(F-Q)))}function m(Y){throw s(Y)}function k(Z){var Y=s(Z);if(D){throw Y}else{console.warn(Y.toString())}}T.YAML=function e(ab,aa){var Z,Y,ac;if(null!==S){m("duplication of %YAML directive")}if(1!==aa.length){m("YAML directive accepts exactly one argument")}Z=/^([0-9]+)\.([0-9]+)$/.exec(aa[0]);if(null===Z){m("ill-formed argument of the YAML directive")}Y=parseInt(Z[1],10);ac=parseInt(Z[2],10);if(1!==Y){m("unacceptable YAML version of the document")}S=aa[0];x=(ac<2);if(1!==ac&&2!==ac){k("unsupported YAML version of the document")}};T.TAG=function N(Z,Y){var ab,aa;if(2!==Y.length){m("TAG directive accepts exactly two arguments")}ab=Y[0];aa=Y[1];if(!PATTERN_TAG_HANDLE.test(ab)){m("ill-formed tag handle (first argument) of the TAG directive")}if(_hasOwnProperty.call(M,ab)){m('there is a previously declared suffix for "'+ab+'" tag handle')}if(!PATTERN_TAG_URI.test(aa)){m("ill-formed tag prefix (second argument) of the TAG directive")}M[ab]=aa};function c(ae,Z,ad){var Y,ac,ab,aa;if(ae<Z){aa=b.slice(ae,Z);if(ad&&o){for(Y=0,ac=aa.length;Y<ac;Y+=1){ab=aa.charCodeAt(Y);if(!(9===ab||32<=ab&&ab<=1114111)){m("expected valid JSON character")}}}p+=aa}}function X(Y,ac){var ab,aa,Z,ad;if(!common.isObject(ac)){m("cannot merge mappings; the provided source object is unacceptable")}ab=Object.keys(ac);for(Z=0,ad=ab.length;Z<ad;Z+=1){aa=ab[Z];if(!_hasOwnProperty.call(Y,aa)){Y[aa]=ac[aa]}}}function W(ab,Z,ad,Y){var aa,ac;ad=String(ad);if(null===ab){ab={}}if("tag:yaml.org,2002:merge"===Z){if(Array.isArray(Y)){for(aa=0,ac=Y.length;aa<ac;aa+=1){X(ab,Y[aa])}}else{X(ab,Y)}}else{ab[ad]=Y}return ab}function E(){if(CHAR_LINE_FEED===R){F+=1}else{if(CHAR_CARRIAGE_RETURN===R){if(CHAR_LINE_FEED===b.charCodeAt(F+1)){F+=2}else{F+=1}}else{m("a line break is expected")}}i+=1;Q=F;R=b.charCodeAt(F)}function f(Z,aa){var Y=0;while(F<n){while(CHAR_SPACE===R||CHAR_TAB===R){R=b.charCodeAt(++F)}if(Z&&CHAR_SHARP===R){do{R=b.charCodeAt(++F)}while(F<n&&CHAR_LINE_FEED!==R&&CHAR_CARRIAGE_RETURN!==R)}if(CHAR_LINE_FEED===R||CHAR_CARRIAGE_RETURN===R){E();Y+=1;J=0;while(CHAR_SPACE===R){J+=1;R=b.charCodeAt(++F)}if(J<aa){k("deficient indentation")}}else{break}}return Y}function j(){var Y,Z;if(F===Q&&(CHAR_MINUS===R||CHAR_DOT===R)&&b.charCodeAt(F+1)===R&&b.charCodeAt(F+2)===R){Y=F+3;Z=b.charCodeAt(Y);if(Y>=n||CHAR_SPACE===Z||CHAR_TAB===Z||CHAR_LINE_FEED===Z||CHAR_CARRIAGE_RETURN===Z){return true}}return false}function d(Y){if(1===Y){p+=" "}else{if(Y>1){p+=common.repeat("\n",Y-1)}}}function z(ad,aj){var ac,aa,Z,af,ae,ai,ah,ab,Y=I,ag=p;if(CHAR_SPACE===R||CHAR_TAB===R||CHAR_LINE_FEED===R||CHAR_CARRIAGE_RETURN===R||CHAR_COMMA===R||CHAR_LEFT_SQUARE_BRACKET===R||CHAR_RIGHT_SQUARE_BRACKET===R||CHAR_LEFT_CURLY_BRACKET===R||CHAR_RIGHT_CURLY_BRACKET===R||CHAR_SHARP===R||CHAR_AMPERSAND===R||CHAR_ASTERISK===R||CHAR_EXCLAMATION===R||CHAR_VERTICAL_LINE===R||CHAR_GREATER_THAN===R||CHAR_SINGLE_QUOTE===R||CHAR_DOUBLE_QUOTE===R||CHAR_PERCENT===R||CHAR_COMMERCIAL_AT===R||CHAR_GRAVE_ACCENT===R){return false}if(CHAR_QUESTION===R||CHAR_MINUS===R){aa=b.charCodeAt(F+1);if(CHAR_SPACE===aa||CHAR_TAB===aa||CHAR_LINE_FEED===aa||CHAR_CARRIAGE_RETURN===aa||aj&&(CHAR_COMMA===aa||CHAR_LEFT_SQUARE_BRACKET===aa||CHAR_RIGHT_SQUARE_BRACKET===aa||CHAR_LEFT_CURLY_BRACKET===aa||CHAR_RIGHT_CURLY_BRACKET===aa)){return false}}I=KIND_STRING;p="";Z=af=F;ae=false;while(F<n){if(CHAR_COLON===R){aa=b.charCodeAt(F+1);if(CHAR_SPACE===aa||CHAR_TAB===aa||CHAR_LINE_FEED===aa||CHAR_CARRIAGE_RETURN===aa||aj&&(CHAR_COMMA===aa||CHAR_LEFT_SQUARE_BRACKET===aa||CHAR_RIGHT_SQUARE_BRACKET===aa||CHAR_LEFT_CURLY_BRACKET===aa||CHAR_RIGHT_CURLY_BRACKET===aa)){break}}else{if(CHAR_SHARP===R){ac=b.charCodeAt(F-1);if(CHAR_SPACE===ac||CHAR_TAB===ac||CHAR_LINE_FEED===ac||CHAR_CARRIAGE_RETURN===ac){break}}else{if((F===Q&&j())||aj&&(CHAR_COMMA===R||CHAR_LEFT_SQUARE_BRACKET===R||CHAR_RIGHT_SQUARE_BRACKET===R||CHAR_LEFT_CURLY_BRACKET===R||CHAR_RIGHT_CURLY_BRACKET===R)){break}else{if(CHAR_LINE_FEED===R||CHAR_CARRIAGE_RETURN===R){ai=i;ah=Q;ab=J;f(false,-1);if(J>=ad){ae=true;continue}else{F=af;i=ai;Q=ah;J=ab;R=b.charCodeAt(F);break}}}}}if(ae){c(Z,af,false);d(i-ai);Z=af=F;ae=false}if(CHAR_SPACE!==R&&CHAR_TAB!==R){af=F+1}R=b.charCodeAt(++F)}c(Z,af,false);if(p){return true}else{I=Y;p=ag;return false}}function O(aa){var Z,Y;if(CHAR_SINGLE_QUOTE!==R){return false}I=KIND_STRING;p="";R=b.charCodeAt(++F);Z=Y=F;while(F<n){if(CHAR_SINGLE_QUOTE===R){c(Z,F,true);R=b.charCodeAt(++F);if(CHAR_SINGLE_QUOTE===R){Z=Y=F;R=b.charCodeAt(++F)}else{return true}}else{if(CHAR_LINE_FEED===R||CHAR_CARRIAGE_RETURN===R){c(Z,Y,true);d(f(false,aa));Z=Y=F;R=b.charCodeAt(F)}else{if(F===Q&&j()){m("unexpected end of the document within a single quoted scalar")}else{R=b.charCodeAt(++F);Y=F}}}}m("unexpected end of the stream within a single quoted scalar")}function C(ad){var Z,Y,aa,ab,ac,ae;if(CHAR_DOUBLE_QUOTE!==R){return false}I=KIND_STRING;p="";R=b.charCodeAt(++F);Z=Y=F;while(F<n){if(CHAR_DOUBLE_QUOTE===R){c(Z,F,true);R=b.charCodeAt(++F);return true}else{if(CHAR_BACKSLASH===R){c(Z,F,true);R=b.charCodeAt(++F);if(CHAR_LINE_FEED===R||CHAR_CARRIAGE_RETURN===R){f(false,ad)}else{if(SIMPLE_ESCAPE_SEQUENCES[R]){p+=SIMPLE_ESCAPE_SEQUENCES[R];R=b.charCodeAt(++F)}else{if(HEXADECIMAL_ESCAPE_SEQUENCES[R]){aa=HEXADECIMAL_ESCAPE_SEQUENCES[R];ae=0;for(ab=1;ab<=aa;ab+=1){ac=(aa-ab)*4;R=b.charCodeAt(++F);if(CHAR_DIGIT_ZERO<=R&&R<=CHAR_DIGIT_NINE){ae|=(R-CHAR_DIGIT_ZERO)<<ac}else{if(CHAR_CAPITAL_A<=R&&R<=CHAR_CAPITAL_F){ae|=(R-CHAR_CAPITAL_A+10)<<ac}else{if(CHAR_SMALL_A<=R&&R<=CHAR_SMALL_F){ae|=(R-CHAR_SMALL_A+10)<<ac}else{m("expected hexadecimal character")}}}}p+=String.fromCharCode(ae);R=b.charCodeAt(++F)}else{m("unknown escape sequence")}}}Z=Y=F}else{if(CHAR_LINE_FEED===R||CHAR_CARRIAGE_RETURN===R){c(Z,Y,true);d(f(false,ad));Z=Y=F;R=b.charCodeAt(F)}else{if(F===Q&&j()){m("unexpected end of the document within a double quoted scalar")}else{R=b.charCodeAt(++F);Y=F}}}}}m("unexpected end of the stream within a double quoted scalar")}function r(ad){var aa=true,ai,ab=K,ae,ac,Y,ak,ah,ag,Z,af,aj;switch(R){case CHAR_LEFT_SQUARE_BRACKET:Y=CHAR_RIGHT_SQUARE_BRACKET;ag=false;ae=[];break;case CHAR_LEFT_CURLY_BRACKET:Y=CHAR_RIGHT_CURLY_BRACKET;ag=true;ae={};break;default:return false}if(null!==h){v[h]=ae}R=b.charCodeAt(++F);while(F<n){f(true,ad);if(R===Y){R=b.charCodeAt(++F);K=ab;I=ag?KIND_OBJECT:KIND_ARRAY;p=ae;return true}else{if(!aa){m("missed comma between flow collection entries")}}af=Z=aj=null;ak=ah=false;if(CHAR_QUESTION===R){ac=b.charCodeAt(F+1);if(CHAR_SPACE===ac||CHAR_TAB===ac||CHAR_LINE_FEED===ac||CHAR_CARRIAGE_RETURN===ac){ak=ah=true;F+=1;R=ac;f(true,ad)}}ai=i;V(ad,CONTEXT_FLOW_IN,false,true);af=K;Z=p;if((ah||i===ai)&&CHAR_COLON===R){ak=true;R=b.charCodeAt(++F);f(true,ad);V(ad,CONTEXT_FLOW_IN,false,true);aj=p}if(ag){W(ae,af,Z,aj)}else{if(ak){ae.push(W(null,af,Z,aj))}else{ae.push(Z)}}f(true,ad);if(CHAR_COMMA===R){aa=true;R=b.charCodeAt(++F)}else{aa=false}}m("unexpected end of the stream within a flow collection")}function a(ad){var Z,Y,ac=CHOMPING_CLIP,ab=false,ae=ad,aa=-1;switch(R){case CHAR_VERTICAL_LINE:Y=false;break;case CHAR_GREATER_THAN:Y=true;break;default:return false}I=KIND_STRING;p="";while(F<n){R=b.charCodeAt(++F);if(CHAR_PLUS===R||CHAR_MINUS===R){if(CHOMPING_CLIP===ac){ac=(CHAR_PLUS===R)?CHOMPING_KEEP:CHOMPING_STRIP}else{m("repeat of a chomping mode identifier")}}else{if(CHAR_DIGIT_ZERO<=R&&R<=CHAR_DIGIT_NINE){if(CHAR_DIGIT_ZERO===R){m("bad explicit indentation width of a block scalar; it cannot be less than one")}else{if(!ab){ae=ad+(R-CHAR_DIGIT_ONE);ab=true}else{m("repeat of an indentation width identifier")}}}else{break}}}if(CHAR_SPACE===R||CHAR_TAB===R){do{R=b.charCodeAt(++F)}while(CHAR_SPACE===R||CHAR_TAB===R);if(CHAR_SHARP===R){do{R=b.charCodeAt(++F)}while(F<n&&CHAR_LINE_FEED!==R&&CHAR_CARRIAGE_RETURN!==R)}}while(F<n){E();J=0;while((!ab||J<ae)&&(CHAR_SPACE===R)){J+=1;R=b.charCodeAt(++F)}if(!ab&&J>ae){ae=J}if(CHAR_LINE_FEED===R||CHAR_CARRIAGE_RETURN===R){aa+=1;continue}if(J<ae){if(CHOMPING_KEEP===ac){p+=common.repeat("\n",aa+1)}else{if(CHOMPING_CLIP===ac){p+="\n"}}break}ab=true;if(Y){if(CHAR_SPACE===R||CHAR_TAB===R){p+=common.repeat("\n",aa+1);aa=1}else{if(0===aa){p+=" ";aa=0}else{p+=common.repeat("\n",aa);aa=0}}}else{p+=common.repeat("\n",aa+1);aa=0}Z=F;do{R=b.charCodeAt(++F)}while(F<n&&CHAR_LINE_FEED!==R&&CHAR_CARRIAGE_RETURN!==R);c(Z,F,false)}return true}function A(ac){var ad,Y=K,aa=[],ab,Z=false;if(null!==h){v[h]=aa}while(F<n){if(CHAR_MINUS!==R){break}ab=b.charCodeAt(F+1);if(CHAR_SPACE!==ab&&CHAR_TAB!==ab&&CHAR_LINE_FEED!==ab&&CHAR_CARRIAGE_RETURN!==ab){break}Z=true;F+=1;R=ab;if(f(true,-1)){if(J<=ac){aa.push(null);continue}}ad=i;V(ac,CONTEXT_BLOCK_IN,false,true);aa.push(p);f(true,-1);if((i===ad||J>ac)&&F<n){m("bad indentation of a sequence entry")}else{if(J<ac){break}}}if(Z){K=Y;I=KIND_ARRAY;p=aa;return true}else{return false}}function U(ab){var aa,ag,af,Z=K,ac={},ad=null,Y=null,ai=null,ah=false,ae=false;if(null!==h){v[h]=ac}while(F<n){aa=b.charCodeAt(F+1);af=i;if((CHAR_QUESTION===R||CHAR_COLON===R)&&(CHAR_SPACE===aa||CHAR_TAB===aa||CHAR_LINE_FEED===aa||CHAR_CARRIAGE_RETURN===aa)){if(CHAR_QUESTION===R){if(ah){W(ac,ad,Y,null);ad=Y=ai=null}ae=true;ah=true;ag=true}else{if(ah){ah=false;ag=true}else{m("incomplete explicit mapping pair; a key node is missed")}}F+=1;R=aa}else{if(V(ab,CONTEXT_FLOW_OUT,false,true)){if(i===af){while(CHAR_SPACE===R||CHAR_TAB===R){R=b.charCodeAt(++F)}if(CHAR_COLON===R){R=b.charCodeAt(++F);if(CHAR_SPACE!==R&&CHAR_TAB!==R&&CHAR_LINE_FEED!==R&&CHAR_CARRIAGE_RETURN!==R){m("a whitespace character is expected after the key-value separator within a block mapping")}if(ah){W(ac,ad,Y,null);ad=Y=ai=null}ae=true;ah=false;ag=false;ad=K;Y=p}else{if(ae){m("can not read an implicit mapping pair; a colon is missed")}else{K=Z;return true}}}else{if(ae){m("can not read a block mapping entry; a multiline key may not be an implicit key")}else{K=Z;return true}}}else{break}}if(i===af||J>ab){if(V(ab,CONTEXT_BLOCK_OUT,true,ag)){if(ah){Y=p}else{ai=p}}if(!ah){W(ac,ad,Y,ai);ad=Y=ai=null}f(true,-1)}if(J>ab&&F<n){m("bad indentation of a mapping entry")}else{if(J<ab){break}}}if(ah){W(ac,ad,Y,null)}if(ae){K=Z;I=KIND_OBJECT;p=ac}return ae}function l(){var Y,ac=false,Z=false,ab,aa;if(CHAR_EXCLAMATION!==R){return false}if(null!==K){m("duplication of a tag property")}R=b.charCodeAt(++F);if(CHAR_LESS_THAN===R){ac=true;R=b.charCodeAt(++F)}else{if(CHAR_EXCLAMATION===R){Z=true;ab="!!";R=b.charCodeAt(++F)}else{ab="!"}}Y=F;if(ac){do{R=b.charCodeAt(++F)}while(F<n&&CHAR_GREATER_THAN!==R);if(F<n){aa=b.slice(Y,F);R=b.charCodeAt(++F)}else{m("unexpected end of the stream within a verbatim tag")}}else{while(F<n&&CHAR_SPACE!==R&&CHAR_TAB!==R&&CHAR_LINE_FEED!==R&&CHAR_CARRIAGE_RETURN!==R){if(CHAR_EXCLAMATION===R){if(!Z){ab=b.slice(Y-1,F+1);if(o&&!PATTERN_TAG_HANDLE.test(ab)){m("named tag handle cannot contain such characters")}Z=true;Y=F+1}else{m("tag suffix cannot contain exclamation marks")}}R=b.charCodeAt(++F)}aa=b.slice(Y,F);if(o&&PATTERN_FLOW_INDICATORS.test(aa)){m("tag suffix cannot contain flow indicator characters")}}if(o&&aa&&!PATTERN_TAG_URI.test(aa)){m("tag name cannot contain such characters: "+aa)}if(ac){K=aa}else{if(_hasOwnProperty.call(M,ab)){K=M[ab]+aa}else{if("!"===ab){K="!"+aa}else{if("!!"===ab){K="tag:yaml.org,2002:"+aa}else{m('undeclared tag handle "'+ab+'"')}}}}return true}function g(){var Y;if(CHAR_AMPERSAND!==R){return false}if(null!==h){m("duplication of an anchor property")}R=b.charCodeAt(++F);Y=F;while(F<n&&CHAR_SPACE!==R&&CHAR_TAB!==R&&CHAR_LINE_FEED!==R&&CHAR_CARRIAGE_RETURN!==R&&CHAR_COMMA!==R&&CHAR_LEFT_SQUARE_BRACKET!==R&&CHAR_RIGHT_SQUARE_BRACKET!==R&&CHAR_LEFT_CURLY_BRACKET!==R&&CHAR_RIGHT_CURLY_BRACKET!==R){R=b.charCodeAt(++F)}if(F===Y){m("name of an anchor node must contain at least one character")}h=b.slice(Y,F);return true}function L(){var Y,Z;if(CHAR_ASTERISK!==R){return false}R=b.charCodeAt(++F);Y=F;while(F<n&&CHAR_SPACE!==R&&CHAR_TAB!==R&&CHAR_LINE_FEED!==R&&CHAR_CARRIAGE_RETURN!==R&&CHAR_COMMA!==R&&CHAR_LEFT_SQUARE_BRACKET!==R&&CHAR_RIGHT_SQUARE_BRACKET!==R&&CHAR_LEFT_CURLY_BRACKET!==R&&CHAR_RIGHT_CURLY_BRACKET!==R){R=b.charCodeAt(++F)}if(F===Y){m("name of an alias node must contain at least one character")}Z=b.slice(Y,F);if(!v.hasOwnProperty(Z)){m('unidentified alias "'+Z+'"')}p=v[Z];f(true,-1);return true}function V(am,ag,an,al){var Y,ao,Z,ae=false,ab=true,aa=false,af,ai,ah,ak,aj,ac,ad;K=null;h=null;I=null;p=null;Y=ao=Z=CONTEXT_BLOCK_OUT===ag||CONTEXT_BLOCK_IN===ag;if(an){if(f(true,-1)){ae=true;if(J===am){ab=false}else{if(J>am){ab=true}else{return false}}}}if(ab){while(l()||g()){if(f(true,-1)){ae=true;if(J>am){ab=true;Z=Y}else{if(J===am){ab=false;Z=Y}else{return true}}}else{Z=false}}}if(Z){Z=ae||al}if(ab||CONTEXT_BLOCK_OUT===ag){if(CONTEXT_FLOW_IN===ag||CONTEXT_FLOW_OUT===ag){aj=am}else{aj=am+1}ac=F-Q;if(ab){if(Z&&(A(ac)||U(ac))||r(aj)){aa=true}else{if((ao&&a(aj))||O(aj)||C(aj)){aa=true}else{if(L()){aa=true;if(null!==K||null!==h){m("alias node should not have any properties")}}else{if(z(aj,CONTEXT_FLOW_IN===ag)){aa=true;if(null===K){K="?"}}}}if(null!==h){v[h]=p}}}else{aa=Z&&A(ac)}}if(null!==K&&"!"!==K){if("?"===K){if(q){for(af=0,ai=H.length;af<ai;af+=1){ah=H[af];ad=ah.loader.resolver(p,false);if(NIL!==ad){K=ah.tag;p=ad;break}}}}else{if(_hasOwnProperty.call(G,K)){ak=G[K].loader;if(null!==p&&ak.kind!==I){m("unacceptable node kind for !<"+K+'> tag; it should be "'+ak.kind+'", not "'+I+'"')}if(ak.resolver){ad=ak.resolver(p,true);if(NIL!==ad){p=ad}else{m("cannot resolve a node with !<"+K+"> explicit tag")}}}else{k("unknown tag !<"+K+">")}}}return null!==K||null!==h||aa}function P(){var aa=F,Z,ac,ab,Y=false;S=null;x=w;M={};v={};while(F<n){f(true,-1);if(J>0||CHAR_PERCENT!==R){break}Y=true;R=b.charCodeAt(++F);Z=F;while(F<n&&CHAR_SPACE!==R&&CHAR_TAB!==R&&CHAR_LINE_FEED!==R&&CHAR_CARRIAGE_RETURN!==R){R=b.charCodeAt(++F)}ac=b.slice(Z,F);ab=[];if(ac.length<1){m("directive name must not be less than one character in length")}while(F<n){while(CHAR_SPACE===R||CHAR_TAB===R){R=b.charCodeAt(++F)}if(CHAR_SHARP===R){do{R=b.charCodeAt(++F)}while(F<n&&CHAR_LINE_FEED!==R&&CHAR_CARRIAGE_RETURN!==R);break}if(CHAR_LINE_FEED===R||CHAR_CARRIAGE_RETURN===R){break}Z=F;while(F<n&&CHAR_SPACE!==R&&CHAR_TAB!==R&&CHAR_LINE_FEED!==R&&CHAR_CARRIAGE_RETURN!==R){R=b.charCodeAt(++F)}ab.push(b.slice(Z,F))}if(F<n){E()}if(_hasOwnProperty.call(T,ac)){T[ac](ac,ab)}else{k('unknown document directive "'+ac+'"')}}f(true,-1);if(0===J&&CHAR_MINUS===R&&CHAR_MINUS===b.charCodeAt(F+1)&&CHAR_MINUS===b.charCodeAt(F+2)){F+=3;R=b.charCodeAt(F);f(true,-1)}else{if(Y){m("directives end mark is expected")}}V(J-1,CONTEXT_BLOCK_OUT,false,true);f(true,-1);if(o&&x&&PATTERN_NON_ASCII_LINE_BREAKS.test(b.slice(aa,F))){k("non-ASCII line breaks are interpreted as content")}u(p);if(F===Q&&j()){if(CHAR_DOT===R){F+=3;R=b.charCodeAt(F);f(true,-1)}return}if(F<n){m("end of the stream or a document separator is expected")}else{return}}if(o&&PATTERN_NON_PRINTABLE.test(b)){m("the stream contains non-printable characters")}while(CHAR_SPACE===R){J+=1;R=b.charCodeAt(++F)}while(F<n){P()}}function load(b,c){var a=null,e=false;function d(f){if(!e){a=f;e=true}else{throw new YAMLException("expected a single document in the stream, but found more")}}loadAll(b,d,c);return a}function safeLoadAll(b,a,c){loadAll(b,a,common.extend({schema:SAFE_SCHEMA},c))}function safeLoad(a,b){return load(a,common.extend({schema:SAFE_SCHEMA},b))}module.exports.loadAll=loadAll;module.exports.load=load;module.exports.safeLoadAll=safeLoadAll;module.exports.safeLoad=safeLoad;