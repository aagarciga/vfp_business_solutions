"use strict";var legacyLog=require("../");var Log=legacyLog.Log;var hooker=require("hooker");function stdoutEqual(d,c,a){var b="";hooker.hook(process.stdout,"write",{pre:function(e){b+=e;return hooker.preempt()},});c();stdoutUnmute();d.equal(b,a)}function stdoutMute(){hooker.hook(process.stdout,"write",{pre:function(){return hooker.preempt()},})}function stdoutUnmute(){hooker.unhook(process.stdout,"write")}function repeat(d,e,c){var a=d;for(var b=1;b<e;b++){a+=(c||"")+d}return a}var fooBuffer=new Buffer("foo");exports["Log instance"]={setUp:function(a){this.grunt={fail:{errorcount:0}};a()},write:function(b){b.expect(4);var a=new Log();stdoutEqual(b,function(){a.write("")},"");stdoutEqual(b,function(){a.write("foo")},"foo");stdoutEqual(b,function(){a.write("%s","foo")},"foo");stdoutEqual(b,function(){a.write(fooBuffer)},"foo");b.done()},writeln:function(b){b.expect(4);var a=new Log();stdoutEqual(b,function(){a.writeln()},"\n");stdoutEqual(b,function(){a.writeln("foo")},"foo\n");stdoutEqual(b,function(){a.writeln("%s","foo")},"foo\n");stdoutEqual(b,function(){a.writeln(fooBuffer)},"foo\n");b.done()},warn:function(b){b.expect(5);var a=new Log({grunt:this.grunt});stdoutEqual(b,function(){a.warn()},"ERROR".red+"\n");stdoutEqual(b,function(){a.warn("foo")},">> ".red+"foo\n");stdoutEqual(b,function(){a.warn("%s","foo")},">> ".red+"foo\n");stdoutEqual(b,function(){a.warn(fooBuffer)},">> ".red+"foo\n");b.equal(this.grunt.fail.errorcount,0);b.done()},error:function(b){b.expect(5);var a=new Log({grunt:this.grunt});stdoutEqual(b,function(){a.error()},"ERROR".red+"\n");stdoutEqual(b,function(){a.error("foo")},">> ".red+"foo\n");stdoutEqual(b,function(){a.error("%s","foo")},">> ".red+"foo\n");stdoutEqual(b,function(){a.error(fooBuffer)},">> ".red+"foo\n");b.equal(this.grunt.fail.errorcount,4);b.done()},ok:function(b){b.expect(4);var a=new Log({grunt:this.grunt});stdoutEqual(b,function(){a.ok()},"OK".green+"\n");stdoutEqual(b,function(){a.ok("foo")},">> ".green+"foo\n");stdoutEqual(b,function(){a.ok("%s","foo")},">> ".green+"foo\n");stdoutEqual(b,function(){a.ok(fooBuffer)},">> ".green+"foo\n");b.done()},errorlns:function(b){b.expect(2);var a=new Log({grunt:this.grunt});stdoutEqual(b,function(){a.errorlns(repeat("foo",30," "))},">> ".red+repeat("foo",19," ")+"\n>> ".red+repeat("foo",11," ")+"\n");b.equal(this.grunt.fail.errorcount,1);b.done()},oklns:function(b){b.expect(1);var a=new Log();stdoutEqual(b,function(){a.oklns(repeat("foo",30," "))},">> ".green+repeat("foo",19," ")+"\n>> ".green+repeat("foo",11," ")+"\n");b.done()},success:function(b){b.expect(4);var a=new Log();stdoutEqual(b,function(){a.success()},"".green+"\n");stdoutEqual(b,function(){a.success("foo")},"foo".green+"\n");stdoutEqual(b,function(){a.success("%s","foo")},"foo".green+"\n");stdoutEqual(b,function(){a.success(fooBuffer)},"foo".green+"\n");b.done()},fail:function(b){b.expect(4);var a=new Log();stdoutEqual(b,function(){a.fail()},"".red+"\n");stdoutEqual(b,function(){a.fail("foo")},"foo".red+"\n");stdoutEqual(b,function(){a.fail("%s","foo")},"foo".red+"\n");stdoutEqual(b,function(){a.fail(fooBuffer)},"foo".red+"\n");b.done()},header:function(b){b.expect(5);var a=new Log();stdoutEqual(b,function(){a.header()},"".underline+"\n");stdoutEqual(b,function(){a.header()},"\n"+"".underline+"\n");stdoutEqual(b,function(){a.header("foo")},"\n"+"foo".underline+"\n");stdoutEqual(b,function(){a.header("%s","foo")},"\n"+"foo".underline+"\n");stdoutEqual(b,function(){a.header(fooBuffer)},"\n"+"foo".underline+"\n");b.done()},subhead:function(b){b.expect(5);var a=new Log();stdoutEqual(b,function(){a.subhead()},"".bold+"\n");stdoutEqual(b,function(){a.subhead()},"\n"+"".bold+"\n");stdoutEqual(b,function(){a.subhead("foo")},"\n"+"foo".bold+"\n");stdoutEqual(b,function(){a.subhead("%s","foo")},"\n"+"foo".bold+"\n");stdoutEqual(b,function(){a.subhead(fooBuffer)},"\n"+"foo".bold+"\n");b.done()},writetableln:function(b){b.expect(1);var a=new Log();stdoutEqual(b,function(){a.writetableln([10],[repeat("foo",10)])},"foofoofoof\noofoofoofo\nofoofoofoo\n");b.done()},writelns:function(b){b.expect(1);var a=new Log();stdoutEqual(b,function(){a.writelns(repeat("foo",30," "))},repeat("foo",20," ")+"\n"+repeat("foo",10," ")+"\n");b.done()},writeflags:function(b){b.expect(3);var a=new Log();stdoutEqual(b,function(){a.writeflags(["a","b"])},"Flags: "+"a".cyan+", "+"b".cyan+"\n");stdoutEqual(b,function(){a.writeflags(["a","b"],"Prefix")},"Prefix: "+"a".cyan+", "+"b".cyan+"\n");stdoutEqual(b,function(){a.writeflags({a:true,b:false,c:0,d:null},"Prefix")},"Prefix: "+"a".cyan+", "+"b=false".cyan+", "+"c=0".cyan+", "+"d=null".cyan+"\n");b.done()},always:function(b){b.expect(3);var a=new Log();b.strictEqual(a.always,a);b.strictEqual(a.verbose.always,a);b.strictEqual(a.notverbose.always,a);b.done()},or:function(b){b.expect(2);var a=new Log();b.strictEqual(a.verbose.or,a.notverbose);b.strictEqual(a.notverbose.or,a.verbose);b.done()},hasLogged:function(b){b.expect(24);var a=new Log();b.equal(a.hasLogged,false);b.equal(a.verbose.hasLogged,false);b.equal(a.notverbose.hasLogged,false);a.write("");b.equal(a.hasLogged,true);b.equal(a.verbose.hasLogged,true);b.equal(a.notverbose.hasLogged,true);a=new Log({verbose:true});a.verbose.write("");b.equal(a.hasLogged,true);b.equal(a.verbose.hasLogged,true);b.equal(a.notverbose.hasLogged,true);a=new Log();a.notverbose.write("");b.equal(a.hasLogged,true);b.equal(a.verbose.hasLogged,true);b.equal(a.notverbose.hasLogged,true);stdoutMute();a=new Log({debug:true});a.debug("");b.equal(a.hasLogged,true);b.equal(a.verbose.hasLogged,true);b.equal(a.notverbose.hasLogged,true);stdoutUnmute();a=new Log();a.verbose.write("");b.equal(a.hasLogged,false);b.equal(a.verbose.hasLogged,false);b.equal(a.notverbose.hasLogged,false);a=new Log({verbose:true});a.notverbose.write("");b.equal(a.hasLogged,false);b.equal(a.verbose.hasLogged,false);b.equal(a.notverbose.hasLogged,false);a=new Log();a.debug("");b.equal(a.hasLogged,false);b.equal(a.verbose.hasLogged,false);b.equal(a.notverbose.hasLogged,false);b.done()},muted:function(b){b.expect(30);var a=new Log();b.equal(a.muted,false);b.equal(a.verbose.muted,false);b.equal(a.notverbose.muted,false);b.equal(a.options.muted,false);b.equal(a.verbose.options.muted,false);b.equal(a.notverbose.options.muted,false);a.muted=true;b.equal(a.muted,true);b.equal(a.verbose.muted,true);b.equal(a.notverbose.muted,true);b.equal(a.options.muted,true);b.equal(a.verbose.options.muted,true);b.equal(a.notverbose.options.muted,true);a.muted=false;b.equal(a.muted,false);b.equal(a.verbose.muted,false);b.equal(a.notverbose.muted,false);b.equal(a.options.muted,false);b.equal(a.verbose.options.muted,false);b.equal(a.notverbose.options.muted,false);a.options.muted=true;b.equal(a.muted,true);b.equal(a.verbose.muted,true);b.equal(a.notverbose.muted,true);b.equal(a.options.muted,true);b.equal(a.verbose.options.muted,true);b.equal(a.notverbose.options.muted,true);a.options.muted=false;b.equal(a.muted,false);b.equal(a.verbose.muted,false);b.equal(a.notverbose.muted,false);b.equal(a.options.muted,false);b.equal(a.verbose.options.muted,false);b.equal(a.notverbose.options.muted,false);b.done()},verbose:function(b){b.expect(15);var a=new Log();a.muted=true;b.strictEqual(a.verbose.write(""),a.verbose);b.strictEqual(a.verbose.writeln(""),a.verbose);b.strictEqual(a.verbose.warn(""),a.verbose);b.strictEqual(a.verbose.error(""),a.verbose);b.strictEqual(a.verbose.ok(""),a.verbose);b.strictEqual(a.verbose.errorlns(""),a.verbose);b.strictEqual(a.verbose.oklns(""),a.verbose);b.strictEqual(a.verbose.success(""),a.verbose);b.strictEqual(a.verbose.fail(""),a.verbose);b.strictEqual(a.verbose.header(""),a.verbose);b.strictEqual(a.verbose.subhead(""),a.verbose);b.strictEqual(a.verbose.debug(""),a.verbose);b.strictEqual(a.verbose.writetableln([]),a.verbose);b.strictEqual(a.verbose.writelns(""),a.verbose);b.strictEqual(a.verbose.writeflags([]),a.verbose);b.done()},notverbose:function(b){b.expect(15);var a=new Log();a.muted=true;b.strictEqual(a.notverbose.write(""),a.notverbose);b.strictEqual(a.notverbose.writeln(""),a.notverbose);b.strictEqual(a.notverbose.warn(""),a.notverbose);b.strictEqual(a.notverbose.error(""),a.notverbose);b.strictEqual(a.notverbose.ok(""),a.notverbose);b.strictEqual(a.notverbose.errorlns(""),a.notverbose);b.strictEqual(a.notverbose.oklns(""),a.notverbose);b.strictEqual(a.notverbose.success(""),a.notverbose);b.strictEqual(a.notverbose.fail(""),a.notverbose);b.strictEqual(a.notverbose.header(""),a.notverbose);b.strictEqual(a.notverbose.subhead(""),a.notverbose);b.strictEqual(a.notverbose.debug(""),a.notverbose);b.strictEqual(a.notverbose.writetableln([]),a.notverbose);b.strictEqual(a.notverbose.writelns(""),a.notverbose);b.strictEqual(a.notverbose.writeflags([]),a.notverbose);b.done()},"options.debug = true":function(b){b.expect(4);var a=new Log({debug:true});stdoutEqual(b,function(){a.debug()},"[D] "+"".magenta+"\n");stdoutEqual(b,function(){a.debug("foo")},"[D] "+"foo".magenta+"\n");stdoutEqual(b,function(){a.debug("%s","foo")},"[D] "+"foo".magenta+"\n");stdoutEqual(b,function(){a.debug(fooBuffer)},"[D] "+"foo".magenta+"\n");b.done()},"options.verbose = false":function(b){b.expect(7);var a=new Log({verbose:false});stdoutEqual(b,function(){a.notverbose.write("foo")},"foo");stdoutEqual(b,function(){a.notverbose.write("%s","foo")},"foo");stdoutEqual(b,function(){a.notverbose.write(fooBuffer)},"foo");stdoutEqual(b,function(){a.verbose.write("foo")},"");stdoutEqual(b,function(){a.verbose.write("%s","foo")},"");stdoutEqual(b,function(){a.verbose.write(fooBuffer)},"");stdoutEqual(b,function(){a.verbose.write("a").or.write("b")},"b");b.done()},"options.verbose = true":function(b){b.expect(7);var a=new Log({verbose:true});stdoutEqual(b,function(){a.verbose.write("foo")},"foo");stdoutEqual(b,function(){a.verbose.write("%s","foo")},"foo");stdoutEqual(b,function(){a.verbose.write(fooBuffer)},"foo");stdoutEqual(b,function(){a.notverbose.write("foo")},"");stdoutEqual(b,function(){a.notverbose.write("%s","foo")},"");stdoutEqual(b,function(){a.notverbose.write(fooBuffer)},"");stdoutEqual(b,function(){a.notverbose.write("a").or.write("b")},"b");b.done()},"options.debug = false":function(b){b.expect(1);var a=new Log({debug:false});stdoutEqual(b,function(){a.debug("foo")},"");b.done()},"options.color = true":function(b){b.expect(1);var a=new Log({color:true});stdoutEqual(b,function(){a.write("foo".blue+"bar".underline)},"foo".blue+"bar".underline);b.done()},"options.color = false":function(b){b.expect(1);var a=new Log({color:false});stdoutEqual(b,function(){a.write("foo".blue+"bar".underline)},"foobar");b.done()},"perma-bind this when passing grunt in (backcompat)":function(b){b.expect(43);var a=new Log({grunt:this.grunt});stdoutMute();["write","writeln","warn","error","ok","errorlns","oklns","success","fail","header","subhead","debug",].forEach(function(f){var d=a[f];var e=a.verbose[f];var c=a.notverbose[f];b.equal(d(),a,"Should return log if invoked in a way where this is not log.");b.equal(e(),a.verbose,"Should return log.verbose if invoked in a way where this is not log.");b.equal(c(),a.notverbose,"Should return log.notverbose if invoked in a way where this is not log.")});b.doesNotThrow(function(){var c=a.writetableln;c([])},"Should not throw if invoked in a way where this is not log.");b.doesNotThrow(function(){var c=a.writelns;c([])},"Should not throw if invoked in a way where this is not log.");b.doesNotThrow(function(){var c=a.writeflags;c([])},"Should not throw if invoked in a way where this is not log.");b.doesNotThrow(function(){var c=a.wordlist;c([])},"Should not throw if invoked in a way where this is not log.");b.doesNotThrow(function(){var c=a.uncolor;c("")},"Should not throw if invoked in a way where this is not log.");b.doesNotThrow(function(){var c=a.wraptext;c(1,"")},"Should not throw if invoked in a way where this is not log.");b.doesNotThrow(function(){var c=a.table;c([],"")},"Should not throw if invoked in a way where this is not log.");stdoutUnmute();b.done()},};exports.Helpers={uncolor:function(b){b.expect(2);var a=new Log();b.ok(a.uncolor);b.strictEqual(a.uncolor,legacyLog.uncolor);b.done()},wordlist:function(b){b.expect(2);var a=new Log();b.ok(a.wordlist);b.strictEqual(a.wordlist,legacyLog.wordlist);b.done()},wraptext:function(b){b.expect(2);var a=new Log();b.ok(a.wraptext);b.strictEqual(a.wraptext,legacyLog.wraptext);b.done()},table:function(b){b.expect(2);var a=new Log();b.ok(a.table);b.strictEqual(a.table,legacyLog.table);b.done()},};