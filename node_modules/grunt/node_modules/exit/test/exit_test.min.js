"use strict";var fs=require("fs");var exec=require("child_process").exec;var _which=require("which").sync;function which(b){try{_which(b);return b}catch(a){return false}}var grep=which("grep")||process.platform==="win32"&&which("find");exports.exit={setUp:function(a){this.origCwd=process.cwd();process.chdir("test/fixtures");a()},tearDown:function(a){process.chdir(this.origCwd);a()},grep:function(a){a.expect(1);a.ok(grep,'A suitable "grep" or "find" program was not found in the PATH.');a.done()},};function normalizeLineEndings(a){return a.replace(/\r?\n/g,"\n")}function run(a,b){exec(a,function(d,c){b(d?d.code:0,normalizeLineEndings(c))})}function fixture(a){return normalizeLineEndings(String(fs.readFileSync(a)))}function buildTests(){var b=[10,100,1000];var d=[" stdout stderr"," stdout"," stderr"];var c=[""," | "+grep+' "std"'];b.forEach(function(e){d.forEach(function(f){c.forEach(function(g){var h="node log.js 0 "+e+f+" 2>&1"+g;exports.exit["output ("+h+")"]=function(i){i.expect(2);run(h,function(k,l){var j=fixture(e+f.replace(/ /g,"-")+".txt");i.equal(l.length,j.length,"should be the same length.");i.ok(l.indexOf("fail")===-1,"should not output after exit is called.");i.done()})}})})});var a=[0,1,123];a.forEach(function(e){var f="node log.js "+e+" 10 stdout stderr";exports.exit["exit code ("+f+")"]=function(g){g.expect(1);run(f,function(h){g.equal(h,e,"should exit with "+e+" error code.");g.done()})}})}if(grep){buildTests()};