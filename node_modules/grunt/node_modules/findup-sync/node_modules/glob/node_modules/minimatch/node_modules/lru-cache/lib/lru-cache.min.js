(function(){if(typeof module==="object"&&module.exports){module.exports=g}else{this.LRUCache=g}function h(l,k){return Object.prototype.hasOwnProperty.call(l,k)}function d(){return 1}function g(k){if(!(this instanceof g)){return new g(k)}if(typeof k==="number"){k={max:k}}if(!k){k={}}this._max=k.max;if(!this._max||!(typeof this._max==="number")||this._max<=0){this._max=Infinity}this._lengthCalculator=k.length||d;if(typeof this._lengthCalculator!=="function"){this._lengthCalculator=d}this._allowStale=k.stale||false;this._maxAge=k.maxAge||null;this._dispose=k.dispose;this.reset()}Object.defineProperty(g.prototype,"max",{set:function(k){if(!k||!(typeof k==="number")||k<=0){k=Infinity}this._max=k;if(this._length>this._max){c(this)}},get:function(){return this._max},enumerable:true});Object.defineProperty(g.prototype,"lengthCalculator",{set:function(l){if(typeof l!=="function"){this._lengthCalculator=d;this._length=this._itemCount;for(var k in this._cache){this._cache[k].length=1}}else{this._lengthCalculator=l;this._length=0;for(var k in this._cache){this._cache[k].length=this._lengthCalculator(this._cache[k].value);this._length+=this._cache[k].length}}if(this._length>this._max){c(this)}},get:function(){return this._lengthCalculator},enumerable:true});Object.defineProperty(g.prototype,"length",{get:function(){return this._length},enumerable:true});Object.defineProperty(g.prototype,"itemCount",{get:function(){return this._itemCount},enumerable:true});g.prototype.forEach=function(o,n){n=n||this;var m=0;var q=this._itemCount;for(var l=this._mru-1;l>=0&&m<q;l--){if(this._lruList[l]){m++;var p=this._lruList[l];if(i(this,p)){j(this,p);if(!this._allowStale){p=undefined}}if(p){o.call(n,p.value,p.key,this)}}}};g.prototype.keys=function(){var n=new Array(this._itemCount);var m=0;for(var l=this._mru-1;l>=0&&m<this._itemCount;l--){if(this._lruList[l]){var o=this._lruList[l];n[m++]=o.key}}return n};g.prototype.values=function(){var m=new Array(this._itemCount);var n=0;for(var l=this._mru-1;l>=0&&n<this._itemCount;l--){if(this._lruList[l]){var o=this._lruList[l];m[n++]=o.value}}return m};g.prototype.reset=function(){if(this._dispose&&this._cache){for(var l in this._cache){this._dispose(l,this._cache[l].value)}}this._cache=Object.create(null);this._lruList=Object.create(null);this._mru=0;this._lru=0;this._length=0;this._itemCount=0};g.prototype.dump=function(){return this._cache};g.prototype.dumpLru=function(){return this._lruList};g.prototype.set=function(n,p,m){m=m||this._maxAge;var l=m?Date.now():0;if(h(this._cache,n)){if(this._dispose){this._dispose(n,this._cache[n].value)}this._cache[n].now=l;this._cache[n].maxAge=m;this._cache[n].value=p;this.get(n);return true}var k=this._lengthCalculator(p);var o=new f(n,p,this._mru++,k,l,m);if(o.length>this._max){if(this._dispose){this._dispose(n,p)}return false}this._length+=o.length;this._lruList[o.lu]=this._cache[n]=o;this._itemCount++;if(this._length>this._max){c(this)}return true};g.prototype.has=function(k){if(!h(this._cache,k)){return false}var l=this._cache[k];if(i(this,l)){return false}return true};g.prototype.get=function(k){return b(this,k,true)};g.prototype.peek=function(k){return b(this,k,false)};g.prototype.pop=function(){var k=this._lruList[this._lru];j(this,k);return k||null};g.prototype.del=function(k){j(this,this._cache[k])};function b(l,m,k){var n=l._cache[m];if(n){if(i(l,n)){j(l,n);if(!l._allowStale){n=undefined}}else{if(k){a(l,n)}}if(n){n=n.value}}return n}function i(l,m){if(!m||(!m.maxAge&&!l._maxAge)){return false}var k=false;var n=Date.now()-m.now;if(m.maxAge){k=n>m.maxAge}else{k=l._maxAge&&(n>l._maxAge)}return k}function a(k,l){e(k,l);l.lu=k._mru++;k._lruList[l.lu]=l}function c(k){while(k._lru<k._mru&&k._length>k._max){j(k,k._lruList[k._lru])}}function e(k,l){delete k._lruList[l.lu];while(k._lru<k._mru&&!k._lruList[k._lru]){k._lru++}}function j(k,l){if(l){if(k._dispose){k._dispose(l.key,l.value)}k._length-=l.length;k._itemCount--;delete k._cache[l.key];e(k,l)}}function f(m,o,p,n,l,k){this.key=m;this.value=o;this.lu=p;this.length=n;this.now=l;if(k){this.maxAge=k}}})();