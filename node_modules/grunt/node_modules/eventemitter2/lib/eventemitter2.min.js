/*!
 * EventEmitter2
 * https://github.com/hij1nx/EventEmitter2
 *
 * Copyright (c) 2013 hij1nx
 * Licensed under the MIT license.
 */
!function(b){var d=Array.isArray?Array.isArray:function g(j){return Object.prototype.toString.call(j)==="[object Array]"};var e=10;function h(){this._events={};if(this._conf){a.call(this,this._conf)}}function a(j){if(j){this._conf=j;j.delimiter&&(this.delimiter=j.delimiter);j.maxListeners&&(this._events.maxListeners=j.maxListeners);j.wildcard&&(this.wildcard=j.wildcard);j.newListener&&(this.newListener=j.newListener);if(this.wildcard){this.listenerTree={}}}}function i(j){this._events={};this.newListener=false;a.call(this,j)}function c(k,s,x,m){if(!x){return[]}var t=[],p,o,v,w,r,q,l,j=s.length,n=s[m],u=s[m+1];if(m===j&&x._listeners){if(typeof x._listeners==="function"){k&&k.push(x._listeners);return[x]}else{for(p=0,o=x._listeners.length;p<o;p++){k&&k.push(x._listeners[p])}return[x]}}if((n==="*"||n==="**")||x[n]){if(n==="*"){for(v in x){if(v!=="_listeners"&&x.hasOwnProperty(v)){t=t.concat(c(k,s,x[v],m+1))}}return t}else{if(n==="**"){l=(m+1===j||(m+2===j&&u==="*"));if(l&&x._listeners){t=t.concat(c(k,s,x,j))}for(v in x){if(v!=="_listeners"&&x.hasOwnProperty(v)){if(v==="*"||v==="**"){if(x[v]._listeners&&!l){t=t.concat(c(k,s,x[v],j))}t=t.concat(c(k,s,x[v],m))}else{if(v===u){t=t.concat(c(k,s,x[v],m+2))}else{t=t.concat(c(k,s,x[v],m))}}}}return t}}t=t.concat(c(k,s,x[n],m+1))}w=x["*"];if(w){c(k,s,w,m+1)}r=x["**"];if(r){if(m<j){if(r._listeners){c(k,s,r,j)}for(v in r){if(v!=="_listeners"&&r.hasOwnProperty(v)){if(v===u){c(k,s,r[v],m+2)}else{if(v===n){c(k,s,r[v],m+1)}else{q={};q[v]=r[v];c(k,s,{"**":q},m+1)}}}}}else{if(r._listeners){c(k,s,r,j)}else{if(r["*"]&&r["*"]._listeners){c(k,s,r["*"],j)}}}}return t}function f(p,q){p=typeof p==="string"?p.split(this.delimiter):p.slice();for(var o=0,l=p.length;o+1<l;o++){if(p[o]==="**"&&p[o+1]==="**"){return}}var k=this.listenerTree;var n=p.shift();while(n){if(!k[n]){k[n]={}}k=k[n];if(p.length===0){if(!k._listeners){k._listeners=q}else{if(typeof k._listeners==="function"){k._listeners=[k._listeners,q]}else{if(d(k._listeners)){k._listeners.push(q);if(!k._listeners.warned){var j=e;if(typeof this._events.maxListeners!=="undefined"){j=this._events.maxListeners}if(j>0&&k._listeners.length>j){k._listeners.warned=true;console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",k._listeners.length);console.trace()}}}}}return true}n=p.shift()}return true}i.prototype.delimiter=".";i.prototype.setMaxListeners=function(j){this._events||h.call(this);this._events.maxListeners=j;if(!this._conf){this._conf={}}this._conf.maxListeners=j};i.prototype.event="";i.prototype.once=function(k,j){this.many(k,1,j);return this};i.prototype.many=function(m,j,l){var k=this;if(typeof l!=="function"){throw new Error("many only accepts instances of Function")}function n(){if(--j===0){k.off(m,n)}l.apply(this,arguments)}n._origin=l;this.on(m,n);return k};i.prototype.emit=function(){this._events||h.call(this);var q=arguments[0];if(q==="newListener"&&!this.newListener){if(!this._events.newListener){return false}}if(this._all){var j=arguments.length;var k=new Array(j-1);for(var m=1;m<j;m++){k[m-1]=arguments[m]}for(m=0,j=this._all.length;m<j;m++){this.event=q;this._all[m].apply(this,k)}}if(q==="error"){if(!this._all&&!this._events.error&&!(this.wildcard&&this.listenerTree.error)){if(arguments[1] instanceof Error){throw arguments[1]}else{throw new Error("Uncaught, unspecified 'error' event.")}return false}}var p;if(this.wildcard){p=[];var o=typeof q==="string"?q.split(this.delimiter):q.slice();c.call(this,p,o,this.listenerTree,0)}else{p=this._events[q]}if(typeof p==="function"){this.event=q;if(arguments.length===1){p.call(this)}else{if(arguments.length>1){switch(arguments.length){case 2:p.call(this,arguments[1]);break;case 3:p.call(this,arguments[1],arguments[2]);break;default:var j=arguments.length;var k=new Array(j-1);for(var m=1;m<j;m++){k[m-1]=arguments[m]}p.apply(this,k)}}}return true}else{if(p){var j=arguments.length;var k=new Array(j-1);for(var m=1;m<j;m++){k[m-1]=arguments[m]}var n=p.slice();for(var m=0,j=n.length;m<j;m++){this.event=q;n[m].apply(this,k)}return(n.length>0)||!!this._all}else{return !!this._all}}};i.prototype.on=function(k,l){if(typeof k==="function"){this.onAny(k);return this}if(typeof l!=="function"){throw new Error("on only accepts instances of Function")}this._events||h.call(this);this.emit("newListener",k,l);if(this.wildcard){f.call(this,k,l);return this}if(!this._events[k]){this._events[k]=l}else{if(typeof this._events[k]==="function"){this._events[k]=[this._events[k],l]}else{if(d(this._events[k])){this._events[k].push(l);if(!this._events[k].warned){var j=e;if(typeof this._events.maxListeners!=="undefined"){j=this._events.maxListeners}if(j>0&&this._events[k].length>j){this._events[k].warned=true;console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[k].length);console.trace()}}}}}return this};i.prototype.onAny=function(j){if(typeof j!=="function"){throw new Error("onAny only accepts instances of Function")}if(!this._all){this._all=[]}this._all.push(j);return this};i.prototype.addListener=i.prototype.on;i.prototype.off=function(p,k){if(typeof k!=="function"){throw new Error("removeListener only takes instances of Function")}var l,s=[];if(this.wildcard){var q=typeof p==="string"?p.split(this.delimiter):p.slice();s=c.call(this,null,q,this.listenerTree,0)}else{if(!this._events[p]){return this}l=this._events[p];s.push({_listeners:l})}for(var r=0;r<s.length;r++){var o=s[r];l=o._listeners;if(d(l)){var n=-1;for(var m=0,j=l.length;m<j;m++){if(l[m]===k||(l[m].listener&&l[m].listener===k)||(l[m]._origin&&l[m]._origin===k)){n=m;break}}if(n<0){continue}if(this.wildcard){o._listeners.splice(n,1)}else{this._events[p].splice(n,1)}if(l.length===0){if(this.wildcard){delete o._listeners}else{delete this._events[p]}}return this}else{if(l===k||(l.listener&&l.listener===k)||(l._origin&&l._origin===k)){if(this.wildcard){delete o._listeners}else{delete this._events[p]}}}}return this};i.prototype.offAny=function(n){var m=0,j=0,k;if(n&&this._all&&this._all.length>0){k=this._all;for(m=0,j=k.length;m<j;m++){if(n===k[m]){k.splice(m,1);return this}}}else{this._all=[]}return this};i.prototype.removeListener=i.prototype.off;i.prototype.removeAllListeners=function(n){if(arguments.length===0){!this._events||h.call(this);return this}if(this.wildcard){var m=typeof n==="string"?n.split(this.delimiter):n.slice();var l=c.call(this,null,m,this.listenerTree,0);for(var k=0;k<l.length;k++){var j=l[k];j._listeners=null}}else{if(!this._events[n]){return this}this._events[n]=null}return this};i.prototype.listeners=function(l){if(this.wildcard){var j=[];var k=typeof l==="string"?l.split(this.delimiter):l.slice();c.call(this,j,k,this.listenerTree,0);return j}this._events||h.call(this);if(!this._events[l]){this._events[l]=[]}if(!d(this._events[l])){this._events[l]=[this._events[l]]}return this._events[l]};i.prototype.listenersAny=function(){if(this._all){return this._all}else{return[]}};if(typeof define==="function"&&define.amd){define(function(){return i})}else{if(typeof exports==="object"){exports.EventEmitter2=i}else{window.EventEmitter2=i}}}();