(function(){var e,c,f,b,g,a,d;d=window;e=d.jQuery;c=d.App;a=d.dandelion;b=a.namespace("App.InventoryDashboard",d);f=c.InventoryDashboard.DynamicFilter;g=c.InventoryDashboard.ProjectFiles;b.status={};b.status.itemsPerPage=50;b.status.table_header_sortLastButton=null;b.status.table_header_sortField="itemno";b.status.table_header_sortFieldOrder="ASC";b.status.currentPage=1;b.status.currentItemno="";b.status.currentSet="details";b.status.currentBalance="0.0";b.dictionaries={};b.htmlBindings={};b.htmlBindings.container=".container";b.htmlBindings.itemCounter="#panelHeadingItemsCount";b.htmlBindings.drpItemPerPage=".top-pager-itemmperpage-control a";b.htmlBindings.drpItemPerPageValue=".top-pager-itemmperpage-control button span.value";b.htmlBindings.filterForm="#filterForm";b.htmlBindings.table="#inventoryDashboardTable";b.htmlBindings.table_header_btnSort=".btn-table-sort";b.htmlBindings.table_body_btnCommitted=".btn-committed-form-link";b.htmlBindings.table_body_btnOnorder=".btn-onorder-form-link";b.htmlBindings.table_body_btnAttach=".btn-files-dialog";b.htmlBindings.pager_container=".pager-wrapper";b.htmlBindings.pager_btnPagerPages=".pager-btn";b.functions={};b.functions.paginate=function(){e.ajax({data:{predicate:b.DynamicFilter.functions.getPredicate(),page:b.status.currentPage,itemsPerPage:b.status.itemsPerPage,orderby:b.status.table_header_sortField,order:b.status.table_header_sortFieldOrder},url:b.urls.getPage,type:"post",beforeSend:function(){return e(".loading").show()},success:function(k,n,l){var m,h,j,i;m=e.parseJSON(k);h=new BootstrapPager(m,b.eventHandlers.pager_btnPagerPages_onClick);i=h.getCurrentPagedItems();j=h.getPagerControl();e(b.htmlBindings.pager_container).empty().append(j);b.functions.updateTable(i);e(b.htmlBindings.itemCounter).html(h.itemsCount);return e(".loading").hide()}});return this};b.functions.updateTable=function(h){var j,k,i;j=e(b.htmlBindings.table);k=j.children("tbody");k.empty();for(i in h){if(h.hasOwnProperty(i)){k.append(b.functions.buildTableItem(h[i],"","item-field"))}}b.functions.bindTableItemsEventHandlers();return this};b.functions.buildTableItem=function(o,s,q){var r,t,j,i,n,p,l,k,h,m;r=d.document;t=r.createElement("tr");p=function(){return c.Helpers.simpleTdBuilder(o.itemno,"")};l=function(){return c.Helpers.simpleTdBuilder(o.itmwhs,"")};n=function(){return c.Helpers.simpleTdBuilder(o.descrip,"")};k=function(){return c.Helpers.simpleTdBuilder(o.onhand,"number")};h=function(){return c.Helpers.withLinkTdBuilder(o.onorder,"number",b.htmlBindings.table_body_btnOnorder.slice(1),o.onorderHref,{})};i=function(){return c.Helpers.withLinkTdBuilder(o.committed,"number",b.htmlBindings.table_body_btnCommitted.slice(1),o.committedHref,{})};m=function(){return c.Helpers.withLightboxLinkPictureBuilder(o.itemno+o.itmwhs,"item-image","",o.picture_fi,"glyphicon glyphicon-eye-open",null,{})};j=function(){var u;u=r.createElement("span");u.className="glyphicon glyphicon-folder-close";return c.Helpers.withLinkTdBuilder(u,"item-action item-files",b.htmlBindings.table_body_btnAttach.slice(1),"#",{itemno:o.itemno})};t.className=s;t.appendChild(p());t.appendChild(l());t.appendChild(n());t.appendChild(k());t.appendChild(h());t.appendChild(i());t.appendChild(m());t.appendChild(j());return t};b.functions.bindTableItemsEventHandlers=function(){e(b.htmlBindings.table_body_btnAttach).on("click",b.eventHandlers.table_body_btnAttach_onClick);return this};b.functions.bindEventHandlers=function(){e(b.htmlBindings.drpItemPerPage).on("click",b.eventHandlers.drpItemPerPage_onClick);e(b.htmlBindings.table_header_btnSort).on("click",b.eventHandlers.table_body_btnSort_onClick);e(b.htmlBindings.pager_btnPagerPages).on("click",b.eventHandlers.pager_btnPagerPages_onClick);e(b.htmlBindings.table_body_btnAttach).on("click",b.eventHandlers.table_body_btnAttach_onClick);b.functions.bindTableItemsEventHandlers();return this};b.eventHandlers={};b.eventHandlers.drpItemPerPage_onClick=function(i){var h,j;h=e(i.target);j=h.html();b.status.itemsPerPage=j;e(b.htmlBindings.drpItemPerPageValue).text(j);b.status.currentPage=1;b.functions.paginate();return this};b.eventHandlers.pager_btnPagerPages_onClick=function(i){var h,j;h=e(i.target);j=h.data("page");b.status.currentPage=j;b.functions.paginate();return this};b.eventHandlers.table_body_btnSort_onClick=function(i){var h,j;h=e(i.target);j=h.data("field");if(b.status.table_header_sortLastButton!==null){b.status.table_header_sortLastButton.removeClass("asc desc")}if(b.status.table_header_sortField!==j){b.status.table_header_sortFieldOrder=""}b.status.table_header_sortField=j;if(b.status.table_header_sortFieldOrder==="ASC"){b.status.table_header_sortFieldOrder="DESC";h.addClass("asc").removeClass("desc")}else{b.status.table_header_sortFieldOrder="ASC";h.addClass("desc").removeClass("asc")}b.status.table_header_sortLastButton=h;b.functions.paginate();return this};b.eventHandlers.table_body_btnAttach_onClick=function(j){var i,h;i=e(this).data("itemno");h=i+"_IN";b.status.currentItemno=h;console.log(g);g.functions.loadFileTree(h);e(g.htmlBindings.modal_ProjectFiles).modal("show");return this};b.init=function(h){b.status.itemsPerPage=e(b.htmlBindings.drpItemPerPageValue).text();f.init(h);g.init();b.functions.bindEventHandlers();return this}}).call(this);