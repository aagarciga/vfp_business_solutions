// Generated by CoffeeScript 1.10.0
(function() {
  var $, App, DynamicFilter, HistoryDashboard, dandelion, global;

  global = window;

  $ = global.jQuery;

  App = global.App;

  dandelion = global.dandelion;

  HistoryDashboard = dandelion.namespace('App.HistoryDashboard', global);

  DynamicFilter = App.HistoryDashboard.DynamicFilter;

  HistoryDashboard.status = {};

  HistoryDashboard.status.itemsPerPage = 50;

  HistoryDashboard.status.table_header_sortLastButton = null;

  HistoryDashboard.status.table_header_sortField = 'equipid';

  HistoryDashboard.status.table_header_sortFieldOrder = 'ASC';

  HistoryDashboard.status.currentPage = 1;

  HistoryDashboard.status.currentEquipid = '';

  HistoryDashboard.status.currentSet = 'details';

  HistoryDashboard.status.currentBalance = "0.0";

  HistoryDashboard.dictionaries = {};

  HistoryDashboard.htmlBindings = {};

  HistoryDashboard.htmlBindings.container = '.container';

  HistoryDashboard.htmlBindings.itemCounter = '#panelHeadingItemsCount';

  HistoryDashboard.htmlBindings.drpItemPerPage = '.top-pager-itemmperpage-control a';

  HistoryDashboard.htmlBindings.drpItemPerPageValue = '.top-pager-itemmperpage-control button span.value';

  HistoryDashboard.htmlBindings.filterForm = '#filterForm';

  HistoryDashboard.htmlBindings.table = '#HistoryDashboardTable';

  HistoryDashboard.htmlBindings.table_header_btnSort = '.btn-table-sort';

  HistoryDashboard.htmlBindings.table_body_btnCommitted = '.btn-committed-form-link';

  HistoryDashboard.htmlBindings.table_body_btnOnorder = '.btn-onorder-form-link';

  HistoryDashboard.htmlBindings.table_body_btnAttach = '.btn-files-dialog';

  HistoryDashboard.htmlBindings.pager_container = '.pager-wrapper';

  HistoryDashboard.htmlBindings.pager_btnPagerPages = '.pager-btn';

  HistoryDashboard.functions = {};

  HistoryDashboard.functions.paginate = function() {
    var filterTree, jsonFilterTree;
    filterTree = App.HistoryDashboard.DynamicFilter.functions.getFilterTree();
    jsonFilterTree = JSON.stringify(filterTree);
    $.ajax({
      data: {
        equipid: History.status.currentEquipid,
        filterTree: jsonFilterTree,
        page: HistoryDashboard.status.currentPage,
        itemsPerPage: HistoryDashboard.status.itemsPerPage,
        orderby: HistoryDashboard.status.table_header_sortField,
        order: HistoryDashboard.status.table_header_sortFieldOrder
      },
      url: HistoryDashboard.urls.getPage,
      type: 'post',
      beforeSend: function() {
        return $('.loading').show();
      },
      success: function(response, textStatus, jqXHR) {
        var data, pager, pagerControl, pagerItems;
        data = $.parseJSON(response);
        pager = new BootstrapPager(data, HistoryDashboard.eventHandlers.pager_btnPagerPages_onClick);
        pagerItems = pager.getCurrentPagedItems();
        pagerControl = pager.getPagerControl();
        $(HistoryDashboard.htmlBindings.pager_container).empty().append(pagerControl);
        HistoryDashboard.functions.updateTable(pagerItems);
        $(HistoryDashboard.htmlBindings.itemCounter).html(pager.itemsCount);
        return $('.loading').hide();
      }
    });
    return this;
  };

  HistoryDashboard.functions.updateTable = function(items) {
    var $table, $tableBody, index;
    $table = $(HistoryDashboard.htmlBindings.table);
    $tableBody = $table.children('tbody');
    $tableBody.empty();
    for (index in items) {
      if (items.hasOwnProperty(index)) {
        $tableBody.append(HistoryDashboard.functions.buildTableItem(items[index], '', "item-field"));
      }
    }
    HistoryDashboard.functions.bindTableItemsEventHandlers();
    return this;
  };

  HistoryDashboard.functions.buildTableItem = function(dataRow, trClass, tdClass) {
    var doc, result, tdAttachedFilesBuilder, tdDateRecBuilder, tdEquipIdBuilder, tdExpDteInBuilder, tdInspectNoBuilder, tdInstallDteBuilder, tdOrdNumBuilder;
    doc = global.document;
    result = doc.createElement('tr');
    tdEquipIdBuilder = function() {
      return App.Helpers.simpleTdBuilder(dataRow.equipid, '');
    };
    tdOrdNumBuilder = function() {
      return App.Helpers.simpleTdBuilder(dataRow.ordnum, '');
    };
    tdInspectNoBuilder = function() {
      return App.Helpers.simpleTdBuilder(dataRow.inspectno, '');
    };
    tdInstallDteBuilder = function() {
      return App.Helpers.simpleTdBuilder(dataRow.installdte, '');
    };
    tdExpDteInBuilder = function() {
      return App.Helpers.simpleTdBuilder(dataRow.expdtein, '');
    };
    tdDateRecBuilder = function() {
      return App.Helpers.simpleTdBuilder(dataRow.daterec, '');
    };
    tdAttachedFilesBuilder = function() {
      var spanGlyphIcon;
      spanGlyphIcon = doc.createElement('span');
      spanGlyphIcon.className = 'glyphicon glyphicon-folder-close';
      return App.Helpers.withLinkTdBuilder(spanGlyphIcon, 'item-action item-files', HistoryDashboard.htmlBindings.table_body_btnAttach.slice(1), "#", {
        equipid: dataRow.equipid
      });
    };
    result.className = trClass;
    result.appendChild(tdEquipIdBuilder());
    result.appendChild(tdOrdNumBuilder());
    result.appendChild(tdInspectNoBuilder());
    result.appendChild(tdInstallDteBuilder());
    result.appendChild(tdExpDteInBuilder());
    result.appendChild(tdDateRecBuilder());
    return result;
  };

  HistoryDashboard.functions.bindTableItemsEventHandlers = function() {
    $(HistoryDashboard.htmlBindings.table_body_btnAttach).on('click', HistoryDashboard.eventHandlers.table_body_btnAttach_onClick);
    return this;
  };

  HistoryDashboard.functions.bindEventHandlers = function() {
    $(HistoryDashboard.htmlBindings.drpItemPerPage).on('click', HistoryDashboard.eventHandlers.drpItemPerPage_onClick);
    $(HistoryDashboard.htmlBindings.table_header_btnSort).on('click', HistoryDashboard.eventHandlers.table_body_btnSort_onClick);
    $(HistoryDashboard.htmlBindings.pager_btnPagerPages).on('click', HistoryDashboard.eventHandlers.pager_btnPagerPages_onClick);
    HistoryDashboard.functions.bindTableItemsEventHandlers();
    $(HistoryDashboard.htmlBindings.table_body_btnAttach).on('click', HistoryDashboard.eventHandlers.table_body_btnAttach_onClick);
    return this;
  };

  HistoryDashboard.eventHandlers = {};

  HistoryDashboard.eventHandlers.drpItemPerPage_onClick = function(event) {
    var $target, value;
    $target = $(event.target);
    value = $target.html();
    HistoryDashboard.status.itemsPerPage = value;
    $(HistoryDashboard.htmlBindings.drpItemPerPageValue).text(value);
    HistoryDashboard.status.currentPage = 1;
    HistoryDashboard.functions.paginate();
    return this;
  };

  HistoryDashboard.eventHandlers.pager_btnPagerPages_onClick = function(event) {
    var $target, value;
    $target = $(event.target);
    value = $target.data('page');
    HistoryDashboard.status.currentPage = value;
    HistoryDashboard.functions.paginate();
    return this;
  };

  HistoryDashboard.eventHandlers.table_body_btnSort_onClick = function(event) {
    var $target, sortingField;
    $target = $(event.target);
    sortingField = $target.data('field');
    if (HistoryDashboard.status.table_header_sortLastButton !== null) {
      HistoryDashboard.status.table_header_sortLastButton.removeClass('asc desc');
    }
    if (HistoryDashboard.status.table_header_sortField !== sortingField) {
      HistoryDashboard.status.table_header_sortFieldOrder = '';
    }
    HistoryDashboard.status.table_header_sortField = sortingField;
    if (HistoryDashboard.status.table_header_sortFieldOrder === 'ASC') {
      HistoryDashboard.status.table_header_sortFieldOrder = 'DESC';
      $target.addClass('asc').removeClass('desc');
    } else {
      HistoryDashboard.status.table_header_sortFieldOrder = 'ASC';
      $target.addClass('desc').removeClass('asc');
    }
    HistoryDashboard.status.table_header_sortLastButton = $target;
    HistoryDashboard.functions.paginate();
    return this;
  };

  HistoryDashboard.eventHandlers.table_body_btnAttach_onClick = function(event) {
    var currentEquipid, currentProjectRoot;
    currentEquipid = $(this).data('equipid');
    currentProjectRoot = currentEquipid + '_EQ';
    HistoryDashboard.status.currentEquipid = currentProjectRoot;
    ProjectFiles.functions.loadFileTree(currentProjectRoot);
    $(ProjectFiles.htmlBindings.modal_ProjectFiles).modal('show');
    return this;
  };

  HistoryDashboard.init = function(defaultUserFilter, fieldsDefinition, equipid) {
    HistoryDashboard.status.fieldsDefinition = $.parseJSON(fieldsDefinition);
    HistoryDashboard.status.currentEquipid = equipid;
    HistoryDashboard.status.itemsPerPage = $(HistoryDashboard.htmlBindings.drpItemPerPageValue).text();
    DynamicFilter.init(defaultUserFilter, HistoryDashboard.status.fieldsDefinition, equipid);
    HistoryDashboard.functions.bindEventHandlers();
    return this;
  };

}).call(this);

//# sourceMappingURL=main.js.map
