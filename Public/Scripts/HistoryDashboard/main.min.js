(function(){var e,c,f,a,b,d;d=window;e=d.jQuery;c=d.App;b=d.dandelion;a=b.namespace("App.HistoryDashboard",d);f=c.HistoryDashboard.DynamicFilter;a.status={};a.status.itemsPerPage=50;a.status.table_header_sortLastButton=null;a.status.table_header_sortField="equipid";a.status.table_header_sortFieldOrder="ASC";a.status.currentPage=1;a.status.currentEquipid="";a.status.currentSet="details";a.status.currentBalance="0.0";a.dictionaries={};a.htmlBindings={};a.htmlBindings.container=".container";a.htmlBindings.itemCounter="#panelHeadingItemsCount";a.htmlBindings.drpItemPerPage=".top-pager-itemmperpage-control a";a.htmlBindings.drpItemPerPageValue=".top-pager-itemmperpage-control button span.value";a.htmlBindings.filterForm="#filterForm";a.htmlBindings.table="#HistoryDashboardTable";a.htmlBindings.table_header_btnSort=".btn-table-sort";a.htmlBindings.table_body_btnCommitted=".btn-committed-form-link";a.htmlBindings.table_body_btnOnorder=".btn-onorder-form-link";a.htmlBindings.table_body_btnAttach=".btn-files-dialog";a.htmlBindings.pager_container=".pager-wrapper";a.htmlBindings.pager_btnPagerPages=".pager-btn";a.functions={};a.functions.paginate=function(){var g,h;g=c.HistoryDashboard.DynamicFilter.functions.getFilterTree();h=JSON.stringify(g);e.ajax({data:{equipid:History.status.currentEquipid,filterTree:h,page:a.status.currentPage,itemsPerPage:a.status.itemsPerPage,orderby:a.status.table_header_sortField,order:a.status.table_header_sortFieldOrder},url:a.urls.getPage,type:"post",beforeSend:function(){return e(".loading").show()},success:function(l,o,m){var n,i,k,j;n=e.parseJSON(l);i=new BootstrapPager(n,a.eventHandlers.pager_btnPagerPages_onClick);j=i.getCurrentPagedItems();k=i.getPagerControl();e(a.htmlBindings.pager_container).empty().append(k);a.functions.updateTable(j);e(a.htmlBindings.itemCounter).html(i.itemsCount);return e(".loading").hide()}});return this};a.functions.updateTable=function(g){var i,j,h;i=e(a.htmlBindings.table);j=i.children("tbody");j.empty();for(h in g){if(g.hasOwnProperty(h)){j.append(a.functions.buildTableItem(g[h],"","item-field"))}}a.functions.bindTableItemsEventHandlers();return this};a.functions.buildTableItem=function(k,q,n){var p,r,h,j,g,o,l,m,i;p=d.document;r=p.createElement("tr");g=function(){return c.Helpers.simpleTdBuilder(k.equipid,"")};i=function(){return c.Helpers.simpleTdBuilder(k.ordnum,"")};l=function(){return c.Helpers.simpleTdBuilder(k.inspectno,"")};m=function(){return c.Helpers.simpleTdBuilder(k.installdte,"")};o=function(){return c.Helpers.simpleTdBuilder(k.expdtein,"")};j=function(){return c.Helpers.simpleTdBuilder(k.daterec,"")};h=function(){var s;s=p.createElement("span");s.className="glyphicon glyphicon-folder-close";return c.Helpers.withLinkTdBuilder(s,"item-action item-files",a.htmlBindings.table_body_btnAttach.slice(1),"#",{equipid:k.equipid})};r.className=q;r.appendChild(g());r.appendChild(i());r.appendChild(l());r.appendChild(m());r.appendChild(o());r.appendChild(j());return r};a.functions.bindTableItemsEventHandlers=function(){e(a.htmlBindings.table_body_btnAttach).on("click",a.eventHandlers.table_body_btnAttach_onClick);return this};a.functions.bindEventHandlers=function(){e(a.htmlBindings.drpItemPerPage).on("click",a.eventHandlers.drpItemPerPage_onClick);e(a.htmlBindings.table_header_btnSort).on("click",a.eventHandlers.table_body_btnSort_onClick);e(a.htmlBindings.pager_btnPagerPages).on("click",a.eventHandlers.pager_btnPagerPages_onClick);a.functions.bindTableItemsEventHandlers();e(a.htmlBindings.table_body_btnAttach).on("click",a.eventHandlers.table_body_btnAttach_onClick);return this};a.eventHandlers={};a.eventHandlers.drpItemPerPage_onClick=function(h){var g,i;g=e(h.target);i=g.html();a.status.itemsPerPage=i;e(a.htmlBindings.drpItemPerPageValue).text(i);a.status.currentPage=1;a.functions.paginate();return this};a.eventHandlers.pager_btnPagerPages_onClick=function(h){var g,i;g=e(h.target);i=g.data("page");a.status.currentPage=i;a.functions.paginate();return this};a.eventHandlers.table_body_btnSort_onClick=function(h){var g,i;g=e(h.target);i=g.data("field");if(a.status.table_header_sortLastButton!==null){a.status.table_header_sortLastButton.removeClass("asc desc")}if(a.status.table_header_sortField!==i){a.status.table_header_sortFieldOrder=""}a.status.table_header_sortField=i;if(a.status.table_header_sortFieldOrder==="ASC"){a.status.table_header_sortFieldOrder="DESC";g.addClass("asc").removeClass("desc")}else{a.status.table_header_sortFieldOrder="ASC";g.addClass("desc").removeClass("asc")}a.status.table_header_sortLastButton=g;a.functions.paginate();return this};a.eventHandlers.table_body_btnAttach_onClick=function(i){var g,h;g=e(this).data("equipid");h=g+"_EQ";a.status.currentEquipid=h;ProjectFiles.functions.loadFileTree(h);e(ProjectFiles.htmlBindings.modal_ProjectFiles).modal("show");return this};a.init=function(i,g,h){a.status.fieldsDefinition=e.parseJSON(g);a.status.currentEquipid=h;a.status.itemsPerPage=e(a.htmlBindings.drpItemPerPageValue).text();f.init(i,a.status.fieldsDefinition,h);a.functions.bindEventHandlers();return this}}).call(this);