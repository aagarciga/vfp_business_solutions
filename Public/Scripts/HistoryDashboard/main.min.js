(function(){var e,b,f,d,g,a,c;c=window;e=c.jQuery;b=c.App;a=c.dandelion;d=a.namespace("App.HistoryDashboard",c);f=b.HistoryDashboard.DynamicFilter;g=b.HistoryDashboard.ProjectFiles;HistoryDashboard.status={};HistoryDashboard.status.itemsPerPage=50;HistoryDashboard.status.table_header_sortLastButton=null;HistoryDashboard.status.table_header_sortField="ordnum";HistoryDashboard.status.table_header_sortFieldOrder="ASC";HistoryDashboard.status.currentPage=1;HistoryDashboard.status.currentEquipid="";HistoryDashboard.status.currentSet="details";HistoryDashboard.status.currentBalance="0.0";HistoryDashboard.dictionaries={};HistoryDashboard.htmlBindings={};HistoryDashboard.htmlBindings.container=".container";HistoryDashboard.htmlBindings.itemCounter="#panelHeadingItemsCount";HistoryDashboard.htmlBindings.drpItemPerPage=".top-pager-itemmperpage-control a";HistoryDashboard.htmlBindings.drpItemPerPageValue=".top-pager-itemmperpage-control button span.value";HistoryDashboard.htmlBindings.filterForm="#filterForm";HistoryDashboard.htmlBindings.table="#HistoryDashboardTable";HistoryDashboard.htmlBindings.table_header_btnSort=".btn-table-sort";HistoryDashboard.htmlBindings.table_body_btnCommitted=".btn-committed-form-link";HistoryDashboard.htmlBindings.table_body_btnOnorder=".btn-onorder-form-link";HistoryDashboard.htmlBindings.table_body_btnAttach=".btn-files-dialog";HistoryDashboard.htmlBindings.table_body_drpStatus=".status.update-dropdown ";HistoryDashboard.htmlBindings.pager_container=".pager-wrapper";HistoryDashboard.htmlBindings.pager_btnPagerPages=".pager-btn";HistoryDashboard.functions={};HistoryDashboard.functions.paginate=function(){var h,i;h=b.HistoryDashboard.DynamicFilter.functions.getFilterTree();i=JSON.stringify(h);e.ajax({data:{filterTree:i,page:HistoryDashboard.status.currentPage,itemsPerPage:HistoryDashboard.status.itemsPerPage,orderby:HistoryDashboard.status.table_header_sortField,order:HistoryDashboard.status.table_header_sortFieldOrder},url:HistoryDashboard.urls.getPage,type:"post",beforeSend:function(){return e(".loading").show()},success:function(m,p,n){var o,j,l,k;o=e.parseJSON(m);j=new BootstrapPager(o,HistoryDashboard.eventHandlers.pager_btnPagerPages_onClick);k=j.getCurrentPagedItems();l=j.getPagerControl();e(HistoryDashboard.htmlBindings.pager_container).empty().append(l);HistoryDashboard.functions.updateTable(k);e(HistoryDashboard.htmlBindings.itemCounter).html(j.itemsCount);return e(".loading").hide()}});return this};HistoryDashboard.functions.updateTable=function(h){var j,k,i;j=e(HistoryDashboard.htmlBindings.table);k=j.children("tbody");k.empty();for(i in h){if(h.hasOwnProperty(i)){k.append(HistoryDashboard.functions.buildTableItem(h[i],"","item-field"))}}HistoryDashboard.functions.bindTableItemsEventHandlers();return this};HistoryDashboard.functions.buildTableItem=function(s,j,q){var D,m,k,u,n,t,B,z,x,l,o,r,w,y,p,i,A,h,v,C;D=c.document;m=D.createElement("tr");i=function(){return b.Helpers.simpleTdBuilder(s.ordnum,"")};z=function(){return b.Helpers.simpleTdBuilder(s.equipid,"")};o=function(){return b.Helpers.simpleTdBuilder(s.itemno,"")};t=function(){return b.Helpers.simpleTdBuilder(s.descrip,"")};w=function(){return b.Helpers.simpleTdBuilder(s.make,"")};y=function(){return b.Helpers.simpleTdBuilder(s.model,"")};h=function(){return b.Helpers.simpleTdBuilder(s.serialno,"")};C=function(){return b.Helpers.simpleTdBuilder(s.Voltage,"")};B=function(){return b.Helpers.simpleTdBuilder(s.EquipType,"")};l=function(){return b.Helpers.simpleTdBuilder(s.installdte,"")};x=function(){return b.Helpers.simpleTdBuilder(s.expdtein,"")};n=function(){return b.Helpers.simpleTdBuilder(s.daterec,"")};v=function(){return b.Helpers.withSelectBuilder(s.status,"","form-control update-dropdown status select2-nosearch",HistoryDashboard.status.statusValue,{equipid:s.equipid})};p=function(){return b.Helpers.simpleTdBuilder(s.notes,"")};A=function(){return b.Helpers.withLightboxLinkPictureBuilder(s.equipid,"item-image","",s.picture_fi,"glyphicon glyphicon-eye-open",null,{})};k=function(){return b.Helpers.simpleTdBuilder(s.assettag,"")};r=function(){return b.Helpers.simpleTdBuilder(s.Locno,"")};u=function(){var E;E=D.createElement("span");E.className="glyphicon glyphicon-folder-close";return b.Helpers.withLinkTdBuilder(E,"item-action item-files",HistoryDashboard.htmlBindings.table_body_btnAttach.slice(1),"#",{equipid:s.equipid})};m.className=j;m.appendChild(i());m.appendChild(z());m.appendChild(o());m.appendChild(t());m.appendChild(w());m.appendChild(y());m.appendChild(h());m.appendChild(C());m.appendChild(B());m.appendChild(l());m.appendChild(x());m.appendChild(n());m.appendChild(v());m.appendChild(p());m.appendChild(A());m.appendChild(k());m.appendChild(r());m.appendChild(u());return m};HistoryDashboard.functions.bindTableItemsEventHandlers=function(){e(HistoryDashboard.htmlBindings.table_body_btnAttach).on("click",HistoryDashboard.eventHandlers.table_body_btnAttach_onClick);e(HistoryDashboard.htmlBindings.table_body_drpStatus).on("change",HistoryDashboard.eventHandlers.table_body_dprStatus_onChange);return this};HistoryDashboard.functions.bindEventHandlers=function(){e(HistoryDashboard.htmlBindings.drpItemPerPage).on("click",HistoryDashboard.eventHandlers.drpItemPerPage_onClick);e(HistoryDashboard.htmlBindings.table_header_btnSort).on("click",HistoryDashboard.eventHandlers.table_body_btnSort_onClick);e(HistoryDashboard.htmlBindings.pager_btnPagerPages).on("click",HistoryDashboard.eventHandlers.pager_btnPagerPages_onClick);HistoryDashboard.functions.bindTableItemsEventHandlers();e(HistoryDashboard.htmlBindings.table_body_btnAttach).on("click",HistoryDashboard.eventHandlers.table_body_btnAttach_onClick);return this};HistoryDashboard.eventHandlers={};HistoryDashboard.eventHandlers.drpItemPerPage_onClick=function(i){var h,j;h=e(i.target);j=h.html();HistoryDashboard.status.itemsPerPage=j;e(HistoryDashboard.htmlBindings.drpItemPerPageValue).text(j);HistoryDashboard.status.currentPage=1;HistoryDashboard.functions.paginate();return this};HistoryDashboard.eventHandlers.pager_btnPagerPages_onClick=function(i){var h,j;h=e(i.target);j=h.data("page");HistoryDashboard.status.currentPage=j;HistoryDashboard.functions.paginate();return this};HistoryDashboard.eventHandlers.table_body_btnSort_onClick=function(i){var h,j;h=e(i.target);j=h.data("field");if(HistoryDashboard.status.table_header_sortLastButton!==null){HistoryDashboard.status.table_header_sortLastButton.removeClass("asc desc")}if(HistoryDashboard.status.table_header_sortField!==j){HistoryDashboard.status.table_header_sortFieldOrder=""}HistoryDashboard.status.table_header_sortField=j;if(HistoryDashboard.status.table_header_sortFieldOrder==="ASC"){HistoryDashboard.status.table_header_sortFieldOrder="DESC";h.addClass("asc").removeClass("desc")}else{HistoryDashboard.status.table_header_sortFieldOrder="ASC";h.addClass("desc").removeClass("asc")}HistoryDashboard.status.table_header_sortLastButton=h;HistoryDashboard.functions.paginate();return this};HistoryDashboard.eventHandlers.table_body_btnAttach_onClick=function(j){var h,i;h=e(this).data("equipid");i=h+"_EQ";HistoryDashboard.status.currentEquipid=i;g.functions.loadFileTree(i);e(g.htmlBindings.modal_ProjectFiles).modal("show");return this};HistoryDashboard.eventHandlers.table_body_dprStatus_onChange=function(j){var h,i,k;h=e(j.target);i=h.data("equipid");k=h.val();e.ajax({data:{equipid:i,status:k},url:HistoryDashboard.urls.updateStatus,type:"post",beforeSend:function(){return e(".loading").show()},success:function(l){var m;m=e.parseJSON(l);if(m==="success"){return e(".loading").hide()}else{throw m}}});return this};HistoryDashboard.init=function(k,h){var j,m,i,l;HistoryDashboard.status.fieldsDefinition=e.parseJSON(h);i=[];m=HistoryDashboard.status.fieldsDefinition.status["values"];for(j in m){if(m.hasOwnProperty(j)){l=m[j];i.push({id:j,descrip:l})}}HistoryDashboard.status.statusValue=i;HistoryDashboard.dictionaries.status=i;HistoryDashboard.status.itemsPerPage=e(HistoryDashboard.htmlBindings.drpItemPerPageValue).text();f.init(k,HistoryDashboard.status.fieldsDefinition);g.init();HistoryDashboard.functions.bindEventHandlers();return this}}).call(this);