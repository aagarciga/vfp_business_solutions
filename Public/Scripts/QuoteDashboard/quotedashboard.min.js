if(window.jQuery==="undefined"){throw new Error("VFP Business Series's Quote Dashboard JavaScript requires jQuery")}if(window.kb==="undefined"){throw new Error("VFP Business Series's Quote Dashboard JavaScript requires Knockback.js")}if(window.ko==="undefined"){throw new Error("VFP Business Series's Quote Dashboard JavaScript requires Knockout.js")}if(window.Backbone==="undefined"){throw new Error("VFP Business Series's Quote Dashboard JavaScript requires Backbone.js")}(function(e,f,d,g,h,c){var a=e.dandelion,b=a.namespace("App.QuoteDashboard.QuoteDetails",e);b.htmlBindings={};b.htmlBindings.kbViewElement="#kb-view-quote-details";b.htmlBindings.modalSaveNotes="#quoteDetails_modal_saveNotes";b.Model=(function(i){function j(){return j.base.constructor.apply(this,arguments)}a.js.augment(j,i);j.prototype.qutno="";j.prototype.status="";j.prototype.ordnum="";j.prototype.date="";j.prototype.custno="";j.prototype.projectLocation="";j.prototype.notes="";j.prototype.companyName="";j.prototype.address="";j.prototype.city="";j.prototype.state="";j.prototype.zip="";j.prototype.phone="";j.prototype.subtotal="";j.prototype.discount="";j.prototype.tax="";j.prototype.shipping="";j.prototype.total="";j.prototype.items=new h.Collection([]);j.prototype.ponum="";j.prototype.company="";j.prototype.destino="";j.prototype.sotypecode="";j.prototype.cstctid="";j.prototype.jobdescrip="";j.prototype.technam1="";j.prototype.technam2="";j.prototype.projno="";return j}(h.Model));b.ViewModel=function(j){var i=this;i.qutno=d.observable(j,"qutno");i.status=d.observable(j,"status");i.ordnum=d.observable(j,"ordnum");i.date=d.observable(j,"date");i.custno=d.observable(j,"custno");i.projectLocation=d.observable(j,"projectLocation");i.notes=d.observable(j,"notes");i.companyName=d.observable(j,"companyName");i.address=d.observable(j,"address");i.city=d.observable(j,"city");i.state=d.observable(j,"state");i.zip=d.observable(j,"zip");i.phone=d.observable(j,"phone");i.subtotal=d.observable(j,"subtotal");i.discount=d.observable(j,"discount");i.tax=d.observable(j,"tax");i.shipping=d.observable(j,"shipping");i.total=d.observable(j,"total");i.ponum=d.observable(j,"ponum");i.company=d.observable(j,"company");i.destino=d.observable(j,"destino");i.sotypecode=d.observable(j,"sotypecode");i.cstctid=d.observable(j,"cstctid");i.jobdescrip=d.observable(j,"jobdescrip");i.technam1=d.observable(j,"technam1");i.technam2=d.observable(j,"technam2");i.projno=d.observable(j,"projno");i.items=d.collectionObservable(j.items);i.showTable=g.computed(function(){return i.items().length>0});i.onShowNotesModal=function(k){f(b.htmlBindings.modalSaveNotes).modal();return k};i.onSaveNotesModal=function(k){f.post(c.QuoteDashboard.urls.updateNotes,{qutno:k.qutno(),notes:k.notes()}).done(function(){f(b.htmlBindings.modalSaveNotes).modal("hide")}).fail(function(l){throw l});return k}};b.init=function(){b.view=f(b.htmlBindings.kbViewElement)[0];b.model=new b.Model();b.viewModel=new b.ViewModel(b.model);g.applyBindings(b.viewModel,b.view)}}(window,window.jQuery,window.kb,window.ko,window.Backbone,window.App));(function(c,d,b){var a=c.dandelion,e=a.namespace("App.QuoteDashboard.DynamicFilter",c);e.status={};e.status.filterId="";e.status.predicate="";e.status.areControlsEnabled=false;e.htmlBindings={};e.htmlBindings.filterFieldsContainer="#dynamicFilter_filterFieldsContainer";e.htmlBindings.filterFields_btnAdd=".filter-field";e.htmlBindings.filterField_btnRemove=".input-group-btn button";e.htmlBindings.controls={};e.htmlBindings.controls.btnToggleVisibility="#dynamicFilter_btnToggleVisibility";e.htmlBindings.controls.btnReset="#dynamicFilter_btnReset";e.htmlBindings.controls.btnSave="#dynamicFilter_btnSave";e.htmlBindings.controls.btnFilter="#dynamicFilter_btnFilter";e.htmlBindings.drpSavedFilters="#dynamicFilter_drpSavedFilters";e.htmlBindings.drpSavedFilterItems=".saved-filter-list-item";e.htmlBindings.drpSavedFilterItems_btnDelete="#dynamicFilter_drpSavedFilters li .close";e.htmlBindings.modalSaveFilter="#dynamicFilter_modal_saveFilter";e.htmlBindings.modalSaveFilter_txtName="#dynamicFilter_modal_txtFilterName";e.htmlBindings.modalSaveFilter_btnSave="#dynamicFilter_modal_btnSaveFilter";e.functions={};e.functions.disableControls=function(){a.js.foreachPropertyDo(e.htmlBindings.controls,function(f){d(f).addClass("disabled")});e.status.areControlsEnabled=false};e.functions.enableControls=function(){a.js.foreachPropertyDo(e.htmlBindings.controls,function(f){d(f).removeClass("disabled")});e.status.areControlsEnabled=true};e.functions.reset=function(f){d(e.htmlBindings.filterFieldsContainer).empty();e.functions.disableControls();d(e.htmlBindings.controls.btnFilter).next().focus();if(!f){e.functions.filter()}};e.functions.getPredicate=function(){var g=d(e.htmlBindings.filterFieldsContainer).children(),k=null,j="",i=null,h="",f="",l;e.status.predicate="";g.each(function(){k=d(this);if(k.hasClass("btn-group")){j=k.children("button").text();e.status.predicate+=j+" "}else{if(k.hasClass("form-group")){i=k.find("input, select");h=i.val();f=i.data("fieldname");if(h===""){e.status.predicate+="EMPTY("+f+") "}else{if(i.hasClass("daterangepicker")){l=h.split(" - ");e.status.predicate+="("+f+" >= '"+l[0]+"' AND "+f+" <= '"+l[1]+"') "}else{if(i.hasClass("daterangepicker-single")){e.status.predicate+=f+" = '"+h+"' "}else{if(i.data("valueType")==="numeric"){e.status.predicate+=f+" = "+h+" "}else{e.status.predicate+="LOWER("+f+") LIKE '%"+h.toLowerCase()+"%' "}}}}}else{throw"Unexpected filter component. Must be an 'btn-group' or 'form-group'."}}});return e.status.predicate};e.functions.filter=function(){b.QuoteDashboard.functions.paginate()};e.functions.loadFilter=function(f){d.ajax({data:{filterid:f},url:b.QuoteDashboard.urls.getSavedFilter,type:"post",beforeSend:function(){d(".loading").show()},success:function(h){var j=d.parseJSON(h),g,i;if(j.success){g=j.expfrom.split(", ");i=d(e.htmlBindings.filterFieldsContainer);i.append(j.expfields);i.find("select, input").each(function(k){d(this).val(g[k])});e.functions.bindOperatorGroupsEventHandlers();e.functions.bindFormGroupsEnventhandlers();d(e.htmlBindings.controls.btnToggleVisibility).click();e.functions.filter()}else{throw"Filter not loaded"}d(".loading").hide()}})};e.functions.createOperatorGroup=function(h){var g='<div class="btn-group"><button type="button" class="btn btn-default btn-filter-modifier disabled" style="opacity:1"></button><button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown"><span class="caret"></span></button><ul class="dropdown-menu"><li class="current"><a href="#" style="display: inline-block; height: 26px; width: 100%;">Clear Not</a></li><li><a href="#">Not</a></li></ul></div>',f='<div class="btn-group "><button type="button" class="btn btn-default btn-filter-modifier disabled" style="opacity:1">And</button><button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown"><span class="caret"></span></button><ul class="dropdown-menu"><li class="current"><a href="#">And</a></li><li><a href="#">And Not</a></li><li class="divider"></li><li><a href="#">Or</a></li><li><a href="#">Or Not</a></li></ul></div>';if(h===true){return d(g)}return d(f)};e.functions.createTextField=function(g,f,h){return d('<div class="form-group" title="'+f+'"><label class="control-label">'+f+'</label><div class="input-group"><input type="text" class="form-control" data-value-type="'+h+'" data-fieldname="'+g+'" placeholder="'+f+'"><span class="input-group-btn"><button class="btn btn-default glyphicon-action-button glyphicon-minus btn-delete-filter-field" title="Delete Filter Field" type="button"></button></span></div></div>')};e.functions.createDropdownField=function(l,f,i,m){var j=d('<div class="form-group" title="'+f+'"><label class="control-label">'+f+'</label><div class="input-group select2-bootstrap-append"><select class="form-control select2-container" data-value-type="'+m+'" data-fieldname="'+l+'"></select><span class="input-group-btn"><button class="btn btn-default glyphicon-action-button glyphicon-minus btn-delete-filter-field" title="Delete Filter Field" type="button"></button></span></div></div>'),h=j.find("select"),g,k;for(g in i){if(i.hasOwnProperty(g)){k=i[g];h.append(d('<option value="'+k.id+'">'+k.descrip+"</option>"))}}return j};e.functions.createDateField=function(i,f,g){var h=g?"daterangepicker":"daterangepicker-single";return d('<div class="form-group"><label class="control-label">'+f+'</label><div class="input-prepend input-group" title="'+f+'"><span class="add-on input-group-addon"><i class="glyphicon glyphicon-calendar fa fa-calendar"></i></span><input type="text" class="form-control '+h+'" data-fieldname="'+i+'" placeholder="'+f+'"><span class="input-group-btn"><button type="button" class="btn btn-default glyphicon-action-button glyphicon-minus btn-delete-filter-field"></button></span></div></div>')};e.functions.createDropdownSavedFilters=function(h,g){var f='<button type="button" class="btn btn-success dropdown-toggle" data-toggle="dropdown"><span class="caret"></span></button>';f+='<ul id="'+h.slice(1)+'" class="dropdown-menu" role="menu"><li role="presentation" class="dropdown-header">'+g+"</li></ul>";return d(f)};e.functions.createDropdownSavedFilterItem=function(h,g){var f='<li><a href="#" class="saved-filter-list-item" data-filterid="'+h+'">'+g+'</a><button type="button" class="close" aria-hidden="true">&times;</button></li>',i=d(f);i.children("a").on("click",e.eventHandlers.drpSavedFilterItem_onClick);i.find("button.close").on("click",e.eventHandlers.drpSavedFilterItem_btnDelete_onClick);return i};e.functions.bindOperatorGroupEventHandler=function(f){f.find("li").on("click",e.eventHandlers.filterOperator_onClick)};e.functions.bindOperatorGroupsEventHandlers=function(){d(e.htmlBindings.filterFieldsContainer).find(".btn-group").each(function(){e.functions.bindOperatorGroupEventHandler(d(this))})};e.functions.bindFormGroupEventHandlers=function(f){f.find(e.htmlBindings.filterField_btnRemove).on("click",e.eventHandlers.filterField_btnRemove_onClick);f.find("input").on("keypress",e.eventHandlers.input_onKeyPress);f.find("input.daterangepicker").daterangepicker({singleDatePicker:false,format:"MM/DD/YYYY",startDate:c.moment(),endDate:c.moment()});f.find("input.daterangepicker-single").daterangepicker({singleDatePicker:true,format:"MM/DD/YYYY",startDate:c.moment(),endDate:c.moment()});f.find("select").select2()};e.functions.bindFormGroupsEnventhandlers=function(){d(e.htmlBindings.filterFieldsContainer).find(".form-group").each(function(){e.functions.bindFormGroupEventHandlers(d(this))})};e.eventHandlers={};e.eventHandlers.input_onKeyPress=function(f){if(f.keyCode===13){e.functions.filter()}};e.eventHandlers.btnFilter_onClick=function(){e.functions.filter()};e.eventHandlers.btnToggleVisibility_onClick=function(g){var h=d(g.target),f=h.html();if(f==="Hide"){d(e.htmlBindings.filterFieldsContainer).hide("slow");h.html("Show")}else{d(e.htmlBindings.filterFieldsContainer).show("slow");h.html("Hide")}};e.eventHandlers.btnReset_onClick=function(){e.functions.reset()};e.eventHandlers.btnSave_onClick=function(){var f=d(e.htmlBindings.modalSaveFilter_txtName);f.val("");f.popover("hide").focus().parent().removeClass("has-error");d(e.htmlBindings.modalSaveFilter).modal("show")};e.eventHandlers.drpSavedFilterItem_onClick=function(g){var f=g.currentTarget.dataset.filterid;e.functions.reset(true);e.functions.loadFilter(f);e.functions.enableControls()};e.eventHandlers.drpSavedFilterItem_btnDelete_onClick=function(h){var g=d(h.currentTarget),i=g.prev(),f=i.data("filterid");d.ajax({data:{filterId:f},url:b.QuoteDashboard.urls.deleteFilter,type:"post",beforeSend:function(){d(".loading").show()},success:function(k){var l=d.parseJSON(k),j=d(e.htmlBindings.drpSavedFilters);if(j.children().length>2){d('[data-filterid="'+l.filterid+'"]').parent().remove()}else{j.prev("button").remove();j.remove()}d(".loading").hide()}})};e.eventHandlers.filterOperator_onClick=function(g){var f=d(g.target),j=f.html(),k=f.parent().parent(),i=k.parent(),h=i.children(":first");if(j==="Clear Not"){j=""}h.html(j);k.find("li.current").removeClass("current");f.parent().addClass("current");e.functions.filter()};e.eventHandlers.filterFields_btnAdd_onClick=function(g){var f=d(g.target),j=f.data("field-type"),h=d(e.htmlBindings.filterFieldsContainer),n=h.children().length===0,k=j==="date",m=[],i=e.functions.createOperatorGroup(n),l;h.append(i);e.functions.bindOperatorGroupEventHandler(i);if(j==="text"){l=e.functions.createTextField(f.data("field"),f.text())}else{if(j==="date"||j==="date-single"){l=e.functions.createDateField(f.data("field"),f.text(),k)}else{if(j==="dropdown"){m=c.App.QuoteDashboard.dictionaries[f.data("field-collection")];l=e.functions.createDropdownField(f.data("field"),f.text(),m,f.data("field-value-type"))}}}h.append(l);e.functions.bindFormGroupEventHandlers(l);if(e.status.areControlsEnabled!==true){e.functions.enableControls()}};e.eventHandlers.filterField_btnRemove_onClick=function(h){var i=d(h.target),f=i.parent().parent().parent(),g=f.prev(),j=f.next();if(g.prev().length===0){if(j.length===0){g.remove();if(e.status.areControlsEnabled){e.functions.disableControls()}}else{j.remove()}}else{g.remove()}f.remove();e.functions.filter()};e.eventHandlers.modalSaveFilter_btnSave_onClick=function(){var h=d(e.htmlBindings.modalSaveFilter_txtName),i=h.val(),g=d(e.htmlBindings.filterFieldsContainer),j="",k="",f=d(e.htmlBindings.drpSavedFilters);g.find("select.select2-container").each(function(){d(this).select2("destroy")});j=g.html();g.find("select, input[type=text]").each(function(l){if(l===0){k+=d(this).val()}else{k+=", "+d(this).val()}});if(i!==""&&/\w/.test(i)){d.ajax({data:{filterName:i,filterString:e.functions.getPredicate(),filterHtml:j,filterValues:k},url:b.QuoteDashboard.urls.saveFilter,type:"post",beforeSend:function(){d(".loading").show()},success:function(l){var m=d.parseJSON(l),n;if(f.length===0){n=e.functions.createDropdownSavedFilters(e.htmlBindings.drpSavedFilters,"Load Saved Filter");d(e.htmlBindings.controls.btnSave).after(n);f=d(e.htmlBindings.drpSavedFilters)}f.append(e.functions.createDropdownSavedFilterItem(m.filterid,i));d(e.htmlBindings.modalSaveFilter).modal("hide");g.find("select.select2-container").select2();d(".loading").hide()}})}else{h.popover("show").focus().parent().addClass("has-error")}d(e.htmlBindings.modalSaveFilter).modal("hide")};e.init=function(f){if(f){e.status.filterId=f;e.functions.reset(true);e.functions.loadFilter(f);e.functions.enableControls()}else{e.functions.disableControls()}d(e.htmlBindings.controls.btnFilter).on("click",e.eventHandlers.btnFilter_onClick);d(e.htmlBindings.controls.btnToggleVisibility).on("click",e.eventHandlers.btnToggleVisibility_onClick);d(e.htmlBindings.controls.btnReset).on("click",e.eventHandlers.btnReset_onClick);d(e.htmlBindings.controls.btnSave).on("click",e.eventHandlers.btnSave_onClick);d(e.htmlBindings.filterFields_btnAdd).on("click",e.eventHandlers.filterFields_btnAdd_onClick);d(e.htmlBindings.modalSaveFilter_btnSave).on("click",e.eventHandlers.modalSaveFilter_btnSave_onClick);d(e.htmlBindings.drpSavedFilterItems).on("click",e.eventHandlers.drpSavedFilterItem_onClick);d(e.htmlBindings.drpSavedFilterItems_btnDelete).on("click",e.eventHandlers.drpSavedFilterItem_btnDelete_onClick)}}(window,window.jQuery,window.App));(function(c,d,b){var a=c.dandelion,e=a.namespace("App.QuoteDashboard.ProjectFiles",c);e.status={};e.status.dropzone=null;e.status.jsTree=null;e.htmlBindings={};e.htmlBindings.modal_ProjectFiles="#project-files-modal";e.htmlBindings.dropzone="#projectFilesDropzone";e.htmlBindings.dropzone_previews=".dz-preview";e.htmlBindings.jsTree="#project-files-jstree";e.htmlBindings.jsTree_SearchControl="#tree-search";e.functions={};e.functions.dropzoneReset=function(){var f;for(f in e.status.dropzone.files){if(e.status.dropzone.files.hasOwnProperty(f)){e.status.dropzone.files[f].ready4Remove=false}}e.status.dropzone.removeAllFiles();d(e.htmlBindings.dropzone_previews).children(".dz-preview").remove();d(e.htmlBindings.dropzone).children(".dz-message.custom").css("opacity","1")};e.functions.bindJsTreeSearching=function(f){d(e.htmlBindings.jsTree_SearchControl).on("keyup",function(g){if(f){clearTimeout(f)}f=setTimeout(function(){var h=d(e.htmlBindings.jsTree_SearchControl).val();e.status.jsTree.jstree(true).search(h)},250)})};e.functions.loadFileTree=function(f){if(e.status.jsTree!==null){e.status.jsTree.jstree(true).destroy()}e.status.jsTree=d(e.htmlBindings.jsTree).jstree({id:e.htmlBindings.jsTree,plugins:["state","dnd","sort","types","contextmenu","unique","search"],searchControlId:e.htmlBindings.jsTree_SearchControl,core:{animation:true,themes:{name:"default",responsive:false,variant:"medium",stripes:false},data:{url:b.urls.treeViewManager.getNode+"&rootDir="+f,data:function(g){return{id:g.id}}},check_callback:function(g,i,k,j,h){if(h&&h.dnd&&h.pos!=="i"){return false}if(g==="move_node"||g==="copy_node"){if(this.get_node(i).parent===this.get_node(k).id){return false}}return true},error:function(g){console.log("Error callback:",g)}},sort:function(h,g){return this.get_type(h)===this.get_type(g)?(this.get_text(h)>this.get_text(g)?1:-1):(this.get_type(h)>=this.get_type(g)?1:-1)},types:{"#":{max_children:1,valid_children:["default"],icon:"glyphicon glyphicon-folder-open"},"default":{valid_children:["default"],icon:"glyphicon glyphicon-folder-close"}},contextmenu:{items:function(h){var g=d.jstree.defaults.contextmenu.items();delete g.ccp;if(this.get_type(h)==="file"){delete g.create}return g}},unique:{duplicate:function(h,g){return h+" "+g}}}).on("delete_node.jstree",function(g,h){var i={rootDir:f,operation:g.type,id:h.node.id};d(".loading").show();d.get(b.urls.treeViewManager.deleteNode,i).done(function(j){d(".loading").hide()}).fail(function(){h.instance.refresh();d(".loading").hide()})}).on("create_node.jstree",function(g,h){var i={rootDir:f,operation:g.type,type:h.node.type,id:h.node.parent,text:h.node.text};d(".loading").show();d.get(b.urls.treeViewManager.createNode,i).done(function(j){h.instance.set_id(h.node,j.id);d(".loading").hide()}).fail(function(){h.instance.refresh();d(".loading").hide()})}).on("rename_node.jstree",function(g,h){var i={rootDir:f,operation:g.type,id:h.node.id,text:h.text};d(".loading").show();d.get(b.urls.treeViewManager.renameNode,i).done(function(j){h.instance.set_id(h.node,j.id);d(".loading").hide()}).fail(function(){h.instance.refresh();d(".loading").hide()})}).on("move_node.jstree",function(g,h){var i={rootDir:f,operation:g.type,id:h.node.id,parent:h.parent};d(".loading").show();d.get(b.urls.treeViewManager.moveNode,i).done(function(j){h.instance.refresh();d(".loading").hide()}).fail(function(){h.instance.refresh();d(".loading").hide()})}).on("copy_node.jstree",function(g,h){var i={rootDir:f,operation:g.type,id:h.original.id,parent:h.parent};d(".loading").show();d.get(b.urls.treeViewManager.copyNode,i).done(function(j){h.instance.load_node(h.parent);h.instance.refresh();d(".loading").hide()}).fail(function(){h.instance.refresh();d(".loading").hide()})}).on("changed.jstree",function(i,j){var g=e.status.jsTree.jstree(true).get_selected()[0],h=(g==="/"?"":g+"/"),k={rootDir:f,selectedDir:g};if(g){e.functions.dropzoneReset();d.post(b.urls.fileManager.list,k).done(function(l){if(l&&l.length!==0){h="public/uploads/"+f+"/"+h;(function(m){}(e.status.dropzone));d.each(l,function(n,p){var o=/\.(gif|jpg|jpeg|tiff|png)$/i,m={name:p.name,size:p.size,ready4Remove:true};e.status.dropzone.options.addedfile.call(e.status.dropzone,m);e.status.dropzone.files.push(m);if(o.test(p.name)){e.status.dropzone.options.thumbnail.call(e.status.dropzone,m,h+p.name)}});d(e.htmlBindings.dropzone_previews).on("click",function(p){var m=f,q=d(this).find(".dz-filename span").html(),n=g,o=d('<form action="'+b.urls.fileManager.downloadFile+'" method="POST"><input type="hidden" name="rootDir" value="'+m+'" /><input type="hidden" name="selectedDir" value="'+n+'" /><input type="hidden" name="fileName" value="'+q+'" /></form>');o.appendTo("body");o[0].submit()})}}).fail(function(l){console.log(l)})}});e.functions.bindJsTreeSearching(false);e.status.jsTree.jstree(true).select_node(f)};e.functions.createDir=function(){var g=e.status.jsTree.jstree(true),f=g.get_selected();if(!f.length){return false}f=f[0];f=g.create_node(f,{type:"default"},"last",function(h){setTimeout(function(){g.edit(h)},0)})};e.functions.renameDir=function(){var g=e.status.jsTree.jstree(true),f=g.get_selected();if(!f.length){return false}f=f[0];g.edit(f)};e.functions.deleteDir=function(){var g=e.status.jsTree.jstree(true),f=g.get_selected();if(!f.length){return false}if(f[0]==="/"){throw"Project folder can't be deleted.";return false}g.delete_node(f);e.functions.dropzoneReset()};e.eventHandlers={};e.init=function(){c.Dropzone.options.projectFilesDropzone=false;e.status.dropzone=new c.Dropzone(e.htmlBindings.dropzone,{paramName:"file",maxFilesize:1024,maxThumbnailFilesize:1,addRemoveLinks:true,accept:function(g,f){if(g.name==="Alex.jpg"){f("Hello Creator.")}else{f()}},init:function(){this.on("removedfile",function(g){var f=e.status.jsTree.jstree(true).get_selected(),h={rootDir:b.QuoteDashboard.status.currentQuote,selectedDir:f[0],fileName:g.name};if(g.ready4Remove){d(".loading").show();d.post(b.urls.fileManager.deleteFile,h).done(function(i){d(".loading").hide()}).fail(function(i){d(".loading").hide()})}g.ready4Remove=true});this.on("sending",function(h,j,i){var g=e.status.jsTree.jstree(true),f=g.get_selected();h.ready4Remove=true;h.uploadPath=b.QuoteDashboard.status.currentQuote+"/"+f;if(b.QuoteDashboard.status.currentQuote){i.append("rootDir",b.QuoteDashboard.status.currentQuote);i.append("selectedDir",f)}d(e.htmlBindings.dropzone_previews).on("click",function(){var k=e.status.jsTree.jstree(true).get_selected()[0],l=b.QuoteDashboard.status.currentQuote,n=d(this).find(".dz-filename span").html(),m=d('<form action="'+b.urls.fileManager.downloadFile+'" method="POST"><input type="hidden" name="rootDir" value="'+l+'" /><input type="hidden" name="selectedDir" value="'+k+'" /><input type="hidden" name="fileName" value="'+n+'" /></form>');m.appendTo("body");m[0].submit()})})}})}}(window,window.jQuery,window.App));(function(e,f,d){var b=e.dandelion,a=b.namespace("App.QuoteDashboard",e),g=d.QuoteDashboard.DynamicFilter,c=d.QuoteDashboard.QuoteDetails,h=d.QuoteDashboard.ProjectFiles;a.status={};a.status.itemsPerPage=50;a.status.table_header_sortLastButton=null;a.status.table_header_sortField="ordnum";a.status.table_header_sortFieldOrder="ASC";a.status.currentPage=1;a.status.currentQuote="";a.dictionaries={};a.dictionaries.status=[];a.dictionaries.vessel=[];a.dictionaries.costCenter=[];a.dictionaries.projectManager=[];a.htmlBindings={};a.htmlBindings.container=".container";a.htmlBindings.itemCounter="#panelHeadingItemsCount";a.htmlBindings.drpItemPerPage=".top-pager-itemmperpage-control a";a.htmlBindings.drpItemPerPageValue=".top-pager-itemmperpage-control button span.value";a.htmlBindings.filterForm="#filterForm";a.htmlBindings.table="#quoteDashboardTable";a.htmlBindings.table_header_btnSort=".btn-table-sort";a.htmlBindings.table_body_btnQuoteNo=".qutno-form-link";a.htmlBindings.table_body_btnAttach=".btn-files-dialog";a.htmlBindings.pager_container=".pager-wrapper";a.htmlBindings.pager_btnPagerPages=".pager-btn";a.htmlBindings.control_quoteDetails="#quoteDetails";a.htmlBindings.control_quoteDetails_btnClose="#quoteDetails_btnClose";a.functions={};a.functions.paginate=function(){f.ajax({data:{predicate:a.DynamicFilter.functions.getPredicate(),page:a.status.currentPage,itemsPerPage:a.status.itemsPerPage,orderby:a.status.table_header_sortField,order:a.status.table_header_sortFieldOrder},url:a.urls.getPage,type:"post",beforeSend:function(){f(".loading").show()},success:function(l){var m=f.parseJSON(l),i=new BootstrapPager(m,a.eventHandlers.pager_btnPagerPages_onClick),k=i.getCurrentPagedItems(),j=i.getPagerControl();f(a.htmlBindings.pager_container).empty().append(j);a.functions.updateTable(k);f(a.htmlBindings.itemCounter).html(i.itemsCount);f(".loading").hide()}})};a.functions.getDictionaries=function(){f.ajax({data:{},url:a.urls.getDictionaries,type:"post",beforeSend:function(){f(".loading").show()},success:function(i){var j=f.parseJSON(i);a.dictionaries=j;f(".loading").hide()}})};a.functions.updateTable=function(i){var k=f(a.htmlBindings.table),l=k.children("tbody"),j;l.empty();for(j in i){if(i.hasOwnProperty(j)){l.append(a.functions.buildTableItem(i[j],"","item-field"))}}a.functions.bindTableItemsEventHandlers()};a.functions.buildTableItem=function(u,p,s){var D=e.document,q=D.createElement("tr"),x=function(E){var F=D.createElement("td");F.className=s;F.appendChild(D.createTextNode(E));return F},l=function(H,G,E){var I=D.createElement("td"),F=D.createElement("a");F.href="#";F.className=G;F.dataset.qutno=u.qutno;if(typeof H==="string"){F.appendChild(D.createTextNode(H))}else{F.appendChild(H)}I.className=E||s;I.appendChild(F);return I},n=function(K,G){var H,J,F,I,E=D.createElement("select");J=D.createElement("option");J.appendChild(D.createTextNode("Empty"));E.appendChild(J);for(H in G){if(G.hasOwnProperty(H)){F=G[H].id;I=G[H].descrip;J=D.createElement("option");if(K===F){J.selected="selected"}J.value=F;J.appendChild(D.createTextNode(I));E.appendChild(J)}}E.className="form-control update-dropdown";return E},k=function(G,I,F){var H=D.createElement("td"),E=n(G,I);E.dataset.ordnum=u.ordnum;E.className+=" select2-nosearch "+F;H.appendChild(E);return H},i=function(){return l(u.qutno,a.htmlBindings.table_body_btnQuoteNo.slice(1))},v=function(){return x(u.projno)},m=function(){return x(u.company)},r=function(){return x(u.vesselid)},C=function(){return x(u.sotypecode)},j=function(){return x(u.jobdescrip)},z=function(){return k(u.status,a.dictionaries.status,"status")},t=function(){return x(u.qutdate)},y=function(){return x(u.ordnum)},o=function(){return x(u.cstctid)},A=function(){return x(u.projectManager1)},B=function(){return x(u.projectManager2)},w=function(){var E=D.createElement("span");E.className="glyphicon glyphicon-folder-close";return l(E,a.htmlBindings.table_body_btnAttach.slice(1),"item-action item-files")};q.className=p;q.appendChild(i());q.appendChild(v());q.appendChild(m());q.appendChild(r());q.appendChild(C());q.appendChild(j());q.appendChild(z());q.appendChild(t());q.appendChild(y());q.appendChild(o());q.appendChild(A());q.appendChild(B());q.appendChild(w());return q};a.functions.bindTableItemsEventHandlers=function(){f(a.htmlBindings.table_body_btnQuoteNo).on("click",a.eventHandlers.control_quoteDetails_itemsLink_onClick);f("select.select2-nosearch").select2({minimumResultsForSearch:Infinity});f(a.htmlBindings.table_body_btnAttach).on("click",a.eventHandlers.table_body_btnAttach_onClick)};a.functions.bindEventHandlers=function(){f(a.htmlBindings.drpItemPerPage).on("click",a.eventHandlers.drpItemPerPage_onClick);f(a.htmlBindings.control_quoteDetails_btnClose).on("click",function(){f(a.htmlBindings.control_quoteDetails).hide()});f(a.htmlBindings.table_header_btnSort).on("click",a.eventHandlers.table_body_btnSalesOrder_onClick);f(a.htmlBindings.pager_btnPagerPages).on("click",a.eventHandlers.pager_btnPagerPages_onClick);a.functions.bindTableItemsEventHandlers()};a.eventHandlers={};a.eventHandlers.drpItemPerPage_onClick=function(j){var i=f(j.target),k=i.html();a.status.itemsPerPage=k;f(a.htmlBindings.drpItemPerPageValue).text(k);a.status.currentPage=1;a.functions.paginate()};a.eventHandlers.pager_btnPagerPages_onClick=function(j){var i=f(j.target),k=i.data("page");a.status.currentPage=k;a.functions.paginate()};a.eventHandlers.table_body_btnSalesOrder_onClick=function(j){var i=f(j.target),k=i.data("field");if(a.status.table_header_sortLastButton!==null){a.status.table_header_sortLastButton.removeClass("asc desc")}if(a.status.table_header_sortField!==k){a.status.table_header_sortFieldOrder=""}a.status.table_header_sortField=k;if(a.status.table_header_sortFieldOrder==="ASC"){a.status.table_header_sortFieldOrder="DESC";i.addClass("asc").removeClass("desc")}else{a.status.table_header_sortFieldOrder="ASC";i.addClass("desc").removeClass("asc")}a.status.table_header_sortLastButton=i;a.functions.paginate()};a.eventHandlers.table_body_drpstatus_onChange=function(){};a.eventHandlers.control_quoteDetails_itemsLink_onClick=function(k){console.log(f(k.target).html());var j=f(k.target).html(),m={quoteNo:j},i,l;f.post(a.urls.getQuoteDetails,m).done(function(n){n=f.parseJSON(n);console.log(n);var o=a.QuoteDetails.viewModel;if(n.success){o.qutno(n.quoteDetails.qutno);o.status(n.quoteDetails.status);o.ordnum(n.quoteDetails.ordnum);o.date(n.quoteDetails.date);o.custno(n.quoteDetails.custno);o.projectLocation(n.quoteDetails.projectLocation);o.notes(n.quoteDetails.notes);o.companyName(n.quoteDetails.companyName);o.address(n.quoteDetails.address);o.city(n.quoteDetails.city);o.state(n.quoteDetails.state);o.zip(n.quoteDetails.zip);o.phone(n.quoteDetails.phone);o.subtotal(n.quoteDetails.subtotal);o.discount(n.quoteDetails.discount);o.tax(n.quoteDetails.tax);o.shipping(n.quoteDetails.shipping);o.total(n.quoteDetails.total);o.ponum(n.quoteDetails.ponum);o.company(n.quoteDetails.company);o.destino(n.quoteDetails.destino);o.sotypecode(n.quoteDetails.sotypecode);o.jobdescrip(n.quoteDetails.jobdescrip);o.technam1(n.quoteDetails.technam1);o.technam2(n.quoteDetails.technam2);o.cstctid(n.quoteDetails.cstctid);o.projno(n.quoteDetails.projno);o.items(n.quoteDetails.itemsCollection)}}).fail(function(n){console.log(n)});i=parseInt(f(a.htmlBindings.container).css("height"),10);l=parseInt(f(a.htmlBindings.control_quoteDetails).css("height"),10);if(i>l){f(a.htmlBindings.control_quoteDetails).css("height",i)}f(a.htmlBindings.control_quoteDetails).show()};a.eventHandlers.table_body_btnAttach_onClick=function(k){var i=f(k.target),j="Quote "+i.parent().data("qutno");a.status.currentQuote=j;h.functions.loadFileTree(j);f(h.htmlBindings.modal_ProjectFiles).modal("show")};a.init=function(i){a.status.itemsPerPage=f(a.htmlBindings.drpItemPerPageValue).text();a.functions.getDictionaries();g.init(i);c.init();h.init();a.functions.bindEventHandlers()}}(window,window.jQuery,window.App));