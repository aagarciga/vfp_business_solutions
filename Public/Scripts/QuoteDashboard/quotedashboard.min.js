if(jQuery==="undefined"){throw new Error("VFP Business Series's Quote Dashboard JavaScript requires jQuery")}if(kb==="undefined"){throw new Error("VFP Business Series's Quote Dashboard JavaScript requires Knockback.js")}if(ko==="undefined"){throw new Error("VFP Business Series's Quote Dashboard JavaScript requires Knockout.js")}if(Backbone==="undefined"){throw new Error("VFP Business Series's Quote Dashboard JavaScript requires Backbone.js")}(function(c,d,b){var a=c.dandelion,e=a.namespace("App.QuoteDashboard.DynamicFilter",c);e.status={};e.status.filterId="";e.status.predicate="";e.status.areControlsEnabled=false;e.htmlBindings={};e.htmlBindings.filterFieldsContainer="#dynamicFilter_filterFieldsContainer";e.htmlBindings.filterFields_btnAdd=".filter-field";e.htmlBindings.filterField_btnRemove=".input-group-btn button";e.htmlBindings.controls={};e.htmlBindings.controls.btnToggleVisibility="#dynamicFilter_btnToggleVisibility";e.htmlBindings.controls.btnReset="#dynamicFilter_btnReset";e.htmlBindings.controls.btnSave="#dynamicFilter_btnSave";e.htmlBindings.controls.btnFilter="#dynamicFilter_btnFilter";e.htmlBindings.drpSavedFilters="#dynamicFilter_drpSavedFilters";e.htmlBindings.drpSavedFilterItems=".saved-filter-list-item";e.htmlBindings.drpSavedFilterItems_btnDelete="#dynamicFilter_drpSavedFilters li .close";e.htmlBindings.modalSaveFilter="#dynamicFilter_modal_saveFilter";e.htmlBindings.modalSaveFilter_txtName="#dynamicFilter_modal_txtFilterName";e.htmlBindings.modalSaveFilter_btnSave="#dynamicFilter_modal_btnSaveFilter";e.functions={};e.functions.disableControls=function(){a.js.foreachPropertyDo(e.htmlBindings.controls,function(f){d(f).addClass("disabled")});e.status.areControlsEnabled=false};e.functions.enableControls=function(){a.js.foreachPropertyDo(e.htmlBindings.controls,function(f){d(f).removeClass("disabled")});e.status.areControlsEnabled=true};e.functions.reset=function(f){d(e.htmlBindings.filterFieldsContainer).empty();e.functions.disableControls();d(e.htmlBindings.controls.btnFilter).next().focus();if(!f){e.functions.filter()}};e.functions.getPredicate=function(){var g=d(e.htmlBindings.filterFieldsContainer).children(),k=null,j="",i=null,h="",f="",l;e.status.predicate="";g.each(function(){k=d(this);if(k.hasClass("btn-group")){j=k.children("button").text();e.status.predicate+=j+" "}else{if(k.hasClass("form-group")){i=k.find("input, select");h=i.val();f=i.data("fieldname");if(h===""){e.status.predicate+="EMPTY("+f+") "}else{if(i.hasClass("daterangepicker")){l=h.split(" - ");e.status.predicate+="("+f+" >= '"+l[0]+"' AND "+f+" <= '"+l[1]+"') "}else{if(i.hasClass("daterangepicker-single")){e.status.predicate+=f+" = '"+h+"' "}else{if(i.data("valueType")==="numeric"){e.status.predicate+=f+" = "+h+" "}else{e.status.predicate+="LOWER("+f+") LIKE '%"+h.toLowerCase()+"%' "}}}}}else{throw"Unexpected filter component. Must be an 'btn-group' or 'form-group'."}}});return e.status.predicate};e.functions.filter=function(){b.QuoteDashboard.functions.paginate()};e.functions.createOperatorGroup=function(h){var g='<div class="btn-group"><button type="button" class="btn btn-default btn-filter-modifier disabled" style="opacity:1"></button><button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown"><span class="caret"></span></button><ul class="dropdown-menu"><li class="current"><a href="#" style="display: inline-block; height: 26px; width: 100%;">Clear Not</a></li><li><a href="#">Not</a></li></ul></div>',f='<div class="btn-group "><button type="button" class="btn btn-default btn-filter-modifier disabled" style="opacity:1">And</button><button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown"><span class="caret"></span></button><ul class="dropdown-menu"><li class="current"><a href="#">And</a></li><li><a href="#">And Not</a></li><li class="divider"></li><li><a href="#">Or</a></li><li><a href="#">Or Not</a></li></ul></div>';if(h===true){return d(g)}return d(f)};e.functions.createTextField=function(g,f,h){return d('<div class="form-group" title="'+f+'"><label class="control-label">'+f+'</label><div class="input-group"><input type="text" class="form-control" data-value-type="'+h+'" data-fieldname="'+g+'" placeholder="'+f+'"><span class="input-group-btn"><button class="btn btn-default glyphicon-action-button glyphicon-minus btn-delete-filter-field" title="Delete Filter Field" type="button"></button></span></div></div>')};e.functions.createDropdownField=function(l,f,i,m){var j=d('<div class="form-group" title="'+f+'"><label class="control-label">'+f+'</label><div class="input-group select2-bootstrap-append"><select class="form-control select2-container" data-value-type="'+m+'" data-fieldname="'+l+'"></select><span class="input-group-btn"><button class="btn btn-default glyphicon-action-button glyphicon-minus btn-delete-filter-field" title="Delete Filter Field" type="button"></button></span></div></div>'),h=j.find("select"),g,k;for(g in i){if(i.hasOwnProperty(g)){k=i[g];h.append(d('<option value="'+k.id+'">'+k.descrip+"</option>"))}}return j};e.functions.createDateField=function(i,f,g){var h=g?"daterangepicker":"daterangepicker-single";return d('<div class="form-group"><label class="control-label">'+f+'</label><div class="input-prepend input-group" title="'+f+'"><span class="add-on input-group-addon"><i class="glyphicon glyphicon-calendar fa fa-calendar"></i></span><input type="text" class="form-control '+h+'" data-fieldname="'+i+'" placeholder="'+f+'"><span class="input-group-btn"><button type="button" class="btn btn-default glyphicon-action-button glyphicon-minus btn-delete-filter-field"></button></span></div></div>')};e.functions.createDropdownSavedFilters=function(h,g){var f='<button type="button" class="btn btn-success dropdown-toggle" data-toggle="dropdown"><span class="caret"></span></button>';f+='<ul id="'+h.slice(1)+'" class="dropdown-menu" role="menu"><li role="presentation" class="dropdown-header">'+g+"</li></ul>";return d(f)};e.functions.createDropdownSavedFilterItem=function(h,g){var f='<li><a href="#" class="saved-filter-list-item" data-filterid="'+h+'">'+g+'</a><button type="button" class="close" aria-hidden="true">&times;</button></li>',i=d(f);i.children("a").on("click",e.eventHandlers.drpSavedFilterItem_onClick);i.find("button.close").on("click",e.eventHandlers.drpSavedFilterItem_btnDelete_onClick);return i};e.functions.bindOperatorGroupEventHandler=function(f){f.find("li").on("click",e.eventHandlers.filterOperator_onClick)};e.functions.bindOperatorGroupsEventHandlers=function(){d(e.htmlBindings.filterFieldsContainer).find(".btn-group").each(function(){e.functions.bindOperatorGroupEventHandler(d(this))})};e.functions.bindFormGroupEventHandlers=function(f){f.find(e.htmlBindings.filterField_btnRemove).on("click",e.eventHandlers.filterField_btnRemove_onClick);f.find("input").on("keypress",e.eventHandlers.input_onKeyPress);f.find("input.daterangepicker").daterangepicker({singleDatePicker:false,format:"MM/DD/YYYY",startDate:c.moment(),endDate:c.moment()});f.find("input.daterangepicker-single").daterangepicker({singleDatePicker:true,format:"MM/DD/YYYY",startDate:c.moment(),endDate:c.moment()});f.find("select").select2()};e.functions.bindFormGroupsEnventhandlers=function(){d(e.htmlBindings.filterFieldsContainer).find(".form-group").each(function(){e.functions.bindFormGroupEventHandlers(d(this))})};e.eventHandlers={};e.eventHandlers.input_onKeyPress=function(f){if(f.keyCode===13){e.functions.filter()}};e.eventHandlers.btnFilter_onClick=function(){e.functions.filter()};e.eventHandlers.btnToggleVisibility_onClick=function(g){var h=d(g.target),f=h.html();if(f==="Hide"){d(e.htmlBindings.filterFieldsContainer).hide("slow");h.html("Show")}else{d(e.htmlBindings.filterFieldsContainer).show("slow");h.html("Hide")}};e.eventHandlers.btnReset_onClick=function(){e.functions.reset()};e.eventHandlers.filterOperator_onClick=function(g){var f=d(g.target),j=f.html(),k=f.parent().parent(),i=k.parent(),h=i.children(":first");if(j==="Clear Not"){j=""}h.html(j);k.find("li.current").removeClass("current");f.parent().addClass("current");e.functions.filter()};e.eventHandlers.filterFields_btnAdd_onClick=function(g){var f=d(g.target),j=f.data("field-type"),h=d(e.htmlBindings.filterFieldsContainer),n=h.children().length===0,k=j==="date",m=[],i=e.functions.createOperatorGroup(n),l;h.append(i);e.functions.bindOperatorGroupEventHandler(i);if(j==="text"){l=e.functions.createTextField(f.data("field"),f.text())}else{if(j==="date"||j==="date-single"){l=e.functions.createDateField(f.data("field"),f.text(),k)}else{if(j==="dropdown"){m=c.App.QuoteDashboard.dictionaries[f.data("field-collection")];l=e.functions.createDropdownField(f.data("field"),f.text(),m,f.data("field-value-type"))}}}h.append(l);e.functions.bindFormGroupEventHandlers(l);if(e.status.areControlsEnabled!==true){e.functions.enableControls()}};e.eventHandlers.filterField_btnRemove_onClick=function(h){var i=d(h.target),f=i.parent().parent().parent(),g=f.prev(),j=f.next();if(g.prev().length===0){if(j.length===0){g.remove();if(e.status.areControlsEnabled){e.functions.disableControls()}}else{j.remove()}}else{g.remove()}f.remove();e.functions.filter()};e.init=function(f){if(f){e.status.filterId=f;e.functions.reset(true);e.functions.loadFilter(f);e.functions.enableControls()}else{e.functions.disableControls()}d(e.htmlBindings.controls.btnFilter).on("click",e.eventHandlers.btnFilter_onClick);d(e.htmlBindings.controls.btnToggleVisibility).on("click",e.eventHandlers.btnToggleVisibility_onClick);d(e.htmlBindings.controls.btnReset).on("click",e.eventHandlers.btnReset_onClick);d(e.htmlBindings.filterFields_btnAdd).on("click",e.eventHandlers.filterFields_btnAdd_onClick)}}(window,jQuery,App));(function(d,e,c){var b=d.dandelion,a=b.namespace("App.QuoteDashboard",d),f=c.QuoteDashboard.DynamicFilter;a.status={};a.status.itemsPerPage=50;a.status.table_header_sortLastButton=null;a.status.table_header_sortField="ordnum";a.status.table_header_sortFieldOrder="ASC";a.status.currentPage=1;a.dictionaries={};a.dictionaries.status=[];a.dictionaries.vessel=[];a.dictionaries.costCenter=[];a.dictionaries.projectManager=[];a.htmlBindings={};a.htmlBindings.container=".container";a.htmlBindings.itemCounter="#panelHeadingItemsCount";a.htmlBindings.drpItemPerPage=".top-pager-itemmperpage-control a";a.htmlBindings.drpItemPerPageValue=".top-pager-itemmperpage-control button span.value";a.htmlBindings.filterForm="#filterForm";a.htmlBindings.table="#quoteDashboardTable";a.htmlBindings.table_header_btnSort=".btn-table-sort";a.htmlBindings.table_body_btnQuoteNo=".qutno-form-link";a.htmlBindings.table_body_btnAttach=".btn-files-dialog";a.htmlBindings.pager_container=".pager-wrapper";a.htmlBindings.pager_btnPagerPages=".pager-btn";a.functions={};a.functions.paginate=function(){e.ajax({data:{predicate:a.DynamicFilter.functions.getPredicate(),page:a.status.currentPage,itemsPerPage:a.status.itemsPerPage,orderby:a.status.table_header_sortField,order:a.status.table_header_sortFieldOrder},url:a.urls.getPage,type:"post",beforeSend:function(){e(".loading").show()},success:function(j){var k=e.parseJSON(j),g=new BootstrapPager(k,a.eventHandlers.pager_btnPagerPages_onClick),i=g.getCurrentPagedItems(),h=g.getPagerControl();e(a.htmlBindings.pager_container).empty().append(h);a.functions.updateTable(i);e(a.htmlBindings.itemCounter).html(g.itemsCount);e(".loading").hide()}})};a.functions.getDictionaries=function(){e.ajax({data:{},url:a.urls.getDictionaries,type:"post",beforeSend:function(){e(".loading").show()},success:function(g){var h=e.parseJSON(g);a.dictionaries=h;e(".loading").hide()}})};a.functions.updateTable=function(g){var i=e(a.htmlBindings.table),j=i.children("tbody"),h;j.empty();for(h in g){if(g.hasOwnProperty(h)){j.append(a.functions.buildTableItem(g[h],"","item-field"))}}a.functions.bindTableItemsEventHandlers()};a.functions.buildTableItem=function(s,n,q){var B=d.document,o=B.createElement("tr"),v=function(C){var D=B.createElement("td");D.className=q;D.appendChild(B.createTextNode(C));return D},j=function(F,E,C){var G=B.createElement("td"),D=B.createElement("a");D.href="#";D.className=E;D.dataset.ordnum=s.ordnum;if(typeof F==="string"){D.appendChild(B.createTextNode(F))}else{D.appendChild(F)}G.className=C||q;G.appendChild(D);return G},l=function(I,E){var F,H,D,G,C=B.createElement("select");H=B.createElement("option");H.appendChild(B.createTextNode("Empty"));C.appendChild(H);for(F in E){if(E.hasOwnProperty(F)){D=E[F].id;G=E[F].descrip;H=B.createElement("option");if(I===D){H.selected="selected"}H.value=D;H.appendChild(B.createTextNode(G));C.appendChild(H)}}C.className="form-control update-dropdown";return C},i=function(E,G,D){var F=B.createElement("td"),C=l(E,G);C.dataset.ordnum=s.ordnum;C.className+=" select2-nosearch "+D;F.appendChild(C);return F},g=function(){return j(s.qutno,a.htmlBindings.table_body_btnQuoteNo.slice(1))},t=function(){return v(s.projno)},k=function(){return v(s.company)},p=function(){return v(s.vesselid)},A=function(){return v(s.sotypecode)},h=function(){return v(s.jobdescrip)},x=function(){return i(s.status,a.dictionaries.status,"status")},r=function(){return v(s.qutdate)},w=function(){return v(s.ordnum)},m=function(){return v(s.cstctid)},y=function(){return v(s.projectManager1)},z=function(){return v(s.projectManager2)},u=function(){var C=B.createElement("span");C.className="glyphicon glyphicon-folder-close";return j(C,a.htmlBindings.table_body_btnAttach.slice(1),"item-action item-files")};o.className=n;o.appendChild(g());o.appendChild(t());o.appendChild(k());o.appendChild(p());o.appendChild(A());o.appendChild(h());o.appendChild(x());o.appendChild(r());o.appendChild(w());o.appendChild(m());o.appendChild(y());o.appendChild(z());o.appendChild(u());return o};a.functions.bindTableItemsEventHandlers=function(){};a.functions.bindEventHandlers=function(){e(a.htmlBindings.drpItemPerPage).on("click",a.eventHandlers.drpItemPerPage_onClick);e(a.htmlBindings.table_header_btnSort).on("click",a.eventHandlers.table_body_btnSalesOrder_onClick);e(a.htmlBindings.pager_btnPagerPages).on("click",a.eventHandlers.pager_btnPagerPages_onClick);a.functions.bindTableItemsEventHandlers()};a.eventHandlers={};a.eventHandlers.drpItemPerPage_onClick=function(h){var g=e(h.target),i=g.html();a.status.itemsPerPage=i;e(a.htmlBindings.drpItemPerPageValue).text(i);a.status.currentPage=1;a.functions.paginate()};a.eventHandlers.pager_btnPagerPages_onClick=function(h){var g=e(h.target),i=g.data("page");a.status.currentPage=i;a.functions.paginate()};a.eventHandlers.table_body_btnSalesOrder_onClick=function(h){var g=e(h.target),i=g.data("field");if(a.status.table_header_sortLastButton!==null){a.status.table_header_sortLastButton.removeClass("asc desc")}if(a.status.table_header_sortField!==i){a.status.table_header_sortFieldOrder=""}a.status.table_header_sortField=i;if(a.status.table_header_sortFieldOrder==="ASC"){a.status.table_header_sortFieldOrder="DESC";g.addClass("asc").removeClass("desc")}else{a.status.table_header_sortFieldOrder="ASC";g.addClass("desc").removeClass("asc")}a.status.table_header_sortLastButton=g;a.functions.paginate()};a.eventHandlers.table_body_drpstatus_onChange=function(g){};a.init=function(g){a.status.itemsPerPage=e(a.htmlBindings.drpItemPerPageValue).text();a.functions.getDictionaries();f.init(g);a.functions.bindEventHandlers()}}(window,jQuery,App));