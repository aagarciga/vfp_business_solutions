(function(d,e,c){var b=d.dandelion,a=b.namespace("App.PickTicket",d);a.status={};a.status.ticketVerified=false;a.status.locationVerified=false;a.status.modal_TicketList_CurrentTicket="";a.status.modal_TicketList_CurrentPage=1;a.status.modal_TicketList_ItemsPerPage=10;a.dictionaries={};a.htmlBindings={};a.htmlBindings.txtTicketId="#txtShpRelNo";a.htmlBindings.btnTicketNo="#btnTicketNo";a.htmlBindings.txtLocation="#txtLocation";a.htmlBindings.txtBarcode="#txtBarcode";a.htmlBindings.modal_TicketList="#ticket-list-modal";a.htmlBindings.modal_TicketList_itemCounter="#itemCounter";a.htmlBindings.modal_TicketList_Pager_container=".pager-wrapper";a.htmlBindings.modal_TicketList_Pager_btnPagerPages=".pager-btn";a.htmlBindings.modal_TicketList_Table="#tickets";a.htmlBindings.modal_TicketList_Table_btnTicket=".ticket-link";a.functions={};a.functions.bindEventHandlers=function(){e(a.htmlBindings.btnTicketNo).on("click",a.eventHandlers.btnTicketNo_onClick);e(a.htmlBindings.txtTicketId).on("keypress",a.eventHandlers.txtTicketId_onKeyPress).on("blur",a.eventHandlers.txtTicketId_onLeave);e(a.htmlBindings.txtLocation).on("keypress",a.eventHandlers.txtLocation_onKeyPress).on("blur",a.eventHandlers.txtLocation_onLeave);e(a.htmlBindings.modal_TicketList_Pager_btnPagerPages).on("click",a.eventHandlers.modal_ticketList_pager_btnPagerPages_onClick);a.functions.modal_ticketList_bindTableItemsEventHandlers()};a.functions.verifyTicket=function(f){e.ajax({data:{ticketId:f},url:a.url.verifyTicket,type:"post",beforeSend:function(){e(".loading").show()},success:function(g){var h=e.parseJSON(g);if(h.verified===true){a.status.ticketVerified=true;c.Helpers.setSuccessTo(a.htmlBindings.txtTicketId);ShowFeedback("Ticket verified.")}else{c.Helpers.setErrorTo(a.htmlBindings.txtTicketId);ShowFeedback("Ticket not found.")}e(".loading").hide()}})};a.functions.verifyLocation=function(f){e.ajax({data:{location:f},url:a.url.verifyLocation,type:"post",beforeSend:function(){e(".loading").show()},success:function(g){var h=e.parseJSON(g);if(h.verified===true){a.status.locationVerified=true;c.Helpers.setSuccessTo(a.htmlBindings.txtLocation);ShowFeedback("Location verified.")}else{c.Helpers.setErrorTo(a.htmlBindings.txtLocation);ShowFeedback("Location not found.")}e(".loading").hide()}})};a.functions.modal_ticketList_paginate=function(){e.ajax({data:{page:a.status.modal_TicketList_CurrentPage,itemsPerPage:a.status.modal_TicketList_ItemsPerPage},url:a.url.getTicketPage,type:"post",beforeSend:function(){e(".loading").show()},success:function(i){var j=e.parseJSON(i),f=new BootstrapPager(j,a.eventHandlers.modal_ticketList_pager_btnPagerPages_onClick),h=f.getCurrentPagedItems(),g=f.getPagerControl();e(a.htmlBindings.modal_TicketList_Pager_container).empty().append(g);a.functions.modal_ticketList_updateTable(h);e(".loading").hide()}})};a.functions.modal_ticketList_updateTable=function(f){var h=e(a.htmlBindings.modal_TicketList_Table),i=h.children("tbody"),g;i.empty();for(g in f){if(f.hasOwnProperty(g)){i.append(a.functions.modal_ticketList_buildTableItem(f[g],"","item-field"))}}a.functions.modal_ticketList_bindTableItemsEventHandlers()};a.functions.modal_ticketList_buildTableItem=function(k,o,l){var n=d.document,p=n.createElement("tr"),m=function(q){var r=n.createElement("td");r.className=l;r.appendChild(n.createTextNode(q));return r},f=function(t,s,q){var u=n.createElement("td"),r=n.createElement("a");r.href="#";r.className=s;r.dataset.ticketid=k.shprelno;if(typeof t==="string"){r.appendChild(n.createTextNode(t))}else{r.appendChild(t)}u.className=q||l;u.appendChild(r);return u},j=function(){return f(k.shprelno,a.htmlBindings.modal_TicketList_Table_btnTicket.slice(1))},h=function(){return m(k.qtyshprel)},g=function(){return m(k.qtypick)},i=function(){return m(k.company)};p.className=o;p.appendChild(j());p.appendChild(h());p.appendChild(g());p.appendChild(i());return p};a.functions.modal_ticketList_bindTableItemsEventHandlers=function(){e(a.htmlBindings.modal_TicketList_Table_btnTicket).on("click",a.eventHandlers.modal_ticketList_table_btnTicket_onClick)};a.eventHandlers={};a.eventHandlers.btnTicketNo_onClick=function(){e(a.htmlBindings.modal_TicketList).modal("show")};a.eventHandlers.txtTicketId_onKeyPress=function(f){a.status.ticketVerified=false;if(f.keyCode===13){a.functions.verifyTicket(f.target.value)}};a.eventHandlers.txtLocation_onKeyPress=function(f){a.status.locationVerified=false;if(f.keyCode===13){a.functions.verifyLocation(f.target.value)}};a.eventHandlers.txtTicketId_onLeave=function(f){if(!a.status.ticketVerified){a.functions.verifyTicket(f.target.value)}};a.eventHandlers.txtLocation_onLeave=function(f){if(!a.status.locationVerified){a.functions.verifyLocation(f.target.value)}};a.eventHandlers.modal_ticketList_pager_btnPagerPages_onClick=function(g){var f=e(g.target),h=f.data("page");a.status.modal_TicketList_CurrentPage=h;a.functions.modal_ticketList_paginate()};a.eventHandlers.modal_ticketList_table_btnTicket_onClick=function(g){var f=e(g.target),h=f.data("ticketid");a.status.modal_TicketList_CurrentTicket=h;e(a.htmlBindings.txtTicketId).val(a.status.modal_TicketList_CurrentTicket).focus();e(a.htmlBindings.modal_TicketList).modal("hide")};a.init=function(){console.log("PickTicket Init");a.functions.bindEventHandlers()}}(window,jQuery,App));