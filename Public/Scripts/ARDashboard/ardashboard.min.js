(function(){var d,f,b,e,a,c;c=window;d=c.jQuery;b=c.App;a=c.dandelion;f=a.namespace("App.ARDashboard",c);e=b.ARDashboard.DynamicFilter;f.status={};f.status.itemsPerPage=50;f.status.table_header_sortLastButton=null;f.status.table_header_sortField="custno";f.status.table_header_sortFieldOrder="ASC";f.status.currentPage=1;f.status.currentQuote="";f.dictionaries={};f.htmlBindings={};f.htmlBindings.container=".container";f.htmlBindings.itemCounter="#panelHeadingItemsCount";f.htmlBindings.drpItemPerPage=".top-pager-itemmperpage-control a";f.htmlBindings.drpItemPerPageValue=".top-pager-itemmperpage-control button span.value";f.htmlBindings.filterForm="#filterForm";f.htmlBindings.table="#arDashboardTable";f.htmlBindings.table_header_btnSort=".btn-table-sort";f.htmlBindings.table_body_btnCustNo=".custno-form-link";f.htmlBindings.table_body_btnAttach=".btn-files-dialog";f.htmlBindings.pager_container=".pager-wrapper";f.htmlBindings.pager_btnPagerPages=".pager-btn";f.functions={};f.functions.formatToCurrency=function(h,j){var g,i,l,k;if(j==null){j=","}k=h.toString();g=parseInt((k.length/3)-1,10);l=0;i=!!~k.indexOf(".");if(i){l=k.slice(k.indexOf(".")).length}k=k.split("").reverse().join("");while(g!==0){k=k.slice(0,(g*3)+l)+j+k.slice((g*3)+l);g-=1}k=k.split("").reverse().join("");if(k.charAt(0)===j){k=k.slice(1)}return k};f.functions.paginate=function(){d.ajax({data:{predicate:f.DynamicFilter.functions.getPredicate(),page:f.status.currentPage,itemsPerPage:f.status.itemsPerPage,orderby:f.status.table_header_sortField,order:f.status.table_header_sortFieldOrder},url:f.urls.getPage,type:"post",beforeSend:function(){return d(".loading").show()},success:function(j,m,k){var l,g,i,h;l=d.parseJSON(j);g=new BootstrapPager(l,f.eventHandlers.pager_btnPagerPages_onClick);h=g.getCurrentPagedItems();i=g.getPagerControl();d(f.htmlBindings.pager_container).empty().append(i);f.functions.updateTable(h);d(f.htmlBindings.itemCounter).html(g.itemsCount);return d(".loading").hide()}});return this};f.functions.updateTable=function(g){var i,j,h;i=d(f.htmlBindings.table);j=i.children("tbody");j.empty();for(h in g){if(g.hasOwnProperty(h)){j.append(f.functions.buildTableItem(g[h],"","item-field"))}}f.functions.bindTableItemsEventHandlers();return this};f.functions.buildTableItem=function(p,l,o){var w,n,j,t,m,i,r,s,k,q,u,x,v,h,g;w=c.document;n=w.createElement("tr");t=function(y){var z;z=w.createElement("td");z.className=o;z.appendChild(w.createTextNode(y));return z};h=function(B,A,y){var z,C;C=w.createElement("td");z=w.createElement("a");z.href="#";z.className=A;z.dataset.qutno=p.qutno;if(typeof B==="string"){z.appendChild(w.createTextNode(B))}else{z.appendChild(B)}C.className=y||o;C.appendChild(z);return C};j=function(E,A){var z,D,B,C,y;y=w.createElement("select");C=w.createElement("option");C.appendChild(w.createTextNode("Empty"));y.appendChild(C);for(B in A){if(A.hasOwnProperty(B)){z=A[B].id;D=A[B].descrip;C=w.createElement("option");if(E===z){C.selected="selected"}C.value=z;C.appendChild(w.createTextNode(D));y.appendChild(C)}}y.className="form-control update-dropdown";return y};g=function(A,C,z){var y,B;B=w.createElement("td");y=j(A,C);y.dataset.ordnum=p.ordnum;y.className+=" select2-nosearch "+z;B.appendChild(y);return B};s=function(){return h(p.custno,f.htmlBindings.table_body_btnCustNo.slice(1))};i=function(){return t(p.company)};r=function(){return t(f.functions.formatToCurrency(p.current))};k=function(){return t(p["11-30"])};q=function(){return t(p["31-45"])};u=function(){return t(p["46-60"])};x=function(){return t(p["61-90"])};v=function(){return t(p[">91"])};m=function(){return t(f.functions.formatToCurrency(p.balance))};n.className=l;n.appendChild(s());n.appendChild(i());n.appendChild(r());n.appendChild(k());n.appendChild(q());n.appendChild(u());n.appendChild(x());n.appendChild(v());n.appendChild(m());return n};f.functions.bindTableItemsEventHandlers=function(){return this};f.functions.bindEventHandlers=function(){d(f.htmlBindings.drpItemPerPage).on("click",f.eventHandlers.drpItemPerPage_onClick);d(f.htmlBindings.table_header_btnSort).on("click",f.eventHandlers.table_body_btnSort_onClick);d(f.htmlBindings.pager_btnPagerPages).on("click",f.eventHandlers.pager_btnPagerPages_onClick);f.functions.bindTableItemsEventHandlers();return this};f.eventHandlers={};f.eventHandlers.drpItemPerPage_onClick=function(h){var g,i;g=d(h.target);i=g.html();f.status.itemsPerPage=i;d(f.htmlBindings.drpItemPerPageValue).text(i);f.status.currentPage=1;f.functions.paginate();return this};f.eventHandlers.pager_btnPagerPages_onClick=function(h){var g,i;g=d(h.target);i=g.data("page");f.status.currentPage=i;f.functions.paginate();return this};f.eventHandlers.table_body_btnSort_onClick=function(h){var g,i;g=d(h.target);i=g.data("field");if(f.status.table_header_sortLastButton!==null){f.status.table_header_sortLastButton.removeClass("asc desc")}if(f.status.table_header_sortField!==i){f.status.table_header_sortFieldOrder=""}f.status.table_header_sortField=i;if(f.status.table_header_sortFieldOrder==="ASC"){f.status.table_header_sortFieldOrder="DESC";g.addClass("asc").removeClass("desc")}else{f.status.table_header_sortFieldOrder="ASC";g.addClass("desc").removeClass("asc")}f.status.table_header_sortLastButton=g;f.functions.paginate();return this};f.init=function(g){f.status.itemsPerPage=d(f.htmlBindings.drpItemPerPageValue).text();e.init(g);return f.functions.bindEventHandlers()}}).call(this);