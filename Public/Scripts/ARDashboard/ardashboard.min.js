(function(){var d,f,b,e,a,c;c=window;d=c.jQuery;b=c.App;a=c.dandelion;f=a.namespace("App.ARDashboard",c);e=b.ARDashboard.DynamicFilter;f.status={};f.status.itemsPerPage=50;f.status.table_header_sortLastButton=null;f.status.table_header_sortField="custno";f.status.table_header_sortFieldOrder="ASC";f.status.currentPage=1;f.status.currentCustno="";f.status.modal_detail_CurrentTicket="";f.status.modal_detail_CurrentPage=1;f.status.modal_detail_ItemsPerPage=10;f.dictionaries={};f.htmlBindings={};f.htmlBindings.container=".container";f.htmlBindings.itemCounter="#panelHeadingItemsCount";f.htmlBindings.drpItemPerPage=".top-pager-itemmperpage-control a";f.htmlBindings.drpItemPerPageValue=".top-pager-itemmperpage-control button span.value";f.htmlBindings.filterForm="#filterForm";f.htmlBindings.table="#arDashboardTable";f.htmlBindings.table_header_btnSort=".btn-table-sort";f.htmlBindings.table_body_btnCustNo=".custno-form-link";f.htmlBindings.table_body_btnAttach=".btn-files-dialog";f.htmlBindings.pager_container=".pager-wrapper";f.htmlBindings.pager_btnPagerPages=".pager-btn";f.htmlBindings.modal_Details="#details_modal";f.htmlBindings.modal_Details_balance="#balance";f.htmlBindings.modal_Details_Pager_container=".pager-wrapper";f.htmlBindings.modal_Details_Pager_btnPagerPages=".pager-btn";f.htmlBindings.modal_Details_Table="#details";f.functions={};f.functions.formatToCurrency=function(h,j){var g,i,l,k;if(j==null){j=","}k=h.toString();g=parseInt((k.length/3)-1,10);l=0;i=!!~k.indexOf(".");if(i){l=k.slice(k.indexOf(".")).length}k=k.split("").reverse().join("");while(g!==0){k=k.slice(0,(g*3)+l)+j+k.slice((g*3)+l);g-=1}k=k.split("").reverse().join("");if(k.charAt(0)===j){k=k.slice(1)}return k};f.functions.paginate=function(){d.ajax({data:{predicate:f.DynamicFilter.functions.getPredicate(),page:f.status.currentPage,itemsPerPage:f.status.itemsPerPage,orderby:f.status.table_header_sortField,order:f.status.table_header_sortFieldOrder},url:f.urls.getPage,type:"post",beforeSend:function(){return d(".loading").show()},success:function(j,m,k){var l,g,i,h;l=d.parseJSON(j);g=new BootstrapPager(l,f.eventHandlers.pager_btnPagerPages_onClick);h=g.getCurrentPagedItems();i=g.getPagerControl();d(f.htmlBindings.pager_container).empty().append(i);f.functions.updateTable(h);d(f.htmlBindings.itemCounter).html(g.itemsCount);return d(".loading").hide()}});return this};f.functions.updateTable=function(g){var i,j,h;i=d(f.htmlBindings.table);j=i.children("tbody");j.empty();for(h in g){if(g.hasOwnProperty(h)){j.append(f.functions.buildTableItem(g[h],"","item-field"))}}f.functions.bindTableItemsEventHandlers();return this};f.functions.buildTableItem=function(p,l,o){var w,n,j,t,m,i,r,s,k,q,u,x,v,h,g;w=c.document;n=w.createElement("tr");t=function(y){var z;z=w.createElement("td");z.className=o;z.appendChild(w.createTextNode(y));return z};h=function(B,A,y){var z,C;C=w.createElement("td");z=w.createElement("a");z.href="#";z.className=A;z.dataset.qutno=p.qutno;if(typeof B==="string"){z.appendChild(w.createTextNode(B))}else{z.appendChild(B)}C.className=y||o;C.appendChild(z);return C};j=function(E,A){var z,D,B,C,y;y=w.createElement("select");C=w.createElement("option");C.appendChild(w.createTextNode("Empty"));y.appendChild(C);for(B in A){if(A.hasOwnProperty(B)){z=A[B].id;D=A[B].descrip;C=w.createElement("option");if(E===z){C.selected="selected"}C.value=z;C.appendChild(w.createTextNode(D));y.appendChild(C)}}y.className="form-control update-dropdown";return y};g=function(A,C,z){var y,B;B=w.createElement("td");y=j(A,C);y.dataset.ordnum=p.ordnum;y.className+=" select2-nosearch "+z;B.appendChild(y);return B};s=function(){return h(p.custno,f.htmlBindings.table_body_btnCustNo.slice(1))};i=function(){return t(p.company)};r=function(){return t(f.functions.formatToCurrency(p.current))};k=function(){return t(f.functions.formatToCurrency(p["11-30"]))};q=function(){return t(f.functions.formatToCurrency(p["31-45"]))};u=function(){return t(f.functions.formatToCurrency(p["46-60"]))};x=function(){return t(f.functions.formatToCurrency(p["61-90"]))};v=function(){return t(f.functions.formatToCurrency(p[">91"]))};m=function(){return t(f.functions.formatToCurrency(p.balance))};n.className=l;n.appendChild(s());n.appendChild(i());n.appendChild(r());n.appendChild(k());n.appendChild(q());n.appendChild(u());n.appendChild(x());n.appendChild(v());n.appendChild(m());return n};f.functions.bindTableItemsEventHandlers=function(){d(f.htmlBindings.table_body_btnCustNo).on("click",f.eventHandlers.table_body_btnCustNo_onClick);return this};f.functions.bindEventHandlers=function(){d(f.htmlBindings.drpItemPerPage).on("click",f.eventHandlers.drpItemPerPage_onClick);d(f.htmlBindings.table_header_btnSort).on("click",f.eventHandlers.table_body_btnSort_onClick);d(f.htmlBindings.pager_btnPagerPages).on("click",f.eventHandlers.pager_btnPagerPages_onClick);f.functions.bindTableItemsEventHandlers();return this};f.functions.modal_details_paginate=function(){d.ajax({data:{page:f.status.modal_detail_CurrentPage,itemsPerPage:f.status.modal_detail_ItemsPerPage,custno:f.status.currentCustno},url:f.urls.getCustnoDetailPage,type:"post",beforeSend:function(){return d(".loading").show()},success:function(j){var k,g,i,h;k=d.parseJSON(j);g=new BootstrapPager(k,f.eventHandlers.modal_details_pager_btnPagerPages_onClick);h=g.getCurrentPagedItems();i=g.getPagerControl();d(f.htmlBindings.modal_Details_Pager_container).empty().append(i);f.functions.modal_details_updateTable(h);return d(".loading").hide()}});return this};f.functions.modal_details_updateTable=function(g){var i,j,h;i=d(f.htmlBindings.modal_Details_Table);j=i.children("tbody");j.empty();for(h in g){console.log(h);if(g.hasOwnProperty(h)){j.append(f.functions.modal_details_buildTableItem(g[h],"","item-field"))}}f.functions.modal_details_bindTableItemsEventHandlers();return this};f.functions.modal_details_buildTableItem=function(j,r,m){var p,s,o,i,q,h,n,k,l,g;console.log(j);p=c.document;s=p.createElement("tr");o=function(t){var u;u=p.createElement("td");u.className=m;u.appendChild(p.createTextNode(t));return u};g=function(w,v,t){var u,x;x=p.createElement("td");u=p.createElement("a");u.href="#";u.className=v;u.dataset.qutno=j.qutno;if(typeof w==="string"){u.appendChild(p.createTextNode(w))}else{u.appendChild(w)}x.className=t||m;x.appendChild(u);return x};i=function(){return o(j.amtpaid)};q=function(){return o(j.datepaid)};h=function(){return o(j.invdate)};n=function(){return o(j.invno)};k=function(){return o(j.openbal)};l=function(){return o(j.refno)};s.className=r;s.appendChild(n());s.appendChild(h());s.appendChild(i());s.appendChild(q());s.appendChild(l());s.appendChild(k());return s};f.functions.modal_details_bindTableItemsEventHandlers=function(){return this};f.eventHandlers={};f.eventHandlers.drpItemPerPage_onClick=function(h){var g,i;g=d(h.target);i=g.html();f.status.itemsPerPage=i;d(f.htmlBindings.drpItemPerPageValue).text(i);f.status.currentPage=1;f.functions.paginate();return this};f.eventHandlers.pager_btnPagerPages_onClick=function(h){var g,i;g=d(h.target);i=g.data("page");f.status.currentPage=i;f.functions.paginate();return this};f.eventHandlers.table_body_btnSort_onClick=function(h){var g,i;g=d(h.target);i=g.data("field");if(f.status.table_header_sortLastButton!==null){f.status.table_header_sortLastButton.removeClass("asc desc")}if(f.status.table_header_sortField!==i){f.status.table_header_sortFieldOrder=""}f.status.table_header_sortField=i;if(f.status.table_header_sortFieldOrder==="ASC"){f.status.table_header_sortFieldOrder="DESC";g.addClass("asc").removeClass("desc")}else{f.status.table_header_sortFieldOrder="ASC";g.addClass("desc").removeClass("asc")}f.status.table_header_sortLastButton=g;f.functions.paginate();return this};f.eventHandlers.table_body_btnCustNo_onClick=function(h){var g,i;g=d(h.target);f.status.currentCustno=g.text();i=g.parent().parent().children(":last").text();d.ajax({data:{custno:f.status.currentCustno,balance:i},url:f.urls.getCustnoDetailPage,type:"post",beforeSend:function(){return d(".loading").show()},success:function(m,p,n){var o,j,l,k;o=d.parseJSON(m);j=new BootstrapPager(o,f.eventHandlers.modal_details_pager_btnPagerPages_onClick);k=j.getCurrentPagedItems();l=j.getPagerControl();d(f.htmlBindings.modal_Details_Pager_container).empty().append(l);f.functions.modal_details_updateTable(k);d(f.htmlBindings.modal_Details_balance).text("$ "+i);d(f.htmlBindings.modal_Details).modal();return d(".loading").hide()}});return this};f.eventHandlers.modal_details_pager_btnPagerPages_onClick=function(h){var g,i;g=d(h.target);i=g.data("page");f.status.modal_detail_CurrentPage=i;f.functions.modal_details_paginate();return this};f.init=function(g){f.status.itemsPerPage=d(f.htmlBindings.drpItemPerPageValue).text();e.init(g);return f.functions.bindEventHandlers()}}).call(this);