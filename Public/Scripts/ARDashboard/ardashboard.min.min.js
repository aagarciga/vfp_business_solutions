(function(){var k,i,g,j,h,l;l=window;k=l.jQuery;g=l.App;h=l.dandelion;i=h.namespace("App.ARDashboard",l);j=g.ARDashboard.DynamicFilter;i.status={};i.status.itemsPerPage=50;i.status.table_header_sortLastButton=null;i.status.table_header_sortField="custno";i.status.table_header_sortFieldOrder="ASC";i.status.currentPage=1;i.status.currentCustno="";i.status.currentSet="details";i.status.currentBalance="0.0";i.status.modal_detail_CurrentTicket="";i.status.modal_detail_CurrentPage=1;i.status.modal_detail_ItemsPerPage=10;i.dictionaries={};i.htmlBindings={};i.htmlBindings.container=".container";i.htmlBindings.itemCounter="#panelHeadingItemsCount";i.htmlBindings.drpItemPerPage=".top-pager-itemmperpage-control a";i.htmlBindings.drpItemPerPageValue=".top-pager-itemmperpage-control button span.value";i.htmlBindings.filterForm="#filterForm";i.htmlBindings.table="#arDashboardTable";i.htmlBindings.table_header_btnSort=".btn-table-sort";i.htmlBindings.table_body_btnCustNo=".btn-custno-form-link";i.htmlBindings.table_body_btnCurrent=".btn-current-form-link";i.htmlBindings.table_body_btn11_30=".btn-11-30-form-link";i.htmlBindings.table_body_btn31_45=".btn-31-45-form-link";i.htmlBindings.table_body_btn46_60=".btn-46-60-form-link";i.htmlBindings.table_body_btn61_90=".btn-61-90-form-link";i.htmlBindings.table_body_btnMoreThan90=".btn-more-than-90-form-link";i.htmlBindings.table_body_btnAttach=".btn-files-dialog";i.htmlBindings.pager_container=".pager-wrapper";i.htmlBindings.pager_btnPagerPages=".pager-btn";i.htmlBindings.modal_Details="#details_modal";i.htmlBindings.modal_Details_balance="#balance";i.htmlBindings.modal_Details_Pager_container=".pager-wrapper-details";i.htmlBindings.modal_Details_Pager_btnPagerPages=".pager-btn";i.htmlBindings.modal_Details_Table="#details";i.functions={};i.functions.updateDetailSumary=function(a){var b,d,c;c=accounting.formatMoney(a.balance,"$ ");d=accounting.formatMoney(a.balancePortion,"");if(a.setname===""){b=a.custno+" balance: "+c}else{b=" "+a.custno+" [ "+a.setname+" ] balance: "+c}k(i.htmlBindings.modal_Details_balance).text(b);return this};i.functions.paginate=function(){k.ajax({data:{predicate:i.DynamicFilter.functions.getPredicate(),page:i.status.currentPage,itemsPerPage:i.status.itemsPerPage,orderby:i.status.table_header_sortField,order:i.status.table_header_sortFieldOrder},url:i.urls.getPage,type:"post",beforeSend:function(){return k(".loading").show()},success:function(d,a,c){var b,n,e,f;b=k.parseJSON(d);n=new BootstrapPager(b,i.eventHandlers.pager_btnPagerPages_onClick);f=n.getCurrentPagedItems();e=n.getPagerControl();k(i.htmlBindings.pager_container).empty().append(e);i.functions.updateTable(f);k(i.htmlBindings.itemCounter).html(n.itemsCount);return k(".loading").hide()}});return this};i.functions.updateTable=function(d){var b,a,c;b=k(i.htmlBindings.table);a=b.children("tbody");a.empty();for(c in d){if(d.hasOwnProperty(c)){a.append(i.functions.buildTableItem(d[c],"","item-field"))}}i.functions.bindTableItemsEventHandlers();return this};i.functions.buildTableItem=function(A,E,B){var b,C,G,e,D,H,y,f,F,z,d,a,c,I,J;b=l.document;C=b.createElement("tr");e=function(n,o){var m;m=b.createElement("td");m.className=o;m.appendChild(b.createTextNode(n));return m};I=function(q,m,p){var o,n;n=b.createElement("td");o=b.createElement("a");o.href="#";o.className=m;o.dataset.custno=A.custno;if(typeof q==="string"){o.appendChild(b.createTextNode(q))}else{o.appendChild(q)}n.className=p||B;n.appendChild(o);return n};G=function(n,m){var q,o,s,p,r;r=b.createElement("select");p=b.createElement("option");p.appendChild(b.createTextNode("Empty"));r.appendChild(p);for(s in m){if(m.hasOwnProperty(s)){q=m[s].id;o=m[s].descrip;p=b.createElement("option");if(n===q){p.selected="selected"}p.value=q;p.appendChild(b.createTextNode(o));r.appendChild(p)}}r.className="form-control update-dropdown";return r};J=function(m,o,n){var q,p;p=b.createElement("td");q=G(m,o);q.dataset.ordnum=A.ordnum;q.className+=" select2-nosearch "+n;p.appendChild(q);return p};f=function(){return I(A.custno,i.htmlBindings.table_body_btnCustNo.slice(1))};H=function(){return e(A.company)};y=function(){if(A.current==="0"){return e(accounting.formatMoney(A.current,""),"currency")}else{return I(accounting.formatMoney(A.current,""),i.htmlBindings.table_body_btnCurrent.slice(1),"currency")}};F=function(){if(A["11-30"]==="0"){return e(accounting.formatMoney(A["11-30"],""),"currency")}else{return I(accounting.formatMoneyformatMoney(A["11-30"],""),i.htmlBindings.table_body_btn11_30.slice(1),"currency")}};z=function(){if(A["31-45"]==="0"){return e(accounting.formatMoney(A["31-45"],""),"currency")}else{return I(accounting.formatMoney(A["31-45"],""),i.htmlBindings.table_body_btn31_45.slice(1),"currency")}};d=function(){if(A["46-60"]==="0"){return e(accounting.formatMoney(A["46-60"],""),"currency")}else{return I(accounting.formatMoney(A["46-60"],""),i.htmlBindings.table_body_btn46_60.slice(1),"currency")}};a=function(){if(A["61-90"]==="0"){return e(accounting.formatMoney(A["61-90"],""),"currency")}else{return I(accounting.formatMoney(A["61-90"],""),i.htmlBindings.table_body_btn61_90.slice(1),"currency")}};c=function(){if(A[">91"]==="0"){return e(accounting.formatMoney(A[">91"],""),"currency")}else{return I(accounting.formatMoney(A[">91"],""),i.htmlBindings.table_body_btnMoreThan90.slice(1),"currency")}};D=function(){return e(accounting.formatMoney(A.balance,""),"currency")};C.className=E;C.appendChild(f());C.appendChild(H());C.appendChild(y());C.appendChild(F());C.appendChild(z());C.appendChild(d());C.appendChild(a());C.appendChild(c());C.appendChild(D());return C};i.functions.bindTableItemsEventHandlers=function(){k(i.htmlBindings.table_body_btnCustNo).on("click",i.eventHandlers.table_body_btnCustNo_onClick);k(i.htmlBindings.table_body_btnCurrent).on("click",i.eventHandlers.table_body_btnCustNo_onClick);k(i.htmlBindings.table_body_btn11_30).on("click",i.eventHandlers.table_body_btnCustNo_onClick);k(i.htmlBindings.table_body_btn31_45).on("click",i.eventHandlers.table_body_btnCustNo_onClick);k(i.htmlBindings.table_body_btn46_60).on("click",i.eventHandlers.table_body_btnCustNo_onClick);k(i.htmlBindings.table_body_btn61_90).on("click",i.eventHandlers.table_body_btnCustNo_onClick);k(i.htmlBindings.table_body_btnMoreThan90).on("click",i.eventHandlers.table_body_btnCustNo_onClick);return this};i.functions.bindEventHandlers=function(){k(i.htmlBindings.drpItemPerPage).on("click",i.eventHandlers.drpItemPerPage_onClick);k(i.htmlBindings.table_header_btnSort).on("click",i.eventHandlers.table_body_btnSort_onClick);k(i.htmlBindings.pager_btnPagerPages).on("click",i.eventHandlers.pager_btnPagerPages_onClick);i.functions.bindTableItemsEventHandlers();return this};i.functions.modal_details_paginate=function(){k.ajax({data:{setname:i.status.currentSet,page:i.status.modal_detail_CurrentPage,itemsPerPage:i.status.modal_detail_ItemsPerPage,custno:i.status.currentCustno,balance:i.status.currentBalance},url:i.urls.getCustnoDetailPage,type:"post",beforeSend:function(){return k(".loading").show()},success:function(b){var a,e,c,d;a=k.parseJSON(b);e=new BootstrapPager(a,i.eventHandlers.modal_details_pager_btnPagerPages_onClick);d=e.getCurrentPagedItems();c=e.getPagerControl();k(i.htmlBindings.modal_Details_Pager_container).empty().append(c);i.functions.modal_details_updateTable(d);i.functions.updateDetailSumary(a);return k(".loading").hide()}});return this};i.functions.modal_details_updateTable=function(d){var b,a,c;b=k(i.htmlBindings.modal_Details_Table);a=b.children("tbody");a.empty();for(c in d){if(d.hasOwnProperty(c)){a.append(i.functions.modal_details_buildTableItem(d[c],"","item-field"))}}i.functions.modal_details_bindTableItemsEventHandlers();return this};i.functions.modal_details_buildTableItem=function(v,b,s){var d,a,e,w,c,x,f,u,t;d=l.document;a=d.createElement("tr");e=function(n,o){var m;m=d.createElement("td");m.className=o;m.appendChild(d.createTextNode(n));return m};w=function(){return e(accounting.formatMoney(v.amtpaid,""),"currency")};c=function(){return e(v.datepaid)};x=function(){return e(v.invdate)};f=function(){return e(v.invno)};u=function(){return e(accounting.formatMoney(v.openbal,""),"currency")};t=function(){return e(v.refno)};a.className=b;a.appendChild(f());a.appendChild(x());a.appendChild(w());a.appendChild(c());a.appendChild(t());a.appendChild(u());return a};i.functions.modal_details_bindTableItemsEventHandlers=function(){return this};i.eventHandlers={};i.eventHandlers.drpItemPerPage_onClick=function(b){var c,a;c=k(b.target);a=c.html();i.status.itemsPerPage=a;k(i.htmlBindings.drpItemPerPageValue).text(a);i.status.currentPage=1;i.functions.paginate();return this};i.eventHandlers.pager_btnPagerPages_onClick=function(b){var c,a;c=k(b.target);a=c.data("page");i.status.currentPage=a;i.functions.paginate();return this};i.eventHandlers.table_body_btnSort_onClick=function(b){var c,a;c=k(b.target);a=c.data("field");if(i.status.table_header_sortLastButton!==null){i.status.table_header_sortLastButton.removeClass("asc desc")}if(i.status.table_header_sortField!==a){i.status.table_header_sortFieldOrder=""}i.status.table_header_sortField=a;if(i.status.table_header_sortFieldOrder==="ASC"){i.status.table_header_sortFieldOrder="DESC";c.addClass("asc").removeClass("desc")}else{i.status.table_header_sortFieldOrder="ASC";c.addClass("desc").removeClass("asc")}i.status.table_header_sortLastButton=c;i.functions.paginate();return this};i.eventHandlers.table_body_btnCustNo_onClick=function(a){var b;b=k(a.target);i.status.currentCustno=b.data("custno");i.status.currentBalance=b.text().trim();if(b.attr("class")===i.htmlBindings.table_body_btnCustNo.slice(1)){i.status.currentBalance=b.parent().parent().children(":last").text();i.status.currentSet="details"}if(b.attr("class")===i.htmlBindings.table_body_btnCurrent.slice(1)){i.status.currentSet="setCurrent"}else{if(b.attr("class")===i.htmlBindings.table_body_btn11_30.slice(1)){i.status.currentSet="set11_30"}else{if(b.attr("class")===i.htmlBindings.table_body_btn31_45.slice(1)){i.status.currentSet="set31_45"}else{if(b.attr("class")===i.htmlBindings.table_body_btn46_60.slice(1)){i.status.currentSet="set45_60"}else{if(b.attr("class")===i.htmlBindings.table_body_btn61_90.slice(1)){i.status.currentSet="set61_90"}else{if(b.attr("class")===i.htmlBindings.table_body_btnMoreThan90.slice(1)){i.status.currentSet="setGreatherThan90"}}}}}}k.ajax({data:{setname:i.status.currentSet,custno:i.status.currentCustno,balance:i.status.currentBalance},url:i.urls.getCustnoDetailPage,type:"post",beforeSend:function(){return k(".loading").show()},success:function(d,q,c){var r,p,e,f;r=k.parseJSON(d);p=new BootstrapPager(r,i.eventHandlers.modal_details_pager_btnPagerPages_onClick);f=p.getCurrentPagedItems();e=p.getPagerControl();k(i.htmlBindings.modal_Details_Pager_container).empty().append(e);i.functions.modal_details_updateTable(f);i.functions.updateDetailSumary(r);k(i.htmlBindings.modal_Details).modal();return k(".loading").hide()}});return this};i.eventHandlers.modal_details_pager_btnPagerPages_onClick=function(b){var c,a;c=k(b.target);a=c.data("page");i.status.modal_detail_CurrentPage=a;i.status.currentSet;i.functions.modal_details_paginate();return this};i.init=function(a){i.status.itemsPerPage=k(i.htmlBindings.drpItemPerPageValue).text();j.init(a);return i.functions.bindEventHandlers()}}).call(this);