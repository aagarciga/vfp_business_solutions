(function(){var e,b,f,d,g,a,c;c=window;e=c.jQuery;b=c.App;a=c.dandelion;d=a.namespace("App.EquipmentDashboard",c);f=b.EquipmentDashboard.DynamicFilter;g=b.EquipmentDashboard.ProjectFiles;d.status={};d.status.itemsPerPage=50;d.status.table_header_sortLastButton=null;d.status.table_header_sortField="ordnum";d.status.table_header_sortFieldOrder="ASC";d.status.currentPage=1;d.status.currentEquipid="";d.status.currentSet="details";d.status.currentBalance="0.0";d.dictionaries={};d.htmlBindings={};d.htmlBindings.container=".container";d.htmlBindings.itemCounter="#panelHeadingItemsCount";d.htmlBindings.drpItemPerPage=".top-pager-itemmperpage-control a";d.htmlBindings.drpItemPerPageValue=".top-pager-itemmperpage-control button span.value";d.htmlBindings.filterForm="#filterForm";d.htmlBindings.table="#EquipmentDashboardTable";d.htmlBindings.table_header_btnSort=".btn-table-sort";d.htmlBindings.table_body_btnCommitted=".btn-committed-form-link";d.htmlBindings.table_body_btnOnorder=".btn-onorder-form-link";d.htmlBindings.table_body_btnAttach=".btn-files-dialog";d.htmlBindings.table_body_drpStatus=".status.update-dropdown ";d.htmlBindings.pager_container=".pager-wrapper";d.htmlBindings.pager_btnPagerPages=".pager-btn";d.htmlBindings.table_body_field_btn_edit="#btn-edit";d.functions={};d.functions.paginate=function(){var h,i;h=b.EquipmentDashboard.DynamicFilter.functions.getFilterTree();i=JSON.stringify(h);e.ajax({data:{filterTree:i,page:d.status.currentPage,itemsPerPage:d.status.itemsPerPage,orderby:d.status.table_header_sortField,order:d.status.table_header_sortFieldOrder},url:d.urls.getPage,type:"post",beforeSend:function(){return e(".loading").show()},success:function(m,p,n){var o,j,l,k;o=e.parseJSON(m);j=new BootstrapPager(o,d.eventHandlers.pager_btnPagerPages_onClick);k=j.getCurrentPagedItems();l=j.getPagerControl();e(d.htmlBindings.pager_container).empty().append(l);d.functions.updateTable(k);e(d.htmlBindings.itemCounter).html(j.itemsCount);return e(".loading").hide()}});return this};d.functions.updateTable=function(h){var j,k,i;j=e(d.htmlBindings.table);k=j.children("tbody");k.empty();for(i in h){if(h.hasOwnProperty(i)){k.append(d.functions.buildTableItem(h[i],"","item-field"))}}d.functions.bindTableItemsEventHandlers();return this};d.functions.buildTableItem=function(s,j,q){var D,m,k,u,n,t,B,z,x,l,o,r,w,y,p,i,A,h,v,C;D=c.document;m=D.createElement("tr");i=function(){return b.Helpers.simpleTdBuilder(s.ordnum,"")};z=function(){return b.Helpers.withLinkTdBuilder(s.equipid,"","",b.Helpers.Href("HistoryDashboard","Index",{equipid:btoa(s.equipid),jsonFilterTree:btoa(JSON.stringify(d.DynamicFilter.functions.getFilterTree())),itemPerPage:d.status.itemsPerPage,page:d.status.currentPage,orderBy:d.status.table_header_sortField,order:d.status.table_header_sortFieldOrder}),{})};o=function(){return b.Helpers.simpleTdBuilder(s.itemno,"")};t=function(){return b.Helpers.simpleTdBuilder(s.descrip,"")};w=function(){return b.Helpers.simpleTdBuilder(s.make,"")};y=function(){return b.Helpers.simpleTdBuilder(s.model,"")};h=function(){return b.Helpers.simpleTdBuilder(s.serialno,"")};C=function(){return b.Helpers.simpleTdBuilder(s.Voltage,"")};B=function(){return b.Helpers.simpleTdBuilder(s.EquipType,"")};l=function(){return b.Helpers.simpleTdBuilder(s.installdte,"")};x=function(){return b.Helpers.simpleTdBuilder(s.expdtein,"")};n=function(){return b.Helpers.simpleTdBuilder(s.daterec,"")};v=function(){return b.Helpers.withSelectBuilder(s.status,"","form-control update-dropdown status select2-nosearch",d.status.statusValue,{equipid:s.equipid})};p=function(){return b.Helpers.simpleTdBuilder(s.notes,"")};A=function(){return b.Helpers.withLightboxLinkPictureBuilder(s.equipid,"item-image","",s.picture_fi,"glyphicon glyphicon-eye-open",null,{})};k=function(){return b.Helpers.simpleTdBuilder(s.assettag,"")};r=function(){return b.Helpers.simpleTdBuilder(s.Locno,"")};u=function(){var E;E=D.createElement("span");E.className="glyphicon glyphicon-folder-close";return b.Helpers.withLinkTdBuilder(E,"item-action item-files",d.htmlBindings.table_body_btnAttach.slice(1),"#",{equipid:s.equipid})};m.className=j;m.appendChild(i());m.appendChild(z());m.appendChild(o());m.appendChild(t());m.appendChild(w());m.appendChild(y());m.appendChild(h());m.appendChild(C());m.appendChild(B());m.appendChild(l());m.appendChild(x());m.appendChild(n());m.appendChild(v());m.appendChild(p());m.appendChild(A());m.appendChild(k());m.appendChild(r());m.appendChild(u());return m};d.functions.bindTableItemsEventHandlers=function(){e(d.htmlBindings.table_body_btnAttach).on("click",d.eventHandlers.table_body_btnAttach_onClick);e(d.htmlBindings.table_body_drpStatus).on("change",d.eventHandlers.table_body_dprStatus_onChange);e(d.htmlBindings.table_body_field_btn_edit).on("click",d.eventHandlers.table_body_field_edit_onClick);return this};d.functions.bindEventHandlers=function(){e(d.htmlBindings.drpItemPerPage).on("click",d.eventHandlers.drpItemPerPage_onClick);e(d.htmlBindings.table_header_btnSort).on("click",d.eventHandlers.table_body_btnSort_onClick);e(d.htmlBindings.pager_btnPagerPages).on("click",d.eventHandlers.pager_btnPagerPages_onClick);d.functions.bindTableItemsEventHandlers();e(d.htmlBindings.table_body_btnAttach).on("click",d.eventHandlers.table_body_btnAttach_onClick);return this};d.eventHandlers={};d.eventHandlers.drpItemPerPage_onClick=function(i){var h,j;h=e(i.target);j=h.html();d.status.itemsPerPage=j;e(d.htmlBindings.drpItemPerPageValue).text(j);d.status.currentPage=1;d.functions.paginate();return this};d.eventHandlers.pager_btnPagerPages_onClick=function(i){var h,j;h=e(i.target);j=h.data("page");d.status.currentPage=j;d.functions.paginate();return this};d.eventHandlers.table_body_btnSort_onClick=function(i){var h,j;h=e(i.target);j=h.data("field");if(d.status.table_header_sortLastButton!==null){d.status.table_header_sortLastButton.removeClass("asc desc")}if(d.status.table_header_sortField!==j){d.status.table_header_sortFieldOrder=""}d.status.table_header_sortField=j;if(d.status.table_header_sortFieldOrder==="ASC"){d.status.table_header_sortFieldOrder="DESC";h.addClass("asc").removeClass("desc")}else{d.status.table_header_sortFieldOrder="ASC";h.addClass("desc").removeClass("asc")}d.status.table_header_sortLastButton=h;d.functions.paginate();return this};d.eventHandlers.table_body_btnAttach_onClick=function(j){var h,i;h=e(this).data("equipid");i=h+"_EQ";d.status.currentEquipid=i;g.functions.loadFileTree(i);e(g.htmlBindings.modal_ProjectFiles).modal("show");return this};d.eventHandlers.table_body_dprStatus_onChange=function(j){var h,i,k;h=e(j.target);i=h.data("equipid");k=h.val();e.ajax({data:{equipid:i,status:k},url:d.urls.updateStatus,type:"post",beforeSend:function(){return e(".loading").show()},success:function(l){var m;m=e.parseJSON(l);if(m==="success"){return e(".loading").hide()}else{throw m}}});return this};d.eventHandlers.table_body_field_edit_onClick=function(j){var i,h;i=e(j.target);h=i.data("qbtxlineid");c.location=b.Helpers.Href("EditTupleDashboard","Edit",{id:atob(h),redirect:atob(JSON.stringify({controller:"EquipmentDashboard",action:"Index"}))});return this};d.init=function(k,h){var j,m,i,l;d.status.fieldsDefinition=e.parseJSON(h);i=[];m=d.status.fieldsDefinition.status["values"];for(j in m){if(m.hasOwnProperty(j)){l=m[j];i.push({id:j,descrip:l})}}d.status.statusValue=i;d.dictionaries.status=i;d.status.itemsPerPage=e(d.htmlBindings.drpItemPerPageValue).text();f.init(k,d.status.fieldsDefinition);g.init();d.functions.bindEventHandlers();return this}}).call(this);