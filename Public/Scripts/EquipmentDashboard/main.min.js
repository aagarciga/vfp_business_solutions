(function(){var e,b,f,d,g,a,c;c=window;e=c.jQuery;b=c.App;a=c.dandelion;d=a.namespace("App.EquipmentDashboard",c);f=b.EquipmentDashboard.DynamicFilter;g=b.EquipmentDashboard.ProjectFiles;d.status={};d.status.itemsPerPage=50;d.status.table_header_sortLastButton=null;d.status.table_header_sortField="ordnum";d.status.table_header_sortFieldOrder="ASC";d.status.currentPage=1;d.status.currentEquipid="";d.status.currentSet="details";d.status.currentBalance="0.0";d.dictionaries={};d.htmlBindings={};d.htmlBindings.container=".container";d.htmlBindings.itemCounter="#panelHeadingItemsCount";d.htmlBindings.drpItemPerPage=".top-pager-itemmperpage-control a";d.htmlBindings.drpItemPerPageValue=".top-pager-itemmperpage-control button span.value";d.htmlBindings.filterForm="#filterForm";d.htmlBindings.table="#EquipmentDashboardTable";d.htmlBindings.table_header_btnSort=".btn-table-sort";d.htmlBindings.table_body_btnCommitted=".btn-committed-form-link";d.htmlBindings.table_body_btnOnorder=".btn-onorder-form-link";d.htmlBindings.table_body_btnAttach=".btn-files-dialog";d.htmlBindings.table_body_btnEdit=".btn-edit";d.htmlBindings.table_body_btnAdd=".btn-add";d.htmlBindings.table_body_btnView=".btn-view";d.htmlBindings.table_body_drpStatus=".status.update-dropdown ";d.htmlBindings.pager_container=".pager-wrapper";d.htmlBindings.pager_btnPagerPages=".pager-btn";d.functions={};d.functions.paginate=function(){var h,i;h=b.EquipmentDashboard.DynamicFilter.functions.getFilterTree();i=JSON.stringify(h);e.ajax({data:{filterTree:i,page:d.status.currentPage,itemsPerPage:d.status.itemsPerPage,orderby:d.status.table_header_sortField,order:d.status.table_header_sortFieldOrder},url:d.urls.getPage,type:"post",beforeSend:function(){return e(".loading").show()},success:function(m,p,n){var o,j,l,k;o=e.parseJSON(m);j=new BootstrapPager(o,d.eventHandlers.pager_btnPagerPages_onClick);k=j.getCurrentPagedItems();l=j.getPagerControl();e(d.htmlBindings.pager_container).empty().append(l);d.functions.updateTable(k);e(d.htmlBindings.itemCounter).html(j.itemsCount);return e(".loading").hide()}});return this};d.functions.updateTable=function(h){var j,k,i;j=e(d.htmlBindings.table);k=j.children("tbody");k.empty();for(i in h){if(h.hasOwnProperty(i)){k.append(d.functions.buildTableItem(h[i],"","item-field"))}}d.functions.bindTableItemsEventHandlers();return this};d.functions.buildTableItem=function(v,k,t){var y,l,H,i,o,r,m,p,w,F,D,B,n,q,u,A,C,s,j,E,h,z,G,x;H=c.document;o=H.createElement("tr");j=function(){return b.Helpers.simpleTdBuilder(v.ordnum,"")};D=function(){return b.Helpers.withLinkTdBuilder(v.equipid,"","",b.Helpers.Href("HistoryDashboard","Index",{equipid:btoa(v.equipid),jsonFilterTree:btoa(JSON.stringify(d.DynamicFilter.functions.getFilterTree())),itemPerPage:d.status.itemsPerPage,page:d.status.currentPage,orderBy:d.status.table_header_sortField,order:d.status.table_header_sortFieldOrder}),{})};q=function(){return b.Helpers.simpleTdBuilder(v.itemno,"")};w=function(){return b.Helpers.simpleTdBuilder(v.descrip,"")};A=function(){return b.Helpers.simpleTdBuilder(v.make,"")};C=function(){return b.Helpers.simpleTdBuilder(v.model,"")};h=function(){return b.Helpers.simpleTdBuilder(v.serialno,"")};G=function(){return b.Helpers.simpleTdBuilder(v.Voltage,"")};F=function(){return b.Helpers.simpleTdBuilder(v.EquipType,"")};n=function(){return b.Helpers.simpleTdBuilder(v.installdte,"")};B=function(){return b.Helpers.simpleTdBuilder(v.expdtein,"")};p=function(){return b.Helpers.simpleTdBuilder(v.daterec,"")};z=function(){return b.Helpers.withSelectBuilder(v.status,"","form-control update-dropdown status select2-nosearch",d.status.statusValue,{equipid:v.equipid})};s=function(){return b.Helpers.simpleTdBuilder(v.notes,"")};E=function(){return b.Helpers.withLightboxLinkPictureBuilder(v.equipid,"item-image","",v.picture_fi,"glyphicon glyphicon-eye-open",null,{})};m=function(){return b.Helpers.simpleTdBuilder(v.assettag,"")};u=function(){return b.Helpers.simpleTdBuilder(v.Locno,"")};r=function(){var J,I;I=[];I.push(x());I.push(y());I.push(i());I.push(l());J=window.document.createElement("div");J.className="btn-group";return b.Helpers.complexTdBuilder(I,"item-action item-files",J)};l=function(){var I,J;J=H.createElement("span");J.className="glyphicon glyphicon-folder-close";I=d.htmlBindings.table_body_btnAttach.slice(1)+" btn-action btn btn-default btn-sm";return b.Helpers.linkBuilder(J,I,"#",{equipid:v.equipid})};i=function(){var I,K,J;J=H.createElement("span");J.className="glyphicon glyphicon-edit";I=d.htmlBindings.table_body_btnEdit.slice(1)+" btn-action btn btn-default btn-sm";K={equipid:v.equipid,qbtxlineid:"",ordnum:""};return b.Helpers.linkBuilder(J,I,"#",K)};y=function(){var I,K,J;J=H.createElement("span");J.className="glyphicon glyphicon-plus-sign";I=d.htmlBindings.table_body_btnAdd.slice(1)+" btn-action btn btn-default btn-sm";K={equipid:v.equipid,qbtxlineid:"",ordnum:""};return b.Helpers.linkBuilder(J,I,"#",K)};x=function(){var I,J;J=H.createElement("span");J.className="glyphicon glyphicon-eye-open";I=d.htmlBindings.table_body_btnView.slice(1)+" btn-action btn btn-default btn-sm";return b.Helpers.linkBuilder(J,I,"#",{equipid:v.equipid})};o.className=k;o.appendChild(j());o.appendChild(D());o.appendChild(q());o.appendChild(w());o.appendChild(A());o.appendChild(C());o.appendChild(h());o.appendChild(G());o.appendChild(F());o.appendChild(n());o.appendChild(B());o.appendChild(p());o.appendChild(z());o.appendChild(s());o.appendChild(m());o.appendChild(u());o.appendChild(r());return o};d.functions.bindTableItemsEventHandlers=function(){e(d.htmlBindings.table_body_btnAttach).on("click",d.eventHandlers.table_body_btnAttach_onClick);e(d.htmlBindings.table_body_drpStatus).on("change",d.eventHandlers.table_body_dprStatus_onChange);e(d.htmlBindings.table_body_btnEdit).on("click",d.eventHandlers.table_body_btnEdit_onClick);e(d.htmlBindings.table_body_btnAdd).on("click",d.eventHandlers.table_body_btnAdd_onClick);return this};d.functions.bindEventHandlers=function(){d.functions.bindTableItemsEventHandlers();e(d.htmlBindings.drpItemPerPage).on("click",d.eventHandlers.drpItemPerPage_onClick);e(d.htmlBindings.table_header_btnSort).on("click",d.eventHandlers.table_body_btnSort_onClick);e(d.htmlBindings.pager_btnPagerPages).on("click",d.eventHandlers.pager_btnPagerPages_onClick);return this};d.eventHandlers={};d.eventHandlers.drpItemPerPage_onClick=function(i){var h,j;h=e(i.target);j=h.html();d.status.itemsPerPage=j;e(d.htmlBindings.drpItemPerPageValue).text(j);d.status.currentPage=1;d.functions.paginate();return this};d.eventHandlers.pager_btnPagerPages_onClick=function(i){var h,j;h=e(i.target);j=h.data("page");d.status.currentPage=j;d.functions.paginate();return this};d.eventHandlers.table_body_btnSort_onClick=function(i){var h,j;h=e(i.target);j=h.data("field");if(d.status.table_header_sortLastButton!==null){d.status.table_header_sortLastButton.removeClass("asc desc")}if(d.status.table_header_sortField!==j){d.status.table_header_sortFieldOrder=""}d.status.table_header_sortField=j;if(d.status.table_header_sortFieldOrder==="ASC"){d.status.table_header_sortFieldOrder="DESC";h.addClass("asc").removeClass("desc")}else{d.status.table_header_sortFieldOrder="ASC";h.addClass("desc").removeClass("asc")}d.status.table_header_sortLastButton=h;d.functions.paginate();return this};d.eventHandlers.table_body_btnAttach_onClick=function(j){var h,i;console.log("attach on click");h=e(this).data("equipid");i=h+"_EQ";d.status.currentEquipid=i;g.functions.loadFileTree(i);e(g.htmlBindings.modal_ProjectFiles).modal("show");return this};d.eventHandlers.table_body_dprStatus_onChange=function(j){var h,i,k;h=e(j.target);i=h.data("equipid");k=h.val();e.ajax({data:{equipid:i,status:k},url:d.urls.updateStatus,type:"post",beforeSend:function(){return e(".loading").show()},success:function(l){var m;m=e.parseJSON(l);if(m==="success"){return e(".loading").hide()}else{throw m}}});return this};d.eventHandlers.table_body_btnEdit_onClick=function(j){var k,i,h;k=e(this).data("qbtxlineid");console.log(k);if(k!==void 0&&k!==""){h=k;i=b.Helpers.Href("EditTupleDashboard","Edit",{id:btoa(h),redirect:btoa(JSON.stringify({controller:"EquipmentDashboard",action:"Index"})),dashboard:btoa("HistoryDashboard")});c.location=i}return this};d.eventHandlers.table_body_btnAdd_onClick=function(k){var j,h,i;j=e(this).data("equipid");h=e(this).data("ordnum");i=b.Helpers.Href("EditTupleDashboard","Add",{redirect:btoa(JSON.stringify({controller:"EquipmentDashboard",action:"UpdateHistoryId"})),values:btoa(JSON.stringify({equipid:j,ordnum:h})),dashboard:btoa("HistoryDashboard")});c.location=i;return this};d.init=function(k,h){var j,m,i,l;d.status.fieldsDefinition=e.parseJSON(h);i=[];m=d.status.fieldsDefinition.status["values"];for(j in m){if(m.hasOwnProperty(j)){l=m[j];i.push({id:j,descrip:l})}}d.status.statusValue=i;d.dictionaries.status=i;d.status.itemsPerPage=e(d.htmlBindings.drpItemPerPageValue).text();f.init(k,d.status.fieldsDefinition);g.init();d.functions.bindEventHandlers();return this}}).call(this);