(function(d,f,c,g,e){var a=d.dandelion,b=a.namespace("App",d);b.EquipmentHistoryDashboard=(function(){var t,m,o,s,x,i,n,l,p,q;p=b.EquipmentHistoryDashboard.ProjectFiles;t={};m={itemsPerPage:0,currentPage:0,sortField:"equipid",sortFieldOrder:"ASC",sortLastButton:null,currentID:null};s={};x={dashboardContainer:".dashboard-container",dropdown:".dropdown",itemCounter:".items-counter",itemsPerPageSelector:".items-per-page-selector",statusSelector:".field-status",btnActionFilesDialog:".btn-action-files-dialog",btnActionAdd:".btn-action-add",btnActionEdit:".btn-action-edit",btnActionView:".btn-action-view",dateRangePickerSingle:".daterangepicker-single",tableMain:"#equipmentHistoryDashboardTable",sortButtons:".btn-table-sort",pagerContainer:".pager-wrapper",pagerButton:".pager-btn",tableMainFieldWorkOrder:".field-work-order",tableMainFieldVessel:".field-vessel",tableMainFieldEquipId:".field-id",tableMainFieldWorkOrderLink:".field-work-order-link",tableMainFieldVesselLink:".field-vessel-link",tableMainFieldStatus:".field-status",tableMainFiledDateOut:".field-date-out",tableMainFiledExpectedIn:".field-expected-in",tableMainFiledReceived:".field-received",formFilterSavedFilters:".form-filter-saved-filters",};n={modalEquipmentHistoryFormAdd:(function(B,E,I,D,L){var z,J,F,G,y,A,C;z={modalViewElement:"#modal-equipment-history-form-add",controlWorkOrder:".control-work-order",controlProjectManager:".control-project-manager",controlDateOut:".control-installdte",controlExpactedIn:".control-expdtein",controlReceived:".control-daterec"};J={usePlugins:function(){E(z.controlWorkOrder).select2({theme:"bootstrap",ajax:{url:t.workOrderSelectorAjaxUrl,dataType:"json",delay:250,processResults:function(O,P){P.page=P.page||1;return{results:O.items,pagination:{more:(P.page*30)<O.totalCount}}},cache:true}});E(z.controlProjectManager).select2({theme:"bootstrap",ajax:{url:t.projectManagerSelectorAjaxUrl,dataType:"json",delay:250,processResults:function(O,P){P.page=P.page||1;return{results:O.items,pagination:{more:(P.page*30)<O.totalCount}}},cache:true}})},reset:function(){C.reset();E(z.controlWorkOrder).val(null).trigger("change");E(z.controlProjectManager).val(null).trigger("change");E(z.controlDateOut).val("");E(z.controlExpactedIn).val("");E(z.controlReceived).val("")},saveHistoryCallback:function(){throw"Exception: Not implemented yet. Must be set by SetUpdateHistoryCallback function."}};F={saveHistory_OnDone:function(O){console.log("On Add:",O);var P=E.parseJSON(O);J.saveHistoryCallback(P.equipid,P.ordnum,P.status,P.qbtxlineid,P.installdte,P.expdtein,P.daterec,P.vesselid);H()}};G=L.Model.extend({defaults:{equipid:"",ordnum:"",inspectno:"",installdte:"",expdtein:"",daterec:""}});y=function(P){var O=this;O.equipid=I.observable(P,"equipid");O.ordnum=I.observable(P,"ordnum");O.inspectno=I.observable(P,"inspectno");O.installdte=I.observable(P,"installdte");O.expdtein=I.observable(P,"expdtein");O.daterec=I.observable(P,"daterec");O.saveHistory=function(Q){O.installdte(E(z.controlDateOut).val());O.expdtein(E(z.controlExpactedIn).val());O.daterec(E(z.controlReceived).val());E.post(t.addEquipmentHistoryUrl,{equipid:Q.equipid(),ordnum:Q.ordnum(),inspectno:Q.inspectno(),installdte:Q.installdte(),expdtein:Q.expdtein(),daterec:Q.daterec()}).done(F.saveHistory_OnDone).fail(function R(S){throw"POST Fail with :"+S})};O.reset=function(){O.equipid("");O.ordnum("");O.inspectno("");O.installdte("");O.expdtein("");O.daterec("")}};function M(){var O;O=B.document.getElementById((z.modalViewElement).slice(1));A=new G({});C=new y(A);D.applyBindings(C,O);J.usePlugins()}function K(O){J.reset();C.equipid(O);E(z.modalViewElement).modal("show")}function H(){E(z.modalViewElement).modal("hide")}function N(O){J.saveHistoryCallback=O}return{init:M,showFor:K,hide:H,setSaveHistoryCallback:N}}(d,f,c,g,e)),modalEquipmentHistoryFormEdit:(function(B,F,J,D,M){var z,K,G,H,y,A,C;z={modalViewElement:"#modal-equipment-history-form-edit",controlProjectManager:".control-project-manager-edit",controlDateOut:".control-installdte-edit",controlExpactedIn:".control-expdtein-edit",controlReceived:".control-daterec-edit",alertDelete:".alert-delete"};K={usePlugins:function(){},reset:function(){C.reset();F(z.controlProjectManager).val(null).trigger("change");F(z.controlDateOut).val("");F(z.controlExpactedIn).val("");F(z.controlReceived).val("")},updateHistoryCallback:function(){throw"Exception: Not implemented yet. Must be set by SetUpdateHistoryCallback function."},deleteHistoryCallback:function(){throw"Exception: Not implemented yet. Must be set by SetDeleteHistoryCallback function."}};G={updateHistory_OnDone:function(P){console.log("On Update:",P);var Q=F.parseJSON(P);if(Q.success){K.updateHistoryCallback(Q.equipid,Q.ordnum,Q.status,Q.qbtxlineid,Q.installdte,Q.expdtein,Q.daterec,Q.vesselid)}I()},deleteHistory_OnDone:function(P){console.log("On Delete:",P);var Q=F.parseJSON(P);if(Q.success){K.deleteHistoryCallback(Q.equipid,Q.ordnum,Q.status,Q.qbtxlineid,Q.installdte,Q.expdtein,Q.daterec,Q.vesselid)}I()},getEquipmentHistory_OnDone:function(P){var Q;Q=F.parseJSON(P);if(Q.success){C.equipid(Q.equipmentHistoryObject.equipid);C.qbtxlineid(Q.equipmentHistoryObject.qbtxlineid);C.inspectno(Q.equipmentHistoryObject.inspectno);C.installdte(Q.equipmentHistoryObject.installdte);C.expdtein(Q.equipmentHistoryObject.expdtein);C.daterec(Q.equipmentHistoryObject.daterec);F(z.controlProjectManager).append('<option value="'+Q.equipmentHistoryObject.inspectno+'">'+Q.equipmentHistoryObject.inspectnoName+"</option>");F(z.controlProjectManager).select2({theme:"bootstrap",ajax:{url:t.projectManagerSelectorAjaxUrl,dataType:"json",delay:250,processResults:function(R,S){S.page=S.page||1;return{results:R.items,pagination:{more:(S.page*30)<R.totalCount}}},cache:true}}).val(Q.equipmentHistoryObject.inspectno).trigger("change")}}};H=M.Model.extend({defaults:{qbtxlineid:"",equipid:"",inspectno:"",installdte:"",expdtein:"",daterec:""}});y=function(Q){var P=this;P.qbtxlineid=J.observable(Q,"qbtxlineid");P.equipid=J.observable(Q,"equipid");P.inspectno=J.observable(Q,"inspectno");P.installdte=J.observable(Q,"installdte");P.expdtein=J.observable(Q,"expdtein");P.daterec=J.observable(Q,"daterec");P.updateHistory=function(){var R,S,U,T;R=F(z.controlProjectManager).val();S=F(z.controlDateOut).val();U=F(z.controlExpactedIn).val();T=F(z.controlReceived).val();F.post(t.updateEquipmentHistoryUrl,{qbtxlineid:P.qbtxlineid(),equipid:P.equipid(),inspectno:R,installdte:S,expdtein:U,daterec:T}).done(G.updateHistory_OnDone).fail(function V(W){throw"POST Fail with :"+W})};P.deleteHistory=function(R){F.post(t.deleteEquipmentHistoryUrl,{qbtxlineid:R.qbtxlineid(),equipid:R.equipid()}).done(G.deleteHistory_OnDone).fail(function S(T){throw"POST Fail with :"+T})};P.reset=function(){P.equipid("");P.inspectno("");P.installdte("");P.expdtein("");P.daterec("")}};function O(){var P;P=B.document.getElementById((z.modalViewElement).slice(1));A=new H({});C=new y(A);D.applyBindings(C,P);K.usePlugins()}function L(P){K.reset();F(z.alertDelete).hide();F.post(t.getEquipmentHistoryUrl,{qbtxlineid:P}).done(G.getEquipmentHistory_OnDone).fail(function Q(R){throw"POST Fail with :"+R});F(z.modalViewElement).modal("show")}function I(){F(z.modalViewElement).modal("hide")}function E(P){K.updateHistoryCallback=P}function N(P){K.deleteHistoryCallback=P}return{init:O,showFor:L,hide:I,setUpdateHistoryCallback:E,setDeleteHistoryCallback:N}}(d,f,c,g,e)),screenWorkOrderDetails:(function(z,C,G,B,K){var y,H,D,A,M,E,J;y={screenViewElement:"#kb-view-salesorder",modalSaveNotes:"#salesOrderForm_modal_saveNotes",salesOrderForm_btnClose:"#salesOrderForm_btnClose"};H={reset:function(){J.reset()}};D={salesOrderForm_btnClose_onClick:function(N){C(y.screenViewElement).hide()},getWorkOrder_OnDone:function(N){var P,O;P=C.parseJSON(N);O=P.formType;if(P.success){J.modelType(O);J.ordnum(P.salesOrderObject.ordnum);J.date(P.salesOrderObject.date);J.custno(P.salesOrderObject.custno);J.projectLocation(P.salesOrderObject.projectLocation);J.notes(P.salesOrderObject.notes);J.companyName(P.salesOrderObject.companyName);J.address(P.salesOrderObject.address);J.city(P.salesOrderObject.city);J.state(P.salesOrderObject.state);J.zip(P.salesOrderObject.zip);J.phone(P.salesOrderObject.phone);J.subtotal(P.salesOrderObject.subtotal);J.discount(P.salesOrderObject.discount);J.tax(P.salesOrderObject.tax);J.shipping(P.salesOrderObject.shipping);J.total(P.salesOrderObject.total);if(O==="B"||O==="C"){J.ponum(P.salesOrderObject.ponum);J.company(P.salesOrderObject.company);J.destino(P.salesOrderObject.destino);J.prostartdt(P.salesOrderObject.prostartdt);J.proenddt(P.salesOrderObject.proenddt);J.sotypecode(P.salesOrderObject.sotypecode);J.mtrlstatus(P.salesOrderObject.mtrlstatus);J.jobstatus(P.salesOrderObject.jobstatus);J.technam1(P.salesOrderObject.technam1);J.technam2(P.salesOrderObject.technam2);J.qutno(P.salesOrderObject.qutno);J.cstctid(P.salesOrderObject.cstctid);J.jobdescrip(P.salesOrderObject.jobdescrip)}J.items(P.salesOrderObject.itemsCollection)}}};A=K.Model.extend({defaults:{ordnum:"",date:"",custno:"",projectLocation:"",notes:"",companyName:"",address:"",city:"",state:"",zip:"",phone:"",subtotal:"",discount:"",tax:"",shipping:"",total:"",items:new K.Collection([]),modelType:"",ponum:"",company:"",destino:"",prostartdt:"",proenddt:"",sotypecode:"",mtrlstatus:"",jobstatus:"",technam1:"",technam2:"",qutno:"",cstctid:"",jobdescrip:"",}});M=function(O){var N=this;N.modelType=G.observable(O,"modelType");N.ordnum=G.observable(O,"ordnum");N.date=G.observable(O,"date");N.custno=G.observable(O,"custno");N.projectLocation=G.observable(O,"projectLocation");N.notes=G.observable(O,"notes");N.companyName=G.observable(O,"companyName");N.address=G.observable(O,"address");N.city=G.observable(O,"city");N.state=G.observable(O,"state");N.zip=G.observable(O,"zip");N.phone=G.observable(O,"phone");N.subtotal=G.observable(O,"subtotal");N.discount=G.observable(O,"discount");N.tax=G.observable(O,"tax");N.shipping=G.observable(O,"shipping");N.total=G.observable(O,"total");N.ponum=G.observable(O,"ponum");N.company=G.observable(O,"company");N.destino=G.observable(O,"destino");N.prostartdt=G.observable(O,"prostartdt");N.proenddt=G.observable(O,"proenddt");N.sotypecode=G.observable(O,"sotypecode");N.mtrlstatus=G.observable(O,"mtrlstatus");N.jobstatus=G.observable(O,"jobstatus");N.technam1=G.observable(O,"technam1");N.technam2=G.observable(O,"technam2");N.qutno=G.observable(O,"qutno");N.cstctid=G.observable(O,"cstctid");N.jobdescrip=G.observable(O,"jobdescrip");N.items=G.collectionObservable(O.items);N.showTable=B.computed(function(){return N.items().length>0});N.showControlIFBOrC=B.computed(function(){return N.modelType()==="B"||N.modelType()==="C"});N.showControlIfNotC=B.computed(function(){return(N.modelType()!=="C")});N.onShowNotesModal=function(P){C(y.modalSaveNotes).modal("show");return P};N.onSaveNotesModal=function(P){C.post(t.updateWorkOrderNotesUrl,{ordnum:P.ordnum(),notes:P.notes()}).done(function R(){C(y.modalSaveNotes).modal("hide")}).fail(function Q(S){throw S});return P};N.reset=function(){N.modelType("");N.ordnum("");N.date("");N.custno("");N.projectLocation("");N.notes("");N.companyName("");N.address("");N.city("");N.state("");N.zip("");N.phone("");N.subtotal("");N.discount("");N.tax("");N.shipping("");N.total("");N.company("");N.destino("");N.prostartdt("");N.proenddt("");N.sotypecode("");N.mtrlstatus("");N.jobstatus("");N.technam1("");N.technam2("");N.qutno("");N.cstctid("");N.jobdescrip("");N.items([])}};function L(){var N;N=z.document.getElementById((y.screenViewElement).slice(1));E=new A({});J=new M(E);B.applyBindings(J,N);C(y.salesOrderForm_btnClose).on("click",D.salesOrderForm_btnClose_onClick)}function I(P){var Q,O,T,R,N;Q=10;R=C(x.dashboardContainer);N=C(y.screenViewElement);O=parseInt(R.css("height"),Q);T=parseInt(N.css("height"),Q);if(O>T){N.css("height",O)}H.reset();C.post(t.getWorkOrderUrl,{ordnum:P}).done(D.getWorkOrder_OnDone).fail(function S(U){throw"POST Fail with :"+U});N.show()}function F(){C(x.screenWorkOrderDetails).hide()}return{init:L,showFor:I,hide:F,}}(d,f,c,g,e))};l={filter:(function(z,B){var F,y,D,C;F={id:"",predicate:"",areControlsEnabled:false};y={filterFieldsContainer:".form-filter-container",filterFields_btnAdd:".filter-field",filterField_btnRemove:".input-group-btn button",filterFieldsControls:{all:".form-filter-action",btnToggleVisibility:".form-filter-action-toggle-visibility",btnReset:".form-filter-action-reset",btnSave:".form-filter-action-save",btnFilter:".form-filter-action-filter"},drpSavedFilters:".form-filter-saved-filters",drpSavedFilterItems:".form-filter-saved-filters-item",drpSavedFilterItems_btnDelete:".form-filter-saved-filters-item-delete",modalSaveFilter:"#dynamicFilter_modal_saveFilter",modalSaveFilter_txtName:"#dynamicFilter_modal_txtFilterName",modalSaveFilter_btnSave:"#dynamicFilter_modal_btnSaveFilter"};D={disableControls:function(){B(y.filterFieldsControls.all).addClass("disabled");F.areControlsEnabled=false},enableControls:function(){B(y.filterFieldsControls.all).removeClass("disabled");F.areControlsEnabled=true},filter:function(){o.paginate()},reset:function(I){B(y.filterFieldsContainer).empty();D.disableControls();B(y.filterFieldsControls.btnFilter).next().focus();if(I!==false){D.filter()}},splitDate:function(J){var I=J.split("/");if(I.length===3){return I}return["12","30","1899"]},splitDateRange:function(N){var I=N.split("-");if(I.length===2){var K=I[0],M=I[1];var J=D.splitDate(K),L=D.splitDate(M);return{inferiorLimit:J,superLimit:L}}return{inferiorLimit:D.splitDate(""),superLimit:D.splitDate("")}},getFilterTree:function(){var J=B(y.filterFieldsContainer).children();var L=(function(){function O(P,Q,R){this.nodeType=P;this.nodeValue=Q;this.nodeChildren=R}return O})();var M=[];var K=[];var N=null;J.each(function(){var X=B(this);var W;var S;var V;var Z;var T;if(X.hasClass("btn-group unary-logical-operator")){W=X.children("button").text();if(W===""){T=new L("positive","")}else{if(W==="Not"){T=new L("not","")}}N=T}else{if(X.hasClass("form-group")){S=X.find("input, select");V=S.val();Z=S.data("fieldname");var Y=Z;var U=F.fieldsDefinition[Y]["table"];var R=F.fieldsDefinition[Y]["displayName"];var Q=new L("field",[Y,U,R],[]);if(S.hasClass("daterangepicker")){var ab=D.splitDateRange(V);var O=new L("date",ab.inferiorLimit,[]);var P=new L("date",ab.superLimit,[]);T=new L("dateRange","",[Q,O,P])}else{var aa=new L("string",V,[]);T=new L("like","",[Q,aa])}N.nodeChildren=[T];M.push(N)}else{if(X.hasClass("binary-logical-operator")){W=X.children("button").text();K.push(W)}}}});var I=new L("blockExpression",K,M);return I},createOperatorGroup:function(K){var J='<div class="btn-group unary-logical-operator"><button type="button" class="btn btn-default btn-filter-modifier disabled" style="opacity:1"></button><button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown"><span class="caret"></span></button><ul class="dropdown-menu"><li class="current"><a href="#" style="display: inline-block; height: 26px; width: 100%;">Clear Not</a></li><li><a href="#">Not</a></li></ul></div>',I='<div class="btn-group binary-logical-operator"><button type="button" class="btn btn-default btn-filter-modifier disabled" style="opacity:1">And</button><button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown"><span class="caret"></span></button><ul class="dropdown-menu"><li class="current"><a href="#">And</a></li><li><a href="#">Or</a></li></ul></div>';if(K===true){return B(J)}return B(I)},createTextField:function(J,I,K){return B('<div class="form-group" title="'+I+'"><label class="control-label">'+I+'</label><div class="input-group"><input type="text" class="form-control" data-value-type="'+K+'" data-fieldname="'+J+'" placeholder="'+I+'"><span class="input-group-btn"><button class="btn btn-default glyphicon-action-button glyphicon-minus btn-delete-filter-field" title="Delete Filter Field" type="button"></button></span></div></div>')},createDropdownField:function(O,I,L,P){var M=B('<div class="form-group" title="'+I+'"><label class="control-label">'+I+'</label><div class="input-group select2-bootstrap-append"><select class="form-control select2-container" data-value-type="'+P+'" data-fieldname="'+O+'"></select><span class="input-group-btn"><button class="btn btn-default glyphicon-action-button glyphicon-minus btn-delete-filter-field" title="Delete Filter Field" type="button"></button></span></div></div>'),K=M.find("select"),J,N;for(J in L){if(L.hasOwnProperty(J)){N=L[J];if(N.id===undefined){K.append(B('<option value="'+J+'">'+L[J]+"</option>"))}else{K.append(B('<option value="'+N.id+'">'+N.descrip+"</option>"))}}}return M},createDateField:function(L,I,J){var K=J?"daterangepicker":"daterangepicker-single";return B('<div class="form-group"><label class="control-label">'+I+'</label><div class="input-prepend input-group" title="'+I+'"><span class="add-on input-group-addon"><i class="glyphicon glyphicon-calendar fa fa-calendar"></i></span><input type="text" class="form-control '+K+'" data-fieldname="'+L+'" placeholder="'+I+'"><span class="input-group-btn"><button type="button" class="btn btn-default glyphicon-action-button glyphicon-minus btn-delete-filter-field"></button></span></div></div>')},createDropdownSavedFilters:function(K,J){var I='<button type="button" class="btn btn-success dropdown-toggle" data-toggle="dropdown"><span class="caret"></span></button>';I+='<ul id="'+K.slice(1)+'" class="dropdown-menu" role="menu"><li role="presentation" class="dropdown-header">'+J+"</li></ul>";return B(I)},createDropdownSavedFilterItem:function(K,J){var I='<li><a href="#" class="'+y.drpSavedFilterItems+'" data-filterid="'+K+'">'+J+'</a><button type="button" class="close '+y.drpSavedFilterItems_btnDelete+'" aria-hidden="true">&times;</button></li>',L=B(I);L.children("a").on("click",C.drpSavedFilterItem_onClick);L.find("button.close").on("click",C.drpSavedFilterItem_btnDelete_onClick);return L},bindOperatorGroupEventHandler:function(I){I.find("li").on("click",C.filterOperator_onClick)},bindOperatorGroupsEventHandlers:function(){B(y.filterFieldsContainer).find(".btn-group").each(function(){D.bindOperatorGroupEventHandler(B(this))})},bindFormGroupEventHandlers:function(I){I.find(y.filterField_btnRemove).on("click",C.filterField_btnRemove_onClick);I.find("input").on("keypress",C.input_onKeyPress);I.find("input.daterangepicker").daterangepicker({singleDatePicker:false,format:"YYYY-MM-DD",startDate:z.moment(),endDate:z.moment()});I.find("input.daterangepicker-single").daterangepicker({singleDatePicker:true,format:"YYYY-MM-DD",startDate:z.moment(),endDate:z.moment()});I.find("select").select2({theme:"bootstrap"})},bindFormGroupsEventHandlers:function(){B(y.filterFieldsContainer).find(".form-group").each(function(){D.bindFormGroupEventHandlers(B(this))})},bindEventHandlers:function(){B(y.filterFieldsControls.btnFilter).on("click",C.btnFilter_onClick);B(y.filterFieldsControls.btnToggleVisibility).on("click",C.btnToggleVisibility_onClick);B(y.filterFieldsControls.btnReset).on("click",C.btnReset_onClick);B(y.filterFieldsControls.btnSave).on("click",C.btnSave_onClick);B(y.filterFields_btnAdd).on("click",C.filterFields_btnAdd_onClick);B(y.modalSaveFilter_btnSave).on("click",C.modalSaveFilter_btnSave_onClick);B(y.drpSavedFilterItems).on("click",C.drpSavedFilterItem_onClick);B(y.drpSavedFilterItems_btnDelete).on("click",C.drpSavedFilterItem_btnDelete_onClick)},loadFilter:function(I,J){B.ajax({data:{filterid:I},url:t.getSavedFilter,type:"post",beforeSend:function(){B(".loading").show()},success:function(K){var M=B.parseJSON(K),L;if(M.success){if(M.expfields!==""){L=B(y.filterFieldsContainer);L.append(M.expfields);D.bindOperatorGroupsEventHandlers();D.bindFormGroupsEventHandlers();B(y.filterFieldsControls.btnToggleVisibility).click();D.enableControls();if(J){D.filter()}}}else{throw"Filter not loaded"}B(".loading").hide()}})},loadHtmlFilter:function(I){D.loadFilter(I,false)},loadHtmlFilterAndFilter:function(I){D.loadFilter(I,true)}};C={input_onKeyPress:function(I){if(I.keyCode===13){D.filter()}},btnFilter_onClick:function(I){D.filter()},btnToggleVisibility_onClick:function(J){var K=B(J.target),I=K.html();if(I.trim()==="Hide"){B(y.filterFieldsContainer).hide("slow");K.html("Show")}else{B(y.filterFieldsContainer).show("slow");K.html("Hide")}},btnReset_onClick:function(I){D.reset()},btnSave_onClick:function(J){var I=B(y.modalSaveFilter_txtName);I.val("");I.popover("hide").focus().parent().removeClass("has-error");B(y.modalSaveFilter).modal("show")},drpSavedFilterItem_onClick:function(J){var I=J.currentTarget.dataset.filterid;D.reset(true);D.loadHtmlFilterAndFilter(I)},drpSavedFilterItem_btnDelete_onClick:function(K){var J=B(K.currentTarget),L=J.prev(),I=L.data("filterid");B.ajax({data:{filterId:I},url:t.deleteFilter,type:"post",beforeSend:function(){B(".loading").show()},success:function(N){console.log(N);var O=B.parseJSON(N),M=B(y.drpSavedFilters);if(M.children().length>2){B('[data-filterid="'+O.filterid+'"]').parent().remove()}else{M.prev("button").remove();M.remove()}B(".loading").hide()}})},filterOperator_onClick:function(J){var I=B(J.target),M=I.html(),N=I.parent().parent(),L=N.parent(),K=L.children(":first");if(M==="Clear Not"){M=""}K.html(M);N.find("li.current").removeClass("current");I.parent().addClass("current");D.filter()},filterFields_btnAdd_onClick:function(J){var I=B(J.target),M=I.data("field-type"),K=B(y.filterFieldsContainer),R=K.children().length===0,O=M==="date",Q=[],L=D.createOperatorGroup(R),N,P;K.append(L);D.bindOperatorGroupEventHandler(L);if(!R){N=D.createOperatorGroup(true);K.append(N);D.bindOperatorGroupEventHandler(N)}if(M==="text"){P=D.createTextField(I.data("field"),I.text(),I.data("field-value-type"))}else{if(M==="date"||M==="date-single"){P=D.createDateField(I.data("field"),I.text(),O)}else{if(M==="dropdown"){Q=s[I.data("field-collection")];console.log(">>>>",s,I.data("field-collection"),Q);P=D.createDropdownField(I.data("field"),I.text(),Q,I.data("field-value-type"))}}}K.append(P);D.bindFormGroupEventHandlers(P);if(F.areControlsEnabled!==true){D.enableControls()}},filterField_btnRemove_onClick:function(L){var M=B(L.target),J=M.parent().parent().parent(),K=J.prev(),N=J.next();if(K.prev().length===0){if(N.length===0){if(F.areControlsEnabled){D.disableControls()}}else{N.remove()}}else{var I=K.prev();if(I.prev().length>0){I.remove()}}K.remove();J.remove();D.filter()},modalSaveFilter_btnSave_onClick:function(M){var J=B(y.modalSaveFilter_txtName),L=J.val(),K=JSON.stringify(D.getFilterTree()),I=B(y.drpSavedFilters);if(L!==""&&/\w/.test(L)){B.ajax({data:{filterName:L,jsonFilterTree:K,},url:t.saveFilter,type:"post",beforeSend:function(){B(".loading").show()},success:function(N){console.log(N);var O=B.parseJSON(N),P;if(I.length===0){P=D.createDropdownSavedFilters(y.drpSavedFilters,"Load Saved Filter");B(y.filterFieldsControls.btnSave).after(P);I=B(y.drpSavedFilters)}I.append(D.createDropdownSavedFilterItem(O.filterid,L));B(y.modalSaveFilter).modal("hide");B(".loading").hide()}})}else{J.popover("show").focus().parent().addClass("has-error")}B(y.modalSaveFilter).modal("hide")},};function H(){console.log("Not implemented yet.");D.disableControls();D.bindEventHandlers()}function A(I){F.fieldsDefinition=I}function E(){return D.getFilterTree()}function G(){return D.getPredicate()}return{init:H,setFieldsDefinition:A,getFilterTree:E}}(d,f))};i={dropdown_OnClick:function(z){var y,A;y=f(this);A=y.html();y.parents(x.dropdown).find(".value").text(A)},itemsPerPageSelector_OnClick:function(y){m.itemsPerPage=f(this).html();m.currentPage=1;o.paginate()},tableMainFieldWorkOrderLink_OnClick:function(y){n.screenWorkOrderDetails.showFor(f(this).data("workorder"))},sortButtons_OnClick:function(y){var z,A;z=f(this);A=z.data("field");if(m.sortLastButton!==null){m.sortLastButton.removeClass("asc desc")}if(m.sortField!==A){m.sortFieldOrder=""}m.sortField=A;if(m.sortFieldOrder==="ASC"){m.sortFieldOrder="DESC";z.addClass("asc").removeClass("desc")}else{m.sortFieldOrder="ASC";z.addClass("desc").removeClass("asc")}m.sortLastButton=z;o.paginate()},statusSelector_OnClick:function(A){var z,y;y=f(this).parents("tr").data("equipid");z=f(this).html();o.updateEquipStatus(y,z);o.updateStatus(y,z);o.setActionsState(y,z)},btnActionFilesDialog_OnClick:function(z){var A,y;A=f(this).data("equipid");y=A+"_EQM";m.currentID=y;p.functions.loadFileTree(y);f(p.htmlBindings.modal_ProjectFiles).modal("show")},btnActionAdd_OnClick:function(y){n.modalEquipmentHistoryFormAdd.showFor(f(this).data("equipid"))},btnActionEdit_OnClick:function(y){n.modalEquipmentHistoryFormEdit.showFor(f(this).data("qbtxlineid"))},btnActionView_OnClick:function(y){throw"Exception: Not implemented yet"},pagerButton_OnClick:function(y){var z=f(this).data("page");m.currentPage=z;o.paginate()},paginate_OnBeforeSend:function(y){f(".loading").show()},paginate_OnSuccess:function(B){d.console.log(B);var C,y,A,z;C=f.parseJSON(B);y=new BootstrapPager(C,i.pagerButton_OnClick);z=y.getPagerControl();f(x.pagerContainer).empty().append(z);f(x.itemCounter).html(y.itemsCount);A=y.getCurrentPagedItems();o.updateTable(A);f(".loading").hide()},};o={bindEventHandlers:function(){f(x.dropdown).on("click","a",i.dropdown_OnClick);f(x.itemsPerPageSelector).on("click","a",i.itemsPerPageSelector_OnClick);f(x.sortButtons).on("click",i.sortButtons_OnClick);f(x.pagerButton).on("click",i.pagerButton_OnClick);o.bindTableItemsEventHandlers()},bindTableItemsEventHandlers:function(){f(x.tableMainFieldWorkOrderLink).on("click",i.tableMainFieldWorkOrderLink_OnClick);f(x.statusSelector).on("click","a",i.statusSelector_OnClick);f(x.btnActionFilesDialog).on("click",i.btnActionFilesDialog_OnClick);f(x.btnActionAdd).on("click",i.btnActionAdd_OnClick);f(x.btnActionEdit).on("click",i.btnActionEdit_OnClick);f(x.btnActionView).on("click",i.btnActionView_OnClick)},buildClassBy:function(y){return y.toLowerCase().replace(" ","-")},usePlugins:function(){f(x.dateRangePickerSingle).daterangepicker({singleDatePicker:true,format:"YYYY-MM-DD",startDate:d.moment(),endDate:d.moment()})},paginate:function(){var y,z;y=l.filter.getFilterTree();z=JSON.stringify(y);f.ajax({data:{filterTree:z,page:m.currentPage,itemsPerPage:m.itemsPerPage,orderBy:m.sortField,order:m.sortFieldOrder},url:t.getEquipmentPage,type:"post",beforeSend:i.paginate_OnBeforeSend,success:i.paginate_OnSuccess})},getRowByEquipID:function(y){return f(x.tableMainFieldEquipId).filter(function z(A){return f(this).find("a").text()===y}).parent()},updateEquip:function(H,z,A,E,G,C,F,y){var B,D;d.console.log("equipID",H);d.console.log("workOrder",z);d.console.log("status",A);d.console.log("historyID",E);d.console.log("DateOut",G);d.console.log("ExpectedIn",C);d.console.log("Received",F);d.console.log("Vessel",y);B=o.buildClassBy(A);D=o.getRowByEquipID(H);D.find(x.tableMainFieldWorkOrder).html('<a href="#" class="'+(x.tableMainFieldWorkOrderLink).slice(1)+'" data-workorder="'+z+'">'+z+"</a>");D.find(x.tableMainFieldVessel).html('<a href="#" class="'+(x.tableMainFieldVesselLink).slice(1)+'" data-vessel="'+y+'">'+y+"</a>");D.find(x.tableMainFieldStatus).find(".value").text(A);D.find(x.tableMainFieldStatus).find(".value").removeClass().addClass("value "+B).text(A);D.find(x.btnActionEdit).data("qbtxlineid",E);D.find(x.tableMainFiledDateOut).html(G);D.find(x.tableMainFiledExpectedIn).html(C);o.setActionsState(H,A)},updateEquipStatus:function(B,z){var A,y;A=o.buildClassBy(z);y=o.getRowByEquipID(B);y.find(x.tableMainFieldStatus).find(".value").removeClass().addClass("value "+A).text(z);o.setActionsState(B,z)},setActionsState:function(z,y){if(y==="Available"){o.enableRowActionAdd(z);o.disableRowActionEdit(z)}else{o.enableRowActionEdit(z);o.disableRowActionAdd(z)}},enableRowActionAdd:function(z){var y=o.getRowByEquipID(z);y.find(x.btnActionAdd).attr({disabled:false})},disableRowActionAdd:function(z){var y=o.getRowByEquipID(z);y.find(x.btnActionAdd).attr({disabled:true})},enableRowActionEdit:function(z){var y=o.getRowByEquipID(z);y.find(x.btnActionEdit).attr({disabled:false})},disableRowActionEdit:function(z){var y=o.getRowByEquipID(z);y.find(x.btnActionEdit).attr({disabled:true})},updateStatus:function(z,y){f.post(t.updateStatusUrl,{equipid:z,status:y}).done(function B(C){var D=f.parseJSON(C);if(D.success){}}).fail(function A(C){throw"POST Fail with :"+C})},buildTableItem:function(W,B,K){var O,C,Z,z,F,I,D,G,M,X,T,R,E,H,L,Q,S,J,A,V,U,y,P,Y,N;Z=d.document;F=Z.createElement("tr");A=function(aa){aa+=" field-work-order";return b.Helpers.withLinkTdBuilder(W.ordnum,aa,"field-work-order-link","#",{workorder:W.ordnum})};V=function(aa){aa+=" field-vesselid";return b.Helpers.withLinkTdBuilder(W.vesselid,aa,"field-vesselid-link","#",{vesselid:W.vesselid})};T=function(aa){aa+=" field-id";return b.Helpers.withLinkTdBuilder(W.equipid,aa,"",b.Helpers.Href("EquipmentHistoryDashboard","EquipmentHistories",{equipid:btoa(W.equipid),jsonFilterTree:"",itemPerPage:m.itemsPerPage,page:m.currentPage,orderBy:m.sortField,order:m.sortFieldOrder}),{})};H=function(aa){aa+=" field-part-no";return b.Helpers.simpleTdBuilder(W.itemno,aa)};M=function(aa){aa+=" field-description";return b.Helpers.simpleTdBuilder(W.descrip,aa)};Q=function(aa){aa+=" field-brand";return b.Helpers.simpleTdBuilder(W.make,"")};S=function(aa){aa+=" field-model";return b.Helpers.simpleTdBuilder(W.model,aa)};y=function(aa){aa+=" field-serial-no";return b.Helpers.simpleTdBuilder(W.serialno,aa)};Y=function(aa){aa+=" field-voltage";return b.Helpers.simpleTdBuilder(W.Voltage,aa)};X=function(aa){aa+=" field-type";return b.Helpers.simpleTdBuilder(W.EquipType,aa)};E=function(aa){aa+=" field-date-out";return b.Helpers.simpleTdBuilder(W.installdte,aa)};R=function(aa){aa+=" field-expected-in";return b.Helpers.simpleTdBuilder(W.expdtein,aa)};L=function(aa){aa+=" field-locno";return b.Helpers.simpleTdBuilder(W.locno,aa)};P=function(){var ah,ab,ag,af,ae,ac,ad,aa;ag=f('<td class="item-field field-status">');af=f('<div class="btn-group dropdown">');ae=f('<button class="btn btn-default btn-sm dropdown-toggle" type="button" data-toggle="dropdown">');ac=f('<span class="value '+o.buildClassBy(W.status)+'">'+W.status+" </span>");ad=f('<span class="caret"></span>');ae.append(ac);ae.append(ad);aa=f('<ul class="dropdown-menu">');ah=["Available","Not Returned","Broken","Lost"];for(ab in ah){if(ah.hasOwnProperty(ab)){aa.append(f('<li role="presentation"> <a role="menuitem" tabindex="-1" href="#" data-value="'+ah[ab]+'">'+ah[ab]+"</a></li>"))}}af.append(ae);af.append(aa);ag.append(af);return ag[0]};I=function(){var ab,aa;aa=[];aa.push(N());aa.push(O());aa.push(z());aa.push(C());ab=window.document.createElement("div");ab.className="btn-group";return b.Helpers.complexTdBuilder(aa,"item-actions",ab)};C=function(){var aa,ab;ab=Z.createElement("span");ab.className="glyphicon glyphicon-folder-close";aa=x.btnActionFilesDialog.slice(1)+" btn-action btn btn-default btn-sm";return b.Helpers.linkBuilder(ab,aa,"#",{equipid:W.equipid})};z=function(){var ab,ad,aa,ac;ac=Z.createElement("span");ac.className="glyphicon glyphicon-edit";ab=x.btnActionEdit.slice(1)+" btn-action btn btn-default btn-sm";ad={equipid:W.equipid,qbtxlineid:W.qbtxlineid,ordnum:W.ordnum};if(!W.qbtxlineid&&W.status==="Available"){aa={disabled:"disabled"}}return b.Helpers.linkBuilder(ac,ab,"#",ad,aa)};O=function(){var ab,ad,ac,aa;ac=Z.createElement("span");ac.className="glyphicon glyphicon-plus-sign";ab=x.btnActionAdd.slice(1)+" btn-action btn btn-default btn-sm";ad={equipid:W.equipid,qbtxlineid:W.qbtxlineid,ordnum:W.ordnum};if(W.status!=="Available"){aa={disabled:"disabled"}}return b.Helpers.linkBuilder(ac,ab,"#",ad,aa)};N=function(){var aa,ab;ab=Z.createElement("span");ab.className="glyphicon glyphicon-eye-open";aa=x.btnActionView.slice(1)+" btn-action btn btn-default btn-sm";return b.Helpers.linkBuilder(ab,aa,"#",{equipid:W.equipid})};F.className=B;F.dataset.equipid=W.equipid;F.appendChild(T(K));F.appendChild(A(K));F.appendChild(V(K));F.appendChild(H(K));F.appendChild(M(K));F.appendChild(Q(K));F.appendChild(S(K));F.appendChild(y(K));F.appendChild(Y(K));F.appendChild(X(K));F.appendChild(E(K));F.appendChild(R(K));F.appendChild(L(K));F.appendChild(P(K));F.appendChild(I());return F},updateTable:function(y){var A,B,z;A=f(x.tableMain);B=A.children("tbody");B.empty();for(z in y){if(y.hasOwnProperty(z)){B.append(o.buildTableItem(y[z],"","item-field"))}}o.bindTableItemsEventHandlers()}};function k(y){x.itemsPerPageSelector=y}function h(y){m.itemsPerPage=y}function u(y){x.statusSelector=y}function v(y,z){s[y]=z}function j(z,y){t[z]=y}function r(){return m.currentID}function w(z,y){var A;d.console.log("filterID: ",z);d.console.log("fieldsDefinition: ",y);d.console.log("HTML Bindings");for(A in x){if(x.hasOwnProperty(A)){d.console.log("\t",A,":",x[A])}}d.console.log("Binding Event Handlers");o.bindEventHandlers();d.console.log("Use Plugins");o.usePlugins();d.console.log("Dictionaries:");d.console.log(s);d.console.log("Initializing MVVM related logic:");for(A in n){if(n.hasOwnProperty(A)){d.console.log("\t",A,":",n[A]);n[A].init()}}n.modalEquipmentHistoryFormAdd.setSaveHistoryCallback(o.updateEquip);n.modalEquipmentHistoryFormEdit.setUpdateHistoryCallback(o.updateEquip);n.modalEquipmentHistoryFormEdit.setDeleteHistoryCallback(o.updateEquip);d.console.log("Initializing Modules related logic:");for(A in l){if(l.hasOwnProperty(A)){d.console.log("\t",A,":",l[A]);l[A].init()}}p.init();l.filter.setFieldsDefinition(y)}return{init:w,setItemsPerPage:h,setItemsPerPageSelector:k,setStatusSelector:u,addDictionary:v,addUrl:j,getCurrentID:r}}())}(window,window.jQuery,window.kb,window.ko,window.Backbone));