(function(d,f,c,g,e){var a=d.dandelion,b=a.namespace("App",d);b.EquipmentHistoryDashboard=(function(){var o,k,m,n,s,h,l;o={};k={itemsPerPage:0,currentPage:0};n={};s={dashboardContainer:".dashboard-container",dropdown:".dropdown",itemsPerPageSelector:".items-per-page-selector",statusSelector:".status-selector",btnActionFilesDialog:".btn-action-files-dialog",btnActionAdd:".btn-action-add",btnActionEdit:".btn-action-edit",btnActionView:".btn-action-view",dateRangePickerSingle:".daterangepicker-single",tableMain:"#equipmentHistoryDashboardTable",tableMainFieldWorkOrder:".field-workorder",tableMainFieldWorkOrderLink:".field-workorder-link",tableMainFieldStatus:".field-status",modalEquipmentHistoryFormEdit:"#modal-equipment-history-form-edit"};l={modalEquipmentHistoryFormAdd:(function(w,z,D,y,G){var u,E,A,B,t,v,x;u={modalViewElement:"#modal-equipment-history-form-add",controlWorkOrder:".control-work-order",controlProjectManager:".control-project-manager",controlDateOut:".control-installdte",controlExpactedIn:".control-expdtein",controlReceived:".control-daterec"};E={usePlugins:function(){z(u.controlWorkOrder).select2({theme:"bootstrap",ajax:{url:o.workOrderSelectorAjaxUrl,dataType:"json",delay:250,processResults:function(J,K){K.page=K.page||1;return{results:J.items,pagination:{more:(K.page*30)<J.totalCount}}},cache:true}});z(u.controlProjectManager).select2({theme:"bootstrap",ajax:{url:o.projectManagerSelectorAjaxUrl,dataType:"json",delay:250,processResults:function(J,K){K.page=K.page||1;return{results:J.items,pagination:{more:(K.page*30)<J.totalCount}}},cache:true}})},reset:function(){x.reset();z(u.controlWorkOrder).val(null).trigger("change");z(u.controlProjectManager).val(null).trigger("change");z(u.controlDateOut).val("");z(u.controlExpactedIn).val("");z(u.controlReceived).val("")},saveHistoryCallback:function(){throw"Exception: Not implemented yet"}};A={saveHistory_OnDone:function(J){var K=z.parseJSON(J);E.saveHistoryCallback(K.equipid,K.ordnum,K.status);C()}};B=G.Model.extend({defaults:{equipid:"",ordnum:"",inspectno:"",installdte:"",expdtein:"",daterec:""}});t=function(K){var J=this;J.equipid=D.observable(K,"equipid");J.ordnum=D.observable(K,"ordnum");J.inspectno=D.observable(K,"inspectno");J.installdte=D.observable(K,"installdte");J.expdtein=D.observable(K,"expdtein");J.daterec=D.observable(K,"daterec");J.saveHistory=function(L){J.installdte(z(u.controlDateOut).val());J.expdtein(z(u.controlExpactedIn).val());J.daterec(z(u.controlReceived).val());z.post(o.addEquipmentHistoryUrl,{equipid:L.equipid(),ordnum:L.ordnum(),inspectno:L.inspectno(),installdte:L.installdte(),expdtein:L.expdtein(),daterec:L.daterec()}).done(A.saveHistory_OnDone).fail(function M(N){throw"POST Fail with :"+N})};J.reset=function(){J.equipid("");J.ordnum("");J.inspectno("");J.installdte("");J.expdtein("");J.daterec("")}};function H(){var J;J=w.document.getElementById((u.modalViewElement).slice(1));v=new B({});x=new t(v);y.applyBindings(x,J);E.usePlugins()}function F(J){E.reset();x.equipid(J);z(u.modalViewElement).modal("show")}function C(){z(u.modalViewElement).modal("hide")}function I(J){E.saveHistoryCallback=J}return{init:H,showFor:F,hide:C,setSaveHistoryCallback:I}}(d,f,c,g,e)),screenWorkOrderDetails:(function(u,x,B,w,F){var t,C,y,v,I,z,E;t={screenViewElement:"#kb-view-salesorder",modalSaveNotes:"#salesOrderForm_modal_saveNotes",salesOrderForm_btnClose:"#salesOrderForm_btnClose"};C={reset:function(){E.reset()}};y={salesOrderForm_btnClose_onClick:function(J){x(t.screenViewElement).hide()},getWorkOrder_OnDone:function(J){var L,K;L=x.parseJSON(J);K=L.formType;if(L.success){E.modelType(K);E.ordnum(L.salesOrderObject.ordnum);E.date(L.salesOrderObject.date);E.custno(L.salesOrderObject.custno);E.projectLocation(L.salesOrderObject.projectLocation);E.notes(L.salesOrderObject.notes);E.companyName(L.salesOrderObject.companyName);E.address(L.salesOrderObject.address);E.city(L.salesOrderObject.city);E.state(L.salesOrderObject.state);E.zip(L.salesOrderObject.zip);E.phone(L.salesOrderObject.phone);E.subtotal(L.salesOrderObject.subtotal);E.discount(L.salesOrderObject.discount);E.tax(L.salesOrderObject.tax);E.shipping(L.salesOrderObject.shipping);E.total(L.salesOrderObject.total);if(K==="B"||K==="C"){E.ponum(L.salesOrderObject.ponum);E.company(L.salesOrderObject.company);E.destino(L.salesOrderObject.destino);E.prostartdt(L.salesOrderObject.prostartdt);E.proenddt(L.salesOrderObject.proenddt);E.sotypecode(L.salesOrderObject.sotypecode);E.mtrlstatus(L.salesOrderObject.mtrlstatus);E.jobstatus(L.salesOrderObject.jobstatus);E.technam1(L.salesOrderObject.technam1);E.technam2(L.salesOrderObject.technam2);E.qutno(L.salesOrderObject.qutno);E.cstctid(L.salesOrderObject.cstctid);E.jobdescrip(L.salesOrderObject.jobdescrip)}E.items(L.salesOrderObject.itemsCollection)}}};v=F.Model.extend({defaults:{ordnum:"",date:"",custno:"",projectLocation:"",notes:"",companyName:"",address:"",city:"",state:"",zip:"",phone:"",subtotal:"",discount:"",tax:"",shipping:"",total:"",items:new F.Collection([]),modelType:"",ponum:"",company:"",destino:"",prostartdt:"",proenddt:"",sotypecode:"",mtrlstatus:"",jobstatus:"",technam1:"",technam2:"",qutno:"",cstctid:"",jobdescrip:"",}});I=function(K){var J=this;J.modelType=B.observable(K,"modelType");J.ordnum=B.observable(K,"ordnum");J.date=B.observable(K,"date");J.custno=B.observable(K,"custno");J.projectLocation=B.observable(K,"projectLocation");J.notes=B.observable(K,"notes");J.companyName=B.observable(K,"companyName");J.address=B.observable(K,"address");J.city=B.observable(K,"city");J.state=B.observable(K,"state");J.zip=B.observable(K,"zip");J.phone=B.observable(K,"phone");J.subtotal=B.observable(K,"subtotal");J.discount=B.observable(K,"discount");J.tax=B.observable(K,"tax");J.shipping=B.observable(K,"shipping");J.total=B.observable(K,"total");J.ponum=B.observable(K,"ponum");J.company=B.observable(K,"company");J.destino=B.observable(K,"destino");J.prostartdt=B.observable(K,"prostartdt");J.proenddt=B.observable(K,"proenddt");J.sotypecode=B.observable(K,"sotypecode");J.mtrlstatus=B.observable(K,"mtrlstatus");J.jobstatus=B.observable(K,"jobstatus");J.technam1=B.observable(K,"technam1");J.technam2=B.observable(K,"technam2");J.qutno=B.observable(K,"qutno");J.cstctid=B.observable(K,"cstctid");J.jobdescrip=B.observable(K,"jobdescrip");J.items=B.collectionObservable(K.items);J.showTable=w.computed(function(){return J.items().length>0});J.showControlIFBOrC=w.computed(function(){return J.modelType()==="B"||J.modelType()==="C"});J.showControlIfNotC=w.computed(function(){return(J.modelType()!=="C")});J.onShowNotesModal=function(L){x(t.modalSaveNotes).modal("show");return L};J.onSaveNotesModal=function(L){throw"Exception: Not implemented yet."};J.reset=function(){J.modelType("");J.ordnum("");J.date("");J.custno("");J.projectLocation("");J.notes("");J.companyName("");J.address("");J.city("");J.state("");J.zip("");J.phone("");J.subtotal("");J.discount("");J.tax("");J.shipping("");J.total("");J.company("");J.destino("");J.prostartdt("");J.proenddt("");J.sotypecode("");J.mtrlstatus("");J.jobstatus("");J.technam1("");J.technam2("");J.qutno("");J.cstctid("");J.jobdescrip("");J.items([])}};function G(){var J;J=u.document.getElementById((t.screenViewElement).slice(1));z=new v({});E=new I(z);w.applyBindings(E,J);x(t.salesOrderForm_btnClose).on("click",y.salesOrderForm_btnClose_onClick)}function D(L){var M,K,P,N,J;M=10;N=x(s.dashboardContainer);J=x(t.screenViewElement);K=parseInt(N.css("height"),M);P=parseInt(J.css("height"),M);if(K>P){J.css("height",K)}C.reset();x.post(o.getWorkOrder,{ordnum:L}).done(y.getWorkOrder_OnDone).fail(function O(Q){throw"POST Fail with :"+Q});J.show()}function A(){x(s.screenWorkOrderDetails).hide()}function H(J){C.saveHistoryCallback=J}return{init:G,showFor:D,hide:A,setSaveHistoryCallback:H}}(d,f,c,g,e))};h={dropdown_OnClick:function(u){var t,v;t=f(this);v=t.html();t.parents(s.dropdown).find(".value").text(v)},itemsPerPageSelector_OnClick:function(t){k.itemsPerPage=f(this).html();k.currentPage=1;m.paginate()},tableMainFieldWorkOrderLink_OnClick:function(t){l.screenWorkOrderDetails.showFor(f(this).data("workorder"))},statusSelector_OnClick:function(u){var t;t=f(this).html();throw"Exception: Not implemented yet. Do something with status: "+t},btnActionFilesDialog_OnClick:function(t){throw"Exception: Not implemented yet"},btnActionAdd_OnClick:function(t){l.modalEquipmentHistoryFormAdd.showFor(f(this).data("equipid"))},btnActionEdit_OnClick:function(t){f(s.modalEquipmentHistoryFormEdit).modal("show");throw"Exception: Not implemented yet"},btnActionView_OnClick:function(t){throw"Exception: Not implemented yet"}};m={bindEventHandlers:function(){f(s.dropdown).on("click","a",h.dropdown_OnClick);f(s.itemsPerPageSelector).on("click","a",h.itemsPerPageSelector_OnClick);f(s.tableMainFieldWorkOrderLink).on("click",h.tableMainFieldWorkOrderLink_OnClick);f(s.statusSelector).on("click","a",h.statusSelector_OnClick);f(s.btnActionFilesDialog).on("click",h.btnActionFilesDialog_OnClick);f(s.btnActionAdd).on("click",h.btnActionAdd_OnClick);f(s.btnActionEdit).on("click",h.btnActionEdit_OnClick);f(s.btnActionView).on("click",h.btnActionView_OnClick)},usePlugins:function(){f(s.dateRangePickerSingle).daterangepicker({singleDatePicker:true,format:"YYYY-MM-DD",startDate:d.moment(),endDate:d.moment()})},paginate:function(){throw"Exception: Not implemented yet"},updateEquip:function(w,v,u){var t=f(s.tableMain).find("tr[data-equipid="+w+"]");t.find(s.tableMainFieldWorkOrder).text(v);t.find(s.tableMainFieldStatus).find(".value").text(u)}};function j(t){s.itemsPerPageSelector=t}function p(t){s.statusSelector=t}function q(t,u){n[t]=u}function i(u,t){o[u]=t}function r(u){var t;d.console.log("filter: ",u);d.console.log("HTML Bindings");for(t in s){if(s.hasOwnProperty(t)){d.console.log("\t",t,":",s[t])}}d.console.log("Binding Event Handlers");m.bindEventHandlers();d.console.log("Use Plugins");m.usePlugins();d.console.log("Dictionaries:");d.console.log(n);d.console.log("Initializing MVVM related logic:");for(t in l){if(l.hasOwnProperty(t)){d.console.log("\t",t,":",l[t]);l[t].init()}}l.modalEquipmentHistoryFormAdd.setSaveHistoryCallback(m.updateEquip)}return{init:r,setItemsPerPageSelector:j,setStatusSelector:p,addDictionary:q,addUrl:i}}())}(window,window.jQuery,window.kb,window.ko,window.Backbone));