(function(d,f,c,g,e){var a=d.dandelion,b=a.namespace("App",d);b.EquipmentHistoryDashboard=(function(){var l,q,n,o,h,m,j;l={};q={itemsPerPage:0,currentPage:0};o={};h={dropdown:".dropdown",itemsPerPageSelector:".items-per-page-selector",statusSelector:".status-selector",btnActionFilesDialog:".btn-action-files-dialog",btnActionAdd:".btn-action-add",btnActionEdit:".btn-action-edit",btnActionView:".btn-action-view",dateRangePickerSingle:".daterangepicker-single",tableMain:"#equipmentHistoryDashboardTable",tableMainFieldWorkOrder:".field-workorder",tableMainFieldStatus:".field-status",modalEquipmentHistoryFormEdit:"#modal-equipment-history-form-edit"};j={modalEquipmentHistoryFormAdd:(function(w,z,y){var t,D,A,B,u,v,x;t={modalViewElement:"#modal-equipment-history-form-add",controlWorkOrder:".control-work-order",controlProjectManager:".control-project-manager",controlDateOut:".control-installdte",controlExpactedIn:".control-expdtein",controlReceived:".control-daterec"};D={usePlugins:function(){z(t.controlWorkOrder).select2({theme:"bootstrap",ajax:{url:l.workOrderSelectorAjaxUrl,dataType:"json",delay:250,processResults:function(H,I){I.page=I.page||1;return{results:H.items,pagination:{more:(I.page*30)<H.totalCount}}},cache:true},});z(t.controlProjectManager).select2({theme:"bootstrap",ajax:{url:l.projectManagerSelectorAjaxUrl,dataType:"json",delay:250,processResults:function(H,I){I.page=I.page||1;return{results:H.items,pagination:{more:(I.page*30)<H.totalCount}}},cache:true},})},reset:function(){x.reset();z(t.controlWorkOrder).val(null).trigger("change");z(t.controlProjectManager).val(null).trigger("change");z(t.controlDateOut).val("");z(t.controlExpactedIn).val("");z(t.controlReceived).val("")},saveHistoryCallback:function(){throw"Exception: Not implemented yet"}};A={saveHistory_OnDone:function(H){w.console.log(H);var I=z.parseJSON(H);w.console.log(I);D.saveHistoryCallback(I.equipid,I.ordnum,I.status);C()}};B=function(){this.equipid="";this.ordnum="";this.inspectno="";this.installdte="";this.expdtein="";this.daterec=""};u=function(I){var H=this;H.equipid=y.observable(I.equipid);H.ordnum=y.observable(I.ordnum);H.inspectno=y.observable(I.inspectno);H.installdte=y.observable(I.installdte);H.expdtein=y.observable(I.expdtein);H.daterec=y.observable(I.daterec);H.saveHistory=function(){H.installdte(z(t.controlDateOut).val());H.expdtein(z(t.controlExpactedIn).val());H.daterec(z(t.controlReceived).val());z.post(l.addEquipmentHistoryUrl,{equipid:H.equipid(),ordnum:H.ordnum(),inspectno:H.inspectno(),installdte:H.installdte(),expdtein:H.expdtein(),daterec:H.daterec()}).done(A.saveHistory_OnDone).fail(function J(K){throw"POST Fail with :"+K})};H.reset=function(){w.console.dir(H);H.equipid=y.observable("");H.ordnum=y.observable("");H.inspectno=y.observable("");H.installdte=y.observable("");H.expdtein=y.observable("");H.daterec=y.observable("")}};function F(){var H;H=w.document.getElementById(t.koViewElement);v=new B();x=new u(v);y.applyBindings(x,H);D.usePlugins()}function E(H){D.reset();x.equipid(H);z(t.modalViewElement).modal("show")}function C(){z(t.modalViewElement).modal("hide")}function G(H){D.saveHistoryCallback=H}return{init:F,showFor:E,hide:C,setSaveHistoryCallback:G}}(d,f,g))};m={dropdown_OnClick:function(u){var t,v;t=f(this);v=t.html();t.parents(h.dropdown).find(".value").text(v)},itemsPerPageSelector_OnClick:function(t){q.itemsPerPage=f(this).html();q.currentPage=1;n.paginate()},statusSelector_OnClick:function(u){var t;t=f(this).html();throw"Exception: Not implemented yet. Do something with status: "+t},btnActionFilesDialog_OnClick:function(t){throw"Exception: Not implemented yet"},btnActionAdd_OnClick:function(t){j.modalEquipmentHistoryFormAdd.showFor(f(this).data("equipid"))},btnActionEdit_OnClick:function(t){f(h.modalEquipmentHistoryFormEdit).modal("show");throw"Exception: Not implemented yet"},btnActionView_OnClick:function(t){throw"Exception: Not implemented yet"}};n={bindEventHandlers:function(){f(h.dropdown).on("click","a",m.dropdown_OnClick);f(h.itemsPerPageSelector).on("click","a",m.itemsPerPageSelector_OnClick);f(h.statusSelector).on("click","a",m.statusSelector_OnClick);f(h.btnActionFilesDialog).on("click",m.btnActionFilesDialog_OnClick);f(h.btnActionAdd).on("click",m.btnActionAdd_OnClick);f(h.btnActionEdit).on("click",m.btnActionEdit_OnClick);f(h.btnActionView).on("click",m.btnActionView_OnClick)},usePlugins:function(){f(h.dateRangePickerSingle).daterangepicker({singleDatePicker:true,format:"YYYY-MM-DD",startDate:d.moment(),endDate:d.moment()})},paginate:function(){throw"Exception: Not implemented yet"},updateEquip:function(w,v,u){d.console.log("Udating Equip with: ",w,u,v);var t=f(h.tableMain).find("tr[data-equipid="+w+"]");t.find(h.tableMainFieldWorkOrder).text(v);t.find(h.tableMainFieldStatus).find(".value").text(u)}};function k(t){h.itemsPerPageSelector=t}function p(t){h.statusSelector=t}function r(t,u){o[t]=u}function i(u,t){l[u]=t}function s(u){var t;d.console.log("filter: ",u);d.console.log("HTML Bindings");for(t in h){if(h.hasOwnProperty(t)){d.console.log("\t",t,":",h[t])}}d.console.log("Binding Event Handlers");n.bindEventHandlers();d.console.log("Use Plugins");n.usePlugins();d.console.log("Dictionaries:");d.console.log(o);d.console.log("Initializing MVVM related logic:");for(t in j){if(j.hasOwnProperty(t)){d.console.log("\t",t,":",j[t]);j[t].init()}}j.modalEquipmentHistoryFormAdd.setSaveHistoryCallback(n.updateEquip)}return{init:s,setItemsPerPageSelector:k,setStatusSelector:p,addDictionary:r,addUrl:i}}())}(window,window.jQuery,window.kb,window.ko,window.Backbone));