(function(d,f,c,g,e){var a=d.dandelion,b=a.namespace("App",d);b.EquipmentHistoryDashboard=(function(){var o,k,m,n,s,h,l;o={};k={itemsPerPage:0,currentPage:0};n={};s={dashboardContainer:".dashboard-container",dropdown:".dropdown",itemsPerPageSelector:".items-per-page-selector",statusSelector:".field-status",btnActionFilesDialog:".btn-action-files-dialog",btnActionAdd:".btn-action-add",btnActionEdit:".btn-action-edit",btnActionView:".btn-action-view",dateRangePickerSingle:".daterangepicker-single",tableMain:"#equipmentHistoryDashboardTable",tableMainFieldWorkOrder:".field-workorder",tableMainFieldEquipId:".field-equipid",tableMainFieldWorkOrderLink:".field-workorder-link",tableMainFieldStatus:".field-status",modalEquipmentHistoryFormEdit:"#modal-equipment-history-form-edit"};l={modalEquipmentHistoryFormAdd:(function(w,z,D,y,G){var u,E,A,B,t,v,x;u={modalViewElement:"#modal-equipment-history-form-add",controlWorkOrder:".control-work-order",controlProjectManager:".control-project-manager",controlDateOut:".control-installdte",controlExpactedIn:".control-expdtein",controlReceived:".control-daterec"};E={usePlugins:function(){z(u.controlWorkOrder).select2({theme:"bootstrap",ajax:{url:o.workOrderSelectorAjaxUrl,dataType:"json",delay:250,processResults:function(J,K){K.page=K.page||1;return{results:J.items,pagination:{more:(K.page*30)<J.totalCount}}},cache:true}});z(u.controlProjectManager).select2({theme:"bootstrap",ajax:{url:o.projectManagerSelectorAjaxUrl,dataType:"json",delay:250,processResults:function(J,K){K.page=K.page||1;return{results:J.items,pagination:{more:(K.page*30)<J.totalCount}}},cache:true}})},reset:function(){x.reset();z(u.controlWorkOrder).val(null).trigger("change");z(u.controlProjectManager).val(null).trigger("change");z(u.controlDateOut).val("");z(u.controlExpactedIn).val("");z(u.controlReceived).val("")},saveHistoryCallback:function(){throw"Exception: Not implemented yet. Must be set by SetUpdateHistoryCallback function."}};A={saveHistory_OnDone:function(J){console.log("On Add:",J);var K=z.parseJSON(J);E.saveHistoryCallback(K.equipid,K.ordnum,K.status,K.qbtxlineid);C()}};B=G.Model.extend({defaults:{equipid:"",ordnum:"",inspectno:"",installdte:"",expdtein:"",daterec:""}});t=function(K){var J=this;J.equipid=D.observable(K,"equipid");J.ordnum=D.observable(K,"ordnum");J.inspectno=D.observable(K,"inspectno");J.installdte=D.observable(K,"installdte");J.expdtein=D.observable(K,"expdtein");J.daterec=D.observable(K,"daterec");J.saveHistory=function(L){J.installdte(z(u.controlDateOut).val());J.expdtein(z(u.controlExpactedIn).val());J.daterec(z(u.controlReceived).val());z.post(o.addEquipmentHistoryUrl,{equipid:L.equipid(),ordnum:L.ordnum(),inspectno:L.inspectno(),installdte:L.installdte(),expdtein:L.expdtein(),daterec:L.daterec()}).done(A.saveHistory_OnDone).fail(function M(N){throw"POST Fail with :"+N})};J.reset=function(){J.equipid("");J.ordnum("");J.inspectno("");J.installdte("");J.expdtein("");J.daterec("")}};function H(){var J;J=w.document.getElementById((u.modalViewElement).slice(1));v=new B({});x=new t(v);y.applyBindings(x,J);E.usePlugins()}function F(J){E.reset();x.equipid(J);z(u.modalViewElement).modal("show")}function C(){z(u.modalViewElement).modal("hide")}function I(J){E.saveHistoryCallback=J}return{init:H,showFor:F,hide:C,setSaveHistoryCallback:I}}(d,f,c,g,e)),modalEquipmentHistoryFormEdit:(function(w,A,E,y,H){var u,F,B,C,t,v,x;u={modalViewElement:"#modal-equipment-history-form-edit",controlProjectManager:".control-project-manager-edit",controlDateOut:".control-installdte-edit",controlExpactedIn:".control-expdtein-edit",controlReceived:".control-daterec-edit",alertDelete:".alert-delete"};F={usePlugins:function(){},reset:function(){x.reset();A(u.controlProjectManager).val(null).trigger("change");A(u.controlDateOut).val("");A(u.controlExpactedIn).val("");A(u.controlReceived).val("")},updateHistoryCallback:function(){throw"Exception: Not implemented yet. Must be set by SetUpdateHistoryCallback function."},deleteHistoryCallback:function(){throw"Exception: Not implemented yet. Must be set by SetDeleteHistoryCallback function."}};B={updateHistory_OnDone:function(K){console.log("On Update:",K);var L=A.parseJSON(K);if(L.success){F.updateHistoryCallback(L.equipid,L.ordnum,L.status,L.qbtxlineid)}D()},deleteHistory_OnDone:function(K){console.log("On Delete:",K);var L=A.parseJSON(K);if(L.success){F.deleteHistoryCallback(L.equipid,L.ordnum,L.status,L.qbtxlineid)}D()},getEquipmentHistory_OnDone:function(K){var L;L=A.parseJSON(K);if(L.success){x.equipid(L.equipmentHistoryObject.equipid);x.qbtxlineid(L.equipmentHistoryObject.qbtxlineid);x.inspectno(L.equipmentHistoryObject.inspectno);x.installdte(L.equipmentHistoryObject.installdte);x.expdtein(L.equipmentHistoryObject.expdtein);x.daterec(L.equipmentHistoryObject.daterec);A(u.controlProjectManager).append('<option value="'+L.equipmentHistoryObject.inspectno+'">'+L.equipmentHistoryObject.inspectnoName+"</option>");A(u.controlProjectManager).select2({theme:"bootstrap",ajax:{url:o.projectManagerSelectorAjaxUrl,dataType:"json",delay:250,processResults:function(M,N){N.page=N.page||1;return{results:M.items,pagination:{more:(N.page*30)<M.totalCount}}},cache:true}}).val(L.equipmentHistoryObject.inspectno).trigger("change")}}};C=H.Model.extend({defaults:{qbtxlineid:"",equipid:"",inspectno:"",installdte:"",expdtein:"",daterec:""}});t=function(L){var K=this;K.qbtxlineid=E.observable(L,"qbtxlineid");K.equipid=E.observable(L,"equipid");K.inspectno=E.observable(L,"inspectno");K.installdte=E.observable(L,"installdte");K.expdtein=E.observable(L,"expdtein");K.daterec=E.observable(L,"daterec");K.updateHistory=function(){var M,N,P,O;M=A(u.controlProjectManager).val();N=A(u.controlDateOut).val();P=A(u.controlExpactedIn).val();O=A(u.controlReceived).val();A.post(o.updateEquipmentHistoryUrl,{qbtxlineid:K.qbtxlineid(),equipid:K.equipid(),inspectno:M,installdte:N,expdtein:P,daterec:O}).done(B.updateHistory_OnDone).fail(function Q(R){throw"POST Fail with :"+R})};K.deleteHistory=function(M){A.post(o.deleteEquipmentHistoryUrl,{qbtxlineid:M.qbtxlineid(),equipid:M.equipid()}).done(B.deleteHistory_OnDone).fail(function N(O){throw"POST Fail with :"+O})};K.reset=function(){K.equipid("");K.inspectno("");K.installdte("");K.expdtein("");K.daterec("")}};function J(){var K;K=w.document.getElementById((u.modalViewElement).slice(1));v=new C({});x=new t(v);y.applyBindings(x,K);F.usePlugins()}function G(K){F.reset();A(u.alertDelete).hide();A.post(o.getEquipmentHistoryUrl,{qbtxlineid:K}).done(B.getEquipmentHistory_OnDone).fail(function L(M){throw"POST Fail with :"+M});A(u.modalViewElement).modal("show")}function D(){A(u.modalViewElement).modal("hide")}function z(K){F.updateHistoryCallback=K}function I(K){F.deleteHistoryCallback=K}return{init:J,showFor:G,hide:D,setUpdateHistoryCallback:z,setDeleteHistoryCallback:I}}(d,f,c,g,e)),screenWorkOrderDetails:(function(u,x,B,w,F){var t,C,y,v,H,z,E;t={screenViewElement:"#kb-view-salesorder",modalSaveNotes:"#salesOrderForm_modal_saveNotes",salesOrderForm_btnClose:"#salesOrderForm_btnClose"};C={reset:function(){E.reset()}};y={salesOrderForm_btnClose_onClick:function(I){x(t.screenViewElement).hide()},getWorkOrder_OnDone:function(I){var K,J;K=x.parseJSON(I);J=K.formType;if(K.success){E.modelType(J);E.ordnum(K.salesOrderObject.ordnum);E.date(K.salesOrderObject.date);E.custno(K.salesOrderObject.custno);E.projectLocation(K.salesOrderObject.projectLocation);E.notes(K.salesOrderObject.notes);E.companyName(K.salesOrderObject.companyName);E.address(K.salesOrderObject.address);E.city(K.salesOrderObject.city);E.state(K.salesOrderObject.state);E.zip(K.salesOrderObject.zip);E.phone(K.salesOrderObject.phone);E.subtotal(K.salesOrderObject.subtotal);E.discount(K.salesOrderObject.discount);E.tax(K.salesOrderObject.tax);E.shipping(K.salesOrderObject.shipping);E.total(K.salesOrderObject.total);if(J==="B"||J==="C"){E.ponum(K.salesOrderObject.ponum);E.company(K.salesOrderObject.company);E.destino(K.salesOrderObject.destino);E.prostartdt(K.salesOrderObject.prostartdt);E.proenddt(K.salesOrderObject.proenddt);E.sotypecode(K.salesOrderObject.sotypecode);E.mtrlstatus(K.salesOrderObject.mtrlstatus);E.jobstatus(K.salesOrderObject.jobstatus);E.technam1(K.salesOrderObject.technam1);E.technam2(K.salesOrderObject.technam2);E.qutno(K.salesOrderObject.qutno);E.cstctid(K.salesOrderObject.cstctid);E.jobdescrip(K.salesOrderObject.jobdescrip)}E.items(K.salesOrderObject.itemsCollection)}}};v=F.Model.extend({defaults:{ordnum:"",date:"",custno:"",projectLocation:"",notes:"",companyName:"",address:"",city:"",state:"",zip:"",phone:"",subtotal:"",discount:"",tax:"",shipping:"",total:"",items:new F.Collection([]),modelType:"",ponum:"",company:"",destino:"",prostartdt:"",proenddt:"",sotypecode:"",mtrlstatus:"",jobstatus:"",technam1:"",technam2:"",qutno:"",cstctid:"",jobdescrip:"",}});H=function(J){var I=this;I.modelType=B.observable(J,"modelType");I.ordnum=B.observable(J,"ordnum");I.date=B.observable(J,"date");I.custno=B.observable(J,"custno");I.projectLocation=B.observable(J,"projectLocation");I.notes=B.observable(J,"notes");I.companyName=B.observable(J,"companyName");I.address=B.observable(J,"address");I.city=B.observable(J,"city");I.state=B.observable(J,"state");I.zip=B.observable(J,"zip");I.phone=B.observable(J,"phone");I.subtotal=B.observable(J,"subtotal");I.discount=B.observable(J,"discount");I.tax=B.observable(J,"tax");I.shipping=B.observable(J,"shipping");I.total=B.observable(J,"total");I.ponum=B.observable(J,"ponum");I.company=B.observable(J,"company");I.destino=B.observable(J,"destino");I.prostartdt=B.observable(J,"prostartdt");I.proenddt=B.observable(J,"proenddt");I.sotypecode=B.observable(J,"sotypecode");I.mtrlstatus=B.observable(J,"mtrlstatus");I.jobstatus=B.observable(J,"jobstatus");I.technam1=B.observable(J,"technam1");I.technam2=B.observable(J,"technam2");I.qutno=B.observable(J,"qutno");I.cstctid=B.observable(J,"cstctid");I.jobdescrip=B.observable(J,"jobdescrip");I.items=B.collectionObservable(J.items);I.showTable=w.computed(function(){return I.items().length>0});I.showControlIFBOrC=w.computed(function(){return I.modelType()==="B"||I.modelType()==="C"});I.showControlIfNotC=w.computed(function(){return(I.modelType()!=="C")});I.onShowNotesModal=function(K){x(t.modalSaveNotes).modal("show");return K};I.onSaveNotesModal=function(K){x.post(o.updateWorkOrderNotesUrl,{ordnum:K.ordnum(),notes:K.notes()}).done(function M(){x(t.modalSaveNotes).modal("hide")}).fail(function L(N){throw N});return K};I.reset=function(){I.modelType("");I.ordnum("");I.date("");I.custno("");I.projectLocation("");I.notes("");I.companyName("");I.address("");I.city("");I.state("");I.zip("");I.phone("");I.subtotal("");I.discount("");I.tax("");I.shipping("");I.total("");I.company("");I.destino("");I.prostartdt("");I.proenddt("");I.sotypecode("");I.mtrlstatus("");I.jobstatus("");I.technam1("");I.technam2("");I.qutno("");I.cstctid("");I.jobdescrip("");I.items([])}};function G(){var I;I=u.document.getElementById((t.screenViewElement).slice(1));z=new v({});E=new H(z);w.applyBindings(E,I);x(t.salesOrderForm_btnClose).on("click",y.salesOrderForm_btnClose_onClick)}function D(K){var L,J,O,M,I;L=10;M=x(s.dashboardContainer);I=x(t.screenViewElement);J=parseInt(M.css("height"),L);O=parseInt(I.css("height"),L);if(J>O){I.css("height",J)}C.reset();x.post(o.getWorkOrderUrl,{ordnum:K}).done(y.getWorkOrder_OnDone).fail(function N(P){throw"POST Fail with :"+P});I.show()}function A(){x(s.screenWorkOrderDetails).hide()}return{init:G,showFor:D,hide:A,}}(d,f,c,g,e))};h={dropdown_OnClick:function(u){var t,v;t=f(this);v=t.html();t.parents(s.dropdown).find(".value").text(v)},itemsPerPageSelector_OnClick:function(t){k.itemsPerPage=f(this).html();k.currentPage=1;m.paginate()},tableMainFieldWorkOrderLink_OnClick:function(t){l.screenWorkOrderDetails.showFor(f(this).data("workorder"))},statusSelector_OnClick:function(v){var u,t;t=f(this).parents("tr").data("equipid");u=f(this).html();m.updateStatus(t,u);m.setActionsState(t,k)},btnActionFilesDialog_OnClick:function(t){throw"Exception: Not implemented yet"},btnActionAdd_OnClick:function(t){l.modalEquipmentHistoryFormAdd.showFor(f(this).data("equipid"))},btnActionEdit_OnClick:function(t){l.modalEquipmentHistoryFormEdit.showFor(f(this).data("qbtxlineid"))},btnActionView_OnClick:function(t){throw"Exception: Not implemented yet"}};m={bindEventHandlers:function(){f(s.dropdown).on("click","a",h.dropdown_OnClick);f(s.itemsPerPageSelector).on("click","a",h.itemsPerPageSelector_OnClick);f(s.tableMainFieldWorkOrderLink).on("click",h.tableMainFieldWorkOrderLink_OnClick);f(s.statusSelector).on("click","a",h.statusSelector_OnClick);f(s.btnActionFilesDialog).on("click",h.btnActionFilesDialog_OnClick);f(s.btnActionAdd).on("click",h.btnActionAdd_OnClick);f(s.btnActionEdit).on("click",h.btnActionEdit_OnClick);f(s.btnActionView).on("click",h.btnActionView_OnClick)},usePlugins:function(){f(s.dateRangePickerSingle).daterangepicker({singleDatePicker:true,format:"YYYY-MM-DD",startDate:d.moment(),endDate:d.moment()})},paginate:function(){throw"Exception: Not implemented yet"},getRowByEquipID:function(t){return f(s.tableMainFieldEquipId).filter(function u(v){return f(this).find("a").text()===t}).parent()},updateEquip:function(w,v,u,x){d.console.log("equipID",w);d.console.log("workOrder",v);d.console.log("status",u);d.console.log("historyID",x);var t=m.getRowByEquipID(w);t.find(s.tableMainFieldWorkOrder).html('<a href="#" class="field-workorder-link" data-workorder="'+v+'">'+v+"</a>");t.find(s.tableMainFieldStatus).find(".value").text(u);t.find(s.btnActionEdit).data("qbtxlineid",x);m.setActionsState(w,u)},updateEquipStatus:function(v,u){var t=m.getRowByEquipID(v);t.find(s.tableMainFieldStatus).find(".value").text(u);m.setActionsState(v,u)},setActionsState:function(u,t){if(t==="Available"){m.enableRowActionAdd(u);m.disableRowActionEdit(u)}else{m.enableRowActionEdit(u);m.disableRowActionAdd(u)}},enableRowActionAdd:function(u){var t=m.getRowByEquipID(u);t.find(s.btnActionAdd).attr({disabled:false})},disableRowActionAdd:function(u){var t=m.getRowByEquipID(u);t.find(s.btnActionAdd).attr({disabled:true})},enableRowActionEdit:function(u){var t=m.getRowByEquipID(u);t.find(s.btnActionEdit).attr({disabled:false})},disableRowActionEdit:function(u){var t=m.getRowByEquipID(u);t.find(s.btnActionEdit).attr({disabled:true})},updateStatus:function(u,t){f.post(o.updateStatusUrl,{equipid:u,status:t}).done(function w(x){var y=f.parseJSON(x)}).fail(function v(x){throw"POST Fail with :"+x})}};function j(t){s.itemsPerPageSelector=t}function p(t){s.statusSelector=t}function q(t,u){n[t]=u}function i(u,t){o[u]=t}function r(u){var t;d.console.log("filter: ",u);d.console.log("HTML Bindings");for(t in s){if(s.hasOwnProperty(t)){d.console.log("\t",t,":",s[t])}}d.console.log("Binding Event Handlers");m.bindEventHandlers();d.console.log("Use Plugins");m.usePlugins();d.console.log("Dictionaries:");d.console.log(n);d.console.log("Initializing MVVM related logic:");for(t in l){if(l.hasOwnProperty(t)){d.console.log("\t",t,":",l[t]);l[t].init()}}l.modalEquipmentHistoryFormAdd.setSaveHistoryCallback(m.updateEquip);l.modalEquipmentHistoryFormEdit.setUpdateHistoryCallback(m.updateEquip);l.modalEquipmentHistoryFormEdit.setDeleteHistoryCallback(m.updateEquip)}return{init:r,setItemsPerPageSelector:j,setStatusSelector:p,addDictionary:q,addUrl:i}}())}(window,window.jQuery,window.kb,window.ko,window.Backbone));