(function(){var a=window.AmCharts;a.AmXYChart=a.Class({inherits:a.AmRectangularChart,construct:function(b){this.type="xy";a.AmXYChart.base.construct.call(this,b);this.cname="AmXYChart";this.theme=b;this.createEvents("zoomed");this.maxZoomFactor=20;a.applyTheme(this,b,this.cname)},initChart:function(){a.AmXYChart.base.initChart.call(this);this.dataChanged&&(this.updateData(),this.dataChanged=!1,this.dispatchDataUpdated=!0);this.updateScrollbar=!0;this.drawChart();this.autoMargins&&!this.marginsUpdated&&(this.marginsUpdated=!0,this.measureMargins());var f=this.marginLeftReal,h=this.marginTopReal,e=this.plotAreaWidth,g=this.plotAreaHeight;this.graphsSet.clipRect(f,h,e,g);this.bulletSet.clipRect(f,h,e,g);this.trendLinesSet.clipRect(f,h,e,g)},prepareForExport:function(){var b=this.bulletSet;b.clipPath&&this.container.remove(b.clipPath)},createValueAxes:function(){var g=[],l=[];this.xAxes=g;this.yAxes=l;var e=this.valueAxes,j,i;for(i=0;i<e.length;i++){j=e[i];var h=j.position;if("top"==h||"bottom"==h){j.rotate=!0}j.setOrientation(j.rotate);h=j.orientation;"V"==h&&l.push(j);"H"==h&&g.push(j)}0===l.length&&(j=new a.ValueAxis(this.theme),j.rotate=!1,j.setOrientation(!1),e.push(j),l.push(j));0===g.length&&(j=new a.ValueAxis(this.theme),j.rotate=!0,j.setOrientation(!0),e.push(j),g.push(j));for(i=0;i<e.length;i++){this.processValueAxis(e[i],i)}g=this.graphs;for(i=0;i<g.length;i++){this.processGraph(g[i],i)}},drawChart:function(){a.AmXYChart.base.drawChart.call(this);a.ifArray(this.chartData)?(this.chartScrollbar&&this.updateScrollbars(),this.selfZoom&&(this.horizontalPosition=this.horizontalPosition*this.plotAreaWidth/this.prevPlotAreaWidth,this.verticalPosition=this.verticalPosition*this.plotAreaHeight/this.prevPlotAreaHeight,this.selfZoom=!1),this.zoomChart()):this.cleanChart();if(this.hideXScrollbar){var b=this.scrollbarH;b&&(this.removeListener(b,"zoomed",this.handleHSBZoom),b.destroy());this.scrollbarH=null}if(this.hideYScrollbar){if(b=this.scrollbarV){this.removeListener(b,"zoomed",this.handleVSBZoom),b.destroy()}this.scrollbarV=null}if(!this.autoMargins||this.marginsUpdated){this.dispDUpd(),this.chartCreated=!0,this.zoomScrollbars()}},cleanChart:function(){a.callMethod("destroy",[this.valueAxes,this.graphs,this.scrollbarV,this.scrollbarH,this.chartCursor])},zoomChart:function(){this.toggleZoomOutButton();this.zoomObjects(this.valueAxes);this.zoomObjects(this.graphs);this.zoomTrendLines();this.dispatchAxisZoom();this.prevPlotAreaWidth=this.plotAreaWidth;this.prevPlotAreaHeight=this.plotAreaHeight},toggleZoomOutButton:function(){1==this.heightMultiplier&&1==this.widthMultiplier?this.showZB(!1):this.showZB(!0)},dispatchAxisZoom:function(){var h=this.valueAxes,l;for(l=0;l<h.length;l++){var g=h[l];if(!isNaN(g.min)&&!isNaN(g.max)){var k,i;"V"==g.orientation?(k=g.coordinateToValue(-this.verticalPosition),i=g.coordinateToValue(-this.verticalPosition+this.plotAreaHeight)):(k=g.coordinateToValue(-this.horizontalPosition),i=g.coordinateToValue(-this.horizontalPosition+this.plotAreaWidth));if(!isNaN(k)&&!isNaN(i)){if(k>i){var j=i;i=k;k=j}g.dispatchZoomEvent(k,i)}}}},zoomObjects:function(f){var h=f.length,e,g;for(e=0;e<h;e++){g=f[e],g.minTemp=g.min,g.maxTemp=g.max,this.updateObjectSize(g),g.zoom(0,this.chartData.length-1),g.minTemp=NaN,g.maxTemp=NaN}},updateData:function(){this.parseData();var t=this.chartData,r=t.length-1,s=this.graphs,q=this.dataProvider,o=-Infinity,j=Infinity,m,i;for(m=0;m<s.length;m++){if(i=s[m],i.data=t,i.zoom(0,r),i=i.valueField){var g;for(g=0;g<q.length;g++){if(null!==f){var f=Number(q[g][i]);f>o&&(o=f);f<j&&(j=f)}}}}for(m=0;m<s.length;m++){i=s[m],i.maxValue=o,i.minValue=j}if(t=this.chartCursor){t.updateData(),t.type="crosshair",t.valueBalloonsEnabled=!1}},zoomOut:function(){this.verticalPosition=this.horizontalPosition=0;this.heightMultiplier=this.widthMultiplier=1;this.zoomChart();this.zoomScrollbars()},processValueAxis:function(b){b.chart=this;b.minMaxField="H"==b.orientation?"x":"y";b.min=NaN;b.max=NaN;this.listenTo(b,"axisSelfZoomed",this.handleAxisSelfZoom)},processGraph:function(b){a.isString(b.xAxis)&&(b.xAxis=this.getValueAxisById(b.xAxis));a.isString(b.yAxis)&&(b.yAxis=this.getValueAxisById(b.yAxis));b.xAxis||(b.xAxis=this.xAxes[0]);b.yAxis||(b.yAxis=this.yAxes[0]);b.valueAxis=b.yAxis},parseData:function(){a.AmXYChart.base.parseData.call(this);this.chartData=[];var C=this.dataProvider,A=this.valueAxes,B=this.graphs,z;if(C){for(z=0;z<C.length;z++){var y={axes:{},x:{},y:{}},v=this.dataDateFormat,w=C[z],u;for(u=0;u<A.length;u++){var o=A[u].id;y.axes[o]={};y.axes[o].graphs={};var j;for(j=0;j<B.length;j++){var s=B[j],D=s.id;if(s.xAxis.id==o||s.yAxis.id==o){var i={};i.serialDataItem=y;i.index=z;var e={},x=w[s.valueField];null!==x&&(x=Number(x),isNaN(x)||(e.value=x));x=w[s.xField];null!==x&&("date"==s.xAxis.type&&(x=a.getDate(w[s.xField],v).getTime()),x=Number(x),isNaN(x)||(e.x=x));x=w[s.yField];null!==x&&("date"==s.yAxis.type&&(x=a.getDate(w[s.yField],v).getTime()),x=Number(x),isNaN(x)||(e.y=x));x=w[s.errorField];null!==x&&(x=Number(x),isNaN(x)||(e.error=x));i.values=e;this.processFields(s,i,w);i.serialDataItem=y;i.graph=s;y.axes[o].graphs[D]=i}}}this.chartData[z]=y}}},formatString:function(g,n,e){var m=n.graph,l=m.numberFormatter;l||(l=this.nf);var i,j;"date"==n.graph.xAxis.type&&(i=a.formatDate(new Date(n.values.x),m.dateFormat,this),j=RegExp("\\[\\[x\\]\\]","g"),g=g.replace(j,i));"date"==n.graph.yAxis.type&&(i=a.formatDate(new Date(n.values.y),m.dateFormat,this),j=RegExp("\\[\\[y\\]\\]","g"),g=g.replace(j,i));g=a.formatValue(g,n.values,["value","x","y"],l);-1!=g.indexOf("[[")&&(g=a.formatDataContextValue(g,n.dataContext));return g=a.AmXYChart.base.formatString.call(this,g,n,e)},addChartScrollbar:function(e){a.callMethod("destroy",[this.chartScrollbar,this.scrollbarH,this.scrollbarV]);if(e){this.chartScrollbar=e;this.scrollbarHeight=e.scrollbarHeight;var f="backgroundColor backgroundAlpha selectedBackgroundColor selectedBackgroundAlpha scrollDuration resizeEnabled hideResizeGrips scrollbarHeight updateOnReleaseOnly".split(" ");if(!this.hideYScrollbar){var d=new a.SimpleChartScrollbar(this.theme);d.skipEvent=!0;d.chart=this;this.listenTo(d,"zoomed",this.handleVSBZoom);a.copyProperties(e,d,f);d.rotate=!0;this.scrollbarV=d}this.hideXScrollbar||(d=new a.SimpleChartScrollbar(this.theme),d.skipEvent=!0,d.chart=this,this.listenTo(d,"zoomed",this.handleHSBZoom),a.copyProperties(e,d,f),d.rotate=!1,this.scrollbarH=d)}},updateTrendLines:function(){var f=this.trendLines,h;for(h=0;h<f.length;h++){var e=f[h],e=a.processObject(e,a.TrendLine,this.theme);f[h]=e;e.chart=this;var g=e.valueAxis;a.isString(g)&&(e.valueAxis=this.getValueAxisById(g));g=e.valueAxisX;a.isString(g)&&(e.valueAxisX=this.getValueAxisById(g));e.id||(e.id="trendLineAuto"+h+"_"+(new Date).getTime());e.valueAxis||(e.valueAxis=this.yAxes[0]);e.valueAxisX||(e.valueAxisX=this.xAxes[0])}},updateMargins:function(){a.AmXYChart.base.updateMargins.call(this);var b=this.scrollbarV;b&&(this.getScrollbarPosition(b,!0,this.yAxes[0].position),this.adjustMargins(b,!0));if(b=this.scrollbarH){this.getScrollbarPosition(b,!1,this.xAxes[0].position),this.adjustMargins(b,!1)}},updateScrollbars:function(){a.AmXYChart.base.updateScrollbars.call(this);var b=this.scrollbarV;b&&(this.updateChartScrollbar(b,!0),b.draw());if(b=this.scrollbarH){this.updateChartScrollbar(b,!1),b.draw()}},zoomScrollbars:function(){var b=this.scrollbarH;b&&b.relativeZoom(this.widthMultiplier,-this.horizontalPosition/this.widthMultiplier);(b=this.scrollbarV)&&b.relativeZoom(this.heightMultiplier,-this.verticalPosition/this.heightMultiplier)},fitMultiplier:function(b){b>this.maxZoomFactor&&(b=this.maxZoomFactor);return b},fitH:function(e,f){var d=-(this.plotAreaWidth*f-this.plotAreaWidth);e<d&&(e=d);this.horizontalPosition=e},fitV:function(e,f){var d=-(this.plotAreaHeight*f-this.plotAreaHeight);e<d&&(e=d);this.verticalPosition=e},handleHSBZoom:function(b){var d=this.fitMultiplier(b.multiplier);this.fitH(-b.position*d,d);this.widthMultiplier=d;this.zoomChart()},handleVSBZoom:function(b){var d=this.fitMultiplier(b.multiplier);this.fitV(-b.position*d,d);this.heightMultiplier=d;this.zoomChart()},handleAxisSelfZoom:function(b){if("H"==b.valueAxis.orientation){var d=this.fitMultiplier(b.multiplier);this.fitH(-b.position*d,d);this.widthMultiplier=d}else{d=this.fitMultiplier(b.multiplier),this.fitV(-b.position*d,d),this.heightMultiplier=d}this.zoomChart();b=this.graphs;for(d=0;d<b.length;d++){b[d].setAnimationPlayed()}this.zoomScrollbars()},handleCursorZoom:function(f){var h=this.widthMultiplier*this.plotAreaWidth/f.selectionWidth,e=this.heightMultiplier*this.plotAreaHeight/f.selectionHeight,h=this.fitMultiplier(h),e=this.fitMultiplier(e),g=(this.verticalPosition-f.selectionY)*e/this.heightMultiplier;this.fitH((this.horizontalPosition-f.selectionX)*h/this.widthMultiplier,h);this.fitV(g,e);this.widthMultiplier=h;this.heightMultiplier=e;this.zoomChart();this.zoomScrollbars()},removeChartScrollbar:function(){a.callMethod("destroy",[this.scrollbarH,this.scrollbarV]);this.scrollbarV=this.scrollbarH=null},handleReleaseOutside:function(b){a.AmXYChart.base.handleReleaseOutside.call(this,b);a.callMethod("handleReleaseOutside",[this.scrollbarH,this.scrollbarV])},update:function(){a.AmXYChart.base.update.call(this);this.scrollbarH&&this.scrollbarH.update&&this.scrollbarH.update();this.scrollbarV&&this.scrollbarV.update&&this.scrollbarV.update()}})})();