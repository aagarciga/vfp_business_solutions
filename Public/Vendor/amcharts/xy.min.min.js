(function(){var b=window.AmCharts;b.AmXYChart=b.Class({inherits:b.AmRectangularChart,construct:function(a){this.type="xy";b.AmXYChart.base.construct.call(this,a);this.cname="AmXYChart";this.theme=a;this.createEvents("zoomed");this.maxZoomFactor=20;b.applyTheme(this,a,this.cname)},initChart:function(){b.AmXYChart.base.initChart.call(this);this.dataChanged&&(this.updateData(),this.dataChanged=!1,this.dispatchDataUpdated=!0);this.updateScrollbar=!0;this.drawChart();this.autoMargins&&!this.marginsUpdated&&(this.marginsUpdated=!0,this.measureMargins());var d=this.marginLeftReal,a=this.marginTopReal,i=this.plotAreaWidth,c=this.plotAreaHeight;this.graphsSet.clipRect(d,a,i,c);this.bulletSet.clipRect(d,a,i,c);this.trendLinesSet.clipRect(d,a,i,c)},prepareForExport:function(){var a=this.bulletSet;a.clipPath&&this.container.remove(a.clipPath)},createValueAxes:function(){var k=[],a=[];this.xAxes=k;this.yAxes=a;var m=this.valueAxes,c,d;for(d=0;d<m.length;d++){c=m[d];var f=c.position;if("top"==f||"bottom"==f){c.rotate=!0}c.setOrientation(c.rotate);f=c.orientation;"V"==f&&a.push(c);"H"==f&&k.push(c)}0===a.length&&(c=new b.ValueAxis(this.theme),c.rotate=!1,c.setOrientation(!1),m.push(c),a.push(c));0===k.length&&(c=new b.ValueAxis(this.theme),c.rotate=!0,c.setOrientation(!0),m.push(c),k.push(c));for(d=0;d<m.length;d++){this.processValueAxis(m[d],d)}k=this.graphs;for(d=0;d<k.length;d++){this.processGraph(k[d],d)}},drawChart:function(){b.AmXYChart.base.drawChart.call(this);b.ifArray(this.chartData)?(this.chartScrollbar&&this.updateScrollbars(),this.selfZoom&&(this.horizontalPosition=this.horizontalPosition*this.plotAreaWidth/this.prevPlotAreaWidth,this.verticalPosition=this.verticalPosition*this.plotAreaHeight/this.prevPlotAreaHeight,this.selfZoom=!1),this.zoomChart()):this.cleanChart();if(this.hideXScrollbar){var a=this.scrollbarH;a&&(this.removeListener(a,"zoomed",this.handleHSBZoom),a.destroy());this.scrollbarH=null}if(this.hideYScrollbar){if(a=this.scrollbarV){this.removeListener(a,"zoomed",this.handleVSBZoom),a.destroy()}this.scrollbarV=null}if(!this.autoMargins||this.marginsUpdated){this.dispDUpd(),this.chartCreated=!0,this.zoomScrollbars()}},cleanChart:function(){b.callMethod("destroy",[this.valueAxes,this.graphs,this.scrollbarV,this.scrollbarH,this.chartCursor])},zoomChart:function(){this.toggleZoomOutButton();this.zoomObjects(this.valueAxes);this.zoomObjects(this.graphs);this.zoomTrendLines();this.dispatchAxisZoom();this.prevPlotAreaWidth=this.plotAreaWidth;this.prevPlotAreaHeight=this.plotAreaHeight},toggleZoomOutButton:function(){1==this.heightMultiplier&&1==this.widthMultiplier?this.showZB(!1):this.showZB(!0)},dispatchAxisZoom:function(){var f=this.valueAxes,a;for(a=0;a<f.length;a++){var m=f[a];if(!isNaN(m.min)&&!isNaN(m.max)){var c,e;"V"==m.orientation?(c=m.coordinateToValue(-this.verticalPosition),e=m.coordinateToValue(-this.verticalPosition+this.plotAreaHeight)):(c=m.coordinateToValue(-this.horizontalPosition),e=m.coordinateToValue(-this.horizontalPosition+this.plotAreaWidth));if(!isNaN(c)&&!isNaN(e)){if(c>e){var d=e;e=c;c=d}m.dispatchZoomEvent(c,e)}}}},zoomObjects:function(d){var a=d.length,i,c;for(i=0;i<a;i++){c=d[i],c.minTemp=c.min,c.maxTemp=c.max,this.updateObjectSize(c),c.zoom(0,this.chartData.length-1),c.minTemp=NaN,c.maxTemp=NaN}},updateData:function(){this.parseData();var p=this.chartData,a=p.length-1,u=this.graphs,c=this.dataProvider,d=-Infinity,h=Infinity,e,k;for(e=0;e<u.length;e++){if(k=u[e],k.data=p,k.zoom(0,a),k=k.valueField){var l;for(l=0;l<c.length;l++){if(null!==n){var n=Number(c[l][k]);n>d&&(d=n);n<h&&(h=n)}}}}for(e=0;e<u.length;e++){k=u[e],k.maxValue=d,k.minValue=h}if(p=this.chartCursor){p.updateData(),p.type="crosshair",p.valueBalloonsEnabled=!1}},zoomOut:function(){this.verticalPosition=this.horizontalPosition=0;this.heightMultiplier=this.widthMultiplier=1;this.zoomChart();this.zoomScrollbars()},processValueAxis:function(a){a.chart=this;a.minMaxField="H"==a.orientation?"x":"y";a.min=NaN;a.max=NaN;this.listenTo(a,"axisSelfZoomed",this.handleAxisSelfZoom)},processGraph:function(a){b.isString(a.xAxis)&&(a.xAxis=this.getValueAxisById(a.xAxis));b.isString(a.yAxis)&&(a.yAxis=this.getValueAxisById(a.yAxis));a.xAxis||(a.xAxis=this.xAxes[0]);a.yAxis||(a.yAxis=this.yAxes[0]);a.valueAxis=a.yAxis},parseData:function(){b.AmXYChart.base.parseData.call(this);this.chartData=[];var c=this.dataProvider,g=this.valueAxes,d=this.graphs,m;if(c){for(m=0;m<c.length;m++){var n={axes:{},x:{},y:{}},r=this.dataDateFormat,q=c[m],t;for(t=0;t<g.length;t++){var f=g[t].id;n.axes[f]={};n.axes[f].graphs={};var h;for(h=0;h<d.length;h++){var E=d[h],a=E.id;if(E.xAxis.id==f||E.yAxis.id==f){var k={};k.serialDataItem=n;k.index=m;var l={},p=q[E.valueField];null!==p&&(p=Number(p),isNaN(p)||(l.value=p));p=q[E.xField];null!==p&&("date"==E.xAxis.type&&(p=b.getDate(q[E.xField],r).getTime()),p=Number(p),isNaN(p)||(l.x=p));p=q[E.yField];null!==p&&("date"==E.yAxis.type&&(p=b.getDate(q[E.yField],r).getTime()),p=Number(p),isNaN(p)||(l.y=p));p=q[E.errorField];null!==p&&(p=Number(p),isNaN(p)||(l.error=p));k.values=l;this.processFields(E,k,q);k.serialDataItem=n;k.graph=E;n.axes[f].graphs[a]=k}}}this.chartData[m]=n}}},formatString:function(h,o,k){var a=o.graph,c=a.numberFormatter;c||(c=this.nf);var f,d;"date"==o.graph.xAxis.type&&(f=b.formatDate(new Date(o.values.x),a.dateFormat,this),d=RegExp("\\[\\[x\\]\\]","g"),h=h.replace(d,f));"date"==o.graph.yAxis.type&&(f=b.formatDate(new Date(o.values.y),a.dateFormat,this),d=RegExp("\\[\\[y\\]\\]","g"),h=h.replace(d,f));h=b.formatValue(h,o.values,["value","x","y"],c);-1!=h.indexOf("[[")&&(h=b.formatDataContextValue(h,o.dataContext));return h=b.AmXYChart.base.formatString.call(this,h,o,k)},addChartScrollbar:function(c){b.callMethod("destroy",[this.chartScrollbar,this.scrollbarH,this.scrollbarV]);if(c){this.chartScrollbar=c;this.scrollbarHeight=c.scrollbarHeight;var a="backgroundColor backgroundAlpha selectedBackgroundColor selectedBackgroundAlpha scrollDuration resizeEnabled hideResizeGrips scrollbarHeight updateOnReleaseOnly".split(" ");if(!this.hideYScrollbar){var g=new b.SimpleChartScrollbar(this.theme);g.skipEvent=!0;g.chart=this;this.listenTo(g,"zoomed",this.handleVSBZoom);b.copyProperties(c,g,a);g.rotate=!0;this.scrollbarV=g}this.hideXScrollbar||(g=new b.SimpleChartScrollbar(this.theme),g.skipEvent=!0,g.chart=this,this.listenTo(g,"zoomed",this.handleHSBZoom),b.copyProperties(c,g,a),g.rotate=!1,this.scrollbarH=g)}},updateTrendLines:function(){var d=this.trendLines,a;for(a=0;a<d.length;a++){var i=d[a],i=b.processObject(i,b.TrendLine,this.theme);d[a]=i;i.chart=this;var c=i.valueAxis;b.isString(c)&&(i.valueAxis=this.getValueAxisById(c));c=i.valueAxisX;b.isString(c)&&(i.valueAxisX=this.getValueAxisById(c));i.id||(i.id="trendLineAuto"+a+"_"+(new Date).getTime());i.valueAxis||(i.valueAxis=this.yAxes[0]);i.valueAxisX||(i.valueAxisX=this.xAxes[0])}},updateMargins:function(){b.AmXYChart.base.updateMargins.call(this);var a=this.scrollbarV;a&&(this.getScrollbarPosition(a,!0,this.yAxes[0].position),this.adjustMargins(a,!0));if(a=this.scrollbarH){this.getScrollbarPosition(a,!1,this.xAxes[0].position),this.adjustMargins(a,!1)}},updateScrollbars:function(){b.AmXYChart.base.updateScrollbars.call(this);var a=this.scrollbarV;a&&(this.updateChartScrollbar(a,!0),a.draw());if(a=this.scrollbarH){this.updateChartScrollbar(a,!1),a.draw()}},zoomScrollbars:function(){var a=this.scrollbarH;a&&a.relativeZoom(this.widthMultiplier,-this.horizontalPosition/this.widthMultiplier);(a=this.scrollbarV)&&a.relativeZoom(this.heightMultiplier,-this.verticalPosition/this.heightMultiplier)},fitMultiplier:function(a){a>this.maxZoomFactor&&(a=this.maxZoomFactor);return a},fitH:function(c,a){var g=-(this.plotAreaWidth*a-this.plotAreaWidth);c<g&&(c=g);this.horizontalPosition=c},fitV:function(c,a){var g=-(this.plotAreaHeight*a-this.plotAreaHeight);c<g&&(c=g);this.verticalPosition=c},handleHSBZoom:function(a){var c=this.fitMultiplier(a.multiplier);this.fitH(-a.position*c,c);this.widthMultiplier=c;this.zoomChart()},handleVSBZoom:function(a){var c=this.fitMultiplier(a.multiplier);this.fitV(-a.position*c,c);this.heightMultiplier=c;this.zoomChart()},handleAxisSelfZoom:function(a){if("H"==a.valueAxis.orientation){var c=this.fitMultiplier(a.multiplier);this.fitH(-a.position*c,c);this.widthMultiplier=c}else{c=this.fitMultiplier(a.multiplier),this.fitV(-a.position*c,c),this.heightMultiplier=c}this.zoomChart();a=this.graphs;for(c=0;c<a.length;c++){a[c].setAnimationPlayed()}this.zoomScrollbars()},handleCursorZoom:function(d){var a=this.widthMultiplier*this.plotAreaWidth/d.selectionWidth,i=this.heightMultiplier*this.plotAreaHeight/d.selectionHeight,a=this.fitMultiplier(a),i=this.fitMultiplier(i),c=(this.verticalPosition-d.selectionY)*i/this.heightMultiplier;this.fitH((this.horizontalPosition-d.selectionX)*a/this.widthMultiplier,a);this.fitV(c,i);this.widthMultiplier=a;this.heightMultiplier=i;this.zoomChart();this.zoomScrollbars()},removeChartScrollbar:function(){b.callMethod("destroy",[this.scrollbarH,this.scrollbarV]);this.scrollbarV=this.scrollbarH=null},handleReleaseOutside:function(a){b.AmXYChart.base.handleReleaseOutside.call(this,a);b.callMethod("handleReleaseOutside",[this.scrollbarH,this.scrollbarV])},update:function(){b.AmXYChart.base.update.call(this);this.scrollbarH&&this.scrollbarH.update&&this.scrollbarH.update();this.scrollbarV&&this.scrollbarV.update&&this.scrollbarV.update()}})})();