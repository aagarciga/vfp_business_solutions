(function(){var b=window.AmCharts;b.AmPieChart=b.Class({inherits:b.AmSlicedChart,construct:function(a){this.type="pie";b.AmPieChart.base.construct.call(this,a);this.cname="AmPieChart";this.pieBrightnessStep=30;this.minRadius=10;this.depth3D=0;this.startAngle=90;this.angle=this.innerRadius=0;this.startRadius="500%";this.pullOutRadius="20%";this.labelRadius=20;this.labelText="[[title]]: [[percents]]%";this.balloonText="[[title]]: [[percents]]% ([[value]])\n[[description]]";this.previousScale=1;this.adjustPrecision=!1;b.applyTheme(this,a,this.cname)},drawChart:function(){b.AmPieChart.base.drawChart.call(this);var c=this.chartData;if(b.ifArray(c)){if(0<this.realWidth&&0<this.realHeight){b.VML&&(this.startAlpha=1);var f=this.startDuration,a=this.container,ab=this.updateWidth();this.realWidth=ab;var m=this.updateHeight();this.realHeight=m;var d=b.toCoordinate,e=d(this.marginLeft,ab),F=d(this.marginRight,ab),A=d(this.marginTop,m)+this.getTitleHeight(),k=d(this.marginBottom,m),p,q,h,D=b.toNumber(this.labelRadius),n=this.measureMaxLabel();n>this.maxLabelWidth&&(n=this.maxLabelWidth);this.labelText&&this.labelsEnabled||(D=n=0);p=void 0===this.pieX?(ab-e-F)/2+e:d(this.pieX,this.realWidth);q=void 0===this.pieY?(m-A-k)/2+A:d(this.pieY,m);h=d(this.radius,ab,m);h||(ab=0<=D?ab-e-F-2*n:ab-e-F,m=m-A-k,h=Math.min(ab,m),m<ab&&(h/=1-this.angle/90,h>ab&&(h=ab)),m=b.toCoordinate(this.pullOutRadius,h),h=(0<=D?h-1.8*(D+m):h-1.8*m)/2);h<this.minRadius&&(h=this.minRadius);m=d(this.pullOutRadius,h);A=b.toCoordinate(this.startRadius,h);d=d(this.innerRadius,h);d>=h&&(d=h-1);k=b.fitToBounds(this.startAngle,0,360);0<this.depth3D&&(k=270<=k?270:90);k-=90;360<k&&(k-=360);ab=h-h*this.angle/90;for(e=n=0;e<c.length;e++){F=c[e],!0!==F.hidden&&(n+=b.roundTo(F.percents,this.pf.precision))}n=b.roundTo(n,this.pf.precision);this.tempPrec=NaN;this.adjustPrecision&&100!=n&&(this.tempPrec=this.pf.precision+1);for(var v,e=0;e<c.length;e++){if(F=c[e],!0!==F.hidden&&(this.showZeroSlices||0!==F.percents)){var t=360*F.percents/100,n=Math.sin((k+t/2)/180*Math.PI),u=-Math.cos((k+t/2)/180*Math.PI)*(ab/h),r=this.outlineColor;r||(r=F.color);var B=this.alpha;isNaN(F.alpha)||(B=F.alpha);r={fill:F.color,stroke:r,"stroke-width":this.outlineThickness,"stroke-opacity":this.outlineAlpha,"fill-opacity":B};F.url&&(r.cursor="pointer");r=b.wedge(a,p,q,k,t,h,ab,d,this.depth3D,r,this.gradientRatio,F.pattern,this.path);b.setCN(this,r,"pie-item");b.setCN(this,r.wedge,"pie-slice");b.setCN(this,r,F.className,!0);this.addEventListeners(r,F);F.startAngle=k;c[e].wedge=r;0<f&&(this.chartCreated||r.setAttr("opacity",this.startAlpha));F.ix=n;F.iy=u;F.wedge=r;F.index=e;B=a.set();if(this.labelsEnabled&&this.labelText&&F.percents>=this.hideLabelsPercent){var g=k+t/2;0>g&&(g+=360);360<g&&(g-=360);var w=D;isNaN(F.labelRadius)||(w=F.labelRadius);var t=p+n*(h+w),x=q+u*(h+w),C,y=0;isNaN(v)&&350<g&&1<c.length-e&&(v=e-1+Math.floor((c.length-e)/2));if(0<=w){var E;90>=g&&0<=g?(E=0,C="start",y=8):90<=g&&180>g?(E=1,C="start",y=8):180<=g&&270>g?(E=2,C="end",y=-8):270<=g&&357>=g?(E=3,C="end",y=-8):357<=g&&(e>v?(E=0,C="start",y=8):(E=3,C="end",y=-8));F.labelQuarter=E}else{C="middle"}g=this.formatString(this.labelText,F);(w=this.labelFunction)&&(g=w(F,g));w=F.labelColor;w||(w=this.color);if(""!==g){g=b.wrappedText(a,g,w,this.fontFamily,this.fontSize,C,!1,this.maxLabelWidth);b.setCN(this,g,"pie-label");b.setCN(this,g,F.className,!0);g.translate(t+1.5*y,x);g.node.style.pointerEvents="none";F.ty=x;F.textX=t+1.5*y;var w=g.getBBox(),z=b.rect(a,w.width+5,w.height+5,"#FFFFFF",0.005);z.translate(t+1.5*y+w.x,x+w.y);F.hitRect=z;B.push(g);B.push(z);this.axesSet.push(B);F.labelSet=B;F.label=g}F.tx=t;F.tx2=t+y;F.tx0=p+n*h;F.ty0=q+u*h}t=d+(h-d)/2;F.pulled&&(t+=this.pullOutRadiusReal);F.balloonX=n*t+p;F.balloonY=u*t+q;F.startX=Math.round(n*A);F.startY=Math.round(u*A);F.pullX=Math.round(n*m);F.pullY=Math.round(u*m);this.graphsSet.push(r);if(0===F.alpha||0<f&&!this.chartCreated){r.hide(),B&&B.hide()}k+=360*F.percents/100;360<k&&(k-=360)}}0<D&&this.arrangeLabels();this.pieXReal=p;this.pieYReal=q;this.radiusReal=h;this.innerRadiusReal=d;0<D&&this.drawTicks();this.initialStart();this.setDepths()}(c=this.legend)&&c.invalidateSize()}else{this.cleanChart()}this.dispDUpd()},setDepths:function(){var c=this.chartData,d;for(d=0;d<c.length;d++){var a=c[d],g=a.wedge,a=a.startAngle;0<=a&&180>a?g.toFront():180<=a&&g.toBack()}},arrangeLabels:function(){var c=this.chartData,d=c.length,a,g;for(g=d-1;0<=g;g--){a=c[g],0!==a.labelQuarter||a.hidden||this.checkOverlapping(g,a,0,!0,0)}for(g=0;g<d;g++){a=c[g],1!=a.labelQuarter||a.hidden||this.checkOverlapping(g,a,1,!1,0)}for(g=d-1;0<=g;g--){a=c[g],2!=a.labelQuarter||a.hidden||this.checkOverlapping(g,a,2,!0,0)}for(g=0;g<d;g++){a=c[g],3!=a.labelQuarter||a.hidden||this.checkOverlapping(g,a,3,!1,0)}},checkOverlapping:function(e,l,d,c,m){var f,g,a=this.chartData,u=a.length,t=l.label;if(t){if(!0===c){for(g=e+1;g<u;g++){a[g].labelQuarter==d&&(f=this.checkOverlappingReal(l,a[g],d))&&(g=u)}}else{for(g=e-1;0<=g;g--){a[g].labelQuarter==d&&(f=this.checkOverlappingReal(l,a[g],d))&&(g=0)}}!0===f&&100>m&&isNaN(l.labelRadius)&&(f=l.ty+3*l.iy,l.ty=f,t.translate(l.textX,f),l.hitRect&&(t=t.getBBox(),l.hitRect.translate(l.tx2,f+t.y)),this.checkOverlapping(e,l,d,c,m+1))}},checkOverlappingReal:function(d,g,a){var m=!1,c=d.label,e=g.label;d.labelQuarter!=a||d.hidden||g.hidden||!e||(c=c.getBBox(),a={},a.width=c.width,a.height=c.height,a.y=d.ty,a.x=d.tx,d=e.getBBox(),e={},e.width=d.width,e.height=d.height,e.y=g.ty,e.x=g.tx,b.hitTest(a,e)&&(m=!0));return m}})})();