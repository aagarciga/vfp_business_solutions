/*! Fabric.js Copyright 2008-2015, Printio (Juriy Zaytsev, Maxim Chernyak) */
var fabric=fabric||{version:"1.5.0"};if(typeof exports!=="undefined"){exports.fabric=fabric}if(typeof document!=="undefined"&&typeof window!=="undefined"){fabric.document=document;fabric.window=window;window.fabric=fabric}else{fabric.document=require("jsdom").jsdom("<!DOCTYPE html><html><head></head><body></body></html>");if(fabric.document.createWindow){fabric.window=fabric.document.createWindow()}else{fabric.window=fabric.document.parentWindow}}fabric.isTouchSupported="ontouchstart" in fabric.document.documentElement;fabric.isLikelyNode=typeof Buffer!=="undefined"&&typeof window==="undefined";fabric.SHARED_ATTRIBUTES=["display","transform","fill","fill-opacity","fill-rule","opacity","stroke","stroke-dasharray","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width"];fabric.DPI=96;fabric.reNum="(?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:e[-+]?\\d+)?)";(function(){function g(b,a){if(!this.__eventListeners[b]){return}if(a){fabric.util.removeFromArray(this.__eventListeners[b],a)}else{this.__eventListeners[b].length=0}}function h(c,b){if(!this.__eventListeners){this.__eventListeners={}}if(arguments.length===1){for(var a in c){this.on(a,c[a])}}else{if(!this.__eventListeners[c]){this.__eventListeners[c]=[]}this.__eventListeners[c].push(b)}return this}function f(c,b){if(!this.__eventListeners){return}if(arguments.length===0){this.__eventListeners={}}else{if(arguments.length===1&&typeof arguments[0]==="object"){for(var a in c){g.call(this,a,c[a])}}else{g.call(this,c,b)}}return this}function e(c,b){if(!this.__eventListeners){return}var d=this.__eventListeners[c];if(!d){return}for(var a=0,i=d.length;a<i;a++){d[a].call(this,b||{})}return this}fabric.Observable={observe:h,stopObserving:f,fire:e,on:h,off:f,trigger:e}})();fabric.Collection={add:function(){this._objects.push.apply(this._objects,arguments);for(var d=0,c=arguments.length;d<c;d++){this._onObjectAdded(arguments[d])}this.renderOnAddRemove&&this.renderAll();return this},insertAt:function(e,f,g){var h=this.getObjects();if(g){h[f]=e}else{h.splice(f,0,e)}this._onObjectAdded(e);this.renderOnAddRemove&&this.renderAll();return this},remove:function(){var g=this.getObjects(),f;for(var e=0,h=arguments.length;e<h;e++){f=g.indexOf(arguments[e]);if(f!==-1){g.splice(f,1);this._onObjectRemoved(arguments[e])}}this.renderOnAddRemove&&this.renderAll();return this},forEachObject:function(g,e){var h=this.getObjects(),f=h.length;while(f--){g.call(e,h[f],f,h)}return this},getObjects:function(b){if(typeof b==="undefined"){return this._objects}return this._objects.filter(function(a){return a.type===b})},item:function(b){return this.getObjects()[b]},isEmpty:function(){return this.getObjects().length===0},size:function(){return this.getObjects().length},contains:function(b){return this.getObjects().indexOf(b)>-1},complexity:function(){return this.getObjects().reduce(function(d,c){d+=c.complexity?c.complexity():0;return d},0)}};(function(h){var g=Math.sqrt,e=Math.atan2,f=Math.PI/180;fabric.util={removeFromArray:function(a,b){var c=a.indexOf(b);if(c!==-1){a.splice(c,1)}return a},getRandomInt:function(a,b){return Math.floor(Math.random()*(b-a+1))+a},degreesToRadians:function(a){return a*f},radiansToDegrees:function(a){return a/f},rotatePoint:function(n,l,a){var m=Math.sin(a),c=Math.cos(a);n.subtractEquals(l);var b=n.x*c-n.y*m,d=n.x*m+n.y*c;return new fabric.Point(b,d).addEquals(l)},transformPoint:function(a,b,c){if(c){return new fabric.Point(b[0]*a.x+b[2]*a.y,b[1]*a.x+b[3]*a.y)}return new fabric.Point(b[0]*a.x+b[2]*a.y+b[4],b[1]*a.x+b[3]*a.y+b[5])},invertTransform:function(c){var b=c.slice(),d=1/(c[0]*c[3]-c[1]*c[2]);b=[d*c[3],-d*c[1],-d*c[2],d*c[0],0,0];var a=fabric.util.transformPoint({x:c[4],y:c[5]},b);b[4]=-a.x;b[5]=-a.y;return b},toFixed:function(a,b){return parseFloat(Number(a).toFixed(b))},parseUnit:function(a,b){var c=/\D{0,2}$/.exec(a),d=parseFloat(a);if(!b){b=fabric.Text.DEFAULT_SVG_FONT_SIZE}switch(c[0]){case"mm":return d*fabric.DPI/25.4;case"cm":return d*fabric.DPI/2.54;case"in":return d*fabric.DPI;case"pt":return d*fabric.DPI/72;case"pc":return d*fabric.DPI/72*12;case"em":return d*b;default:return d}},falseFunction:function(){return false},getKlass:function(a,b){a=fabric.util.string.camelize(a.charAt(0).toUpperCase()+a.slice(1));return fabric.util.resolveNamespace(b)[a]},resolveNamespace:function(c){if(!c){return fabric}var a=c.split("."),i=a.length,b=h||fabric.window;for(var d=0;d<i;++d){b=b[a[d]]}return b},loadImage:function(c,a,b,d){if(!c){a&&a.call(b,c);return}var j=fabric.util.createImage();j.onload=function(){a&&a.call(b,j);j=j.onload=j.onerror=null};j.onerror=function(){fabric.log("Error loading "+j.src);a&&a.call(b,null,true);j=j.onload=j.onerror=null};if(c.indexOf("data")!==0&&typeof d!=="undefined"){j.crossOrigin=d}j.src=c},enlivenObjects:function(d,a,n,o){d=d||[];function m(){if(++b===p){a&&a(c)}}var c=[],b=0,p=d.length;if(!p){a&&a(c);return}d.forEach(function(j,k){if(!j||!j.type){m();return}var i=fabric.util.getKlass(j.type,n);if(i.async){i.fromObject(j,function(l,r){if(!r){c[k]=l;o&&o(j,c[k])}m()})}else{c[k]=i.fromObject(j);o&&o(j,c[k]);m()}})},groupSVGElements:function(b,c,a){var d;d=new fabric.PathGroup(b,c);if(typeof a!=="undefined"){d.setSourcePath(a)}return d},populateWithProperties:function(a,d,b){if(b&&Object.prototype.toString.call(b)==="[object Array]"){for(var c=0,i=b.length;c<i;c++){if(b[c] in a){d[b[c]]=a[b[c]]}}}},drawDashedLine:function(d,s,v,z,u,b){var a=z-s,c=u-v,x=g(a*a+c*c),y=e(c,a),r=b.length,w=0,t=true;d.save();d.translate(s,v);d.moveTo(0,0);d.rotate(y);s=0;while(x>s){s+=b[w++%r];if(s>x){s=x}d[t?"lineTo":"moveTo"](s,0);t=!t}d.restore()},createCanvasElement:function(a){a||(a=fabric.document.createElement("canvas"));if(!a.getContext&&typeof G_vmlCanvasManager!=="undefined"){G_vmlCanvasManager.initElement(a)}return a},createImage:function(){return fabric.isLikelyNode?new (require("canvas").Image)():fabric.document.createElement("img")},createAccessors:function(n){var c=n.prototype;for(var i=c.stateProperties.length;i--;){var b=c.stateProperties[i],a=b.charAt(0).toUpperCase()+b.slice(1),m="set"+a,d="get"+a;if(!c[d]){c[d]=(function(j){return new Function('return this.get("'+j+'")')})(b)}if(!c[m]){c[m]=(function(j){return new Function("value",'return this.set("'+j+'", value)')})(b)}}},clipContext:function(a,b){b.save();b.beginPath();a.clipTo(b);b.clip()},multiplyTransformMatrices:function(a,b){return[a[0]*b[0]+a[2]*b[1],a[1]*b[0]+a[3]*b[1],a[0]*b[2]+a[2]*b[3],a[1]*b[2]+a[3]*b[3],a[0]*b[4]+a[2]*b[5]+a[4],a[1]*b[4]+a[3]*b[5]+a[5]]},getFunctionBody:function(a){return(String(a).match(/function[^{]*\{([\s\S]*)\}/)||{})[1]},isTransparent:function(a,c,d,i){if(i>0){if(c>i){c-=i}else{c=0}if(d>i){d-=i}else{d=0}}var q=true,r=a.getImageData(c,d,(i*2)||1,(i*2)||1);for(var l=3,p=r.data.length;l<p;l+=4){var b=r.data[l];q=b<=0;if(q===false){break}}r=null;return q}}})(typeof exports!=="undefined"?exports:this);(function(){var i={},p={},k={},o=Array.prototype.join;function l(ap,ar,ai,ak,at,aj,Z){var a=o.call(arguments);if(i[a]){return i[a]}var X=Math.PI,af=Z*X/180,e=Math.sin(af),Y=Math.cos(af),ah=0,T=0;ai=Math.abs(ai);ak=Math.abs(ak);var ab=-Y*ap*0.5-e*ar*0.5,ag=-Y*ar*0.5+e*ap*0.5,d=ai*ai,am=ak*ak,aq=ag*ag,h=ab*ab,f=d*am-d*aq-am*h,s=0;if(f<0){var al=Math.sqrt(1-f/(d*am));ai*=al;ak*=al}else{s=(at===aj?-1:1)*Math.sqrt(f/(d*aq+am*h))}var an=s*ai*ag/ak,ao=-s*ak*ab/ai,ad=Y*an-e*ao+ap*0.5,c=e*an+Y*ao+ar*0.5,b=n(1,0,(ab-an)/ai,(ag-ao)/ak),ae=n((ab-an)/ai,(ag-ao)/ak,(-ab-an)/ai,(-ag-ao)/ak);if(aj===0&&ae>0){ae-=2*X}else{if(aj===1&&ae<0){ae+=2*X}}var V=Math.ceil(Math.abs(ae/X*2)),aa=[],U=ae/V,ac=8/3*Math.sin(U/4)*Math.sin(U/4)/Math.sin(U/2),W=b+U;for(var g=0;g<V;g++){aa[g]=m(b,W,Y,e,ai,ak,ad,c,ac,ah,T);ah=aa[g][4];T=aa[g][5];b=W;W+=U}i[a]=aa;return aa}function m(g,G,c,I,L,M,d,E,K,e,f){var P=o.call(arguments);if(p[P]){return p[P]}var N=Math.cos(g),a=Math.sin(g),O=Math.cos(G),b=Math.sin(G),Q=c*L*O-I*M*b+d,R=I*L*O+c*M*b+E,h=e+K*(-c*L*a-I*M*N),H=f+K*(-I*L*a+c*M*N),F=Q+K*(c*L*b+I*M*O),J=R+K*(I*L*b-c*M*O);p[P]=[h,H,F,J,Q,R];return p[P]}function n(b,c,f,a){var d=Math.atan2(c,b),e=Math.atan2(a,f);if(e>=d){return e-d}else{return 2*Math.PI-(d-e)}}fabric.util.drawArc=function(z,c,d,C){var f=C[0],y=C[1],e=C[2],B=C[3],A=C[4],E=C[5],b=C[6],g=[[],[],[],[]],h=l(E-c,b-d,f,y,B,A,e);for(var a=0,D=h.length;a<D;a++){g[a][0]=h[a][0]+c;g[a][1]=h[a][1]+d;g[a][2]=h[a][2]+c;g[a][3]=h[a][3]+d;g[a][4]=h[a][4]+c;g[a][5]=h[a][5]+d;z.bezierCurveTo.apply(z,g[a])}};fabric.util.getBoundsOfArc=function(c,d,f,h,e,C,B,G,a){var D=0,E=0,b=[],A=[],g=l(G-c,a-d,f,h,C,B,e),H=[[],[]];for(var I=0,F=g.length;I<F;I++){b=j(D,E,g[I][0],g[I][1],g[I][2],g[I][3],g[I][4],g[I][5]);H[0].x=b[0].x+c;H[0].y=b[0].y+d;H[1].x=b[1].x+c;H[1].y=b[1].y+d;A.push(H[0]);A.push(H[1]);D=g[I][4];E=g[I][5]}return A};function j(f,af,h,ah,t,ai,x,aj){var a=o.call(arguments);if(k[a]){return k[a]}var b=Math.sqrt,W=Math.min,R=Math.max,ac=Math.abs,aa=[],ae=[[],[]],c,d,e,g,T,Y,ag,ab;d=6*f-12*h+6*t;c=-3*f+9*h-9*t+3*x;e=3*h-3*f;for(var S=0;S<2;++S){if(S>0){d=6*af-12*ah+6*ai;c=-3*af+9*ah-9*ai+3*aj;e=3*ah-3*af}if(ac(c)<1e-12){if(ac(d)<1e-12){continue}g=-e/d;if(0<g&&g<1){aa.push(g)}continue}ag=d*d-4*e*c;if(ag<0){continue}ab=b(ag);T=(-d+ab)/(2*c);if(0<T&&T<1){aa.push(T)}Y=(-d-ab)/(2*c);if(0<Y&&Y<1){aa.push(Y)}}var V,Z,U=aa.length,ad=U,X;while(U--){g=aa[U];X=1-g;V=(X*X*X*f)+(3*X*X*g*h)+(3*X*g*g*t)+(g*g*g*x);ae[0][U]=V;Z=(X*X*X*af)+(3*X*X*g*ah)+(3*X*g*g*ai)+(g*g*g*aj);ae[1][U]=Z}ae[0][ad]=f;ae[1][ad]=af;ae[0][ad+1]=x;ae[1][ad+1]=aj;var y=[{x:W.apply(null,ae[0]),y:W.apply(null,ae[1])},{x:R.apply(null,ae[0]),y:R.apply(null,ae[1])}];k[a]=y;return y}fabric.util.getBoundsOfCurve=j})();(function(){var h=Array.prototype.slice;if(!Array.prototype.indexOf){Array.prototype.indexOf=function(c){if(this===void 0||this===null){throw new TypeError()}var b=Object(this),e=b.length>>>0;if(e===0){return -1}var a=0;if(arguments.length>0){a=Number(arguments[1]);if(a!==a){a=0}else{if(a!==0&&a!==Number.POSITIVE_INFINITY&&a!==Number.NEGATIVE_INFINITY){a=(a>0||-1)*Math.floor(Math.abs(a))}}}if(a>=e){return -1}var d=a>=0?a:Math.max(e-Math.abs(a),0);for(;d<e;d++){if(d in b&&b[d]===c){return d}}return -1}}if(!Array.prototype.forEach){Array.prototype.forEach=function(a,b){for(var c=0,d=this.length>>>0;c<d;c++){if(c in this){a.call(b,this[c],c,this)}}}}if(!Array.prototype.map){Array.prototype.map=function(a,b){var d=[];for(var c=0,e=this.length>>>0;c<e;c++){if(c in this){d[c]=a.call(b,this[c],c,this)}}return d}}if(!Array.prototype.every){Array.prototype.every=function(a,b){for(var c=0,d=this.length>>>0;c<d;c++){if(c in this&&!a.call(b,this[c],c,this)){return false}}return true}}if(!Array.prototype.some){Array.prototype.some=function(a,b){for(var c=0,d=this.length>>>0;c<d;c++){if(c in this&&a.call(b,this[c],c,this)){return true}}return false}}if(!Array.prototype.filter){Array.prototype.filter=function(b,c){var e=[],a;for(var d=0,m=this.length>>>0;d<m;d++){if(d in this){a=this[d];if(b.call(c,a,d,this)){e.push(a)}}}return e}}if(!Array.prototype.reduce){Array.prototype.reduce=function(b){var d=this.length>>>0,c=0,a;if(arguments.length>1){a=arguments[1]}else{do{if(c in this){a=this[c++];break}if(++c>=d){throw new TypeError()}}while(true)}for(;c<d;c++){if(c in this){a=b.call(null,a,this[c],c,this)}}return a}}function f(a,b){var d=h.call(arguments,2),e=[];for(var c=0,m=a.length;c<m;c++){e[c]=d.length?a[c][b].apply(a[c],d):a[c][b].call(a[c])}return e}function g(a,b){return i(a,b,function(c,d){return c>=d})}function j(a,b){return i(a,b,function(c,d){return c<d})}function i(a,c,b){if(!a||a.length===0){return}var d=a.length-1,e=c?a[d][c]:a[d];if(c){while(d--){if(b(a[d][c],e)){e=a[d][c]}}}else{while(d--){if(b(a[d],e)){e=a[d]}}}return e}fabric.util.array={invoke:f,min:j,max:g}})();(function(){function c(f,a){for(var b in a){f[b]=a[b]}return f}function d(a){return c({},a)}fabric.util.object={extend:c,clone:d}})();(function(){if(!String.prototype.trim){String.prototype.trim=function(){return this.replace(/^[\s\xA0]+/,"").replace(/[\s\xA0]+$/,"")}}function d(a){return a.replace(/-+(.)?/g,function(c,b){return b?b.toUpperCase():""})}function f(b,a){return b.charAt(0).toUpperCase()+(a?b.slice(1):b.slice(1).toLowerCase())}function e(a){return a.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}fabric.util.string={camelize:d,capitalize:f,escapeXml:e}}());(function(){var f=Array.prototype.slice,e=Function.prototype.apply,d=function(){};if(!Function.prototype.bind){Function.prototype.bind=function(h){var a=this,c=f.call(arguments,1),b;if(c.length){b=function(){return e.call(a,this instanceof d?this:h,c.concat(f.call(arguments)))}}else{b=function(){return e.call(a,this instanceof d?this:h,arguments)}}d.prototype=this.prototype;b.prototype=new d();return b}}})();(function(){var j=Array.prototype.slice,k=function(){},m=(function(){for(var a in {toString:1}){if(a==="toString"){return false}}return true})(),n=function(d,a,c){for(var b in a){if(b in d.prototype&&typeof d.prototype[b]==="function"&&(a[b]+"").indexOf("callSuper")>-1){d.prototype[b]=(function(e){return function(){var g=this.constructor.superclass;this.constructor.superclass=c;var f=a[e].apply(this,arguments);this.constructor.superclass=g;if(e!=="initialize"){return f}}})(b)}else{d.prototype[b]=a[b]}if(m){if(a.toString!==Object.prototype.toString){d.prototype.toString=a.toString}if(a.valueOf!==Object.prototype.valueOf){d.prototype.valueOf=a.valueOf}}}};function h(){}function i(b){var a=this.constructor.superclass.prototype[b];return(arguments.length>1)?a.apply(this,j.call(arguments,1)):a.call(this)}function l(){var b=null,c=j.call(arguments,0);if(typeof c[0]==="function"){b=c.shift()}function e(){this.initialize.apply(this,arguments)}e.superclass=b;e.subclasses=[];if(b){h.prototype=b.prototype;e.prototype=new h();b.subclasses.push(e)}for(var d=0,a=c.length;d<a;d++){n(e,c[d],b)}if(!e.prototype.initialize){e.prototype.initialize=k}e.prototype.constructor=e;e.prototype.callSuper=i;return e}fabric.util.createClass=l})();(function(){var s="unknown";function x(d){var a=Array.prototype.slice.call(arguments,1),b,c,e=a.length;for(c=0;c<e;c++){b=typeof d[a[c]];if(!(/^(?:function|object|unknown)$/).test(b)){return false}}return true}var D,t,A=(function(){var a=0;return function(b){return b.__uniqueID||(b.__uniqueID="uniqueID__"+a++)}})();(function(){var a={};D=function(b){return a[b]};t=function(b,c){a[b]=c}})();function G(b,a){return{handler:a,wrappedHandler:y(b,a)}}function y(b,a){return function(c){a.call(D(b),c||fabric.window.event)}}function E(a,b){return function(c){if(v[a]&&v[a][b]){var e=v[a][b];for(var d=0,f=e.length;d<f;d++){e[d].call(this,c||fabric.window.event)}}}}var u=(x(fabric.document.documentElement,"addEventListener","removeEventListener")&&x(fabric.window,"addEventListener","removeEventListener")),C=(x(fabric.document.documentElement,"attachEvent","detachEvent")&&x(fabric.window,"attachEvent","detachEvent")),w={},v={},z,H;if(u){z=function(b,c,a){b.addEventListener(c,a,false)};H=function(b,c,a){b.removeEventListener(c,a,false)}}else{if(C){z=function(c,e,b){var d=A(c);t(d,c);if(!w[d]){w[d]={}}if(!w[d][e]){w[d][e]=[]}var a=G(d,b);w[d][e].push(a);c.attachEvent("on"+e,a.wrappedHandler)};H=function(b,e,a){var c=A(b),g;if(w[c]&&w[c][e]){for(var d=0,f=w[c][e].length;d<f;d++){g=w[c][e][d];if(g&&g.handler===a){b.detachEvent("on"+e,g.wrappedHandler);w[c][e][d]=null}}}}}else{z=function(c,e,b){var d=A(c);if(!v[d]){v[d]={}}if(!v[d][e]){v[d][e]=[];var a=c["on"+e];if(a){v[d][e].push(a)}c["on"+e]=E(d,e)}v[d][e].push(b)};H=function(a,d,g){var b=A(a);if(v[b]&&v[b][d]){var e=v[b][d];for(var c=0,f=e.length;c<f;c++){if(e[c]===g){e.splice(c,1)}}}}}}fabric.util.addListener=z;fabric.util.removeListener=H;function B(a,c){a||(a=fabric.window.event);var b=a.target||(typeof a.srcElement!==s?a.srcElement:null),d=fabric.util.getScrollLeftTop(b,c);return{x:I(a)+d.left,y:J(a)+d.top}}var I=function(a){return(typeof a.clientX!==s?a.clientX:0)},J=function(a){return(typeof a.clientY!==s?a.clientY:0)};function F(c,a,d){var b=c.type==="touchend"?"changedTouches":"touches";return(c[b]&&c[b][0]?(c[b][0][a]-(c[b][0][a]-c[b][0][d]))||c[d]:c[d])}if(fabric.isTouchSupported){I=function(a){return F(a,"pageX","clientX")};J=function(a){return F(a,"pageY","clientY")}}fabric.util.getPointer=B;fabric.util.object.extend(fabric.util,fabric.Observable)})();(function(){function k(e,c){var a=e.style;if(!a){return e}if(typeof c==="string"){e.style.cssText+=";"+c;return c.indexOf("opacity")>-1?g(e,c.match(/opacity:\s*(\d?\.?\d*)/)[1]):e}for(var b in c){if(b==="opacity"){g(e,c[b])}else{var d=(b==="float"||b==="cssFloat")?(typeof a.styleFloat==="undefined"?"cssFloat":"styleFloat"):b;a[d]=c[b]}}return e}var i=fabric.document.createElement("div"),j=typeof i.style.opacity==="string",h=typeof i.style.filter==="string",l=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,g=function(a){return a};if(j){g=function(b,a){b.style.opacity=a;return b}}else{if(h){g=function(c,b){var a=c.style;if(c.currentStyle&&!c.currentStyle.hasLayout){a.zoom=1}if(l.test(a.filter)){b=b>=0.9999?"":("alpha(opacity="+(b*100)+")");a.filter=a.filter.replace(l,b)}else{a.filter+=" alpha(opacity="+(b*100)+")"}return c}}}fabric.util.setStyle=k})();(function(){var m=Array.prototype.slice;function n(a){return typeof a==="string"?fabric.document.getElementById(a):a}var l,t=function(a){return m.call(a,0)};try{l=t(fabric.document.childNodes) instanceof Array}catch(u){}if(!l){t=function(a){var b=new Array(a.length),c=a.length;while(c--){b[c]=a[c]}return b}}function s(a,b){var d=fabric.document.createElement(a);for(var c in b){if(c==="class"){d.className=b[c]}else{if(c==="for"){d.htmlFor=b[c]}else{d.setAttribute(c,b[c])}}}return d}function o(b,a){if(b&&(" "+b.className+" ").indexOf(" "+a+" ")===-1){b.className+=(b.className?" ":"")+a}}function p(a,c,b){if(typeof c==="string"){c=s(c,b)}if(a.parentNode){a.parentNode.replaceChild(c,a)}c.appendChild(a);return c}function v(f,g){var e,a,c=0,d=0,h=fabric.document.documentElement,b=fabric.document.body||{scrollLeft:0,scrollTop:0};a=f;while(f&&f.parentNode&&!e){f=f.parentNode;if(f.nodeType===1&&fabric.util.getElementStyle(f,"position")==="fixed"){e=f}if(f.nodeType===1&&a!==g&&fabric.util.getElementStyle(f,"position")==="absolute"){c=0;d=0}else{if(f===fabric.document){c=b.scrollLeft||h.scrollLeft||0;d=b.scrollTop||h.scrollTop||0}else{c+=f.scrollLeft||0;d+=f.scrollTop||0}}}return{left:c,top:d}}function q(g){var a,d=g&&g.ownerDocument,f={left:0,top:0},c={left:0,top:0},e,h={borderLeftWidth:"left",borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"};if(!d){return{left:0,top:0}}for(var b in h){c[h[b]]+=parseInt(r(g,b),10)||0}a=d.documentElement;if(typeof g.getBoundingClientRect!=="undefined"){f=g.getBoundingClientRect()}e=fabric.util.getScrollLeftTop(g,null);return{left:f.left+e.left-(a.clientLeft||0)+c.left,top:f.top+e.top-(a.clientTop||0)+c.top}}var r;if(fabric.document.defaultView&&fabric.document.defaultView.getComputedStyle){r=function(a,b){var c=fabric.document.defaultView.getComputedStyle(a,null);return c?c[b]:undefined}}else{r=function(a,b){var c=a.style[b];if(!c&&a.currentStyle){c=a.currentStyle[b]}return c}}(function(){var a=fabric.document.documentElement.style,d="userSelect" in a?"userSelect":"MozUserSelect" in a?"MozUserSelect":"WebkitUserSelect" in a?"WebkitUserSelect":"KhtmlUserSelect" in a?"KhtmlUserSelect":"";function c(e){if(typeof e.onselectstart!=="undefined"){e.onselectstart=fabric.util.falseFunction}if(d){e.style[d]="none"}else{if(typeof e.unselectable==="string"){e.unselectable="on"}}return e}function b(e){if(typeof e.onselectstart!=="undefined"){e.onselectstart=null}if(d){e.style[d]=""}else{if(typeof e.unselectable==="string"){e.unselectable=""}}return e}fabric.util.makeElementUnselectable=c;fabric.util.makeElementSelectable=b})();(function(){function a(b,c){var e=fabric.document.getElementsByTagName("head")[0],f=fabric.document.createElement("script"),d=true;f.onload=f.onreadystatechange=function(g){if(d){if(typeof this.readyState==="string"&&this.readyState!=="loaded"&&this.readyState!=="complete"){return}d=false;c(g||fabric.window.event);f=f.onload=f.onreadystatechange=null}};f.src=b;e.appendChild(f)}fabric.util.getScript=a})();fabric.util.getById=n;fabric.util.toArray=t;fabric.util.makeElement=s;fabric.util.addClass=o;fabric.util.wrapElement=p;fabric.util.getScrollLeftTop=v;fabric.util.getElementOffset=q;fabric.util.getElementStyle=r})();(function(){function g(b,a){return b+(/\?/.test(b)?"&":"?")+a}var h=(function(){var a=[function(){return new ActiveXObject("Microsoft.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP.3.0")},function(){return new XMLHttpRequest()}];for(var d=a.length;d--;){try{var b=a[d]();if(b){return a[d]}}catch(c){}}})();function f(){}function e(d,k){k||(k={});var a=k.method?k.method.toUpperCase():"GET",c=k.onComplete||function(){},b=h(),l;b.onreadystatechange=function(){if(b.readyState===4){c(b);b.onreadystatechange=f}};if(a==="GET"){l=null;if(typeof k.parameters==="string"){d=g(d,k.parameters)}}b.open(a,d,true);if(a==="POST"||a==="PUT"){b.setRequestHeader("Content-Type","application/x-www-form-urlencoded")}b.send(l);return b}fabric.util.request=e})();fabric.log=function(){};fabric.warn=function(){};if(typeof console!=="undefined"){["log","warn"].forEach(function(b){if(typeof console[b]!=="undefined"&&typeof console[b].apply==="function"){fabric[b]=function(){return console[b].apply(console,arguments)}}})}(function(){function e(a){d(function(t){a||(a={});var y=t||+new Date(),w=a.duration||500,c=y+w,x,s=a.onChange||function(){},v=a.abort||function(){return false},r=a.easing||function(i,j,g,h){return -g*Math.cos(i/h*(Math.PI/2))+g+j},z="startValue" in a?a.startValue:0,q="endValue" in a?a.endValue:100,b=a.byValue||q-z;a.onStart&&a.onStart();(function u(h){x=h||+new Date();var g=x>c?w:(x-y);if(v()){a.onComplete&&a.onComplete();return}s(r(g,z,b,w));if(x>c){a.onComplete&&a.onComplete();return}d(u)})(y)})}var f=fabric.window.requestAnimationFrame||fabric.window.webkitRequestAnimationFrame||fabric.window.mozRequestAnimationFrame||fabric.window.oRequestAnimationFrame||fabric.window.msRequestAnimationFrame||function(a){fabric.window.setTimeout(a,1000/60)};function d(){return f.apply(fabric.window,arguments)}fabric.util.animate=e;fabric.util.requestAnimFrame=d})();(function(){function D(d,a,b,c){if(d<Math.abs(a)){d=a;c=b/4}else{c=b/(2*Math.PI)*Math.asin(a/d)}return{a:d,c:a,p:b,s:c}}function O(b,c,a){return b.a*Math.pow(2,10*(c-=1))*Math.sin((c*a-b.s)*(2*Math.PI)/b.p)}function P(c,d,a,b){return a*((c=c/b-1)*c*c+1)+d}function J(c,d,a,b){c/=b/2;if(c<1){return a/2*c*c*c+d}return a/2*((c-=2)*c*c+2)+d}function K(c,d,a,b){return a*(c/=b)*c*c*c+d}function Y(c,d,a,b){return -a*((c=c/b-1)*c*c*c-1)+d}function U(c,d,a,b){c/=b/2;if(c<1){return a/2*c*c*c*c+d}return -a/2*((c-=2)*c*c*c-2)+d}function F(c,d,a,b){return a*(c/=b)*c*c*c*c+d}function V(c,d,a,b){return a*((c=c/b-1)*c*c*c*c+1)+d}function S(c,d,a,b){c/=b/2;if(c<1){return a/2*c*c*c*c*c+d}return a/2*((c-=2)*c*c*c*c+2)+d}function Z(c,d,a,b){return -a*Math.cos(c/b*(Math.PI/2))+a+d}function R(c,d,a,b){return a*Math.sin(c/b*(Math.PI/2))+d}function I(c,d,a,b){return -a/2*(Math.cos(Math.PI*c/b)-1)+d}function M(c,d,a,b){return(c===0)?d:a*Math.pow(2,10*(c/b-1))+d}function ab(c,d,a,b){return(c===b)?d+a:a*(-Math.pow(2,-10*c/b)+1)+d}function W(c,d,a,b){if(c===0){return d}if(c===b){return d+a}c/=b/2;if(c<1){return a/2*Math.pow(2,10*(c-1))+d}return a/2*(-Math.pow(2,-10*--c)+2)+d}function X(c,d,a,b){return -a*(Math.sqrt(1-(c/=b)*c)-1)+d}function Q(c,d,a,b){return a*Math.sqrt(1-(c=c/b-1)*c)+d}function G(c,d,a,b){c/=b/2;if(c<1){return -a/2*(Math.sqrt(1-c*c)-1)+d}return a/2*(Math.sqrt(1-(c-=2)*c)+1)+d}function L(f,h,a,b){var e=1.70158,c=0,g=a;if(f===0){return h}f/=b;if(f===1){return h+a}if(!c){c=b*0.3}var d=D(g,a,c,e);return -O(d,f,b)+h}function E(f,h,a,b){var e=1.70158,c=0,g=a;if(f===0){return h}f/=b;if(f===1){return h+a}if(!c){c=b*0.3}var d=D(g,a,c,e);return d.a*Math.pow(2,-10*f)*Math.sin((f*b-d.s)*(2*Math.PI)/d.p)+d.c+h}function ad(f,h,a,b){var e=1.70158,c=0,g=a;if(f===0){return h}f/=b/2;if(f===2){return h+a}if(!c){c=b*(0.3*1.5)}var d=D(g,a,c,e);if(f<1){return -0.5*O(d,f,b)+h}return d.a*Math.pow(2,-10*(f-=1))*Math.sin((f*b-d.s)*(2*Math.PI)/d.p)*0.5+d.c+h}function T(d,e,a,b,c){if(c===undefined){c=1.70158}return a*(d/=b)*d*((c+1)*d-c)+e}function H(d,e,a,b,c){if(c===undefined){c=1.70158}return a*((d=d/b-1)*d*((c+1)*d+c)+1)+e}function C(d,e,a,b,c){if(c===undefined){c=1.70158}d/=b/2;if(d<1){return a/2*(d*d*(((c*=(1.525))+1)*d-c))+e}return a/2*((d-=2)*d*(((c*=(1.525))+1)*d+c)+2)+e}function aa(c,d,a,b){return a-ac(b-c,0,a,b)+d}function ac(c,d,a,b){if((c/=b)<(1/2.75)){return a*(7.5625*c*c)+d}else{if(c<(2/2.75)){return a*(7.5625*(c-=(1.5/2.75))*c+0.75)+d}else{if(c<(2.5/2.75)){return a*(7.5625*(c-=(2.25/2.75))*c+0.9375)+d}else{return a*(7.5625*(c-=(2.625/2.75))*c+0.984375)+d}}}}function N(c,d,a,b){if(c<b/2){return aa(c*2,0,a,b)*0.5+d}return ac(c*2-b,0,a,b)*0.5+a*0.5+d}fabric.util.ease={easeInQuad:function(c,d,a,b){return a*(c/=b)*c+d},easeOutQuad:function(c,d,a,b){return -a*(c/=b)*(c-2)+d},easeInOutQuad:function(c,d,a,b){c/=(b/2);if(c<1){return a/2*c*c+d}return -a/2*((--c)*(c-2)-1)+d},easeInCubic:function(c,d,a,b){return a*(c/=b)*c*c+d},easeOutCubic:P,easeInOutCubic:J,easeInQuart:K,easeOutQuart:Y,easeInOutQuart:U,easeInQuint:F,easeOutQuint:V,easeInOutQuint:S,easeInSine:Z,easeOutSine:R,easeInOutSine:I,easeInExpo:M,easeOutExpo:ab,easeInOutExpo:W,easeInCirc:X,easeOutCirc:Q,easeInOutCirc:G,easeInElastic:L,easeOutElastic:E,easeInOutElastic:ad,easeInBack:T,easeOutBack:H,easeInOutBack:C,easeInBounce:aa,easeOutBounce:ac,easeInOutBounce:N}}());(function(I){var L=I.fabric||(I.fabric={}),C=L.util.object.extend,P=L.util.string.capitalize,B=L.util.object.clone,M=L.util.toFixed,J=L.util.parseUnit,G=L.util.multiplyTransformMatrices,F={cx:"left",x:"left",r:"radius",cy:"top",y:"top",display:"visible",visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","stroke-dasharray":"strokeDashArray","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration","text-anchor":"originX"},T={stroke:"strokeOpacity",fill:"fillOpacity"};L.cssRules={};L.gradientDefs={};function Z(a){if(a in F){return F[a]}return a}function S(a,b,d,c){var f=Object.prototype.toString.call(b)==="[object Array]",e;if((a==="fill"||a==="stroke")&&b==="none"){b=""}else{if(a==="strokeDashArray"){b=b.replace(/,/g," ").split(/\s+/).map(function(g){return parseFloat(g)})}else{if(a==="transformMatrix"){if(d&&d.transformMatrix){b=G(d.transformMatrix,L.parseTransformAttribute(b))}else{b=L.parseTransformAttribute(b)}}else{if(a==="visible"){b=(b==="none"||b==="hidden")?false:true;if(d&&d.visible===false){b=false}}else{if(a==="originX"){b=b==="start"?"left":b==="end"?"right":"center"}else{e=f?b.map(J):J(b,c)}}}}}return(!f&&isNaN(e)?b:e)}function X(b){for(var a in T){if(!b[a]||typeof b[T[a]]==="undefined"){continue}if(b[a].indexOf("url(")===0){continue}var c=new L.Color(b[a]);b[a]=c.setAlpha(M(c.getAlpha()*b[T[a]],2)).toRgba()}return b}L.parseTransformAttribute=(function(){function s(v,u){var t=u[0];v[0]=Math.cos(t);v[1]=Math.sin(t);v[2]=-Math.sin(t);v[3]=Math.cos(t)}function o(u,t){var v=t[0],w=(t.length===2)?t[1]:t[0];u[0]=v;u[3]=w}function b(u,t){u[2]=Math.tan(L.util.degreesToRadians(t[0]))}function q(u,t){u[1]=Math.tan(L.util.degreesToRadians(t[0]))}function g(u,t){u[4]=t[0];if(t.length===2){u[5]=t[1]}}var m=[1,0,0,1,0,0],r=L.reNum,e="(?:\\s+,?\\s*|,\\s*)",l="(?:(skewX)\\s*\\(\\s*("+r+")\\s*\\))",n="(?:(skewY)\\s*\\(\\s*("+r+")\\s*\\))",d="(?:(rotate)\\s*\\(\\s*("+r+")(?:"+e+"("+r+")"+e+"("+r+"))?\\s*\\))",a="(?:(scale)\\s*\\(\\s*("+r+")(?:"+e+"("+r+"))?\\s*\\))",i="(?:(translate)\\s*\\(\\s*("+r+")(?:"+e+"("+r+"))?\\s*\\))",f="(?:(matrix)\\s*\\(\\s*("+r+")"+e+"("+r+")"+e+"("+r+")"+e+"("+r+")"+e+"("+r+")"+e+"("+r+")\\s*\\))",h="(?:"+f+"|"+i+"|"+a+"|"+d+"|"+l+"|"+n+")",k="(?:"+h+"(?:"+e+h+")*)",c="^\\s*(?:"+k+"?)\\s*$",j=new RegExp(c),p=new RegExp(h,"g");return function(t){var w=m.concat(),v=[];if(!t||(t&&!j.test(t))){return w}t.replace(p,function(y){var aa=new RegExp(h).exec(y).filter(function(ac){return(ac!==""&&ac!=null)}),z=aa[1],x=aa.slice(2).map(parseFloat);switch(z){case"translate":g(w,x);break;case"rotate":x[0]=L.util.degreesToRadians(x[0]);s(w,x);break;case"scale":o(w,x);break;case"skewX":b(w,x);break;case"skewY":q(w,x);break;case"matrix":w=x;break}v.push(w.concat());w=m.concat()});var u=v[0];while(v.length>1){v.shift();u=L.util.multiplyTransformMatrices(u,v[0])}return u}})();function K(c,d){var a,b;c.replace(/;$/,"").split(";").forEach(function(f){var e=f.split(":");a=Z(e[0].trim().toLowerCase());b=S(a,e[1].trim());d[a]=b})}function N(d,e){var a,c;for(var b in d){if(typeof d[b]==="undefined"){continue}a=Z(b.toLowerCase());c=S(a,d[b]);e[a]=c}}function D(e,a){var d={};for(var b in L.cssRules[a]){if(E(e,b.split(" "))){for(var c in L.cssRules[a][b]){d[c]=L.cssRules[a][b][c]}}}return d}function E(c,d){var a,b=true;a=Q(c,d.pop());if(a&&d.length){b=O(c,d)}return a&&b&&(d.length===0)}function O(c,d){var a,b=true;while(c.parentNode&&c.parentNode.nodeType===1&&d.length){if(b){a=d.pop()}c=c.parentNode;b=Q(c,a)}return d.length===0}function Q(f,a){var b=f.nodeName,d=f.getAttribute("class"),c=f.getAttribute("id"),e;e=new RegExp("^"+b,"i");a=a.replace(e,"");if(c&&a.length){e=new RegExp("#"+c+"(?![a-zA-Z\\-]+)","i");a=a.replace(e,"")}if(d&&a.length){d=d.split(" ");for(var g=d.length;g--;){e=new RegExp("\\."+d[g]+"(?![a-zA-Z\\-]+)","i");a=a.replace(e,"")}}return a.length===0}function V(g){var e=g.getElementsByTagName("use");while(e.length){var c=e[0],m=c.getAttribute("xlink:href").substr(1),h=c.getAttribute("x")||0,i=c.getAttribute("y")||0,b=g.getElementById(m).cloneNode(true),d=(b.getAttribute("transform")||"")+" translate("+h+", "+i+")",k;for(var l=0,f=c.attributes,a=f.length;l<a;l++){var j=f.item(l);if(j.nodeName==="x"||j.nodeName==="y"||j.nodeName==="xlink:href"){continue}if(j.nodeName==="transform"){d=j.nodeValue+" "+d}else{b.setAttribute(j.nodeName,j.nodeValue)}}b.setAttribute("transform",d);b.setAttribute("instantiated_by_use","1");b.removeAttribute("id");k=c.parentNode;k.replaceChild(b,c)}}var R=new RegExp("^\\s*("+L.reNum+"+)\\s*,?\\s*("+L.reNum+"+)\\s*,?\\s*("+L.reNum+"+)\\s*,?\\s*("+L.reNum+"+)\\s*$");function A(i,l,b){var d=i.getAttribute("viewBox"),f=1,g=1,j=0,a=0,e,k,h,c;if(d&&(d=d.match(R))){j=-parseFloat(d[1]),a=-parseFloat(d[2]),e=parseFloat(d[3]),k=parseFloat(d[4])}else{return}if(l&&l!==e){f=l/e}if(b&&b!==k){g=b/k}g=f=(f>g?g:f);if(!(f!==1||g!==1||j!==0||a!==0)){return}h=" matrix("+f+" 0 0 "+g+" "+(j*f)+" "+(a*g)+") ";if(i.tagName==="svg"){c=i.ownerDocument.createElement("g");while(i.firstChild!=null){c.appendChild(i.firstChild)}i.appendChild(c)}else{c=i;h=c.getAttribute("transform")+h}c.setAttribute("transform",h)}L.parseSVGDocument=(function(){var c=/^(path|circle|polygon|polyline|ellipse|rect|line|image|text)$/,a=/^(symbol|image|marker|pattern|view)$/;function b(e,d){while(e&&(e=e.parentNode)){if(d.test(e.nodeName)&&!e.getAttribute("instantiated_by_use")){return true}}return false}return function(g,f,i){if(!g){return}V(g);var q=new Date(),h=L.Object.__uid++,o,p,k=false;if(g.getAttribute("width")&&g.getAttribute("width")!=="100%"){o=J(g.getAttribute("width"))}if(g.getAttribute("height")&&g.getAttribute("height")!=="100%"){p=J(g.getAttribute("height"))}if(!o||!p){var r=g.getAttribute("viewBox");if(r&&(r=r.match(R))){o=parseFloat(r[3]),p=parseFloat(r[4])}else{k=true}}A(g,o,p);var n=L.util.toArray(g.getElementsByTagName("*"));if(n.length===0&&L.isLikelyNode){n=g.selectNodes('//*[name(.)!="svg"]');var l=[];for(var m=0,j=n.length;m<j;m++){l[m]=n[m]}n=l}var d=n.filter(function(s){a.test(s.tagName)&&A(s,0,0);return c.test(s.tagName)&&!b(s,/^(?:pattern|defs|symbol)$/)});if(!d||(d&&!d.length)){f&&f([],{});return}var e={width:o,height:p,svgUid:h,toBeParsed:k};L.gradientDefs[h]=L.getGradientDefs(g);L.cssRules[h]=L.getCSSRules(g);L.parseElements(d,function(s){L.documentParsingTime=new Date()-q;if(f){f(s,e)}},B(e),i)}})();var H={has:function(a,b){b(false)},get:function(){},set:function(){}};function W(b){var c=b.objects,a=b.options;c=c.map(function(d){return L[P(d.type)].fromObject(d)});return({objects:c,options:a})}function U(a,c,b){if(c[b]&&c[b].toSVG){a.push('<pattern x="0" y="0" id="',b,'Pattern" ','width="',c[b].source.width,'" height="',c[b].source.height,'" patternUnits="userSpaceOnUse">','<image x="0" y="0" ','width="',c[b].source.width,'" height="',c[b].source.height,'" xlink:href="',c[b].source.src,'"></image></pattern>')}}var Y=new RegExp("(normal|italic)?\\s*(normal|small-caps)?\\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*("+L.reNum+"(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|"+L.reNum+"))?\\s+(.*)");C(L,{parseFontDeclaration:function(c,h){var f=c.match(Y);if(!f){return}var b=f[1],g=f[3],d=f[4],e=f[5],a=f[6];if(b){h.fontStyle=b}if(g){h.fontWeight=isNaN(parseFloat(g))?g:parseFloat(g)}if(d){h.fontSize=J(d)}if(a){h.fontFamily=a}if(e){h.lineHeight=e==="normal"?1:e}},getGradientDefs:function(h){var e=h.getElementsByTagName("linearGradient"),d=h.getElementsByTagName("radialGradient"),b,j,k=0,c,l,i=[],g={},f={};i.length=e.length+d.length;j=e.length;while(j--){i[k++]=e[j]}j=d.length;while(j--){i[k++]=d[j]}while(k--){b=i[k];l=b.getAttribute("xlink:href");c=b.getAttribute("id");if(l){f[c]=l.substr(1)}g[c]=b}for(c in f){var a=g[f[c]].cloneNode(true);b=g[c];while(a.firstChild){b.appendChild(a.firstChild)}}return g},parseAttributes:function(e,f,a){if(!e){return}var b,g={},c;if(typeof a==="undefined"){a=e.getAttribute("svgUid")}if(e.parentNode&&/^symbol|[g|a]$/i.test(e.parentNode.nodeName)){g=L.parseAttributes(e.parentNode,f,a)}c=(g&&g.fontSize)||e.getAttribute("font-size")||L.Text.DEFAULT_SVG_FONT_SIZE;var d=f.reduce(function(h,i){b=e.getAttribute(i);if(b){i=Z(i);b=S(i,b,g,c);h[i]=b}return h},{});d=C(d,C(D(e,a),L.parseStyleAttribute(e)));if(d.font){L.parseFontDeclaration(d.font,d)}return X(C(g,d))},parseElements:function(c,b,d,a){new L.ElementsParser(c,b,d,a).parse()},parseStyleAttribute:function(c){var a={},b=c.getAttribute("style");if(!b){return a}if(typeof b==="string"){K(b,a)}else{N(b,a)}return a},parsePointsAttribute:function(b){if(!b){return null}b=b.replace(/,/g," ").trim();b=b.split(/\s+/);var d=[],c,a;c=0;a=b.length;for(;c<a;c+=2){d.push({x:parseFloat(b[c]),y:parseFloat(b[c+1])})}return d},getCSSRules:function(c){var e=c.getElementsByTagName("style"),g={},b;for(var f=0,a=e.length;f<a;f++){var d=e[f].textContent;d=d.replace(/\/\*[\s\S]*?\*\//g,"");if(d.trim()===""){continue}b=d.match(/[^{]*\{[\s\S]*?\}/g);b=b.map(function(h){return h.trim()});b.forEach(function(k){var m=k.match(/([\s\S]*?)\s*\{([^}]*)\}/),o={},q=m[2].trim(),i=q.replace(/;$/,"").split(/\s*;\s*/);for(var n=0,l=i.length;n<l;n++){var p=i[n].split(/\s*:\s*/),h=Z(p[0]),j=S(h,p[1],p[0]);o[h]=j}k=m[1];k.split(",").forEach(function(r){r=r.replace(/^svg/i,"").trim();if(r===""){return}g[r]=L.util.object.clone(o)})})}return g},loadSVGFromURL:function(d,b,a){d=d.replace(/^\n\s*/,"").trim();H.has(d,function(e){if(e){H.get(d,function(f){var g=W(f);b(g.objects,g.options)})}else{new L.util.request(d,{method:"get",onComplete:c})}});function c(e){var f=e.responseXML;if(f&&!f.documentElement&&L.window.ActiveXObject&&e.responseText){f=new ActiveXObject("Microsoft.XMLDOM");f.async="false";f.loadXML(e.responseText.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,""))}if(!f||!f.documentElement){return}L.parseSVGDocument(f.documentElement,function(g,h){H.set(d,{objects:L.util.array.invoke(g,"toObject"),options:h});b(g,h)},a)}},loadSVGFromString:function(e,b,a){e=e.trim();var d;if(typeof DOMParser!=="undefined"){var c=new DOMParser();if(c&&c.parseFromString){d=c.parseFromString(e,"text/xml")}}else{if(L.window.ActiveXObject){d=new ActiveXObject("Microsoft.XMLDOM");d.async="false";d.loadXML(e.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,""))}}L.parseSVGDocument(d.documentElement,function(f,g){b(f,g)},a)},createSVGFontFacesMarkup:function(b){var d="";for(var c=0,a=b.length;c<a;c++){if(b[c].type!=="text"||!b[c].path){continue}d+=["@font-face {","font-family: ",b[c].fontFamily,"; ","src: url('",b[c].path,"')","}"].join("")}if(d){d=['<style type="text/css">',"<![CDATA[",d,"]]>","</style>"].join("")}return d},createSVGRefElementsMarkup:function(b){var a=[];U(a,b,"backgroundColor");U(a,b,"overlayColor");return a.join("")}})})(typeof exports!=="undefined"?exports:this);fabric.ElementsParser=function(h,g,e,f){this.elements=h;this.callback=g;this.options=e;this.reviver=f;this.svgUid=(e&&e.svgUid)||0};fabric.ElementsParser.prototype.parse=function(){this.instances=new Array(this.elements.length);this.numElements=this.elements.length;this.createObjects()};fabric.ElementsParser.prototype.createObjects=function(){for(var c=0,d=this.elements.length;c<d;c++){this.elements[c].setAttribute("svgUid",this.svgUid);(function(a,b){setTimeout(function(){a.createObject(a.elements[b],b)},0)})(this,c)}};fabric.ElementsParser.prototype.createObject=function(h,e){var f=fabric[fabric.util.string.capitalize(h.tagName)];if(f&&f.fromElement){try{this._createObject(f,h,e)}catch(g){fabric.log(g)}}else{this.checkIfDone()}};fabric.ElementsParser.prototype._createObject=function(f,h,e){if(f.async){f.fromElement(h,this.createCallback(e,h),this.options)}else{var g=f.fromElement(h,this.options);this.resolveGradient(g,"fill");this.resolveGradient(g,"stroke");this.reviver&&this.reviver(h,g);this.instances[e]=g;this.checkIfDone()}};fabric.ElementsParser.prototype.createCallback=function(e,d){var f=this;return function(a){f.resolveGradient(a,"fill");f.resolveGradient(a,"stroke");f.reviver&&f.reviver(d,a);f.instances[e]=a;f.checkIfDone()}};fabric.ElementsParser.prototype.resolveGradient=function(g,h){var f=g.get(h);if(!(/^url\(/).test(f)){return}var e=f.slice(5,f.length-1);if(fabric.gradientDefs[this.svgUid][e]){g.set(h,fabric.Gradient.fromElement(fabric.gradientDefs[this.svgUid][e],g))}};fabric.ElementsParser.prototype.checkIfDone=function(){if(--this.numElements===0){this.instances=this.instances.filter(function(b){return b!=null});this.callback(this.instances)}};(function(d){var f=d.fabric||(d.fabric={});if(f.Point){f.warn("fabric.Point is already defined");return}f.Point=e;function e(b,a){this.x=b;this.y=a}e.prototype={constructor:e,add:function(a){return new e(this.x+a.x,this.y+a.y)},addEquals:function(a){this.x+=a.x;this.y+=a.y;return this},scalarAdd:function(a){return new e(this.x+a,this.y+a)},scalarAddEquals:function(a){this.x+=a;this.y+=a;return this},subtract:function(a){return new e(this.x-a.x,this.y-a.y)},subtractEquals:function(a){this.x-=a.x;this.y-=a.y;return this},scalarSubtract:function(a){return new e(this.x-a,this.y-a)},scalarSubtractEquals:function(a){this.x-=a;this.y-=a;return this},multiply:function(a){return new e(this.x*a,this.y*a)},multiplyEquals:function(a){this.x*=a;this.y*=a;return this},divide:function(a){return new e(this.x/a,this.y/a)},divideEquals:function(a){this.x/=a;this.y/=a;return this},eq:function(a){return(this.x===a.x&&this.y===a.y)},lt:function(a){return(this.x<a.x&&this.y<a.y)},lte:function(a){return(this.x<=a.x&&this.y<=a.y)},gt:function(a){return(this.x>a.x&&this.y>a.y)},gte:function(a){return(this.x>=a.x&&this.y>=a.y)},lerp:function(a,b){return new e(this.x+(a.x-this.x)*b,this.y+(a.y-this.y)*b)},distanceFrom:function(a){var b=this.x-a.x,c=this.y-a.y;return Math.sqrt(b*b+c*c)},midPointFrom:function(a){return new e(this.x+(a.x-this.x)/2,this.y+(a.y-this.y)/2)},min:function(a){return new e(Math.min(this.x,a.x),Math.min(this.y,a.y))},max:function(a){return new e(Math.max(this.x,a.x),Math.max(this.y,a.y))},toString:function(){return this.x+","+this.y},setXY:function(b,a){this.x=b;this.y=a},setFromPoint:function(a){this.x=a.x;this.y=a.y},swap:function(b){var c=this.x,a=this.y;this.x=b.x;this.y=b.y;b.x=c;b.y=a}}})(typeof exports!=="undefined"?exports:this);(function(e){var d=e.fabric||(e.fabric={});if(d.Intersection){d.warn("fabric.Intersection is already defined");return}function f(a){this.status=a;this.points=[]}d.Intersection=f;d.Intersection.prototype={appendPoint:function(a){this.points.push(a)},appendPoints:function(a){this.points=this.points.concat(a)}};d.Intersection.intersectLineLine=function(p,q,b,c){var a,s=(c.x-b.x)*(p.y-b.y)-(c.y-b.y)*(p.x-b.x),n=(q.x-p.x)*(p.y-b.y)-(q.y-p.y)*(p.x-b.x),o=(c.y-b.y)*(q.x-p.x)-(c.x-b.x)*(q.y-p.y);if(o!==0){var r=s/o,t=n/o;if(0<=r&&r<=1&&0<=t&&t<=1){a=new f("Intersection");a.points.push(new d.Point(p.x+r*(q.x-p.x),p.y+r*(q.y-p.y)))}else{a=new f()}}else{if(s===0||n===0){a=new f("Coincident")}else{a=new f("Parallel")}}return a};d.Intersection.intersectLinePolygon=function(q,r,b){var a=new f(),p=b.length;for(var n=0;n<p;n++){var c=b[n],i=b[(n+1)%p],o=f.intersectLineLine(q,r,c,i);a.appendPoints(o.points)}if(a.points.length>0){a.status="Intersection"}return a};d.Intersection.intersectPolygonPolygon=function(c,i){var n=new f(),a=c.length;for(var b=0;b<a;b++){var m=c[b],o=c[(b+1)%a],p=f.intersectLinePolygon(m,o,i);n.appendPoints(p.points)}if(n.points.length>0){n.status="Intersection"}return n};d.Intersection.intersectPolygonRectangle=function(b,w,x){var u=w.min(x),c=w.max(x),v=new d.Point(c.x,u.y),p=new d.Point(u.x,c.y),q=f.intersectLinePolygon(u,v,b),r=f.intersectLinePolygon(v,c,b),s=f.intersectLinePolygon(c,p,b),t=f.intersectLinePolygon(p,u,b),a=new f();a.appendPoints(q.points);a.appendPoints(r.points);a.appendPoints(s.points);a.appendPoints(t.points);if(a.points.length>0){a.status="Intersection"}return a}})(typeof exports!=="undefined"?exports:this);(function(e){var h=e.fabric||(e.fabric={});if(h.Color){h.warn("fabric.Color is already defined.");return}function g(a){if(!a){this.setSource([0,0,0,1])}else{this._tryParsingColor(a)}}h.Color=g;h.Color.prototype={_tryParsingColor:function(b){var a;if(b in g.colorNameMap){b=g.colorNameMap[b]}if(b==="transparent"){this.setSource([255,255,255,0]);return}a=g.sourceFromHex(b);if(!a){a=g.sourceFromRgb(b)}if(!a){a=g.sourceFromHsl(b)}if(a){this.setSource(a)}},_rgbToHsl:function(t,l,c){t/=255,l/=255,c/=255;var q,a,s,b=h.util.array.max([t,l,c]),r=h.util.array.min([t,l,c]);s=(b+r)/2;if(b===r){q=a=0}else{var d=b-r;a=s>0.5?d/(2-b-r):d/(b+r);switch(b){case t:q=(l-c)/d+(l<c?6:0);break;case l:q=(c-t)/d+2;break;case c:q=(t-l)/d+4;break}q/=6}return[Math.round(q*360),Math.round(a*100),Math.round(s*100)]},getSource:function(){return this._source},setSource:function(a){this._source=a},toRgb:function(){var a=this.getSource();return"rgb("+a[0]+","+a[1]+","+a[2]+")"},toRgba:function(){var a=this.getSource();return"rgba("+a[0]+","+a[1]+","+a[2]+","+a[3]+")"},toHsl:function(){var a=this.getSource(),b=this._rgbToHsl(a[0],a[1],a[2]);return"hsl("+b[0]+","+b[1]+"%,"+b[2]+"%)"},toHsla:function(){var a=this.getSource(),b=this._rgbToHsl(a[0],a[1],a[2]);return"hsla("+b[0]+","+b[1]+"%,"+b[2]+"%,"+a[3]+")"},toHex:function(){var a=this.getSource(),b,c,d;b=a[0].toString(16);b=(b.length===1)?("0"+b):b;c=a[1].toString(16);c=(c.length===1)?("0"+c):c;d=a[2].toString(16);d=(d.length===1)?("0"+d):d;return b.toUpperCase()+c.toUpperCase()+d.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(a){var b=this.getSource();b[3]=a;this.setSource(b);return this},toGrayscale:function(){var a=this.getSource(),b=parseInt((a[0]*0.3+a[1]*0.59+a[2]*0.11).toFixed(0),10),c=a[3];this.setSource([b,b,b,c]);return this},toBlackWhite:function(d){var a=this.getSource(),b=(a[0]*0.3+a[1]*0.59+a[2]*0.11).toFixed(0),c=a[3];d=d||127;b=(Number(b)<Number(d))?0:255;this.setSource([b,b,b,c]);return this},overlayWith:function(a){if(!(a instanceof g)){a=new g(a)}var n=[],b=this.getAlpha(),d=0.5,c=this.getSource(),m=a.getSource();for(var i=0;i<3;i++){n.push(Math.round((c[i]*(1-d))+(m[i]*d)))}n[3]=b;this.setSource(n);return this}};h.Color.reRGBa=/^rgba?\(\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/;h.Color.reHSLa=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/;h.Color.reHex=/^#?([0-9a-f]{6}|[0-9a-f]{3})$/i;h.Color.colorNameMap={aqua:"#00FFFF",black:"#000000",blue:"#0000FF",fuchsia:"#FF00FF",gray:"#808080",green:"#008000",lime:"#00FF00",maroon:"#800000",navy:"#000080",olive:"#808000",orange:"#FFA500",purple:"#800080",red:"#FF0000",silver:"#C0C0C0",teal:"#008080",white:"#FFFFFF",yellow:"#FFFF00"};function f(a,b,c){if(c<0){c+=1}if(c>1){c-=1}if(c<1/6){return a+(b-a)*6*c}if(c<1/2){return b}if(c<2/3){return a+(b-a)*(2/3-c)*6}return a}h.Color.fromRgb=function(a){return g.fromSource(g.sourceFromRgb(a))};h.Color.sourceFromRgb=function(d){var c=d.match(g.reRGBa);if(c){var a=parseInt(c[1],10)/(/%$/.test(c[1])?100:1)*(/%$/.test(c[1])?255:1),b=parseInt(c[2],10)/(/%$/.test(c[2])?100:1)*(/%$/.test(c[2])?255:1),k=parseInt(c[3],10)/(/%$/.test(c[3])?100:1)*(/%$/.test(c[3])?255:1);return[parseInt(a,10),parseInt(b,10),parseInt(k,10),c[4]?parseFloat(c[4]):1]}};h.Color.fromRgba=g.fromRgb;h.Color.fromHsl=function(a){return g.fromSource(g.sourceFromHsl(a))};h.Color.sourceFromHsl=function(d){var b=d.match(g.reHSLa);if(!b){return}var c=(((parseFloat(b[1])%360)+360)%360)/360,s=parseFloat(b[2])/(/%$/.test(b[2])?100:1),l=parseFloat(b[3])/(/%$/.test(b[3])?100:1),r,a,v;if(s===0){r=a=v=l}else{var q=l<=0.5?l*(s+1):l+s-l*s,p=l*2-q;r=f(p,q,c+1/3);a=f(p,q,c);v=f(p,q,c-1/3)}return[Math.round(r*255),Math.round(a*255),Math.round(v*255),b[4]?parseFloat(b[4]):1]};h.Color.fromHsla=g.fromHsl;h.Color.fromHex=function(a){return g.fromSource(g.sourceFromHex(a))};h.Color.sourceFromHex=function(d){if(d.match(g.reHex)){var a=d.slice(d.indexOf("#")+1),l=(a.length===3),b=l?(a.charAt(0)+a.charAt(0)):a.substring(0,2),c=l?(a.charAt(1)+a.charAt(1)):a.substring(2,4),m=l?(a.charAt(2)+a.charAt(2)):a.substring(4,6);return[parseInt(b,16),parseInt(c,16),parseInt(m,16),1]}};h.Color.fromSource=function(b){var a=new g();a.setSource(b);return a}})(typeof exports!=="undefined"?exports:this);(function(){function g(u){var v=u.getAttribute("style"),s=u.getAttribute("offset"),t,d,i;s=parseFloat(s)/(/%$/.test(s)?100:1);s=s<0?0:s>1?1:s;if(v){var q=v.split(/\s*;\s*/);if(q[q.length-1]===""){q.pop()}for(var r=q.length;r--;){var c=q[r].split(/\s*:\s*/),a=c[0].trim(),b=c[1].trim();if(a==="stop-color"){t=b}else{if(a==="stop-opacity"){i=b}}}}if(!t){t=u.getAttribute("stop-color")||"rgb(0,0,0)"}if(!i){i=u.getAttribute("stop-opacity")}t=new fabric.Color(t);d=t.getAlpha();i=isNaN(parseFloat(i))?1:parseFloat(i);i*=d;return{offset:s,color:t.toRgb(),opacity:i}}function e(a){return{x1:a.getAttribute("x1")||0,y1:a.getAttribute("y1")||0,x2:a.getAttribute("x2")||"100%",y2:a.getAttribute("y2")||0}}function h(a){return{x1:a.getAttribute("fx")||a.getAttribute("cx")||"50%",y1:a.getAttribute("fy")||a.getAttribute("cy")||"50%",r1:0,x2:a.getAttribute("cx")||"50%",y2:a.getAttribute("cy")||"50%",r2:a.getAttribute("r")||"50%"}}fabric.Gradient=fabric.util.createClass({offsetX:0,offsetY:0,initialize:function(b){b||(b={});var a={};this.id=fabric.Object.__uid++;this.type=b.type||"linear";a={x1:b.coords.x1||0,y1:b.coords.y1||0,x2:b.coords.x2||0,y2:b.coords.y2||0};if(this.type==="radial"){a.r1=b.coords.r1||0;a.r2=b.coords.r2||0}this.coords=a;this.colorStops=b.colorStops.slice();if(b.gradientTransform){this.gradientTransform=b.gradientTransform}this.offsetX=b.offsetX||this.offsetX;this.offsetY=b.offsetY||this.offsetY},addColorStop:function(b){for(var c in b){var a=new fabric.Color(b[c]);this.colorStops.push({offset:c,color:a.toRgb(),opacity:a.getAlpha()})}return this},toObject:function(){return{type:this.type,coords:this.coords,colorStops:this.colorStops,offsetX:this.offsetX,offsetY:this.offsetY}},toSVG:function(d){var b=fabric.util.object.clone(this.coords),i,l;this.colorStops.sort(function(j,k){return j.offset-k.offset});if(!(d.group&&d.group.type==="path-group")){for(var a in b){if(a==="x1"||a==="x2"||a==="r2"){b[a]+=this.offsetX-d.width/2}else{if(a==="y1"||a==="y2"){b[a]+=this.offsetY-d.height/2}}}}l='id="SVGID_'+this.id+'" gradientUnits="userSpaceOnUse"';if(this.gradientTransform){l+=' gradientTransform="matrix('+this.gradientTransform.join(" ")+')" '}if(this.type==="linear"){i=["<linearGradient ",l,' x1="',b.x1,'" y1="',b.y1,'" x2="',b.x2,'" y2="',b.y2,'">\n']}else{if(this.type==="radial"){i=["<radialGradient ",l,' cx="',b.x2,'" cy="',b.y2,'" r="',b.r2,'" fx="',b.x1,'" fy="',b.y1,'">\n']}}for(var c=0;c<this.colorStops.length;c++){i.push("<stop ",'offset="',(this.colorStops[c].offset*100)+"%",'" style="stop-color:',this.colorStops[c].color,(this.colorStops[c].opacity!=null?";stop-opacity: "+this.colorStops[c].opacity:";"),'"/>\n')}i.push((this.type==="linear"?"</linearGradient>\n":"</radialGradient>\n"));return i.join("")},toLive:function(a,s){var c,t,b=fabric.util.object.clone(this.coords);if(!this.type){return}if(s.group&&s.group.type==="path-group"){for(t in b){if(t==="x1"||t==="x2"){b[t]+=-this.offsetX+s.width/2}else{if(t==="y1"||t==="y2"){b[t]+=-this.offsetY+s.height/2}}}}if(s.type==="text"||s.type==="i-text"){for(t in b){if(t==="x1"||t==="x2"){b[t]-=s.width/2}else{if(t==="y1"||t==="y2"){b[t]-=s.height/2}}}}if(this.type==="linear"){c=a.createLinearGradient(b.x1,b.y1,b.x2,b.y2)}else{if(this.type==="radial"){c=a.createRadialGradient(b.x1,b.y1,b.r1,b.x2,b.y2,b.r2)}}for(var p=0,d=this.colorStops.length;p<d;p++){var r=this.colorStops[p].color,i=this.colorStops[p].opacity,q=this.colorStops[p].offset;if(typeof i!=="undefined"){r=new fabric.Color(r).setAlpha(i).toRgba()}c.addColorStop(parseFloat(q),r)}return c}});fabric.util.object.extend(fabric.Gradient,{fromElement:function(u,a){var c=u.getElementsByTagName("stop"),i=(u.nodeName==="linearGradient"?"linear":"radial"),s=u.getAttribute("gradientUnits")||"objectBoundingBox",v=u.getAttribute("gradientTransform"),t=[],b={},q;if(i==="linear"){b=e(u)}else{if(i==="radial"){b=h(u)}}for(var r=c.length;r--;){t.push(g(c[r]))}q=f(a,b,s);var d=new fabric.Gradient({type:i,coords:b,colorStops:t,offsetX:-a.left,offsetY:-a.top});if(v||q!==""){d.gradientTransform=fabric.parseTransformAttribute((v||"")+q)}return d},forObject:function(a,b){b||(b={});f(a,b.coords,"userSpaceOnUse");return new fabric.Gradient(b)}});function f(o,a,p){var q,b=0,c=1,n="";for(var r in a){q=parseFloat(a[r],10);if(typeof a[r]==="string"&&/^\d+%$/.test(a[r])){c=0.01}else{c=1}if(r==="x1"||r==="x2"||r==="r2"){c*=p==="objectBoundingBox"?o.width:1;b=p==="objectBoundingBox"?o.left||0:0}else{if(r==="y1"||r==="y2"){c*=p==="objectBoundingBox"?o.height:1;b=p==="objectBoundingBox"?o.top||0:0}}a[r]=q*c+b}if(o.type==="ellipse"&&a.r2!==null&&p==="objectBoundingBox"&&o.rx!==o.ry){var d=o.ry/o.rx;n=" scale(1, "+d+")";if(a.y1){a.y1/=d}if(a.y2){a.y2/=d}}return n}})();fabric.Pattern=fabric.util.createClass({repeat:"repeat",offsetX:0,offsetY:0,initialize:function(d){d||(d={});this.id=fabric.Object.__uid++;if(d.source){if(typeof d.source==="string"){if(typeof fabric.util.getFunctionBody(d.source)!=="undefined"){this.source=new Function(fabric.util.getFunctionBody(d.source))}else{var c=this;this.source=fabric.util.createImage();fabric.util.loadImage(d.source,function(a){c.source=a})}}else{this.source=d.source}}if(d.repeat){this.repeat=d.repeat}if(d.offsetX){this.offsetX=d.offsetX}if(d.offsetY){this.offsetY=d.offsetY}},toObject:function(){var b;if(typeof this.source==="function"){b=String(this.source)}else{if(typeof this.source.src==="string"){b=this.source.src}}return{source:b,repeat:this.repeat,offsetX:this.offsetX,offsetY:this.offsetY}},toSVG:function(h){var i=typeof this.source==="function"?this.source():this.source,k=i.width/h.getWidth(),m=i.height/h.getHeight(),l=this.offsetX/h.getWidth(),n=this.offsetY/h.getHeight(),j="";if(this.repeat==="repeat-x"||this.repeat==="no-repeat"){m=1}if(this.repeat==="repeat-y"||this.repeat==="no-repeat"){k=1}if(i.src){j=i.src}else{if(i.toDataURL){j=i.toDataURL()}}return'<pattern id="SVGID_'+this.id+'" x="'+l+'" y="'+n+'" width="'+k+'" height="'+m+'">\n<image x="0" y="0" width="'+i.width+'" height="'+i.height+'" xlink:href="'+j+'"></image>\n</pattern>\n'},toLive:function(d){var c=typeof this.source==="function"?this.source():this.source;if(!c){return""}if(typeof c.src!=="undefined"){if(!c.complete){return""}if(c.naturalWidth===0||c.naturalHeight===0){return""}}return d.createPattern(c,this.repeat)}});(function(d){var f=d.fabric||(d.fabric={}),e=f.util.toFixed;if(f.Shadow){f.warn("fabric.Shadow is already defined.");return}f.Shadow=f.util.createClass({color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:false,includeDefaultValues:true,initialize:function(b){if(typeof b==="string"){b=this._parseShadow(b)}for(var a in b){this[a]=b[a]}this.id=f.Object.__uid++},_parseShadow:function(a){var b=a.trim(),c=f.Shadow.reOffsetsAndBlur.exec(b)||[],h=b.replace(f.Shadow.reOffsetsAndBlur,"")||"rgb(0,0,0)";return{color:h.trim(),offsetX:parseInt(c[1],10)||0,offsetY:parseInt(c[2],10)||0,blur:parseInt(c[3],10)||0}},toString:function(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")},toSVG:function(c){var b="SourceAlpha",h=40,a=40;if(c&&(c.fill===this.color||c.stroke===this.color)){b="SourceGraphic"}if(c.width&&c.height){h=e(Math.abs(this.offsetX/c.getWidth()),2)*100+20;a=e(Math.abs(this.offsetY/c.getHeight()),2)*100+20}return('<filter id="SVGID_'+this.id+'" y="-'+a+'%" height="'+(100+2*a)+'%" x="-'+h+'%" width="'+(100+2*h)+'%" >\n\t<feGaussianBlur in="'+b+'" stdDeviation="'+e(this.blur?this.blur/2:0,3)+'" result="blurOut"></feGaussianBlur>\n\t<feColorMatrix result="matrixOut" in="blurOut" type="matrix" values="1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 0.30 0" ></feColorMatrix >\n\t<feOffset dx="'+this.offsetX+'" dy="'+this.offsetY+'"></feOffset>\n\t<feMerge>\n\t\t<feMergeNode></feMergeNode>\n\t\t<feMergeNode in="SourceGraphic"></feMergeNode>\n\t</feMerge>\n</filter>\n')},toObject:function(){if(this.includeDefaultValues){return{color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY}}var a={},b=f.Shadow.prototype;if(this.color!==b.color){a.color=this.color}if(this.blur!==b.blur){a.blur=this.blur}if(this.offsetX!==b.offsetX){a.offsetX=this.offsetX}if(this.offsetY!==b.offsetY){a.offsetY=this.offsetY}return a}});f.Shadow.reOffsetsAndBlur=/(?:\s|^)(-?\d+(?:px)?(?:\s?|$))?(-?\d+(?:px)?(?:\s?|$))?(\d+(?:px)?)?(?:\s?|$)(?:$|\s)/})(typeof exports!=="undefined"?exports:this);(function(){if(fabric.StaticCanvas){fabric.warn("fabric.StaticCanvas is already defined.");return}var g=fabric.util.object.extend,e=fabric.util.getElementOffset,h=fabric.util.removeFromArray,f=new Error("Could not initialize `canvas` element");fabric.StaticCanvas=fabric.util.createClass({initialize:function(a,b){b||(b={});this._initStatic(a,b);fabric.StaticCanvas.activeInstance=this},backgroundColor:"",backgroundImage:null,overlayColor:"",overlayImage:null,includeDefaultValues:true,stateful:true,renderOnAddRemove:true,clipTo:null,controlsAboveOverlay:false,allowTouchScrolling:false,imageSmoothingEnabled:true,preserveObjectStacking:false,viewportTransform:[1,0,0,1,0,0],onBeforeScaleRotate:function(){},_initStatic:function(a,b){this._objects=[];this._createLowerCanvas(a);this._initOptions(b);this._setImageSmoothing();if(b.overlayImage){this.setOverlayImage(b.overlayImage,this.renderAll.bind(this))}if(b.backgroundImage){this.setBackgroundImage(b.backgroundImage,this.renderAll.bind(this))}if(b.backgroundColor){this.setBackgroundColor(b.backgroundColor,this.renderAll.bind(this))}if(b.overlayColor){this.setOverlayColor(b.overlayColor,this.renderAll.bind(this))}this.calcOffset()},calcOffset:function(){this._offset=e(this.lowerCanvasEl);return this},setOverlayImage:function(b,a,c){return this.__setBgOverlayImage("overlayImage",b,a,c)},setBackgroundImage:function(b,a,c){return this.__setBgOverlayImage("backgroundImage",b,a,c)},setOverlayColor:function(a,b){return this.__setBgOverlayColor("overlayColor",a,b)},setBackgroundColor:function(b,a){return this.__setBgOverlayColor("backgroundColor",b,a)},_setImageSmoothing:function(){var a=this.getContext();a.imageSmoothingEnabled=this.imageSmoothingEnabled;a.webkitImageSmoothingEnabled=this.imageSmoothingEnabled;a.mozImageSmoothingEnabled=this.imageSmoothingEnabled;a.msImageSmoothingEnabled=this.imageSmoothingEnabled;a.oImageSmoothingEnabled=this.imageSmoothingEnabled},__setBgOverlayImage:function(c,b,a,d){if(typeof b==="string"){fabric.util.loadImage(b,function(j){this[c]=new fabric.Image(j,d);a&&a()},this,d&&d.crossOrigin)}else{d&&b.setOptions(d);this[c]=b;a&&a()}return this},__setBgOverlayColor:function(c,d,a){if(d&&d.source){var b=this;fabric.util.loadImage(d.source,function(j){b[c]=new fabric.Pattern({source:j,repeat:d.repeat,offsetX:d.offsetX,offsetY:d.offsetY});a&&a()})}else{this[c]=d;a&&a()}return this},_createCanvasElement:function(){var a=fabric.document.createElement("canvas");if(!a.style){a.style={}}if(!a){throw f}this._initCanvasElement(a);return a},_initCanvasElement:function(a){fabric.util.createCanvasElement(a);if(typeof a.getContext==="undefined"){throw f}},_initOptions:function(b){for(var a in b){this[a]=b[a]}this.width=this.width||parseInt(this.lowerCanvasEl.width,10)||0;this.height=this.height||parseInt(this.lowerCanvasEl.height,10)||0;if(!this.lowerCanvasEl.style){return}this.lowerCanvasEl.width=this.width;this.lowerCanvasEl.height=this.height;this.lowerCanvasEl.style.width=this.width+"px";this.lowerCanvasEl.style.height=this.height+"px";this.viewportTransform=this.viewportTransform.slice()},_createLowerCanvas:function(a){this.lowerCanvasEl=fabric.util.getById(a)||this._createCanvasElement();this._initCanvasElement(this.lowerCanvasEl);fabric.util.addClass(this.lowerCanvasEl,"lower-canvas");if(this.interactive){this._applyCanvasStyle(this.lowerCanvasEl)}this.contextContainer=this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(a,b){return this.setDimensions({width:a},b)},setHeight:function(a,b){return this.setDimensions({height:a},b)},setDimensions:function(b,c){var d;c=c||{};for(var a in b){d=b[a];if(!c.cssOnly){this._setBackstoreDimension(a,b[a]);d+="px"}if(!c.backstoreOnly){this._setCssDimension(a,d)}}if(!c.cssOnly){this.renderAll()}this.calcOffset();return this},_setBackstoreDimension:function(a,b){this.lowerCanvasEl[a]=b;if(this.upperCanvasEl){this.upperCanvasEl[a]=b}if(this.cacheCanvasEl){this.cacheCanvasEl[a]=b}this[a]=b;return this},_setCssDimension:function(a,b){this.lowerCanvasEl.style[a]=b;if(this.upperCanvasEl){this.upperCanvasEl.style[a]=b}if(this.wrapperEl){this.wrapperEl.style[a]=b}return this},getZoom:function(){return Math.sqrt(this.viewportTransform[0]*this.viewportTransform[3])},setViewportTransform:function(a){var b=this.getActiveGroup();this.viewportTransform=a;this.renderAll();for(var c=0,d=this._objects.length;c<d;c++){this._objects[c].setCoords()}if(b){b.setCoords()}return this},zoomToPoint:function(i,b){var c=i;i=fabric.util.transformPoint(i,fabric.util.invertTransform(this.viewportTransform));this.viewportTransform[0]=b;this.viewportTransform[3]=b;var a=fabric.util.transformPoint(i,this.viewportTransform);this.viewportTransform[4]+=c.x-a.x;this.viewportTransform[5]+=c.y-a.y;this.renderAll();for(var d=0,l=this._objects.length;d<l;d++){this._objects[d].setCoords()}return this},setZoom:function(a){this.zoomToPoint(new fabric.Point(0,0),a);return this},absolutePan:function(b){this.viewportTransform[4]=-b.x;this.viewportTransform[5]=-b.y;this.renderAll();for(var a=0,c=this._objects.length;a<c;a++){this._objects[a].setCoords()}return this},relativePan:function(a){return this.absolutePan(new fabric.Point(-a.x-this.viewportTransform[4],-a.y-this.viewportTransform[5]))},getElement:function(){return this.lowerCanvasEl},getActiveObject:function(){return null},getActiveGroup:function(){return null},_draw:function(c,a){if(!a){return}c.save();var b=this.viewportTransform;c.transform(b[0],b[1],b[2],b[3],b[4],b[5]);if(this._shouldRenderObject(a)){a.render(c)}c.restore();if(!this.controlsAboveOverlay){a._renderControls(c)}},_shouldRenderObject:function(a){if(!a){return false}return(a!==this.getActiveGroup()||!this.preserveObjectStacking)},_onObjectAdded:function(a){this.stateful&&a.setupState();a.canvas=this;a.setCoords();this.fire("object:added",{target:a});a.fire("added")},_onObjectRemoved:function(a){if(this.getActiveObject()===a){this.fire("before:selection:cleared",{target:a});this._discardActiveObject();this.fire("selection:cleared")}this.fire("object:removed",{target:a});a.fire("removed")},clearContext:function(a){a.clearRect(0,0,this.width,this.height);return this},getContext:function(){return this.contextContainer},clear:function(){this._objects.length=0;if(this.discardActiveGroup){this.discardActiveGroup()}if(this.discardActiveObject){this.discardActiveObject()}this.clearContext(this.contextContainer);if(this.contextTop){this.clearContext(this.contextTop)}this.fire("canvas:cleared");this.renderAll();return this},renderAll:function(c){var b=this[(c===true&&this.interactive)?"contextTop":"contextContainer"],a=this.getActiveGroup();if(this.contextTop&&this.selection&&!this._groupSelector){this.clearContext(this.contextTop)}if(!c){this.clearContext(b)}this.fire("before:render");if(this.clipTo){fabric.util.clipContext(this,b)}this._renderBackground(b);this._renderObjects(b,a);this._renderActiveGroup(b,a);if(this.clipTo){b.restore()}this._renderOverlay(b);if(this.controlsAboveOverlay&&this.interactive){this.drawControls(b)}this.fire("after:render");return this},_renderObjects:function(d,b){var c,a;if(!b||this.preserveObjectStacking){for(c=0,a=this._objects.length;c<a;++c){this._draw(d,this._objects[c])}}else{for(c=0,a=this._objects.length;c<a;++c){if(this._objects[c]&&!b.contains(this._objects[c])){this._draw(d,this._objects[c])}}}},_renderActiveGroup:function(c,b){if(b){var a=[];this.forEachObject(function(d){if(b.contains(d)){a.push(d)}});b._set("objects",a);this._draw(c,b)}},_renderBackground:function(a){if(this.backgroundColor){a.fillStyle=this.backgroundColor.toLive?this.backgroundColor.toLive(a):this.backgroundColor;a.fillRect(this.backgroundColor.offsetX||0,this.backgroundColor.offsetY||0,this.width,this.height)}if(this.backgroundImage){this._draw(a,this.backgroundImage)}},_renderOverlay:function(a){if(this.overlayColor){a.fillStyle=this.overlayColor.toLive?this.overlayColor.toLive(a):this.overlayColor;a.fillRect(this.overlayColor.offsetX||0,this.overlayColor.offsetY||0,this.width,this.height)}if(this.overlayImage){this._draw(a,this.overlayImage)}},renderTop:function(){var b=this.contextTop||this.contextContainer;this.clearContext(b);if(this.selection&&this._groupSelector){this._drawSelection()}var a=this.getActiveGroup();if(a){a.render(b)}this._renderOverlay(b);this.fire("after:render");return this},getCenter:function(){return{top:this.getHeight()/2,left:this.getWidth()/2}},centerObjectH:function(a){this._centerObject(a,new fabric.Point(this.getCenter().left,a.getCenterPoint().y));this.renderAll();return this},centerObjectV:function(a){this._centerObject(a,new fabric.Point(a.getCenterPoint().x,this.getCenter().top));this.renderAll();return this},centerObject:function(a){var b=this.getCenter();this._centerObject(a,new fabric.Point(b.left,b.top));this.renderAll();return this},_centerObject:function(a,b){a.setPositionByOrigin(b,"center","center");return this},toDatalessJSON:function(a){return this.toDatalessObject(a)},toObject:function(a){return this._toObjectMethod("toObject",a)},toDatalessObject:function(a){return this._toObjectMethod("toDatalessObject",a)},_toObjectMethod:function(c,a){var b={objects:this._toObjects(c,a)};g(b,this.__serializeBgOverlay());fabric.util.populateWithProperties(this,b,a);return b},_toObjects:function(b,a){return this.getObjects().map(function(c){return this._toObject(c,b,a)},this)},_toObject:function(l,d,a){var k;if(!this.includeDefaultValues){k=l.includeDefaultValues;l.includeDefaultValues=false}var b=this._realizeGroupTransformOnObject(l),c=l[d](a);if(!this.includeDefaultValues){l.includeDefaultValues=k}this._unwindGroupTransformOnObject(l,b);return c},_realizeGroupTransformOnObject:function(c){var b=["angle","flipX","flipY","height","left","scaleX","scaleY","top","width"];if(c.group&&c.group===this.getActiveGroup()){var a={};b.forEach(function(d){a[d]=c[d]});this.getActiveGroup().realizeTransform(c);return a}else{return null}},_unwindGroupTransformOnObject:function(b,a){if(a){b.set(a)}},__serializeBgOverlay:function(){var a={background:(this.backgroundColor&&this.backgroundColor.toObject)?this.backgroundColor.toObject():this.backgroundColor};if(this.overlayColor){a.overlay=this.overlayColor.toObject?this.overlayColor.toObject():this.overlayColor}if(this.backgroundImage){a.backgroundImage=this.backgroundImage.toObject()}if(this.overlayImage){a.overlayImage=this.overlayImage.toObject()}return a},svgViewportTransformation:true,toSVG:function(a,c){a||(a={});var b=[];this._setSVGPreamble(b,a);this._setSVGHeader(b,a);this._setSVGBgOverlayColor(b,"backgroundColor");this._setSVGBgOverlayImage(b,"backgroundImage");this._setSVGObjects(b,c);this._setSVGBgOverlayColor(b,"overlayColor");this._setSVGBgOverlayImage(b,"overlayImage");b.push("</svg>");return b.join("")},_setSVGPreamble:function(b,a){if(!a.suppressPreamble){b.push('<?xml version="1.0" encoding="',(a.encoding||"UTF-8"),'" standalone="no" ?>','<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ','"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n')}},_setSVGHeader:function(d,c){var b,j,a;if(c.viewBox){b=c.viewBox.width;j=c.viewBox.height}else{b=this.width;j=this.height;if(!this.svgViewportTransformation){a=this.viewportTransform;b/=a[0];j/=a[3]}}d.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',b,'" ','height="',j,'" ',(this.backgroundColor&&!this.backgroundColor.toLive?'style="background-color: '+this.backgroundColor+'" ':null),(c.viewBox?'viewBox="'+c.viewBox.x+" "+c.viewBox.y+" "+c.viewBox.width+" "+c.viewBox.height+'" ':null),'xml:space="preserve">',"<desc>Created with Fabric.js ",fabric.version,"</desc>","<defs>",fabric.createSVGFontFacesMarkup(this.getObjects()),fabric.createSVGRefElementsMarkup(this),"</defs>")},_setSVGObjects:function(d,i){for(var c=0,b=this.getObjects(),m=b.length;c<m;c++){var n=b[c],a=this._realizeGroupTransformOnObject(n);d.push(n.toSVG(i));this._unwindGroupTransformOnObject(n,a)}},_setSVGBgOverlayImage:function(b,a){if(this[a]&&this[a].toSVG){b.push(this[a].toSVG())}},_setSVGBgOverlayColor:function(b,a){if(this[a]&&this[a].source){b.push('<rect x="',this[a].offsetX,'" y="',this[a].offsetY,'" ','width="',(this[a].repeat==="repeat-y"||this[a].repeat==="no-repeat"?this[a].source.width:this.width),'" height="',(this[a].repeat==="repeat-x"||this[a].repeat==="no-repeat"?this[a].source.height:this.height),'" fill="url(#'+a+'Pattern)"',"></rect>")}else{if(this[a]&&a==="overlayColor"){b.push('<rect x="0" y="0" ','width="',this.width,'" height="',this.height,'" fill="',this[a],'"',"></rect>")}}},sendToBack:function(a){h(this._objects,a);this._objects.unshift(a);return this.renderAll&&this.renderAll()},bringToFront:function(a){h(this._objects,a);this._objects.push(a);return this.renderAll&&this.renderAll()},sendBackwards:function(c,b){var d=this._objects.indexOf(c);if(d!==0){var a=this._findNewLowerIndex(c,d,b);h(this._objects,c);this._objects.splice(a,0,c);this.renderAll&&this.renderAll()}return this},_findNewLowerIndex:function(d,l,b){var a;if(b){a=l;for(var c=l-1;c>=0;--c){var i=d.intersectsWithObject(this._objects[c])||d.isContainedWithinObject(this._objects[c])||this._objects[c].isContainedWithinObject(d);if(i){a=c;break}}}else{a=l-1}return a},bringForward:function(c,b){var d=this._objects.indexOf(c);if(d!==this._objects.length-1){var a=this._findNewUpperIndex(c,d,b);h(this._objects,c);this._objects.splice(a,0,c);this.renderAll&&this.renderAll()}return this},_findNewUpperIndex:function(d,l,b){var a;if(b){a=l;for(var c=l+1;c<this._objects.length;++c){var i=d.intersectsWithObject(this._objects[c])||d.isContainedWithinObject(this._objects[c])||this._objects[c].isContainedWithinObject(d);if(i){a=c;break}}}else{a=l+1}return a},moveTo:function(a,b){h(this._objects,a);this._objects.splice(b,0,a);return this.renderAll&&this.renderAll()},dispose:function(){this.clear();this.interactive&&this.removeListeners();return this},toString:function(){return"#<fabric.Canvas ("+this.complexity()+"): { objects: "+this.getObjects().length+" }>"}});g(fabric.StaticCanvas.prototype,fabric.Observable);g(fabric.StaticCanvas.prototype,fabric.Collection);g(fabric.StaticCanvas.prototype,fabric.DataURLExporter);g(fabric.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',supports:function(c){var b=fabric.util.createCanvasElement();if(!b||!b.getContext){return null}var d=b.getContext("2d");if(!d){return null}switch(c){case"getImageData":return typeof d.getImageData!=="undefined";case"setLineDash":return typeof d.setLineDash!=="undefined";case"toDataURL":return typeof b.toDataURL!=="undefined";case"toDataURLWithQuality":try{b.toDataURL("image/jpeg",0);return true}catch(a){}return false;default:return null}}});fabric.StaticCanvas.prototype.toJSON=fabric.StaticCanvas.prototype.toObject})();fabric.BaseBrush=fabric.util.createClass({color:"rgb(0, 0, 0)",width:1,shadow:null,strokeLineCap:"round",strokeLineJoin:"round",strokeDashArray:null,setShadow:function(b){this.shadow=new fabric.Shadow(b);return this},_setBrushStyles:function(){var b=this.canvas.contextTop;b.strokeStyle=this.color;b.lineWidth=this.width;b.lineCap=this.strokeLineCap;b.lineJoin=this.strokeLineJoin;if(this.strokeDashArray&&fabric.StaticCanvas.supports("setLineDash")){b.setLineDash(this.strokeDashArray)}},_setShadow:function(){if(!this.shadow){return}var b=this.canvas.contextTop;b.shadowColor=this.shadow.color;b.shadowBlur=this.shadow.blur;b.shadowOffsetX=this.shadow.offsetX;b.shadowOffsetY=this.shadow.offsetY},_resetShadow:function(){var b=this.canvas.contextTop;b.shadowColor="";b.shadowBlur=b.shadowOffsetX=b.shadowOffsetY=0}});(function(){fabric.PencilBrush=fabric.util.createClass(fabric.BaseBrush,{initialize:function(b){this.canvas=b;this._points=[]},onMouseDown:function(b){this._prepareForDrawing(b);this._captureDrawingPath(b);this._render()},onMouseMove:function(b){this._captureDrawingPath(b);this.canvas.clearContext(this.canvas.contextTop);this._render()},onMouseUp:function(){this._finalizeAndAddPath()},_prepareForDrawing:function(c){var d=new fabric.Point(c.x,c.y);this._reset();this._addPoint(d);this.canvas.contextTop.moveTo(d.x,d.y)},_addPoint:function(b){this._points.push(b)},_reset:function(){this._points.length=0;this._setBrushStyles();this._setShadow()},_captureDrawingPath:function(d){var c=new fabric.Point(d.x,d.y);this._addPoint(c)},_render:function(){var h=this.canvas.contextTop,n=this.canvas.viewportTransform,k=this._points[0],l=this._points[1];h.save();h.transform(n[0],n[1],n[2],n[3],n[4],n[5]);h.beginPath();if(this._points.length===2&&k.x===l.x&&k.y===l.y){k.x-=0.5;l.x+=0.5}h.moveTo(k.x,k.y);for(var m=1,i=this._points.length;m<i;m++){var j=k.midPointFrom(l);h.quadraticCurveTo(k.x,k.y,j.x,j.y);k=this._points[m];l=this._points[m+1]}h.lineTo(k.x,k.y);h.stroke();h.restore()},convertPointsToSVGPath:function(n){var l=[],k=new fabric.Point(n[0].x,n[0].y),m=new fabric.Point(n[1].x,n[1].y);l.push("M ",n[0].x," ",n[0].y," ");for(var h=1,i=n.length;h<i;h++){var j=k.midPointFrom(m);l.push("Q ",k.x," ",k.y," ",j.x," ",j.y," ");k=new fabric.Point(n[h].x,n[h].y);if((h+1)<n.length){m=new fabric.Point(n[h+1].x,n[h+1].y)}}l.push("L ",k.x," ",k.y," ");return l},createPath:function(c){var d=new fabric.Path(c,{fill:null,stroke:this.color,strokeWidth:this.width,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeDashArray:this.strokeDashArray,originX:"center",originY:"center"});if(this.shadow){this.shadow.affectStroke=true;d.setShadow(this.shadow)}return d},_finalizeAndAddPath:function(){var e=this.canvas.contextTop;e.closePath();var f=this.convertPointsToSVGPath(this._points).join("");if(f==="M 0 0 Q 0 0 0 0 L 0 0"){this.canvas.renderAll();return}var d=this.createPath(f);this.canvas.add(d);d.setCoords();this.canvas.clearContext(this.canvas.contextTop);this._resetShadow();this.canvas.renderAll();this.canvas.fire("path:created",{path:d})}})})();fabric.CircleBrush=fabric.util.createClass(fabric.BaseBrush,{width:10,initialize:function(b){this.canvas=b;this.points=[]},drawDot:function(g){var f=this.addPoint(g),e=this.canvas.contextTop,h=this.canvas.viewportTransform;e.save();e.transform(h[0],h[1],h[2],h[3],h[4],h[5]);e.fillStyle=f.fill;e.beginPath();e.arc(f.x,f.y,f.radius,0,Math.PI*2,false);e.closePath();e.fill();e.restore()},onMouseDown:function(b){this.points.length=0;this.canvas.clearContext(this.canvas.contextTop);this._setShadow();this.drawDot(b)},onMouseMove:function(b){this.drawDot(b)},onMouseUp:function(){var j=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=false;var k=[];for(var n=0,h=this.points.length;n<h;n++){var i=this.points[n],l=new fabric.Circle({radius:i.radius,left:i.x,top:i.y,originX:"center",originY:"center",fill:i.fill});this.shadow&&l.setShadow(this.shadow);k.push(l)}var m=new fabric.Group(k,{originX:"center",originY:"center"});m.canvas=this.canvas;this.canvas.add(m);this.canvas.fire("path:created",{path:m});this.canvas.clearContext(this.canvas.contextTop);this._resetShadow();this.canvas.renderOnAddRemove=j;this.canvas.renderAll()},addPoint:function(h){var g=new fabric.Point(h.x,h.y),f=fabric.util.getRandomInt(Math.max(0,this.width-20),this.width+20)/2,e=new fabric.Color(this.color).setAlpha(fabric.util.getRandomInt(0,100)/100).toRgba();g.radius=f;g.fill=e;this.points.push(g);return g}});fabric.SprayBrush=fabric.util.createClass(fabric.BaseBrush,{width:10,density:20,dotWidth:1,dotWidthVariance:1,randomOpacity:false,optimizeOverlapping:true,initialize:function(b){this.canvas=b;this.sprayChunks=[]},onMouseDown:function(b){this.sprayChunks.length=0;this.canvas.clearContext(this.canvas.contextTop);this._setShadow();this.addSprayChunk(b);this.render()},onMouseMove:function(b){this.addSprayChunk(b);this.render()},onMouseUp:function(){var n=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=false;var j=[];for(var p=0,r=this.sprayChunks.length;p<r;p++){var o=this.sprayChunks[p];for(var q=0,i=o.length;q<i;q++){var m=new fabric.Rect({width:o[q].width,height:o[q].width,left:o[q].x+1,top:o[q].y+1,originX:"center",originY:"center",fill:this.color});this.shadow&&m.setShadow(this.shadow);j.push(m)}}if(this.optimizeOverlapping){j=this._getOptimizedRects(j)}var l=new fabric.Group(j,{originX:"center",originY:"center"});l.canvas=this.canvas;this.canvas.add(l);this.canvas.fire("path:created",{path:l});this.canvas.clearContext(this.canvas.contextTop);this._resetShadow();this.canvas.renderOnAddRemove=n;this.canvas.renderAll()},_getOptimizedRects:function(l){var g={},j;for(var k=0,h=l.length;k<h;k++){j=l[k].left+""+l[k].top;if(!g[j]){g[j]=l[k]}}var i=[];for(j in g){i.push(g[j])}return i},render:function(){var j=this.canvas.contextTop;j.fillStyle=this.color;var i=this.canvas.viewportTransform;j.save();j.transform(i[0],i[1],i[2],i[3],i[4],i[5]);for(var h=0,f=this.sprayChunkPoints.length;h<f;h++){var g=this.sprayChunkPoints[h];if(typeof g.opacity!=="undefined"){j.globalAlpha=g.opacity}j.fillRect(g.x,g.y,g.width,g.width)}j.restore()},addSprayChunk:function(k){this.sprayChunkPoints=[];var n,j,l,h=this.width/2;for(var m=0;m<this.density;m++){n=fabric.util.getRandomInt(k.x-h,k.x+h);j=fabric.util.getRandomInt(k.y-h,k.y+h);if(this.dotWidthVariance){l=fabric.util.getRandomInt(Math.max(1,this.dotWidth-this.dotWidthVariance),this.dotWidth+this.dotWidthVariance)}else{l=this.dotWidth}var i=new fabric.Point(n,j);i.width=l;if(this.randomOpacity){i.opacity=fabric.util.getRandomInt(0,100)/100}this.sprayChunkPoints.push(i)}this.sprayChunks.push(this.sprayChunkPoints)}});fabric.PatternBrush=fabric.util.createClass(fabric.PencilBrush,{getPatternSrc:function(){var g=20,e=5,h=fabric.document.createElement("canvas"),f=h.getContext("2d");h.width=h.height=g+e;f.fillStyle=this.color;f.beginPath();f.arc(g/2,g/2,g/2,0,Math.PI*2,false);f.closePath();f.fill();return h},getPatternSrcFunction:function(){return String(this.getPatternSrc).replace("this.color",'"'+this.color+'"')},getPattern:function(){return this.canvas.contextTop.createPattern(this.source||this.getPatternSrc(),"repeat")},_setBrushStyles:function(){this.callSuper("_setBrushStyles");this.canvas.contextTop.strokeStyle=this.getPattern()},createPath:function(c){var d=this.callSuper("createPath",c);d.stroke=new fabric.Pattern({source:this.source||this.getPatternSrcFunction()});return d}});(function(){var n=fabric.util.getPointer,m=fabric.util.degreesToRadians,k=fabric.util.radiansToDegrees,l=Math.atan2,h=Math.abs,i=0.5;fabric.Canvas=fabric.util.createClass(fabric.StaticCanvas,{initialize:function(a,b){b||(b={});this._initStatic(a,b);this._initInteractive();this._createCacheCanvas();fabric.Canvas.activeInstance=this},uniScaleTransform:false,centeredScaling:false,centeredRotation:false,interactive:true,selection:true,selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",rotationCursor:"crosshair",containerClass:"canvas-container",perPixelTargetFind:false,targetFindTolerance:0,skipTargetFind:false,_initInteractive:function(){this._currentTransform=null;this._groupSelector=null;this._initWrapperElement();this._createUpperCanvas();this._initEventListeners();this.freeDrawingBrush=fabric.PencilBrush&&new fabric.PencilBrush(this);this.calcOffset()},_resetCurrentTransform:function(a){var b=this._currentTransform;b.target.set({scaleX:b.original.scaleX,scaleY:b.original.scaleY,left:b.original.left,top:b.original.top});if(this._shouldCenterTransform(a,b.target)){if(b.action==="rotate"){this._setOriginToCenter(b.target)}else{if(b.originX!=="center"){if(b.originX==="right"){b.mouseXSign=-1}else{b.mouseXSign=1}}if(b.originY!=="center"){if(b.originY==="bottom"){b.mouseYSign=-1}else{b.mouseYSign=1}}b.originX="center";b.originY="center"}}else{b.originX=b.original.originX;b.originY=b.original.originY}},containsPoint:function(b,c){var a=this.getPointer(b,true),d=this._normalizePointer(c,a);return(c.containsPoint(d)||c._findTargetCorner(a))},_normalizePointer:function(d,a){var b=this.getActiveGroup(),e=a.x,g=a.y,c=(b&&d.type!=="group"&&b.contains(d)),f;if(c){f=new fabric.Point(b.left,b.top);f=fabric.util.transformPoint(f,this.viewportTransform,true);e-=f.x;g-=f.y}return{x:e,y:g}},isTargetTransparent:function(b,f,a){var e=b.hasBorders,d=b.transparentCorners;b.hasBorders=b.transparentCorners=false;this._draw(this.contextCache,b);b.hasBorders=e;b.transparentCorners=d;var c=fabric.util.isTransparent(this.contextCache,f,a,this.targetFindTolerance);this.clearContext(this.contextCache);return c},_shouldClearSelection:function(a,b){var c=this.getActiveGroup(),d=this.getActiveObject();return(!b||(b&&c&&!c.contains(b)&&c!==b&&!a.shiftKey)||(b&&!b.evented)||(b&&!b.selectable&&d&&d!==b))},_shouldCenterTransform:function(a,b){if(!b){return}var c=this._currentTransform,d;if(c.action==="scale"||c.action==="scaleX"||c.action==="scaleY"){d=this.centeredScaling||b.centeredScaling}else{if(c.action==="rotate"){d=this.centeredRotation||b.centeredRotation}}return d?!a.altKey:a.altKey},_getOriginFromCorner:function(a,b){var c={x:a.originX,y:a.originY};if(b==="ml"||b==="tl"||b==="bl"){c.x="right"}else{if(b==="mr"||b==="tr"||b==="br"){c.x="left"}}if(b==="tl"||b==="mt"||b==="tr"){c.y="bottom"}else{if(b==="bl"||b==="mb"||b==="br"){c.y="top"}}return c},_getActionFromCorner:function(a,c){var b="drag";if(c){b=(c==="ml"||c==="mr")?"scaleX":(c==="mt"||c==="mb")?"scaleY":c==="mtr"?"rotate":"scale"}return b},_setupCurrentTransform:function(b,c){if(!c){return}var a=this.getPointer(b),e=c._findTargetCorner(this.getPointer(b,true)),d=this._getActionFromCorner(c,e),f=this._getOriginFromCorner(c,e);this._currentTransform={target:c,action:d,scaleX:c.scaleX,scaleY:c.scaleY,offsetX:a.x-c.left,offsetY:a.y-c.top,originX:f.x,originY:f.y,ex:a.x,ey:a.y,left:c.left,top:c.top,theta:m(c.angle),width:c.width*c.scaleX,mouseXSign:1,mouseYSign:1};this._currentTransform.original={left:c.left,top:c.top,scaleX:c.scaleX,scaleY:c.scaleY,originX:f.x,originY:f.y};this._resetCurrentTransform(b)},_translateObject:function(c,a){var b=this._currentTransform.target;if(!b.get("lockMovementX")){b.set("left",c-this._currentTransform.offsetX)}if(!b.get("lockMovementY")){b.set("top",a-this._currentTransform.offsetY)}},_scaleObject:function(b,c,f){var a=this._currentTransform,r=a.target,e=r.get("lockScalingX"),g=r.get("lockScalingY"),t=r.get("lockScalingFlip");if(e&&g){return}var s=r.translateToOriginPoint(r.getCenterPoint(),a.originX,a.originY),d=r.toLocalPoint(new fabric.Point(b,c),a.originX,a.originY);this._setLocalMouse(d,a);this._setObjectScale(d,a,e,g,f,t);r.setPositionByOrigin(s,a.originX,a.originY)},_setObjectScale:function(b,s,c,e,d,t){var f=s.target,g=false,r=false,a=f.stroke?f.strokeWidth:0;s.newScaleX=b.x/(f.width+a/2);s.newScaleY=b.y/(f.height+a/2);if(t&&s.newScaleX<=0&&s.newScaleX<f.scaleX){g=true}if(t&&s.newScaleY<=0&&s.newScaleY<f.scaleY){r=true}if(d==="equally"&&!c&&!e){g||r||this._scaleObjectEqually(b,f,s)}else{if(!d){g||c||f.set("scaleX",s.newScaleX);r||e||f.set("scaleY",s.newScaleY)}else{if(d==="x"&&!f.get("lockUniScaling")){g||c||f.set("scaleX",s.newScaleX)}else{if(d==="y"&&!f.get("lockUniScaling")){r||e||f.set("scaleY",s.newScaleY)}}}}g||r||this._flipObject(s,d)},_scaleObjectEqually:function(b,e,f){var c=b.y+b.x,a=e.stroke?e.strokeWidth:0,d=(e.height+(a/2))*f.original.scaleY+(e.width+(a/2))*f.original.scaleX;f.newScaleX=f.original.scaleX*c/d;f.newScaleY=f.original.scaleY*c/d;e.set("scaleX",f.newScaleX);e.set("scaleY",f.newScaleY)},_flipObject:function(b,a){if(b.newScaleX<0&&a!=="y"){if(b.originX==="left"){b.originX="right"}else{if(b.originX==="right"){b.originX="left"}}}if(b.newScaleY<0&&a!=="x"){if(b.originY==="top"){b.originY="bottom"}else{if(b.originY==="bottom"){b.originY="top"}}}},_setLocalMouse:function(a,c){var b=c.target;if(c.originX==="right"){a.x*=-1}else{if(c.originX==="center"){a.x*=c.mouseXSign*2;if(a.x<0){c.mouseXSign=-c.mouseXSign}}}if(c.originY==="bottom"){a.y*=-1}else{if(c.originY==="center"){a.y*=c.mouseYSign*2;if(a.y<0){c.mouseYSign=-c.mouseYSign}}}if(h(a.x)>b.padding){if(a.x<0){a.x+=b.padding}else{a.x-=b.padding}}else{a.x=0}if(h(a.y)>b.padding){if(a.y<0){a.y+=b.padding}else{a.y-=b.padding}}else{a.y=0}},_rotateObject:function(f,a){var e=this._currentTransform;if(e.target.get("lockRotation")){return}var d=l(e.ey-e.top,e.ex-e.left),b=l(a-e.top,f-e.left),c=k(b-d+e.theta);if(c<0){c=360+c}e.target.angle=c%360},setCursor:function(a){this.upperCanvasEl.style.cursor=a},_resetObjectTransform:function(a){a.scaleX=1;a.scaleY=1;a.setAngle(0)},_drawSelection:function(){var e=this.contextTop,f=this._groupSelector,g=f.left,p=f.top,a=h(g),c=h(p);e.fillStyle=this.selectionColor;e.fillRect(f.ex-((g>0)?0:-g),f.ey-((p>0)?0:-p),a,c);e.lineWidth=this.selectionLineWidth;e.strokeStyle=this.selectionBorderColor;if(this.selectionDashArray.length>1){var b=f.ex+i-((g>0)?0:a),d=f.ey+i-((p>0)?0:c);e.beginPath();fabric.util.drawDashedLine(e,b,d,b+a,d,this.selectionDashArray);fabric.util.drawDashedLine(e,b,d+c-1,b+a,d+c-1,this.selectionDashArray);fabric.util.drawDashedLine(e,b,d,b,d+c,this.selectionDashArray);fabric.util.drawDashedLine(e,b+a-1,d,b+a-1,d+c,this.selectionDashArray);e.closePath();e.stroke()}else{e.strokeRect(f.ex+i-((g>0)?0:a),f.ey+i-((p>0)?0:c),a,c)}},_isLastRenderedObject:function(a){return(this.controlsAboveOverlay&&this.lastRenderedObjectWithControlsAboveOverlay&&this.lastRenderedObjectWithControlsAboveOverlay.visible&&this.containsPoint(a,this.lastRenderedObjectWithControlsAboveOverlay)&&this.lastRenderedObjectWithControlsAboveOverlay._findTargetCorner(this.getPointer(a,true)))},findTarget:function(a,d){if(this.skipTargetFind){return}if(this._isLastRenderedObject(a)){return this.lastRenderedObjectWithControlsAboveOverlay}var c=this.getActiveGroup();if(c&&!d&&this.containsPoint(a,c)){return c}var b=this._searchPossibleTargets(a);this._fireOverOutEvents(b);return b},_fireOverOutEvents:function(a){if(a){if(this._hoveredTarget!==a){this.fire("mouse:over",{target:a});a.fire("mouseover");if(this._hoveredTarget){this.fire("mouse:out",{target:this._hoveredTarget});this._hoveredTarget.fire("mouseout")}this._hoveredTarget=a}}else{if(this._hoveredTarget){this.fire("mouse:out",{target:this._hoveredTarget});this._hoveredTarget.fire("mouseout");this._hoveredTarget=null}}},_checkTarget:function(b,c,a){if(c&&c.visible&&c.evented&&this.containsPoint(b,c)){if((this.perPixelTargetFind||c.perPixelTargetFind)&&!c.isEditing){var d=this.isTargetTransparent(c,a.x,a.y);if(!d){return true}}else{return true}}},_searchPossibleTargets:function(b){var c,a=this.getPointer(b,true),d=this._objects.length;while(d--){if(!this._objects[d].group&&this._checkTarget(b,this._objects[d],a)){this.relatedTarget=this._objects[d];c=this._objects[d];break}}return c},getPointer:function(p,b,c){if(!c){c=this.upperCanvasEl}var g=n(p,c),a=c.getBoundingClientRect(),d=a.width||0,f=a.height||0,e;if(!d||!f){if("top" in a&&"bottom" in a){f=Math.abs(a.top-a.bottom)}if("right" in a&&"left" in a){d=Math.abs(a.right-a.left)}}this.calcOffset();g.x=g.x-this._offset.left;g.y=g.y-this._offset.top;if(!b){g=fabric.util.transformPoint(g,fabric.util.invertTransform(this.viewportTransform))}if(d===0||f===0){e={width:1,height:1}}else{e={width:c.width/d,height:c.height/f}}return{x:g.x*e.width,y:g.y*e.height}},_createUpperCanvas:function(){var a=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,"");this.upperCanvasEl=this._createCanvasElement();fabric.util.addClass(this.upperCanvasEl,"upper-canvas "+a);this.wrapperEl.appendChild(this.upperCanvasEl);this._copyCanvasStyle(this.lowerCanvasEl,this.upperCanvasEl);this._applyCanvasStyle(this.upperCanvasEl);this.contextTop=this.upperCanvasEl.getContext("2d")},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement();this.cacheCanvasEl.setAttribute("width",this.width);this.cacheCanvasEl.setAttribute("height",this.height);this.contextCache=this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=fabric.util.wrapElement(this.lowerCanvasEl,"div",{"class":this.containerClass});fabric.util.setStyle(this.wrapperEl,{width:this.getWidth()+"px",height:this.getHeight()+"px",position:"relative"});fabric.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(b){var a=this.getWidth()||b.width,c=this.getHeight()||b.height;fabric.util.setStyle(b,{position:"absolute",width:a+"px",height:c+"px",left:0,top:0});b.width=a;b.height=c;fabric.util.makeElementUnselectable(b)},_copyCanvasStyle:function(a,b){b.style.cssText=a.style.cssText},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},_setActiveObject:function(a){if(this._activeObject){this._activeObject.set("active",false)}this._activeObject=a;a.set("active",true)},setActiveObject:function(b,a){this._setActiveObject(b);this.renderAll();this.fire("object:selected",{target:b,e:a});b.fire("selected",{e:a});return this},getActiveObject:function(){return this._activeObject},_discardActiveObject:function(){if(this._activeObject){this._activeObject.set("active",false)}this._activeObject=null},discardActiveObject:function(a){this._discardActiveObject();this.renderAll();this.fire("selection:cleared",{e:a});return this},_setActiveGroup:function(a){this._activeGroup=a;if(a){a.set("active",true)}},setActiveGroup:function(a,b){this._setActiveGroup(a);if(a){this.fire("object:selected",{target:a,e:b});a.fire("selected",{e:b})}return this},getActiveGroup:function(){return this._activeGroup},_discardActiveGroup:function(){var a=this.getActiveGroup();if(a){a.destroy()}this.setActiveGroup(null)},discardActiveGroup:function(a){this._discardActiveGroup();this.fire("selection:cleared",{e:a});return this},deactivateAll:function(){var b=this.getObjects(),a=0,c=b.length;for(;a<c;a++){b[a].set("active",false)}this._discardActiveGroup();this._discardActiveObject();return this},deactivateAllWithDispatch:function(a){var b=this.getActiveGroup()||this.getActiveObject();if(b){this.fire("before:selection:cleared",{target:b,e:a})}this.deactivateAll();if(b){this.fire("selection:cleared",{e:a})}return this},drawControls:function(b){var a=this.getActiveGroup();if(a){this._drawGroupControls(b,a)}else{this._drawObjectsControls(b)}},_drawGroupControls:function(b,a){a._renderControls(b)},_drawObjectsControls:function(b){for(var a=0,c=this._objects.length;a<c;++a){if(!this._objects[a]||!this._objects[a].active){continue}this._objects[a]._renderControls(b);this.lastRenderedObjectWithControlsAboveOverlay=this._objects[a]}}});for(var j in fabric.StaticCanvas){if(j!=="prototype"){fabric.Canvas[j]=fabric.StaticCanvas[j]}}if(fabric.isTouchSupported){fabric.Canvas.prototype._setCursorFromEvent=function(){}}fabric.Element=fabric.Canvas})();(function(){var e={mt:0,tr:1,mr:2,br:3,mb:4,bl:5,ml:6,tl:7},d=fabric.util.addListener,f=fabric.util.removeListener;fabric.util.object.extend(fabric.Canvas.prototype,{cursorMap:["n-resize","ne-resize","e-resize","se-resize","s-resize","sw-resize","w-resize","nw-resize"],_initEventListeners:function(){this._bindEvents();d(fabric.window,"resize",this._onResize);d(this.upperCanvasEl,"mousedown",this._onMouseDown);d(this.upperCanvasEl,"mousemove",this._onMouseMove);d(this.upperCanvasEl,"mousewheel",this._onMouseWheel);d(this.upperCanvasEl,"touchstart",this._onMouseDown);d(this.upperCanvasEl,"touchmove",this._onMouseMove);if(typeof eventjs!=="undefined"&&"add" in eventjs){eventjs.add(this.upperCanvasEl,"gesture",this._onGesture);eventjs.add(this.upperCanvasEl,"drag",this._onDrag);eventjs.add(this.upperCanvasEl,"orientation",this._onOrientationChange);eventjs.add(this.upperCanvasEl,"shake",this._onShake);eventjs.add(this.upperCanvasEl,"longpress",this._onLongPress)}},_bindEvents:function(){this._onMouseDown=this._onMouseDown.bind(this);this._onMouseMove=this._onMouseMove.bind(this);this._onMouseUp=this._onMouseUp.bind(this);this._onResize=this._onResize.bind(this);this._onGesture=this._onGesture.bind(this);this._onDrag=this._onDrag.bind(this);this._onShake=this._onShake.bind(this);this._onLongPress=this._onLongPress.bind(this);this._onOrientationChange=this._onOrientationChange.bind(this);this._onMouseWheel=this._onMouseWheel.bind(this)},removeListeners:function(){f(fabric.window,"resize",this._onResize);f(this.upperCanvasEl,"mousedown",this._onMouseDown);f(this.upperCanvasEl,"mousemove",this._onMouseMove);f(this.upperCanvasEl,"mousewheel",this._onMouseWheel);f(this.upperCanvasEl,"touchstart",this._onMouseDown);f(this.upperCanvasEl,"touchmove",this._onMouseMove);if(typeof eventjs!=="undefined"&&"remove" in eventjs){eventjs.remove(this.upperCanvasEl,"gesture",this._onGesture);eventjs.remove(this.upperCanvasEl,"drag",this._onDrag);eventjs.remove(this.upperCanvasEl,"orientation",this._onOrientationChange);eventjs.remove(this.upperCanvasEl,"shake",this._onShake);eventjs.remove(this.upperCanvasEl,"longpress",this._onLongPress)}},_onGesture:function(a,b){this.__onTransformGesture&&this.__onTransformGesture(a,b)},_onDrag:function(a,b){this.__onDrag&&this.__onDrag(a,b)},_onMouseWheel:function(a,b){this.__onMouseWheel&&this.__onMouseWheel(a,b)},_onOrientationChange:function(a,b){this.__onOrientationChange&&this.__onOrientationChange(a,b)},_onShake:function(a,b){this.__onShake&&this.__onShake(a,b)},_onLongPress:function(a,b){this.__onLongPress&&this.__onLongPress(a,b)},_onMouseDown:function(a){this.__onMouseDown(a);d(fabric.document,"touchend",this._onMouseUp);d(fabric.document,"touchmove",this._onMouseMove);f(this.upperCanvasEl,"mousemove",this._onMouseMove);f(this.upperCanvasEl,"touchmove",this._onMouseMove);if(a.type==="touchstart"){f(this.upperCanvasEl,"mousedown",this._onMouseDown)}else{d(fabric.document,"mouseup",this._onMouseUp);d(fabric.document,"mousemove",this._onMouseMove)}},_onMouseUp:function(b){this.__onMouseUp(b);f(fabric.document,"mouseup",this._onMouseUp);f(fabric.document,"touchend",this._onMouseUp);f(fabric.document,"mousemove",this._onMouseMove);f(fabric.document,"touchmove",this._onMouseMove);d(this.upperCanvasEl,"mousemove",this._onMouseMove);d(this.upperCanvasEl,"touchmove",this._onMouseMove);if(b.type==="touchend"){var a=this;setTimeout(function(){d(a.upperCanvasEl,"mousedown",a._onMouseDown)},400)}},_onMouseMove:function(a){!this.allowTouchScrolling&&a.preventDefault&&a.preventDefault();this.__onMouseMove(a)},_onResize:function(){this.calcOffset()},_shouldRender:function(b,a){var c=this.getActiveGroup()||this.getActiveObject();return !!((b&&(b.isMoving||b!==c))||(!b&&!!c)||(!b&&!c&&!this._groupSelector)||(a&&this._previousPointer&&this.selection&&(a.x!==this._previousPointer.x||a.y!==this._previousPointer.y)))},__onMouseUp:function(b){var c;if(this.isDrawingMode&&this._isCurrentlyDrawing){this._onMouseUpInDrawingMode(b);return}if(this._currentTransform){this._finalizeCurrentTransform();c=this._currentTransform.target}else{c=this.findTarget(b,true)}var a=this._shouldRender(c,this.getPointer(b));this._maybeGroupObjects(b);if(c){c.isMoving=false}a&&this.renderAll();this._handleCursorAndEvent(b,c)},_handleCursorAndEvent:function(b,c){this._setCursorFromEvent(b,c);var a=this;setTimeout(function(){a._setCursorFromEvent(b,c)},50);this.fire("mouse:up",{target:c,e:b});c&&c.fire("mouseup",{e:b})},_finalizeCurrentTransform:function(){var b=this._currentTransform,a=b.target;if(a._scaling){a._scaling=false}a.setCoords();if(this.stateful&&a.hasStateChanged()){this.fire("object:modified",{target:a});a.fire("modified")}this._restoreOriginXY(a)},_restoreOriginXY:function(a){if(this._previousOriginX&&this._previousOriginY){var b=a.translateToOriginPoint(a.getCenterPoint(),this._previousOriginX,this._previousOriginY);a.originX=this._previousOriginX;a.originY=this._previousOriginY;a.left=b.x;a.top=b.y;this._previousOriginX=null;this._previousOriginY=null}},_onMouseDownInDrawingMode:function(b){this._isCurrentlyDrawing=true;this.discardActiveObject(b).renderAll();if(this.clipTo){fabric.util.clipContext(this,this.contextTop)}var i=fabric.util.invertTransform(this.viewportTransform),a=fabric.util.transformPoint(this.getPointer(b,true),i);this.freeDrawingBrush.onMouseDown(a);this.fire("mouse:down",{e:b});var c=this.findTarget(b);if(typeof c!=="undefined"){c.fire("mousedown",{e:b,target:c})}},_onMouseMoveInDrawingMode:function(b){if(this._isCurrentlyDrawing){var i=fabric.util.invertTransform(this.viewportTransform),a=fabric.util.transformPoint(this.getPointer(b,true),i);this.freeDrawingBrush.onMouseMove(a)}this.setCursor(this.freeDrawingCursor);this.fire("mouse:move",{e:b});var c=this.findTarget(b);if(typeof c!=="undefined"){c.fire("mousemove",{e:b,target:c})}},_onMouseUpInDrawingMode:function(a){this._isCurrentlyDrawing=false;if(this.clipTo){this.contextTop.restore()}this.freeDrawingBrush.onMouseUp();this.fire("mouse:up",{e:a});var b=this.findTarget(a);if(typeof b!=="undefined"){b.fire("mouseup",{e:a,target:b})}},__onMouseDown:function(c){var m="which" in c?c.which===1:c.button===1;if(!m&&!fabric.isTouchSupported){return}if(this.isDrawingMode){this._onMouseDownInDrawingMode(c);return}if(this._currentTransform){return}var k=this.findTarget(c),a=this.getPointer(c,true);this._previousPointer=a;var b=this._shouldRender(k,a),l=this._shouldGroup(c,k);if(this._shouldClearSelection(c,k)){this._clearSelection(c,k,a)}else{if(l){this._handleGrouping(c,k);k=this.getActiveGroup()}}if(k&&k.selectable&&!l){this._beforeTransform(c,k);this._setupCurrentTransform(c,k)}b&&this.renderAll();this.fire("mouse:down",{target:k,e:c});k&&k.fire("mousedown",{e:c})},_beforeTransform:function(a,b){this.stateful&&b.saveState();if(b._findTargetCorner(this.getPointer(a))){this.onBeforeScaleRotate(b)}if(b!==this.getActiveGroup()&&b!==this.getActiveObject()){this.deactivateAll();this.setActiveObject(b,a)}},_clearSelection:function(b,c,a){this.deactivateAllWithDispatch(b);if(c&&c.selectable){this.setActiveObject(c,b)}else{if(this.selection){this._groupSelector={ex:a.x,ey:a.y,top:0,left:0}}}},_setOriginToCenter:function(a){this._previousOriginX=this._currentTransform.target.originX;this._previousOriginY=this._currentTransform.target.originY;var b=a.getCenterPoint();a.originX="center";a.originY="center";a.left=b.x;a.top=b.y;this._currentTransform.left=a.left;this._currentTransform.top=a.top},_setCenterToOrigin:function(a){var b=a.translateToOriginPoint(a.getCenterPoint(),this._previousOriginX,this._previousOriginY);a.originX=this._previousOriginX;a.originY=this._previousOriginY;a.left=b.x;a.top=b.y;this._previousOriginX=null;this._previousOriginY=null},__onMouseMove:function(b){var c,a;if(this.isDrawingMode){this._onMouseMoveInDrawingMode(b);return}if(typeof b.touches!=="undefined"&&b.touches.length>1){return}var i=this._groupSelector;if(i){a=this.getPointer(b,true);i.left=a.x-i.ex;i.top=a.y-i.ey;this.renderTop()}else{if(!this._currentTransform){c=this.findTarget(b);if(!c||c&&!c.selectable){this.setCursor(this.defaultCursor)}else{this._setCursorFromEvent(b,c)}}else{this._transformObject(b)}}this.fire("mouse:move",{target:c,e:b});c&&c.fire("mousemove",{e:b})},_transformObject:function(b){var a=this.getPointer(b),c=this._currentTransform;c.reset=false,c.target.isMoving=true;this._beforeScaleTransform(b,c);this._performTransformAction(b,c,a);this.renderAll()},_performTransformAction:function(c,n,b){var o=b.x,a=b.y,l=n.target,m=n.action;if(m==="rotate"){this._rotateObject(o,a);this._fire("rotating",l,c)}else{if(m==="scale"){this._onScale(c,n,o,a);this._fire("scaling",l,c)}else{if(m==="scaleX"){this._scaleObject(o,a,"x");this._fire("scaling",l,c)}else{if(m==="scaleY"){this._scaleObject(o,a,"y");this._fire("scaling",l,c)}else{this._translateObject(o,a);this._fire("moving",l,c);this.setCursor(this.moveCursor)}}}}},_fire:function(c,a,b){this.fire("object:"+c,{target:a,e:b});a.fire(c,{e:b})},_beforeScaleTransform:function(a,c){if(c.action==="scale"||c.action==="scaleX"||c.action==="scaleY"){var b=this._shouldCenterTransform(a,c.target);if((b&&(c.originX!=="center"||c.originY!=="center"))||(!b&&c.originX==="center"&&c.originY==="center")){this._resetCurrentTransform(a);c.reset=true}}},_onScale:function(b,c,i,a){if((b.shiftKey||this.uniScaleTransform)&&!c.target.get("lockUniScaling")){c.currentAction="scale";this._scaleObject(i,a)}else{if(!c.reset&&c.currentAction==="scale"){this._resetCurrentTransform(b,c.target)}c.currentAction="scaleEqually";this._scaleObject(i,a,"equally")}},_setCursorFromEvent:function(a,b){if(!b||!b.selectable){this.setCursor(this.defaultCursor);return false}else{var i=this.getActiveGroup(),c=b._findTargetCorner&&(!i||!i.contains(b))&&b._findTargetCorner(this.getPointer(a,true));if(!c){this.setCursor(b.hoverCursor||this.hoverCursor)}else{this._setCornerCursor(c,b)}}return true},_setCornerCursor:function(b,a){if(b in e){this.setCursor(this._getRotatedCornerCursor(b,a))}else{if(b==="mtr"&&a.hasRotatingPoint){this.setCursor(this.rotationCursor)}else{this.setCursor(this.defaultCursor);return false}}},_getRotatedCornerCursor:function(c,b){var a=Math.round((b.getAngle()%360)/45);if(a<0){a+=8}a+=e[c];a%=8;return this.cursorMap[a]}})})();(function(){var c=Math.min,d=Math.max;fabric.util.object.extend(fabric.Canvas.prototype,{_shouldGroup:function(a,b){var e=this.getActiveObject();return a.shiftKey&&(this.getActiveGroup()||(e&&e!==b))&&this.selection},_handleGrouping:function(a,b){if(b===this.getActiveGroup()){b=this.findTarget(a,true);if(!b||b.isType("group")){return}}if(this.getActiveGroup()){this._updateActiveGroup(b,a)}else{this._createActiveGroup(b,a)}if(this._activeGroup){this._activeGroup.saveCoords()}},_updateActiveGroup:function(a,b){var e=this.getActiveGroup();if(e.contains(a)){e.removeWithUpdate(a);this._resetObjectTransform(e);a.set("active",false);if(e.size()===1){this.discardActiveGroup(b);this.setActiveObject(e.item(0));return}}else{e.addWithUpdate(a);this._resetObjectTransform(e)}this.fire("selection:created",{target:e,e:b});e.set("active",true)},_createActiveGroup:function(a,b){if(this._activeObject&&a!==this._activeObject){var e=this._createGroup(a);e.addWithUpdate();this.setActiveGroup(e);this._activeObject=null;this.fire("selection:created",{target:e,e:b})}a.set("active",true)},_createGroup:function(a){var b=this.getObjects(),h=b.indexOf(this._activeObject)<b.indexOf(a),g=h?[this._activeObject,a]:[a,this._activeObject];return new fabric.Group(g,{canvas:this})},_groupSelectedObjects:function(a){var b=this._collectObjects();if(b.length===1){this.setActiveObject(b[0],a)}else{if(b.length>1){b=new fabric.Group(b.reverse(),{canvas:this});b.addWithUpdate();this.setActiveGroup(b,a);b.saveCoords();this.fire("selection:created",{target:b});this.renderAll()}}},_collectObjects:function(){var a=[],p,s=this._groupSelector.ex,i=this._groupSelector.ey,t=s+this._groupSelector.left,o=i+this._groupSelector.top,q=new fabric.Point(c(s,t),c(i,o)),n=new fabric.Point(d(s,t),d(i,o)),b=s===t&&i===o;for(var r=this._objects.length;r--;){p=this._objects[r];if(!p||!p.selectable||!p.visible){continue}if(p.intersectsWithRect(q,n)||p.isContainedWithinRect(q,n)||p.containsPoint(q)||p.containsPoint(n)){p.set("active",true);a.push(p);if(b){break}}}return a},_maybeGroupObjects:function(a){if(this.selection&&this._groupSelector){this._groupSelectedObjects(a)}var b=this.getActiveGroup();if(b){b.setObjectsCoords().setCoords();b.isMoving=false;this.setCursor(this.defaultCursor)}this._groupSelector=null;this._currentTransform=null}})})();fabric.util.object.extend(fabric.StaticCanvas.prototype,{toDataURL:function(g){g||(g={});var f=g.format||"png",h=g.quality||1,i=g.multiplier||1,j={left:g.left,top:g.top,width:g.width,height:g.height};if(i!==1){return this.__toDataURLWithMultiplier(f,h,j,i)}else{return this.__toDataURL(f,h,j)}},__toDataURL:function(k,i,j){this.renderAll(true);var g=this.upperCanvasEl||this.lowerCanvasEl,h=this.__getCroppedCanvas(g,j);if(k==="jpg"){k="jpeg"}var l=(fabric.StaticCanvas.supports("toDataURLWithQuality"))?(h||g).toDataURL("image/"+k,i):(h||g).toDataURL("image/"+k);this.contextTop&&this.clearContext(this.contextTop);this.renderAll();if(h){h=null}return l},__getCroppedCanvas:function(j,h){var f,i,g="left" in h||"top" in h||"width" in h||"height" in h;if(g){f=fabric.util.createCanvasElement();i=f.getContext("2d");f.width=h.width||this.width;f.height=h.height||this.height;i.drawImage(j,-h.left||0,-h.top||0)}return f},__toDataURLWithMultiplier:function(r,q,w,n){var p=this.getWidth(),m=this.getHeight(),t=p*n,s=m*n,x=this.getActiveObject(),v=this.getActiveGroup(),o=this.contextTop||this.contextContainer;if(n>1){this.setWidth(t).setHeight(s)}o.scale(n,n);if(w.left){w.left*=n}if(w.top){w.top*=n}if(w.width){w.width*=n}else{if(n<1){w.width=t}}if(w.height){w.height*=n}else{if(n<1){w.height=s}}if(v){this._tempRemoveBordersControlsFromGroup(v)}else{if(x&&this.deactivateAll){this.deactivateAll()}}this.renderAll(true);var u=this.__toDataURL(r,q,w);this.width=p;this.height=m;o.scale(1/n,1/n);this.setWidth(p).setHeight(m);if(v){this._restoreBordersControlsOnGroup(v)}else{if(x&&this.setActiveObject){this.setActiveObject(x)}}this.contextTop&&this.clearContext(this.contextTop);this.renderAll();return u},toDataURLWithMultiplier:function(e,f,d){return this.toDataURL({format:e,multiplier:f,quality:d})},_tempRemoveBordersControlsFromGroup:function(b){b.origHasControls=b.hasControls;b.origBorderColor=b.borderColor;b.hasControls=true;b.borderColor="rgba(0,0,0,0)";b.forEachObject(function(a){a.origBorderColor=a.borderColor;a.borderColor="rgba(0,0,0,0)"})},_restoreBordersControlsOnGroup:function(b){b.hideControls=b.origHideControls;b.borderColor=b.origBorderColor;b.forEachObject(function(a){a.borderColor=a.origBorderColor;delete a.origBorderColor})}});fabric.util.object.extend(fabric.StaticCanvas.prototype,{loadFromDatalessJSON:function(d,f,e){return this.loadFromJSON(d,f,e)},loadFromJSON:function(f,h,g){if(!f){return}var j=(typeof f==="string")?JSON.parse(f):f;this.clear();var i=this;this._enlivenObjects(j.objects,function(){i._setBgOverlay(j,h)},g);return this},_setBgOverlay:function(j,h){var i=this,f={backgroundColor:false,overlayColor:false,backgroundImage:false,overlayImage:false};if(!j.backgroundImage&&!j.overlayImage&&!j.background&&!j.overlay){h&&h();return}var g=function(){if(f.backgroundImage&&f.overlayImage&&f.backgroundColor&&f.overlayColor){i.renderAll();h&&h()}};this.__setBgOverlay("backgroundImage",j.backgroundImage,f,g);this.__setBgOverlay("overlayImage",j.overlayImage,f,g);this.__setBgOverlay("backgroundColor",j.background,f,g);this.__setBgOverlay("overlayColor",j.overlay,f,g);g()},__setBgOverlay:function(j,f,g,h){var i=this;if(!f){g[j]=true;return}if(j==="backgroundImage"||j==="overlayImage"){fabric.Image.fromObject(f,function(a){i[j]=a;g[j]=true;h&&h()})}else{this["set"+fabric.util.string.capitalize(j,true)](f,function(){g[j]=true;h&&h()})}},_enlivenObjects:function(f,h,g){var i=this;if(!f||f.length===0){h&&h();return}var j=this.renderOnAddRemove;this.renderOnAddRemove=false;fabric.util.enlivenObjects(f,function(a){a.forEach(function(b,c){i.insertAt(b,c,true)});i.renderOnAddRemove=j;h&&h()},null,g)},_toDataURL:function(d,c){this.clone(function(a){c(a.toDataURL(d))})},_toDataURLWithMultiplier:function(e,f,d){this.clone(function(a){d(a.toDataURLWithMultiplier(e,f))})},clone:function(f,e){var d=JSON.stringify(this.toJSON(e));this.cloneWithoutData(function(a){a.loadFromJSON(d,function(){f&&f(a)})})},cloneWithoutData:function(f){var e=fabric.document.createElement("canvas");e.width=this.getWidth();e.height=this.getHeight();var d=new fabric.Canvas(e);d.clipTo=this.clipTo;if(this.backgroundImage){d.setBackgroundImage(this.backgroundImage.src,function(){d.renderAll();f&&f(d)});d.backgroundImageOpacity=this.backgroundImageOpacity;d.backgroundImageStretch=this.backgroundImageStretch}else{f&&f(d)}}});(function(m){var l=m.fabric||(m.fabric={}),j=l.util.object.extend,i=l.util.toFixed,n=l.util.string.capitalize,h=l.util.degreesToRadians,k=l.StaticCanvas.supports("setLineDash");if(l.Object){return}l.Object=l.util.createClass({type:"object",originX:"left",originY:"top",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:false,flipY:false,opacity:1,angle:0,cornerSize:12,transparentCorners:true,hoverCursor:null,padding:0,borderColor:"rgba(102,153,255,0.75)",cornerColor:"rgba(102,153,255,0.5)",centeredScaling:false,centeredRotation:true,fill:"rgb(0,0,0)",fillRule:"nonzero",globalCompositeOperation:"source-over",backgroundColor:"",stroke:null,strokeWidth:1,strokeDashArray:null,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:10,shadow:null,borderOpacityWhenMoving:0.4,borderScaleFactor:1,transformMatrix:null,minScaleLimit:0.01,selectable:true,evented:true,visible:true,hasControls:true,hasBorders:true,hasRotatingPoint:true,rotatingPointOffset:40,perPixelTargetFind:false,includeDefaultValues:true,clipTo:null,lockMovementX:false,lockMovementY:false,lockRotation:false,lockScalingX:false,lockScalingY:false,lockUniScaling:false,lockScalingFlip:false,stateProperties:("top left width height scaleX scaleY flipX flipY originX originY transformMatrix stroke strokeWidth strokeDashArray strokeLineCap strokeLineJoin strokeMiterLimit angle opacity fill fillRule globalCompositeOperation shadow clipTo visible backgroundColor").split(" "),initialize:function(a){if(a){this.setOptions(a)}},_initGradient:function(a){if(a.fill&&a.fill.colorStops&&!(a.fill instanceof l.Gradient)){this.set("fill",new l.Gradient(a.fill))}},_initPattern:function(a){if(a.fill&&a.fill.source&&!(a.fill instanceof l.Pattern)){this.set("fill",new l.Pattern(a.fill))}if(a.stroke&&a.stroke.source&&!(a.stroke instanceof l.Pattern)){this.set("stroke",new l.Pattern(a.stroke))}},_initClipping:function(b){if(!b.clipTo||typeof b.clipTo!=="string"){return}var a=l.util.getFunctionBody(b.clipTo);if(typeof a!=="undefined"){this.clipTo=new Function("ctx",a)}},setOptions:function(b){for(var a in b){this.set(a,b[a])}this._initGradient(b);this._initPattern(b);this._initClipping(b)},transform:function(b,a){var c=a?this._getLeftTopCoords():this.getCenterPoint();b.translate(c.x,c.y);b.rotate(h(this.angle));b.scale(this.scaleX*(this.flipX?-1:1),this.scaleY*(this.flipY?-1:1))},toObject:function(a){var b=l.Object.NUM_FRACTION_DIGITS,c={type:this.type,originX:this.originX,originY:this.originY,left:i(this.left,b),top:i(this.top,b),width:i(this.width,b),height:i(this.height,b),fill:(this.fill&&this.fill.toObject)?this.fill.toObject():this.fill,stroke:(this.stroke&&this.stroke.toObject)?this.stroke.toObject():this.stroke,strokeWidth:i(this.strokeWidth,b),strokeDashArray:this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeMiterLimit:i(this.strokeMiterLimit,b),scaleX:i(this.scaleX,b),scaleY:i(this.scaleY,b),angle:i(this.getAngle(),b),flipX:this.flipX,flipY:this.flipY,opacity:i(this.opacity,b),shadow:(this.shadow&&this.shadow.toObject)?this.shadow.toObject():this.shadow,visible:this.visible,clipTo:this.clipTo&&String(this.clipTo),backgroundColor:this.backgroundColor,fillRule:this.fillRule,globalCompositeOperation:this.globalCompositeOperation};if(!this.includeDefaultValues){c=this._removeDefaultValues(c)}l.util.populateWithProperties(this,c,a);return c},toDatalessObject:function(a){return this.toObject(a)},_removeDefaultValues:function(b){var c=l.util.getKlass(b.type).prototype,a=c.stateProperties;a.forEach(function(d){if(b[d]===c[d]){delete b[d]}});return b},toString:function(){return"#<fabric."+n(this.type)+">"},get:function(a){return this[a]},_setObject:function(b){for(var a in b){this._set(a,b[a])}},set:function(b,a){if(typeof b==="object"){this._setObject(b)}else{if(typeof a==="function"&&b!=="clipTo"){this._set(b,a(this.get(b)))}else{this._set(b,a)}}return this},_set:function(c,b){var a=(c==="scaleX"||c==="scaleY");if(a){b=this._constrainScale(b)}if(c==="scaleX"&&b<0){this.flipX=!this.flipX;b*=-1}else{if(c==="scaleY"&&b<0){this.flipY=!this.flipY;b*=-1}else{if(c==="width"||c==="height"){this.minScaleLimit=i(Math.min(0.1,1/Math.max(this.width,this.height)),2)}else{if(c==="shadow"&&b&&!(b instanceof l.Shadow)){b=new l.Shadow(b)}}}}this[c]=b;return this},toggle:function(a){var b=this.get(a);if(typeof b==="boolean"){this.set(a,!b)}return this},setSourcePath:function(a){this.sourcePath=a;return this},getViewportTransform:function(){if(this.canvas&&this.canvas.viewportTransform){return this.canvas.viewportTransform}return[1,0,0,1,0,0]},render:function(b,a){if((this.width===0&&this.height===0)||!this.visible){return}b.save();this._setupCompositeOperation(b);if(!a){this.transform(b)}this._setStrokeStyles(b);this._setFillStyles(b);if(this.transformMatrix){b.transform.apply(b,this.transformMatrix)}this._setOpacity(b);this._setShadow(b);this.clipTo&&l.util.clipContext(this,b);this._render(b,a);this.clipTo&&b.restore();this._removeShadow(b);this._restoreCompositeOperation(b);b.restore()},_setOpacity:function(a){if(this.group){this.group._setOpacity(a)}a.globalAlpha*=this.opacity},_setStrokeStyles:function(a){if(this.stroke){a.lineWidth=this.strokeWidth;a.lineCap=this.strokeLineCap;a.lineJoin=this.strokeLineJoin;a.miterLimit=this.strokeMiterLimit;a.strokeStyle=this.stroke.toLive?this.stroke.toLive(a,this):this.stroke}},_setFillStyles:function(a){if(this.fill){a.fillStyle=this.fill.toLive?this.fill.toLive(a,this):this.fill}},_renderControls:function(c,a){if(!this.active||a){return}var b=this.getViewportTransform();c.save();var d;if(this.group){d=l.util.transformPoint(this.group.getCenterPoint(),b);c.translate(d.x,d.y);c.rotate(h(this.group.angle))}d=l.util.transformPoint(this.getCenterPoint(),b,null!=this.group);if(this.group){d.x*=this.group.scaleX;d.y*=this.group.scaleY}c.translate(d.x,d.y);c.rotate(h(this.angle));this.drawBorders(c);this.drawControls(c);c.restore()},_setShadow:function(c){if(!this.shadow){return}var a=(this.canvas&&this.canvas.viewportTransform[0])||1,b=(this.canvas&&this.canvas.viewportTransform[3])||1;c.shadowColor=this.shadow.color;c.shadowBlur=this.shadow.blur*(a+b)*(this.scaleX+this.scaleY)/4;c.shadowOffsetX=this.shadow.offsetX*a*this.scaleX;c.shadowOffsetY=this.shadow.offsetY*b*this.scaleY},_removeShadow:function(a){if(!this.shadow){return}a.shadowColor="";a.shadowBlur=a.shadowOffsetX=a.shadowOffsetY=0},_renderFill:function(b){if(!this.fill){return}b.save();if(this.fill.gradientTransform){var a=this.fill.gradientTransform;b.transform.apply(b,a)}if(this.fill.toLive){b.translate(-this.width/2+this.fill.offsetX||0,-this.height/2+this.fill.offsetY||0)}if(this.fillRule==="evenodd"){b.fill("evenodd")}else{b.fill()}b.restore();if(this.shadow&&!this.shadow.affectStroke){this._removeShadow(b)}},_renderStroke:function(b){if(!this.stroke||this.strokeWidth===0){return}b.save();if(this.strokeDashArray){if(1&this.strokeDashArray.length){this.strokeDashArray.push.apply(this.strokeDashArray,this.strokeDashArray)}if(k){b.setLineDash(this.strokeDashArray);this._stroke&&this._stroke(b)}else{this._renderDashedStroke&&this._renderDashedStroke(b)}b.stroke()}else{if(this.stroke.gradientTransform){var a=this.stroke.gradientTransform;b.transform.apply(b,a)}this._stroke?this._stroke(b):b.stroke()}this._removeShadow(b);b.restore()},clone:function(a,b){if(this.constructor.fromObject){return this.constructor.fromObject(this.toObject(b),a)}return new l.Object(this.toObject(b))},cloneAsImage:function(a){var b=this.toDataURL();l.util.loadImage(b,function(c){if(a){a(new l.Image(c))}});return this},toDataURL:function(d){d||(d={});var c=l.util.createCanvasElement(),e=this.getBoundingRect();c.width=e.width;c.height=e.height;l.util.wrapElement(c,"div");var f=new l.StaticCanvas(c);if(d.format==="jpg"){d.format="jpeg"}if(d.format==="jpeg"){f.backgroundColor="#fff"}var a={active:this.get("active"),left:this.getLeft(),top:this.getTop()};this.set("active",false);this.setPositionByOrigin(new l.Point(c.width/2,c.height/2),"center","center");var g=this.canvas;f.add(this);var b=f.toDataURL(d);this.set(a).setCoords();this.canvas=g;f.dispose();f=null;return b},isType:function(a){return this.type===a},complexity:function(){return 0},toJSON:function(a){return this.toObject(a)},setGradient:function(b,c){c||(c={});var a={colorStops:[]};a.type=c.type||(c.r1||c.r2?"radial":"linear");a.coords={x1:c.x1,y1:c.y1,x2:c.x2,y2:c.y2};if(c.r1||c.r2){a.coords.r1=c.r1;a.coords.r2=c.r2}for(var e in c.colorStops){var d=new l.Color(c.colorStops[e]);a.colorStops.push({offset:e,color:d.toRgb(),opacity:d.getAlpha()})}return this.set(b,l.Gradient.forObject(this,a))},setPatternFill:function(a){return this.set("fill",new l.Pattern(a))},setShadow:function(a){return this.set("shadow",a?new l.Shadow(a):null)},setColor:function(a){this.set("fill",a);return this},setAngle:function(a){var b=(this.originX!=="center"||this.originY!=="center")&&this.centeredRotation;if(b){this._setOriginToCenter()}this.set("angle",a);if(b){this._resetOrigin()}return this},centerH:function(){this.canvas.centerObjectH(this);return this},centerV:function(){this.canvas.centerObjectV(this);return this},center:function(){this.canvas.centerObject(this);return this},remove:function(){this.canvas.remove(this);return this},getLocalPointer:function(c,b){b=b||this.canvas.getPointer(c);var a=this.translateToOriginPoint(this.getCenterPoint(),"left","top");return{x:b.x-a.x,y:b.y-a.y}},_setupCompositeOperation:function(a){if(this.globalCompositeOperation){this._prevGlobalCompositeOperation=a.globalCompositeOperation;a.globalCompositeOperation=this.globalCompositeOperation}},_restoreCompositeOperation:function(a){if(this.globalCompositeOperation&&this._prevGlobalCompositeOperation){a.globalCompositeOperation=this._prevGlobalCompositeOperation}}});l.util.createAccessors(l.Object);l.Object.prototype.rotate=l.Object.prototype.setAngle;j(l.Object.prototype,l.Observable);l.Object.NUM_FRACTION_DIGITS=2;l.Object.__uid=0})(typeof exports!=="undefined"?exports:this);(function(){var b=fabric.util.degreesToRadians;fabric.util.object.extend(fabric.Object.prototype,{translateToCenterPoint:function(l,j,k){var a=l.x,h=l.y,i=this.stroke?this.strokeWidth:0;if(j==="left"){a=l.x+(this.getWidth()+i*this.scaleX)/2}else{if(j==="right"){a=l.x-(this.getWidth()+i*this.scaleX)/2}}if(k==="top"){h=l.y+(this.getHeight()+i*this.scaleY)/2}else{if(k==="bottom"){h=l.y-(this.getHeight()+i*this.scaleY)/2}}return fabric.util.rotatePoint(new fabric.Point(a,h),l,b(this.angle))},translateToOriginPoint:function(l,j,k){var a=l.x,h=l.y,i=this.stroke?this.strokeWidth:0;if(j==="left"){a=l.x-(this.getWidth()+i*this.scaleX)/2}else{if(j==="right"){a=l.x+(this.getWidth()+i*this.scaleX)/2}}if(k==="top"){h=l.y-(this.getHeight()+i*this.scaleY)/2}else{if(k==="bottom"){h=l.y+(this.getHeight()+i*this.scaleY)/2}}return fabric.util.rotatePoint(new fabric.Point(a,h),l,b(this.angle))},getCenterPoint:function(){var a=new fabric.Point(this.left,this.top);return this.translateToCenterPoint(a,this.originX,this.originY)},getPointByOrigin:function(e,f){var a=this.getCenterPoint();return this.translateToOriginPoint(a,e,f)},toLocalPoint:function(m,k,l){var n=this.getCenterPoint(),i=this.stroke?this.strokeWidth:0,a,j;if(k&&l){if(k==="left"){a=n.x-(this.getWidth()+i*this.scaleX)/2}else{if(k==="right"){a=n.x+(this.getWidth()+i*this.scaleX)/2}else{a=n.x}}if(l==="top"){j=n.y-(this.getHeight()+i*this.scaleY)/2}else{if(l==="bottom"){j=n.y+(this.getHeight()+i*this.scaleY)/2}else{j=n.y}}}else{a=this.left;j=this.top}return fabric.util.rotatePoint(new fabric.Point(m.x,m.y),n,-b(this.angle)).subtractEquals(new fabric.Point(a,j))},setPositionByOrigin:function(g,h,i){var j=this.translateToCenterPoint(g,h,i),a=this.translateToOriginPoint(j,this.originX,this.originY);this.set("left",a.x);this.set("top",a.y)},adjustPosition:function(j){var l=b(this.angle),k=this.getWidth()/2,m=Math.cos(l)*k,p=Math.sin(l)*k,n=this.getWidth(),o=Math.cos(l)*n,a=Math.sin(l)*n;if(this.originX==="center"&&j==="left"||this.originX==="right"&&j==="center"){this.left-=m;this.top-=p}else{if(this.originX==="left"&&j==="center"||this.originX==="center"&&j==="right"){this.left+=m;this.top+=p}else{if(this.originX==="left"&&j==="right"){this.left+=o;this.top+=a}else{if(this.originX==="right"&&j==="left"){this.left-=o;this.top-=a}}}}this.setCoords();this.originX=j},_setOriginToCenter:function(){this._originalOriginX=this.originX;this._originalOriginY=this.originY;var a=this.getCenterPoint();this.originX="center";this.originY="center";this.left=a.x;this.top=a.y},_resetOrigin:function(){var a=this.translateToOriginPoint(this.getCenterPoint(),this._originalOriginX,this._originalOriginY);this.originX=this._originalOriginX;this.originY=this._originalOriginY;this.left=a.x;this.top=a.y;this._originalOriginX=null;this._originalOriginY=null},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),"left","center")}})})();(function(){var b=fabric.util.degreesToRadians;fabric.util.object.extend(fabric.Object.prototype,{oCoords:null,intersectsWithRect:function(p,n){var j=this.oCoords,a=new fabric.Point(j.tl.x,j.tl.y),m=new fabric.Point(j.tr.x,j.tr.y),k=new fabric.Point(j.bl.x,j.bl.y),o=new fabric.Point(j.br.x,j.br.y),l=fabric.Intersection.intersectPolygonRectangle([a,m,o,k],p,n);return l.status==="Intersection"},intersectsWithObject:function(a){function j(c){return{tl:new fabric.Point(c.tl.x,c.tl.y),tr:new fabric.Point(c.tr.x,c.tr.y),bl:new fabric.Point(c.bl.x,c.bl.y),br:new fabric.Point(c.br.x,c.br.y)}}var i=j(this.oCoords),g=j(a.oCoords),h=fabric.Intersection.intersectPolygonPolygon([i.tl,i.tr,i.br,i.bl],[g.tl,g.tr,g.br,g.bl]);return h.status==="Intersection"},isContainedWithinObject:function(a){var h=a.getBoundingRect(),f=new fabric.Point(h.left,h.top),g=new fabric.Point(h.left+h.width,h.top+h.height);return this.isContainedWithinRect(f,g)},isContainedWithinRect:function(a,e){var f=this.getBoundingRect();return(f.left>=a.x&&f.left+f.width<=e.x&&f.top>=a.y&&f.top+f.height<=e.y)},containsPoint:function(a){var e=this._getImageLines(this.oCoords),f=this._findCrossPoints(a,e);return(f!==0&&f%2===1)},_getImageLines:function(a){return{topline:{o:a.tl,d:a.tr},rightline:{o:a.tr,d:a.br},bottomline:{o:a.br,d:a.bl},leftline:{o:a.bl,d:a.tl}}},_findCrossPoints:function(m,v){var n,o,t,u,p,q,r=0,s;for(var a in v){s=v[a];if((s.o.y<m.y)&&(s.d.y<m.y)){continue}if((s.o.y>=m.y)&&(s.d.y>=m.y)){continue}if((s.o.x===s.d.x)&&(s.o.x>=m.x)){p=s.o.x;q=m.y}else{n=0;o=(s.d.y-s.o.y)/(s.d.x-s.o.x);t=m.y-n*m.x;u=s.o.y-o*s.o.x;p=-(t-u)/(n-o);q=t+n*p}if(p>=m.x){r+=1}if(r===2){break}}return r},getBoundingRectWidth:function(){return this.getBoundingRect().width},getBoundingRectHeight:function(){return this.getBoundingRect().height},getBoundingRect:function(){this.oCoords||this.setCoords();var o=[this.oCoords.tl.x,this.oCoords.tr.x,this.oCoords.br.x,this.oCoords.bl.x],p=fabric.util.array.min(o),k=fabric.util.array.max(o),m=Math.abs(p-k),n=[this.oCoords.tl.y,this.oCoords.tr.y,this.oCoords.br.y,this.oCoords.bl.y],j=fabric.util.array.min(n),l=fabric.util.array.max(n),a=Math.abs(j-l);return{left:p,top:j,width:m,height:a}},getWidth:function(){return this.width*this.scaleX},getHeight:function(){return this.height*this.scaleY},_constrainScale:function(a){if(Math.abs(a)<this.minScaleLimit){if(a<0){return -this.minScaleLimit}else{return this.minScaleLimit}}return a},scale:function(a){a=this._constrainScale(a);if(a<0){this.flipX=!this.flipX;this.flipY=!this.flipY;a*=-1}this.scaleX=a;this.scaleY=a;this.setCoords();return this},scaleToWidth:function(d){var a=this.getBoundingRectWidth()/this.getWidth();return this.scale(d/this.width/a)},scaleToHeight:function(d){var a=this.getBoundingRectHeight()/this.getHeight();return this.scale(d/this.height/a)},setCoords:function(){var Q=b(this.angle),I=this.getViewportTransform(),p=function(c){return fabric.util.transformPoint(c,I)},J=this._calculateCurrentDimensions(false),O=J.x,U=J.y;if(O<0){O=Math.abs(O)}var N=Math.sqrt(Math.pow(O/2,2)+Math.pow(U/2,2)),P=Math.atan(isFinite(U/O)?U/O:0),a=Math.cos(P+Q)*N,f=Math.sin(P+Q)*N,C=Math.sin(Q),M=Math.cos(Q),E=this.getCenterPoint(),S=new fabric.Point(O,U),F=new fabric.Point(E.x-a,E.y-f),L=new fabric.Point(F.x+(S.x*M),F.y+(S.x*C)),V=p(new fabric.Point(F.x-(S.y*C),F.y+(S.y*M))),K=p(new fabric.Point(L.x-(S.y*C),L.y+(S.y*M))),T=p(F),W=p(L),D=new fabric.Point((T.x+V.x)/2,(T.y+V.y)/2),H=new fabric.Point((W.x+T.x)/2,(W.y+T.y)/2),G=new fabric.Point((K.x+W.x)/2,(K.y+W.y)/2),X=new fabric.Point((K.x+V.x)/2,(K.y+V.y)/2),R=new fabric.Point(H.x+C*this.rotatingPointOffset,H.y-M*this.rotatingPointOffset);this.oCoords={tl:T,tr:W,br:K,bl:V,ml:D,mt:H,mr:G,mb:X,mtr:R};this._setCornerCoords&&this._setCornerCoords();return this}})})();fabric.util.object.extend(fabric.Object.prototype,{sendToBack:function(){if(this.group){fabric.StaticCanvas.prototype.sendToBack.call(this.group,this)}else{this.canvas.sendToBack(this)}return this},bringToFront:function(){if(this.group){fabric.StaticCanvas.prototype.bringToFront.call(this.group,this)}else{this.canvas.bringToFront(this)}return this},sendBackwards:function(b){if(this.group){fabric.StaticCanvas.prototype.sendBackwards.call(this.group,this,b)}else{this.canvas.sendBackwards(this,b)}return this},bringForward:function(b){if(this.group){fabric.StaticCanvas.prototype.bringForward.call(this.group,this,b)}else{this.canvas.bringForward(this,b)}return this},moveTo:function(b){if(this.group){fabric.StaticCanvas.prototype.moveTo.call(this.group,this,b)}else{this.canvas.moveTo(this,b)}return this}});fabric.util.object.extend(fabric.Object.prototype,{getSvgStyles:function(){var n=this.fill?(this.fill.toLive?"url(#SVGID_"+this.fill.id+")":this.fill):"none",s=this.fillRule,m=this.stroke?(this.stroke.toLive?"url(#SVGID_"+this.stroke.id+")":this.stroke):"none",o=this.strokeWidth?this.strokeWidth:"0",p=this.strokeDashArray?this.strokeDashArray.join(" "):"",l=this.strokeLineCap?this.strokeLineCap:"butt",r=this.strokeLineJoin?this.strokeLineJoin:"miter",t=this.strokeMiterLimit?this.strokeMiterLimit:"4",q=typeof this.opacity!=="undefined"?this.opacity:"1",v=this.visible?"":" visibility: hidden;",u=this.shadow?"filter: url(#SVGID_"+this.shadow.id+");":"";return["stroke: ",m,"; ","stroke-width: ",o,"; ","stroke-dasharray: ",p,"; ","stroke-linecap: ",l,"; ","stroke-linejoin: ",r,"; ","stroke-miterlimit: ",t,"; ","fill: ",n,"; ","fill-rule: ",s,"; ","opacity: ",q,";",u,v].join("")},getSvgTransform:function(){if(this.group&&this.group.type==="path-group"){return""}var w=fabric.util.toFixed,t=this.getAngle(),q=!this.canvas||this.canvas.svgViewportTransformation?this.getViewportTransform():[1,0,0,1,0,0],x=fabric.util.transformPoint(this.getCenterPoint(),q),m=fabric.Object.NUM_FRACTION_DIGITS,s=this.type==="path-group"?"":"translate("+w(x.x,m)+" "+w(x.y,m)+")",n=t!==0?(" rotate("+w(t,m)+")"):"",r=(this.scaleX===1&&this.scaleY===1&&q[0]===1&&q[3]===1)?"":(" scale("+w(this.scaleX*q[0],m)+" "+w(this.scaleY*q[3],m)+")"),u=this.type==="path-group"?this.width*q[0]:0,o=this.flipX?" matrix(-1 0 0 1 "+u+" 0) ":"",v=this.type==="path-group"?this.height*q[3]:0,p=this.flipY?" matrix(1 0 0 -1 0 "+v+")":"";return[s,n,r,o,p].join("")},getSvgTransformMatrix:function(){return this.transformMatrix?" matrix("+this.transformMatrix.join(" ")+") ":""},_createBaseSVGMarkup:function(){var b=[];if(this.fill&&this.fill.toLive){b.push(this.fill.toSVG(this,false))}if(this.stroke&&this.stroke.toLive){b.push(this.stroke.toSVG(this,false))}if(this.shadow){b.push(this.shadow.toSVG(this))}return b}});fabric.util.object.extend(fabric.Object.prototype,{hasStateChanged:function(){return this.stateProperties.some(function(b){return this.get(b)!==this.originalState[b]},this)},saveState:function(b){this.stateProperties.forEach(function(a){this.originalState[a]=this.get(a)},this);if(b&&b.stateProperties){b.stateProperties.forEach(function(a){this.originalState[a]=this.get(a)},this)}return this},setupState:function(){this.originalState={};this.saveState();return this}});(function(){var d=fabric.util.degreesToRadians,c=function(){return typeof G_vmlCanvasManager!=="undefined"};fabric.util.object.extend(fabric.Object.prototype,{_controlsVisibility:null,_findTargetCorner:function(a){if(!this.hasControls||!this.active){return false}var b=a.x,j=a.y,k,l;for(var i in this.oCoords){if(!this.isControlVisible(i)){continue}if(i==="mtr"&&!this.hasRotatingPoint){continue}if(this.get("lockUniScaling")&&(i==="mt"||i==="mr"||i==="mb"||i==="ml")){continue}l=this._getImageLines(this.oCoords[i].corner);k=this._findCrossPoints({x:b,y:j},l);if(k!==0&&k%2===1){this.__corner=i;return i}}return false},_setCornerCoords:function(){var b=this.oCoords,l=d(45-this.angle),k=Math.sqrt(2*Math.pow(this.cornerSize,2))/2,n=k*Math.cos(l),m=k*Math.sin(l),o,a;for(var p in b){o=b[p].x;a=b[p].y;b[p].corner={tl:{x:o-m,y:a-n},tr:{x:o+n,y:a-m},bl:{x:o-n,y:a+m},br:{x:o+m,y:a+n}}}},_calculateCurrentDimensions:function(u){var h=this.getViewportTransform(),b=this.strokeWidth,a=this.width,q=this.height,o=this.strokeLineCap==="round"||this.strokeLineCap==="square",v=this.type==="line"&&this.width===0,s=this.type==="line"&&this.height===0,r=v||s,p=(o&&s)||!r,t=(o&&v)||!r;if(v){a=b}else{if(s){q=b}}if(p){a+=(a<0?-b:b)}if(t){q+=(q<0?-b:b)}a=a*this.scaleX+2*this.padding;q=q*this.scaleY+2*this.padding;if(u){return fabric.util.transformPoint(new fabric.Point(a,q),h,true)}return{x:a,y:q}},drawBorders:function(h){if(!this.hasBorders){return this}h.save();h.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1;h.strokeStyle=this.borderColor;h.lineWidth=1/this.borderScaleFactor;var i=this._calculateCurrentDimensions(true),b=i.x,j=i.y;if(this.group){b=b*this.group.scaleX;j=j*this.group.scaleY}h.strokeRect(~~(-(b/2))-0.5,~~(-(j/2))-0.5,~~(b)+1,~~(j)+1);if(this.hasRotatingPoint&&this.isControlVisible("mtr")&&!this.get("lockRotation")&&this.hasControls){var a=-j/2;h.beginPath();h.moveTo(0,a);h.lineTo(0,a-this.rotatingPointOffset);h.closePath();h.stroke()}h.restore();return this},drawControls:function(m){if(!this.hasControls){return this}var n=this._calculateCurrentDimensions(true),k=n.x,o=n.y,a=-(k/2),b=-(o/2),p=this.cornerSize/2,l=this.transparentCorners?"strokeRect":"fillRect";m.save();m.lineWidth=1;m.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1;m.strokeStyle=m.fillStyle=this.cornerColor;this._drawControl("tl",m,l,a-p,b-p);this._drawControl("tr",m,l,a+k-p,b-p);this._drawControl("bl",m,l,a-p,b+o-p);this._drawControl("br",m,l,a+k-p,b+o-p);if(!this.get("lockUniScaling")){this._drawControl("mt",m,l,a+k/2-p,b-p);this._drawControl("mb",m,l,a+k/2-p,b+o-p);this._drawControl("mr",m,l,a+k-p,b+o/2-p);this._drawControl("ml",m,l,a-p,b+o/2-p)}if(this.hasRotatingPoint){this._drawControl("mtr",m,l,a+k/2-p,b-this.rotatingPointOffset-p)}m.restore();return this},_drawControl:function(a,l,k,b,i){if(!this.isControlVisible(a)){return}var j=this.cornerSize;c()||this.transparentCorners||l.clearRect(b,i,j,j);l[k](b,i,j,j)},isControlVisible:function(a){return this._getControlsVisibility()[a]},setControlVisible:function(b,a){this._getControlsVisibility()[b]=a;return this},setControlsVisibility:function(b){b||(b={});for(var a in b){this.setControlVisible(a,b[a])}return this},_getControlsVisibility:function(){if(!this._controlsVisibility){this._controlsVisibility={tl:true,tr:true,br:true,bl:true,ml:true,mt:true,mr:true,mb:true,mtr:true}}return this._controlsVisibility}})})();fabric.util.object.extend(fabric.StaticCanvas.prototype,{FX_DURATION:500,fxCenterObjectH:function(g,l){l=l||{};var k=function(){},j=l.onComplete||k,h=l.onChange||k,i=this;fabric.util.animate({startValue:g.get("left"),endValue:this.getCenter().left,duration:this.FX_DURATION,onChange:function(a){g.set("left",a);i.renderAll();h()},onComplete:function(){g.setCoords();j()}});return this},fxCenterObjectV:function(g,l){l=l||{};var k=function(){},j=l.onComplete||k,h=l.onChange||k,i=this;fabric.util.animate({startValue:g.get("top"),endValue:this.getCenter().top,duration:this.FX_DURATION,onChange:function(a){g.set("top",a);i.renderAll();h()},onComplete:function(){g.setCoords();j()}});return this},fxRemove:function(g,l){l=l||{};var k=function(){},j=l.onComplete||k,h=l.onChange||k,i=this;fabric.util.animate({startValue:g.get("opacity"),endValue:0,duration:this.FX_DURATION,onStart:function(){g.set("active",false)},onChange:function(a){g.set("opacity",a);i.renderAll();h()},onComplete:function(){i.remove(g);j()}});return this}});fabric.util.object.extend(fabric.Object.prototype,{animate:function(){if(arguments[0]&&typeof arguments[0]==="object"){var h=[],i,f;for(i in arguments[0]){h.push(i)}for(var j=0,g=h.length;j<g;j++){i=h[j];f=j!==g-1;this._animate(i,arguments[0][i],arguments[1],f)}}else{this._animate.apply(this,arguments)}return this},_animate:function(l,j,n,i){var k=this,h;j=j.toString();if(!n){n={}}else{n=fabric.util.object.clone(n)}if(~l.indexOf(".")){h=l.split(".")}var m=h?this.get(h[0])[h[1]]:this.get(l);if(!("from" in n)){n.from=m}if(~j.indexOf("=")){j=m+parseFloat(j.replace("=",""))}else{j=parseFloat(j)}fabric.util.animate({startValue:n.from,endValue:j,byValue:n.by,easing:n.easing,duration:n.duration,abort:n.abort&&function(){return n.abort.call(k)},onChange:function(a){if(h){k[h[0]][h[1]]=a}else{k.set(l,a)}if(i){return}n.onChange&&n.onChange()},onComplete:function(){if(i){return}k.setCoords();n.onComplete&&n.onComplete()}})}});(function(g){var l=g.fabric||(g.fabric={}),i=l.util.object.extend,h={x1:1,x2:1,y1:1,y2:1},k=l.StaticCanvas.supports("setLineDash");if(l.Line){l.warn("fabric.Line is already defined");return}l.Line=l.util.createClass(l.Object,{type:"line",x1:0,y1:0,x2:0,y2:0,initialize:function(a,b){b=b||{};if(!a){a=[0,0,0,0]}this.callSuper("initialize",b);this.set("x1",a[0]);this.set("y1",a[1]);this.set("x2",a[2]);this.set("y2",a[3]);this._setWidthHeight(b)},_setWidthHeight:function(a){a||(a={});this.width=Math.abs(this.x2-this.x1);this.height=Math.abs(this.y2-this.y1);this.left="left" in a?a.left:this._getLeftToOriginX();this.top="top" in a?a.top:this._getTopToOriginY()},_set:function(b,a){this.callSuper("_set",b,a);if(typeof h[b]!=="undefined"){this._setWidthHeight()}return this},_getLeftToOriginX:j({origin:"originX",axis1:"x1",axis2:"x2",dimension:"width"},{nearest:"left",center:"center",farthest:"right"}),_getTopToOriginY:j({origin:"originY",axis1:"y1",axis2:"y2",dimension:"height"},{nearest:"top",center:"center",farthest:"bottom"}),_render:function(e,b){e.beginPath();if(b){var c=this.getCenterPoint();e.translate(c.x-this.strokeWidth/2,c.y-this.strokeWidth/2)}if(!this.strokeDashArray||this.strokeDashArray&&k){var d=this.calcLinePoints();e.moveTo(d.x1,d.y1);e.lineTo(d.x2,d.y2)}e.lineWidth=this.strokeWidth;var a=e.strokeStyle;e.strokeStyle=this.stroke||e.fillStyle;this.stroke&&this._renderStroke(e);e.strokeStyle=a},_renderDashedStroke:function(b){var a=this.calcLinePoints();b.beginPath();l.util.drawDashedLine(b,a.x1,a.y1,a.x2,a.y2,this.strokeDashArray);b.closePath()},toObject:function(a){return i(this.callSuper("toObject",a),this.calcLinePoints())},calcLinePoints:function(){var a=this.x1<=this.x2?-1:1,b=this.y1<=this.y2?-1:1,e=(a*this.width*0.5),c=(b*this.height*0.5),f=(a*this.width*-0.5),d=(b*this.height*-0.5);return{x1:e,x2:f,y1:c,y2:d}},toSVG:function(c){var b=this._createBaseSVGMarkup(),a={x1:this.x1,x2:this.x2,y1:this.y1,y2:this.y2};if(!(this.group&&this.group.type==="path-group")){a=this.calcLinePoints()}b.push("<line ",'x1="',a.x1,'" y1="',a.y1,'" x2="',a.x2,'" y2="',a.y2,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'"/>\n');return c?c(b.join("")):b.join("")},complexity:function(){return 1}});l.Line.ATTRIBUTE_NAMES=l.SHARED_ATTRIBUTES.concat("x1 y1 x2 y2".split(" "));l.Line.fromElement=function(c,d){var a=l.parseAttributes(c,l.Line.ATTRIBUTE_NAMES),b=[a.x1||0,a.y1||0,a.x2||0,a.y2||0];return new l.Line(b,i(a,d))};l.Line.fromObject=function(b){var a=[b.x1,b.y1,b.x2,b.y2];return new l.Line(a,b)};function j(q,c){var e=q.origin,b=q.axis1,d=q.axis2,f=q.dimension,p=c.nearest,r=c.center,a=c.farthest;return function(){switch(this.get(e)){case p:return Math.min(this.get(b),this.get(d));case r:return Math.min(this.get(b),this.get(d))+(0.5*this.get(f));case a:return Math.max(this.get(b),this.get(d))}}}})(typeof exports!=="undefined"?exports:this);(function(g){var f=g.fabric||(g.fabric={}),i=Math.PI,h=f.util.object.extend;if(f.Circle){f.warn("fabric.Circle is already defined.");return}f.Circle=f.util.createClass(f.Object,{type:"circle",radius:0,startAngle:0,endAngle:i*2,initialize:function(a){a=a||{};this.callSuper("initialize",a);this.set("radius",a.radius||0);this.startAngle=a.startAngle||this.startAngle;this.endAngle=a.endAngle||this.endAngle},_set:function(b,a){this.callSuper("_set",b,a);if(b==="radius"){this.setRadius(a)}return this},toObject:function(a){return h(this.callSuper("toObject",a),{radius:this.get("radius"),startAngle:this.startAngle,endAngle:this.endAngle})},toSVG:function(p){var b=this._createBaseSVGMarkup(),e=0,q=0,t=(this.endAngle-this.startAngle)%(2*i);if(t===0){if(this.group&&this.group.type==="path-group"){e=this.left+this.radius;q=this.top+this.radius}b.push("<circle ",'cx="'+e+'" cy="'+q+'" ','r="',this.radius,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform()," ",this.getSvgTransformMatrix(),'"/>\n')}else{var r=Math.cos(this.startAngle)*this.radius,s=Math.sin(this.startAngle)*this.radius,c=Math.cos(this.endAngle)*this.radius,d=Math.sin(this.endAngle)*this.radius,a=t>i?"1":"0";b.push('<path d="M '+r+" "+s," A "+this.radius+" "+this.radius," 0 ",+a+" 1"," "+c+" "+d,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform()," ",this.getSvgTransformMatrix(),'"/>\n')}return p?p(b.join("")):b.join("")},_render:function(b,a){b.beginPath();b.arc(a?this.left+this.radius:0,a?this.top+this.radius:0,this.radius,this.startAngle,this.endAngle,false);this._renderFill(b);this._renderStroke(b)},getRadiusX:function(){return this.get("radius")*this.get("scaleX")},getRadiusY:function(){return this.get("radius")*this.get("scaleY")},setRadius:function(a){this.radius=a;this.set("width",a*2).set("height",a*2)},complexity:function(){return 1}});f.Circle.ATTRIBUTE_NAMES=f.SHARED_ATTRIBUTES.concat("cx cy r".split(" "));f.Circle.fromElement=function(c,d){d||(d={});var b=f.parseAttributes(c,f.Circle.ATTRIBUTE_NAMES);if(!j(b)){throw new Error("value of `r` attribute is required and can not be negative")}b.left=b.left||0;b.top=b.top||0;var a=new f.Circle(h(b,d));a.left-=a.radius;a.top-=a.radius;return a};function j(a){return(("radius" in a)&&(a.radius>=0))}f.Circle.fromObject=function(a){return new f.Circle(a)}})(typeof exports!=="undefined"?exports:this);(function(d){var c=d.fabric||(d.fabric={});if(c.Triangle){c.warn("fabric.Triangle is already defined");return}c.Triangle=c.util.createClass(c.Object,{type:"triangle",initialize:function(a){a=a||{};this.callSuper("initialize",a);this.set("width",a.width||100).set("height",a.height||100)},_render:function(f){var b=this.width/2,a=this.height/2;f.beginPath();f.moveTo(-b,a);f.lineTo(0,-a);f.lineTo(b,a);f.closePath();this._renderFill(f);this._renderStroke(f)},_renderDashedStroke:function(f){var b=this.width/2,a=this.height/2;f.beginPath();c.util.drawDashedLine(f,-b,a,0,-a,this.strokeDashArray);c.util.drawDashedLine(f,0,-a,b,a,this.strokeDashArray);c.util.drawDashedLine(f,b,a,-b,a,this.strokeDashArray);f.closePath()},toSVG:function(j){var i=this._createBaseSVGMarkup(),h=this.width/2,b=this.height/2,a=[-h+" "+b,"0 "+-b,h+" "+b].join(",");i.push("<polygon ",'points="',a,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>');return j?j(i.join("")):i.join("")},complexity:function(){return 1}});c.Triangle.fromObject=function(a){return new c.Triangle(a)}})(typeof exports!=="undefined"?exports:this);(function(f){var e=f.fabric||(f.fabric={}),h=Math.PI*2,g=e.util.object.extend;if(e.Ellipse){e.warn("fabric.Ellipse is already defined.");return}e.Ellipse=e.util.createClass(e.Object,{type:"ellipse",rx:0,ry:0,initialize:function(a){a=a||{};this.callSuper("initialize",a);this.set("rx",a.rx||0);this.set("ry",a.ry||0)},_set:function(b,a){this.callSuper("_set",b,a);switch(b){case"rx":this.rx=a;this.set("width",a*2);break;case"ry":this.ry=a;this.set("height",a*2);break}return this},getRx:function(){return this.get("rx")*this.get("scaleX")},getRy:function(){return this.get("ry")*this.get("scaleY")},toObject:function(a){return g(this.callSuper("toObject",a),{rx:this.get("rx"),ry:this.get("ry")})},toSVG:function(c){var b=this._createBaseSVGMarkup(),d=0,a=0;if(this.group&&this.group.type==="path-group"){d=this.left+this.rx;a=this.top+this.ry}b.push("<ellipse ",'cx="',d,'" cy="',a,'" ','rx="',this.rx,'" ry="',this.ry,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'"/>\n');return c?c(b.join("")):b.join("")},_render:function(b,a){b.beginPath();b.save();b.transform(1,0,0,this.ry/this.rx,0,0);b.arc(a?this.left+this.rx:0,a?(this.top+this.ry)*this.rx/this.ry:0,this.rx,0,h,false);b.restore();this._renderFill(b);this._renderStroke(b)},complexity:function(){return 1}});e.Ellipse.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat("cx cy rx ry".split(" "));e.Ellipse.fromElement=function(c,d){d||(d={});var a=e.parseAttributes(c,e.Ellipse.ATTRIBUTE_NAMES);a.left=a.left||0;a.top=a.top||0;var b=new e.Ellipse(g(a,d));b.top-=b.ry;b.left-=b.rx;return b};e.Ellipse.fromObject=function(a){return new e.Ellipse(a)}})(typeof exports!=="undefined"?exports:this);(function(f){var e=f.fabric||(f.fabric={}),g=e.util.object.extend;if(e.Rect){console.warn("fabric.Rect is already defined");return}var h=e.Object.prototype.stateProperties.concat();h.push("rx","ry","x","y");e.Rect=e.util.createClass(e.Object,{stateProperties:h,type:"rect",rx:0,ry:0,strokeDashArray:null,initialize:function(a){a=a||{};this.callSuper("initialize",a);this._initRxRy()},_initRxRy:function(){if(this.rx&&!this.ry){this.ry=this.rx}else{if(this.ry&&!this.rx){this.rx=this.ry}}},_render:function(a,s){if(this.width===1&&this.height===1){a.fillRect(0,0,1,1);return}var t=this.rx?Math.min(this.rx,this.width/2):0,u=this.ry?Math.min(this.ry,this.height/2):0,b=this.width,q=this.height,c=s?this.left:-this.width/2,d=s?this.top:-this.height/2,k=t!==0||u!==0,r=1-0.5522847498;a.beginPath();a.moveTo(c+t,d);a.lineTo(c+b-t,d);k&&a.bezierCurveTo(c+b-r*t,d,c+b,d+r*u,c+b,d+u);a.lineTo(c+b,d+q-u);k&&a.bezierCurveTo(c+b,d+q-r*u,c+b-r*t,d+q,c+b-t,d+q);a.lineTo(c+t,d+q);k&&a.bezierCurveTo(c+r*t,d+q,c,d+q-r*u,c,d+q-u);a.lineTo(c,d+u);k&&a.bezierCurveTo(c,d+r*u,c+r*t,d,c+t,d);a.closePath();this._renderFill(a);this._renderStroke(a)},_renderDashedStroke:function(c){var k=-this.width/2,a=-this.height/2,d=this.width,b=this.height;c.beginPath();e.util.drawDashedLine(c,k,a,k+d,a,this.strokeDashArray);e.util.drawDashedLine(c,k+d,a,k+d,a+b,this.strokeDashArray);e.util.drawDashedLine(c,k+d,a+b,k,a+b,this.strokeDashArray);e.util.drawDashedLine(c,k,a+b,k,a,this.strokeDashArray);c.closePath()},toObject:function(a){var b=g(this.callSuper("toObject",a),{rx:this.get("rx")||0,ry:this.get("ry")||0});if(!this.includeDefaultValues){this._removeDefaultValues(b)}return b},toSVG:function(c){var b=this._createBaseSVGMarkup(),d=this.left,a=this.top;if(!(this.group&&this.group.type==="path-group")){d=-this.width/2;a=-this.height/2}b.push("<rect ",'x="',d,'" y="',a,'" rx="',this.get("rx"),'" ry="',this.get("ry"),'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'"/>\n');return c?c(b.join("")):b.join("")},complexity:function(){return 1}});e.Rect.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat("x y rx ry width height".split(" "));e.Rect.fromElement=function(c,d){if(!c){return null}d=d||{};var a=e.parseAttributes(c,e.Rect.ATTRIBUTE_NAMES);a.left=a.left||0;a.top=a.top||0;var b=new e.Rect(g((d?e.util.object.clone(d):{}),a));b.visible=b.width>0&&b.height>0;return b};e.Rect.fromObject=function(a){return new e.Rect(a)}})(typeof exports!=="undefined"?exports:this);(function(d){var c=d.fabric||(d.fabric={});if(c.Polyline){c.warn("fabric.Polyline is already defined");return}c.Polyline=c.util.createClass(c.Object,{type:"polyline",points:null,minX:0,minY:0,initialize:function(a,b){return c.Polygon.prototype.initialize.call(this,a,b)},_calcDimensions:function(){return c.Polygon.prototype._calcDimensions.call(this)},_applyPointOffset:function(){return c.Polygon.prototype._applyPointOffset.call(this)},toObject:function(a){return c.Polygon.prototype.toObject.call(this,a)},toSVG:function(a){return c.Polygon.prototype.toSVG.call(this,a)},_render:function(a){if(!c.Polygon.prototype.commonRender.call(this,a)){return}this._renderFill(a);this._renderStroke(a)},_renderDashedStroke:function(i){var a,b;i.beginPath();for(var h=0,j=this.points.length;h<j;h++){a=this.points[h];b=this.points[h+1]||a;c.util.drawDashedLine(i,a.x,a.y,b.x,b.y,this.strokeDashArray)}},complexity:function(){return this.get("points").length}});c.Polyline.ATTRIBUTE_NAMES=c.SHARED_ATTRIBUTES.concat();c.Polyline.fromElement=function(g,h){if(!g){return null}h||(h={});var b=c.parsePointsAttribute(g.getAttribute("points")),a=c.parseAttributes(g,c.Polyline.ATTRIBUTE_NAMES);return new c.Polyline(b,c.util.object.extend(a,h))};c.Polyline.fromObject=function(b){var a=b.points;return new c.Polyline(a,b,true)}})(typeof exports!=="undefined"?exports:this);(function(k){var j=k.fabric||(k.fabric={}),i=j.util.object.extend,l=j.util.array.min,g=j.util.array.max,h=j.util.toFixed;if(j.Polygon){j.warn("fabric.Polygon is already defined");return}j.Polygon=j.util.createClass(j.Object,{type:"polygon",points:null,minX:0,minY:0,initialize:function(a,b){b=b||{};this.points=a||[];this.callSuper("initialize",b);this._calcDimensions();if(!("top" in b)){this.top=this.minY}if(!("left" in b)){this.left=this.minX}},_calcDimensions:function(){var d=this.points,e=l(d,"x"),a=l(d,"y"),b=g(d,"x"),c=g(d,"y");this.width=(b-e)||0;this.height=(c-a)||0;this.minX=e||0,this.minY=a||0},_applyPointOffset:function(){this.points.forEach(function(a){a.x-=(this.minX+this.width/2);a.y-=(this.minY+this.height/2)},this)},toObject:function(a){return i(this.callSuper("toObject",a),{points:this.points.concat()})},toSVG:function(d){var a=[],c=this._createBaseSVGMarkup();for(var b=0,e=this.points.length;b<e;b++){a.push(h(this.points[b].x,2),",",h(this.points[b].y,2)," ")}c.push("<",this.type," ",'points="',a.join(""),'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform()," ",this.getSvgTransformMatrix(),'"/>\n');return d?d(c.join("")):c.join("")},_render:function(a){if(!this.commonRender(a)){return}this._renderFill(a);if(this.stroke||this.strokeDashArray){a.closePath();this._renderStroke(a)}},commonRender:function(b){var c,d=this.points.length;if(!d||isNaN(this.points[d-1].y)){return false}b.beginPath();if(this._applyPointOffset){if(!(this.group&&this.group.type==="path-group")){this._applyPointOffset()}this._applyPointOffset=null}b.moveTo(this.points[0].x,this.points[0].y);for(var a=0;a<d;a++){c=this.points[a];b.lineTo(c.x,c.y)}return true},_renderDashedStroke:function(a){j.Polyline.prototype._renderDashedStroke.call(this,a);a.closePath()},complexity:function(){return this.points.length}});j.Polygon.ATTRIBUTE_NAMES=j.SHARED_ATTRIBUTES.concat();j.Polygon.fromElement=function(c,d){if(!c){return null}d||(d={});var b=j.parsePointsAttribute(c.getAttribute("points")),a=j.parseAttributes(c,j.Polygon.ATTRIBUTE_NAMES);return new j.Polygon(b,i(a,d))};j.Polygon.fromObject=function(a){return new j.Polygon(a.points,a,true)}})(typeof exports!=="undefined"?exports:this);(function(r){var p=r.fabric||(r.fabric={}),o=p.util.array.min,l=p.util.array.max,m=p.util.object.extend,q=Object.prototype.toString,k=p.util.drawArc,j={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},n={m:"l",M:"L"};if(p.Path){p.warn("fabric.Path is already defined");return}p.Path=p.util.createClass(p.Object,{type:"path",path:null,minX:0,minY:0,initialize:function(a,b){b=b||{};this.setOptions(b);if(!a){throw new Error("`path` argument is required")}var c=q.call(a)==="[object Array]";this.path=c?a:a.match&&a.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi);if(!this.path){return}if(!c){this.path=this._parsePath()}this._setPositionDimensions();if(b.sourcePath){this.setSourcePath(b.sourcePath)}},_setPositionDimensions:function(){var a=this._parseDimensions();this.minX=a.left;this.minY=a.top;this.width=a.width;this.height=a.height;a.left+=this.originX==="center"?this.width/2:this.originX==="right"?this.width:0;a.top+=this.originY==="center"?this.height/2:this.originY==="bottom"?this.height:0;this.top=this.top||a.top;this.left=this.left||a.left;this.pathOffset=this.pathOffset||{x:this.minX+this.width/2,y:this.minY+this.height/2}},_render:function(x){var a,d=null,c=0,y=0,D=0,E=0,t=0,f=0,e,g,i=-this.pathOffset.x,C=-this.pathOffset.y;if(this.group&&this.group.type==="path-group"){i=0;C=0}x.beginPath();for(var h=0,b=this.path.length;h<b;++h){a=this.path[h];switch(a[0]){case"l":D+=a[1];E+=a[2];x.lineTo(D+i,E+C);break;case"L":D=a[1];E=a[2];x.lineTo(D+i,E+C);break;case"h":D+=a[1];x.lineTo(D+i,E+C);break;case"H":D=a[1];x.lineTo(D+i,E+C);break;case"v":E+=a[1];x.lineTo(D+i,E+C);break;case"V":E=a[1];x.lineTo(D+i,E+C);break;case"m":D+=a[1];E+=a[2];c=D;y=E;x.moveTo(D+i,E+C);break;case"M":D=a[1];E=a[2];c=D;y=E;x.moveTo(D+i,E+C);break;case"c":e=D+a[5];g=E+a[6];t=D+a[3];f=E+a[4];x.bezierCurveTo(D+a[1]+i,E+a[2]+C,t+i,f+C,e+i,g+C);D=e;E=g;break;case"C":D=a[5];E=a[6];t=a[3];f=a[4];x.bezierCurveTo(a[1]+i,a[2]+C,t+i,f+C,D+i,E+C);break;case"s":e=D+a[3];g=E+a[4];if(d[0].match(/[CcSs]/)===null){t=D;f=E}else{t=2*D-t;f=2*E-f}x.bezierCurveTo(t+i,f+C,D+a[1]+i,E+a[2]+C,e+i,g+C);t=D+a[1];f=E+a[2];D=e;E=g;break;case"S":e=a[3];g=a[4];if(d[0].match(/[CcSs]/)===null){t=D;f=E}else{t=2*D-t;f=2*E-f}x.bezierCurveTo(t+i,f+C,a[1]+i,a[2]+C,e+i,g+C);D=e;E=g;t=a[1];f=a[2];break;case"q":e=D+a[3];g=E+a[4];t=D+a[1];f=E+a[2];x.quadraticCurveTo(t+i,f+C,e+i,g+C);D=e;E=g;break;case"Q":e=a[3];g=a[4];x.quadraticCurveTo(a[1]+i,a[2]+C,e+i,g+C);D=e;E=g;t=a[1];f=a[2];break;case"t":e=D+a[1];g=E+a[2];if(d[0].match(/[QqTt]/)===null){t=D;f=E}else{t=2*D-t;f=2*E-f}x.quadraticCurveTo(t+i,f+C,e+i,g+C);D=e;E=g;break;case"T":e=a[1];g=a[2];if(d[0].match(/[QqTt]/)===null){t=D;f=E}else{t=2*D-t;f=2*E-f}x.quadraticCurveTo(t+i,f+C,e+i,g+C);D=e;E=g;break;case"a":k(x,D+i,E+C,[a[1],a[2],a[3],a[4],a[5],a[6]+D+i,a[7]+E+C]);D+=a[6];E+=a[7];break;case"A":k(x,D+i,E+C,[a[1],a[2],a[3],a[4],a[5],a[6]+i,a[7]+C]);D=a[6];E=a[7];break;case"z":case"Z":D=c;E=y;x.closePath();break}d=a}this._renderFill(x);this._renderStroke(x)},toString:function(){return"#<fabric.Path ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }>"},toObject:function(a){var b=m(this.callSuper("toObject",a),{path:this.path.map(function(c){return c.slice()}),pathOffset:this.pathOffset});if(this.sourcePath){b.sourcePath=this.sourcePath}if(this.transformMatrix){b.transformMatrix=this.transformMatrix}return b},toDatalessObject:function(a){var b=this.toObject(a);if(this.sourcePath){b.path=this.sourcePath}delete b.sourcePath;return b},toSVG:function(c){var e=[],b=this._createBaseSVGMarkup(),a="";for(var g=0,d=this.path.length;g<d;g++){e.push(this.path[g].join(" "))}var f=e.join(" ");if(!(this.group&&this.group.type==="path-group")){a=" translate("+(-this.pathOffset.x)+", "+(-this.pathOffset.y)+") "}b.push("<path ",'d="',f,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),a,this.getSvgTransformMatrix(),'" stroke-linecap="round" ',"/>\n");return c?c(b.join("")):b.join("")},complexity:function(){return this.path.length},_parsePath:function(){var c=[],F=[],E,H,C=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:e[-+]?\d+)?)/ig,a,i;for(var d=0,G,J=this.path.length;d<J;d++){E=this.path[d];i=E.slice(1).trim();F.length=0;while((a=C.exec(i))){F.push(a[0])}G=[E.charAt(0)];for(var f=0,D=F.length;f<D;f++){H=parseFloat(F[f]);if(!isNaN(H)){G.push(H)}}var g=G[0],e=j[g.toLowerCase()],b=n[g]||g;if(G.length-1>e){for(var h=1,I=G.length;h<I;h+=e){c.push([g].concat(G.slice(h,h+e)));g=b}}else{c.push(G)}}return c},_parseDimensions:function(){var O=[],R=[],e,P=null,K=0,M=0,i=0,y=0,Q=0,S=0,L,N,J;for(var c=0,a=this.path.length;c<a;++c){e=this.path[c];switch(e[0]){case"l":i+=e[1];y+=e[2];J=[];break;case"L":i=e[1];y=e[2];J=[];break;case"h":i+=e[1];J=[];break;case"H":i=e[1];J=[];break;case"v":y+=e[1];J=[];break;case"V":y=e[1];J=[];break;case"m":i+=e[1];y+=e[2];K=i;M=y;J=[];break;case"M":i=e[1];y=e[2];K=i;M=y;J=[];break;case"c":L=i+e[5];N=y+e[6];Q=i+e[3];S=y+e[4];J=p.util.getBoundsOfCurve(i,y,i+e[1],y+e[2],Q,S,L,N);i=L;y=N;break;case"C":i=e[5];y=e[6];Q=e[3];S=e[4];J=p.util.getBoundsOfCurve(i,y,e[1],e[2],Q,S,i,y);break;case"s":L=i+e[3];N=y+e[4];if(P[0].match(/[CcSs]/)===null){Q=i;S=y}else{Q=2*i-Q;S=2*y-S}J=p.util.getBoundsOfCurve(i,y,Q,S,i+e[1],y+e[2],L,N);Q=i+e[1];S=y+e[2];i=L;y=N;break;case"S":L=e[3];N=e[4];if(P[0].match(/[CcSs]/)===null){Q=i;S=y}else{Q=2*i-Q;S=2*y-S}J=p.util.getBoundsOfCurve(i,y,Q,S,e[1],e[2],L,N);i=L;y=N;Q=e[1];S=e[2];break;case"q":L=i+e[3];N=y+e[4];Q=i+e[1];S=y+e[2];J=p.util.getBoundsOfCurve(i,y,Q,S,Q,S,L,N);i=L;y=N;break;case"Q":Q=e[1];S=e[2];J=p.util.getBoundsOfCurve(i,y,Q,S,Q,S,e[3],e[4]);i=e[3];y=e[4];break;case"t":L=i+e[1];N=y+e[2];if(P[0].match(/[QqTt]/)===null){Q=i;S=y}else{Q=2*i-Q;S=2*y-S}J=p.util.getBoundsOfCurve(i,y,Q,S,Q,S,L,N);i=L;y=N;break;case"T":L=e[1];N=e[2];if(P[0].match(/[QqTt]/)===null){Q=i;S=y}else{Q=2*i-Q;S=2*y-S}J=p.util.getBoundsOfCurve(i,y,Q,S,Q,S,L,N);i=L;y=N;break;case"a":J=p.util.getBoundsOfArc(i,y,e[1],e[2],e[3],e[4],e[5],e[6]+i,e[7]+y);i+=e[6];y+=e[7];break;case"A":J=p.util.getBoundsOfArc(i,y,e[1],e[2],e[3],e[4],e[5],e[6],e[7]);i=e[6];y=e[7];break;case"z":case"Z":i=K;y=M;break}P=e;J.forEach(function(s){O.push(s.x);R.push(s.y)});O.push(i);R.push(y)}var g=o(O),h=o(R),x=l(O),I=l(R),b=x-g,d=I-h,f={left:g,top:h,width:b,height:d};return f}});p.Path.fromObject=function(b,a){if(typeof b.path==="string"){p.loadSVGFromURL(b.path,function(d){var c=d[0],e=b.path;delete b.path;p.util.object.extend(c,b);c.setSourcePath(e);a(c)})}else{a(new p.Path(b.path,b))}};p.Path.ATTRIBUTE_NAMES=p.SHARED_ATTRIBUTES.concat(["d"]);p.Path.fromElement=function(c,a,d){var b=p.parseAttributes(c,p.Path.ATTRIBUTE_NAMES);a&&a(new p.Path(b.d,m(b,d)))};p.Path.async=true})(typeof exports!=="undefined"?exports:this);(function(j){var i=j.fabric||(j.fabric={}),h=i.util.object.extend,g=i.util.array.invoke,f=i.Object.prototype.toObject;if(i.PathGroup){i.warn("fabric.PathGroup is already defined");return}i.PathGroup=i.util.createClass(i.Path,{type:"path-group",fill:"",initialize:function(a,c){c=c||{};this.paths=a||[];for(var b=this.paths.length;b--;){this.paths[b].group=this}if(c.toBeParsed){this.parseDimensionsFromPaths(c);delete c.toBeParsed}this.setOptions(c);this.setCoords();if(c.sourcePath){this.setSourcePath(c.sourcePath)}},parseDimensionsFromPaths:function(w){var c,v,m=[],a=[],x,b,u,p=this.transformMatrix;for(var e=this.paths.length;e--;){x=this.paths[e];b=x.height+x.strokeWidth;u=x.width+x.strokeWidth;c=[{x:x.left,y:x.top},{x:x.left+u,y:x.top},{x:x.left,y:x.top+b},{x:x.left+u,y:x.top+b}];for(var d=0;d<c.length;d++){v=c[d];if(p){v=i.util.transformPoint(v,p,false)}m.push(v.x);a.push(v.y)}}w.width=Math.max.apply(null,m);w.height=Math.max.apply(null,a)},render:function(b){if(!this.visible){return}b.save();if(this.transformMatrix){b.transform.apply(b,this.transformMatrix)}this.transform(b);this._setShadow(b);this.clipTo&&i.util.clipContext(this,b);b.translate(-this.width/2,-this.height/2);for(var a=0,c=this.paths.length;a<c;++a){this.paths[a].render(b,true)}this.clipTo&&b.restore();this._removeShadow(b);b.restore()},_set:function(a,b){if(a==="fill"&&b&&this.isSameColor()){var c=this.paths.length;while(c--){this.paths[c]._set(a,b)}}return this.callSuper("_set",a,b)},toObject:function(a){var b=h(f.call(this,a),{paths:g(this.getObjects(),"toObject",a)});if(this.sourcePath){b.sourcePath=this.sourcePath}return b},toDatalessObject:function(a){var b=this.toObject(a);if(this.sourcePath){b.paths=this.sourcePath}return b},toSVG:function(e){var b=this.getObjects(),a=this.getPointByOrigin("left","top"),n="translate("+a.x+" "+a.y+")",d=["<g ",'style="',this.getSvgStyles(),'" ','transform="',this.getSvgTransformMatrix(),n,this.getSvgTransform(),'" ',">\n"];for(var c=0,o=b.length;c<o;c++){d.push(b[c].toSVG(e))}d.push("</g>\n");return e?e(d.join("")):d.join("")},toString:function(){return"#<fabric.PathGroup ("+this.complexity()+"): { top: "+this.top+", left: "+this.left+" }>"},isSameColor:function(){var a=(this.getObjects()[0].get("fill")||"").toLowerCase();return this.getObjects().every(function(b){return(b.get("fill")||"").toLowerCase()===a})},complexity:function(){return this.paths.reduce(function(b,a){return b+((a&&a.complexity)?a.complexity():0)},0)},getObjects:function(){return this.paths}});i.PathGroup.fromObject=function(b,a){if(typeof b.paths==="string"){i.loadSVGFromURL(b.paths,function(d){var c=b.paths;delete b.paths;var e=i.util.groupSVGElements(d,b,c);a(e)})}else{i.util.enlivenObjects(b.paths,function(c){delete b.paths;a(new i.PathGroup(c,b))})}};i.PathGroup.async=true})(typeof exports!=="undefined"?exports:this);(function(m){var l=m.fabric||(m.fabric={}),j=l.util.object.extend,n=l.util.array.min,i=l.util.array.max,h=l.util.array.invoke;if(l.Group){return}var k={lockMovementX:true,lockMovementY:true,lockRotation:true,lockScalingX:true,lockScalingY:true,lockUniScaling:true};l.Group=l.util.createClass(l.Object,l.Collection,{type:"group",initialize:function(a,c){c=c||{};this._objects=a||[];for(var b=this._objects.length;b--;){this._objects[b].group=this}this.originalState={};this.callSuper("initialize");if(c.originX){this.originX=c.originX}if(c.originY){this.originY=c.originY}this._calcBounds();this._updateObjectsCoords();this.callSuper("initialize",c);this.setCoords();this.saveCoords()},_updateObjectsCoords:function(){this.forEachObject(this._updateObjectCoords,this)},_updateObjectCoords:function(c){var b=c.getLeft(),a=c.getTop(),d=this.getCenterPoint();c.set({originalLeft:b,originalTop:a,left:b-d.x,top:a-d.y});c.setCoords();c.__origHasControls=c.hasControls;c.hasControls=false},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},addWithUpdate:function(a){this._restoreObjectsState();if(a){this._objects.push(a);a.group=this}this.forEachObject(this._setObjectActive,this);this._calcBounds();this._updateObjectsCoords();return this},_setObjectActive:function(a){a.set("active",true);a.group=this},removeWithUpdate:function(a){this._moveFlippedObject(a);this._restoreObjectsState();this.forEachObject(this._setObjectActive,this);this.remove(a);this._calcBounds();this._updateObjectsCoords();return this},_onObjectAdded:function(a){a.group=this},_onObjectRemoved:function(a){delete a.group;a.set("active",false)},delegatedProperties:{fill:true,opacity:true,fontFamily:true,fontWeight:true,fontSize:true,fontStyle:true,lineHeight:true,textDecoration:true,textAlign:true,backgroundColor:true},_set:function(b,a){if(b in this.delegatedProperties){var c=this._objects.length;while(c--){this._objects[c].set(b,a)}}this.callSuper("_set",b,a)},toObject:function(a){return j(this.callSuper("toObject",a),{objects:h(this._objects,"toObject",a)})},render:function(b){if(!this.visible){return}b.save();this.clipTo&&l.util.clipContext(this,b);this.transform(b);for(var a=0,c=this._objects.length;a<c;a++){this._renderObject(this._objects[a],b)}this.clipTo&&b.restore();b.restore()},_renderControls:function(c,a){this.callSuper("_renderControls",c,a);for(var b=0,d=this._objects.length;b<d;b++){this._objects[b]._renderControls(c)}},_renderObject:function(a,b){var c=a.hasRotatingPoint;if(!a.visible){return}a.hasRotatingPoint=false;a.render(b);a.hasRotatingPoint=c},_restoreObjectsState:function(){this._objects.forEach(this._restoreObjectState,this);return this},realizeTransform:function(a){this._moveFlippedObject(a);this._setObjectPosition(a);return a},_moveFlippedObject:function(a){var c=a.get("originX"),d=a.get("originY"),e=a.getCenterPoint();a.set({originX:"center",originY:"center",left:e.x,top:e.y});this._toggleFlipping(a);var b=a.getPointByOrigin(c,d);a.set({originX:c,originY:d,left:b.x,top:b.y});return this},_toggleFlipping:function(a){if(this.flipX){a.toggle("flipX");a.set("left",-a.get("left"));a.setAngle(-a.getAngle())}if(this.flipY){a.toggle("flipY");a.set("top",-a.get("top"));a.setAngle(-a.getAngle())}},_restoreObjectState:function(a){this._setObjectPosition(a);a.setCoords();a.hasControls=a.__origHasControls;delete a.__origHasControls;a.set("active",false);a.setCoords();delete a.group;return this},_setObjectPosition:function(a){var c=this.getCenterPoint(),b=this._getRotatedLeftTop(a);a.set({angle:a.getAngle()+this.getAngle(),left:c.x+b.left,top:c.y+b.top,scaleX:a.get("scaleX")*this.get("scaleX"),scaleY:a.get("scaleY")*this.get("scaleY")})},_getRotatedLeftTop:function(a){var b=this.getAngle()*(Math.PI/180);return{left:(-Math.sin(b)*a.getTop()*this.get("scaleY")+Math.cos(b)*a.getLeft()*this.get("scaleX")),top:(Math.cos(b)*a.getTop()*this.get("scaleY")+Math.sin(b)*a.getLeft()*this.get("scaleX"))}},destroy:function(){this._objects.forEach(this._moveFlippedObject,this);return this._restoreObjectsState()},saveCoords:function(){this._originalLeft=this.get("left");this._originalTop=this.get("top");return this},hasMoved:function(){return this._originalLeft!==this.get("left")||this._originalTop!==this.get("top")},setObjectsCoords:function(){this.forEachObject(function(a){a.setCoords()});return this},_calcBounds:function(f){var c=[],d=[],g,o,t=["tr","br","bl","tl"];for(var b=0,a=this._objects.length;b<a;++b){g=this._objects[b];g.setCoords();for(var e=0;e<t.length;e++){o=t[e];c.push(g.oCoords[o].x);d.push(g.oCoords[o].y)}}this.set(this._getBounds(c,d,f))},_getBounds:function(d,e,g){var b=l.util.invertTransform(this.getViewportTransform()),c=l.util.transformPoint(new l.Point(n(d),n(e)),b),f=l.util.transformPoint(new l.Point(i(d),i(e)),b),a={width:(f.x-c.x)||0,height:(f.y-c.y)||0};if(!g){a.left=c.x||0;a.top=c.y||0;if(this.originX==="center"){a.left+=a.width/2}if(this.originX==="right"){a.left+=a.width}if(this.originY==="center"){a.top+=a.height/2}if(this.originY==="bottom"){a.top+=a.height}}return a},toSVG:function(c){var b=["<g ",'transform="',this.getSvgTransform(),'">\n'];for(var a=0,d=this._objects.length;a<d;a++){b.push(this._objects[a].toSVG(c))}b.push("</g>\n");return c?c(b.join("")):b.join("")},get:function(a){if(a in k){if(this[a]){return this[a]}else{for(var b=0,c=this._objects.length;b<c;b++){if(this._objects[b][a]){return true}}return false}}else{if(a in this.delegatedProperties){return this._objects[0]&&this._objects[0].get(a)}return this[a]}}});l.Group.fromObject=function(b,a){l.util.enlivenObjects(b.objects,function(c){delete b.objects;a&&a(new l.Group(c,b))})};l.Group.async=true})(typeof exports!=="undefined"?exports:this);(function(d){var c=fabric.util.object.extend;if(!d.fabric){d.fabric={}}if(d.fabric.Image){fabric.warn("fabric.Image is already defined.");return}fabric.Image=fabric.util.createClass(fabric.Object,{type:"image",crossOrigin:"",alignX:"none",alignY:"none",meetOrSlice:"meet",_lastScaleX:1,_lastScaleY:1,initialize:function(a,b){b||(b={});this.filters=[];this.resizeFilters=[];this.callSuper("initialize",b);this._initElement(a,b);this._initConfig(b);if(b.filters){this.filters=b.filters;this.applyFilters()}},getElement:function(){return this._element},setElement:function(b,a,f){this._element=b;this._originalElement=b;this._initConfig(f);if(this.filters.length!==0){this.applyFilters(a)}else{if(a){a()}}return this},setCrossOrigin:function(a){this.crossOrigin=a;this._element.crossOrigin=a;return this},getOriginalSize:function(){var a=this.getElement();return{width:a.width,height:a.height}},_stroke:function(a){a.save();this._setStrokeStyles(a);a.beginPath();a.strokeRect(-this.width/2,-this.height/2,this.width,this.height);a.closePath();a.restore()},_renderDashedStroke:function(h){var j=-this.width/2,a=-this.height/2,i=this.width,b=this.height;h.save();this._setStrokeStyles(h);h.beginPath();fabric.util.drawDashedLine(h,j,a,j+i,a,this.strokeDashArray);fabric.util.drawDashedLine(h,j+i,a,j+i,a+b,this.strokeDashArray);fabric.util.drawDashedLine(h,j+i,a+b,j,a+b,this.strokeDashArray);fabric.util.drawDashedLine(h,j,a+b,j,a,this.strokeDashArray);h.closePath();h.restore()},toObject:function(a){return c(this.callSuper("toObject",a),{src:this._originalElement.src||this._originalElement._src,filters:this.filters.map(function(b){return b&&b.toObject()}),crossOrigin:this.crossOrigin,alignX:this.alignX,alignY:this.alignY,meetOrSlice:this.meetOrSlice})},toSVG:function(k){var j=[],l=-this.width/2,a=-this.height/2,b="none";if(this.group&&this.group.type==="path-group"){l=this.left;a=this.top}if(this.alignX!=="none"&&this.alignY!=="none"){b="x"+this.alignX+"Y"+this.alignY+" "+this.meetOrSlice}j.push('<g transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'">\n','<image xlink:href="',this.getSvgSrc(),'" x="',l,'" y="',a,'" style="',this.getSvgStyles(),'" width="',this.width,'" height="',this.height,'" preserveAspectRatio="',b,'"',"></image>\n");if(this.stroke||this.strokeDashArray){var i=this.fill;this.fill=null;j.push("<rect ",'x="',l,'" y="',a,'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'"/>\n');this.fill=i}j.push("</g>\n");return k?k(j.join("")):j.join("")},getSrc:function(){if(this.getElement()){return this.getElement().src||this.getElement()._src}},setSrc:function(b,a,f){fabric.util.loadImage(b,function(e){return this.setElement(e,a,f)},this,f&&f.crossOrigin)},toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},clone:function(a,b){this.constructor.fromObject(this.toObject(b),a)},applyFilters:function(a,m,l,p){m=m||this.filters;l=l||this._originalElement;if(!l){return}var k=l,o=fabric.util.createCanvasElement(),n=fabric.util.createImage(),b=this;o.width=k.width;o.height=k.height;o.getContext("2d").drawImage(k,0,0,k.width,k.height);if(m.length===0){this._element=l;a&&a();return o}m.forEach(function(e){e&&e.applyTo(o,e.scaleX||b.scaleX,e.scaleY||b.scaleY);if(!p&&e&&e.type==="Resize"){b.width*=e.scaleX;b.height*=e.scaleY}});n.width=o.width;n.height=o.height;if(fabric.isLikelyNode){n.src=o.toBuffer(undefined,fabric.Image.pngCompression);b._element=n;!p&&(b._filteredEl=n);a&&a()}else{n.onload=function(){b._element=n;!p&&(b._filteredEl=n);a&&a();n.onload=o=k=null};n.src=o.toDataURL("image/png")}return o},_render:function(j,b){var l,a,k=this._findMargins(),i;l=(b?this.left:-this.width/2);a=(b?this.top:-this.height/2);if(this.meetOrSlice==="slice"){j.beginPath();j.rect(l,a,this.width,this.height);j.clip()}if(this.isMoving===false&&this.resizeFilters.length&&this._needsResize()){this._lastScaleX=this.scaleX;this._lastScaleY=this.scaleY;i=this.applyFilters(null,this.resizeFilters,this._filteredEl||this._originalElement,true)}else{i=this._element}i&&j.drawImage(i,l+k.marginX,a+k.marginY,k.width,k.height);this._renderStroke(j)},_needsResize:function(){return(this.scaleX!==this._lastScaleX||this.scaleY!==this._lastScaleY)},_findMargins:function(){var i=this.width,l=this.height,a,b,j=0,k=0;if(this.alignX!=="none"||this.alignY!=="none"){a=[this.width/this._element.width,this.height/this._element.height];b=this.meetOrSlice==="meet"?Math.min.apply(null,a):Math.max.apply(null,a);i=this._element.width*b;l=this._element.height*b;if(this.alignX==="Mid"){j=(this.width-i)/2}if(this.alignX==="Max"){j=this.width-i}if(this.alignY==="Mid"){k=(this.height-l)/2}if(this.alignY==="Max"){k=this.height-l}}return{width:i,height:l,marginX:j,marginY:k}},_resetWidthHeight:function(){var a=this.getElement();this.set("width",a.width);this.set("height",a.height)},_initElement:function(a){this.setElement(fabric.util.getById(a));fabric.util.addClass(this.getElement(),fabric.Image.CSS_CANVAS)},_initConfig:function(a){a||(a={});this.setOptions(a);this._setWidthHeight(a);if(this._element&&this.crossOrigin){this._element.crossOrigin=this.crossOrigin}},_initFilters:function(b,a){if(b.filters&&b.filters.length){fabric.util.enlivenObjects(b.filters,function(f){a&&a(f)},"fabric.Image.filters")}else{a&&a()}},_setWidthHeight:function(a){this.width="width" in a?a.width:(this.getElement()?this.getElement().width||0:0);this.height="height" in a?a.height:(this.getElement()?this.getElement().height||0:0)},complexity:function(){return 1}});fabric.Image.CSS_CANVAS="canvas-img";fabric.Image.prototype.getSvgSrc=fabric.Image.prototype.getSrc;fabric.Image.fromObject=function(b,a){fabric.util.loadImage(b.src,function(f){fabric.Image.prototype._initFilters.call(b,b,function(e){b.filters=e||[];var h=new fabric.Image(f,b);a&&a(h)})},null,b.crossOrigin)};fabric.Image.fromURL=function(f,a,b){fabric.util.loadImage(f,function(e){a&&a(new fabric.Image(e,b))},null,b&&b.crossOrigin)};fabric.Image.ATTRIBUTE_NAMES=fabric.SHARED_ATTRIBUTES.concat("x y width height preserveAspectRatio xlink:href".split(" "));fabric.Image.fromElement=function(o,l,a){var m=fabric.parseAttributes(o,fabric.Image.ATTRIBUTE_NAMES),n="xMidYMid",r="meet",p,q,b;if(m.preserveAspectRatio){b=m.preserveAspectRatio.split(" ")}if(b&&b.length){r=b.pop();if(r!=="meet"&&r!=="slice"){n=r;r="meet"}else{if(b.length){n=b.pop()}}}p=n!=="none"?n.slice(1,4):"none";q=n!=="none"?n.slice(5,8):"none";m.alignX=p;m.alignY=q;m.meetOrSlice=r;fabric.Image.fromURL(m["xlink:href"],l,c((a?fabric.util.object.clone(a):{}),m))};fabric.Image.async=true;fabric.Image.pngCompression=1})(typeof exports!=="undefined"?exports:this);fabric.util.object.extend(fabric.Object.prototype,{_getAngleValueForStraighten:function(){var b=this.getAngle()%360;if(b>0){return Math.round((b-1)/90)*90}return Math.round(b/90)*90},straighten:function(){this.setAngle(this._getAngleValueForStraighten());return this},fxStraighten:function(f){f=f||{};var j=function(){},i=f.onComplete||j,g=f.onChange||j,h=this;fabric.util.animate({startValue:this.get("angle"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(a){h.setAngle(a);g()},onComplete:function(){h.setCoords();i()},onStart:function(){h.set("active",false)}});return this}});fabric.util.object.extend(fabric.StaticCanvas.prototype,{straightenObject:function(b){b.straighten();this.renderAll();return this},fxStraightenObject:function(b){b.fxStraighten({onChange:this.renderAll.bind(this)});return this}});fabric.Image.filters=fabric.Image.filters||{};fabric.Image.filters.BaseFilter=fabric.util.createClass({type:"BaseFilter",initialize:function(b){if(b){this.setOptions(b)}},setOptions:function(d){for(var c in d){this[c]=d[c]}},toObject:function(){return{type:this.type}},toJSON:function(){return this.toObject()}});(function(e){var d=e.fabric||(e.fabric={}),f=d.util.object.extend;d.Image.filters.Brightness=d.util.createClass(d.Image.filters.BaseFilter,{type:"Brightness",initialize:function(a){a=a||{};this.brightness=a.brightness||0},applyTo:function(i){var l=i.getContext("2d"),a=l.getImageData(0,0,i.width,i.height),c=a.data,b=this.brightness;for(var m=0,n=c.length;m<n;m+=4){c[m]+=b;c[m+1]+=b;c[m+2]+=b}l.putImageData(a,0,0)},toObject:function(){return f(this.callSuper("toObject"),{brightness:this.brightness})}});d.Image.filters.Brightness.fromObject=function(a){return new d.Image.filters.Brightness(a)}})(typeof exports!=="undefined"?exports:this);(function(e){var d=e.fabric||(e.fabric={}),f=d.util.object.extend;d.Image.filters.Convolute=d.util.createClass(d.Image.filters.BaseFilter,{type:"Convolute",initialize:function(b){b=b||{};this.opaque=b.opaque;this.matrix=b.matrix||[0,0,0,0,1,0,0,0,0];var a=d.util.createCanvasElement();this.tmpCtx=a.getContext("2d")},_createImageData:function(b,a){return this.tmpCtx.createImageData(b,a)},applyTo:function(Z){var r=this.matrix,ac=Z.getContext("2d"),U=ac.getImageData(0,0,Z.width,Z.height),ae=Math.round(Math.sqrt(r.length)),aa=Math.floor(ae/2),Y=U.data,T=U.width,c=U.height,Q=T,M=c,X=this._createImageData(Q,M),a=X.data,O=this.opaque?1:0;for(var W=0;W<M;W++){for(var V=0;V<Q;V++){var x=W,b=V,R=(W*Q+V)*4,y=0,w=0,h=0,g=0;for(var ad=0;ad<ae;ad++){for(var ab=0;ab<ae;ab++){var P=x+ad-aa,N=b+ab-aa;if(P<0||P>c||N<0||N>T){continue}var S=(P*T+N)*4,af=r[ad*ae+ab];y+=Y[S]*af;w+=Y[S+1]*af;h+=Y[S+2]*af;g+=Y[S+3]*af}}a[R]=y;a[R+1]=w;a[R+2]=h;a[R+3]=g+O*(255-g)}}ac.putImageData(X,0,0)},toObject:function(){return f(this.callSuper("toObject"),{opaque:this.opaque,matrix:this.matrix})}});d.Image.filters.Convolute.fromObject=function(a){return new d.Image.filters.Convolute(a)}})(typeof exports!=="undefined"?exports:this);(function(e){var d=e.fabric||(e.fabric={}),f=d.util.object.extend;d.Image.filters.GradientTransparency=d.util.createClass(d.Image.filters.BaseFilter,{type:"GradientTransparency",initialize:function(a){a=a||{};this.threshold=a.threshold||100},applyTo:function(i){var m=i.getContext("2d"),a=m.getImageData(0,0,i.width,i.height),b=a.data,o=this.threshold,c=b.length;for(var n=0,p=b.length;n<p;n+=4){b[n+3]=o+255*(c-n)/c}m.putImageData(a,0,0)},toObject:function(){return f(this.callSuper("toObject"),{threshold:this.threshold})}});d.Image.filters.GradientTransparency.fromObject=function(a){return new d.Image.filters.GradientTransparency(a)}})(typeof exports!=="undefined"?exports:this);(function(d){var c=d.fabric||(d.fabric={});c.Image.filters.Grayscale=c.util.createClass(c.Image.filters.BaseFilter,{type:"Grayscale",applyTo:function(k){var l=k.getContext("2d"),a=l.getImageData(0,0,k.width,k.height),b=a.data,n=a.width*a.height*4,m=0,j;while(m<n){j=(b[m]+b[m+1]+b[m+2])/3;b[m]=j;b[m+1]=j;b[m+2]=j;m+=4}l.putImageData(a,0,0)}});c.Image.filters.Grayscale.fromObject=function(){return new c.Image.filters.Grayscale()}})(typeof exports!=="undefined"?exports:this);(function(d){var c=d.fabric||(d.fabric={});c.Image.filters.Invert=c.util.createClass(c.Image.filters.BaseFilter,{type:"Invert",applyTo:function(i){var j=i.getContext("2d"),a=j.getImageData(0,0,i.width,i.height),b=a.data,l=b.length,k;for(k=0;k<l;k+=4){b[k]=255-b[k];b[k+1]=255-b[k+1];b[k+2]=255-b[k+2]}j.putImageData(a,0,0)}});c.Image.filters.Invert.fromObject=function(){return new c.Image.filters.Invert()}})(typeof exports!=="undefined"?exports:this);(function(e){var d=e.fabric||(e.fabric={}),f=d.util.object.extend;d.Image.filters.Mask=d.util.createClass(d.Image.filters.BaseFilter,{type:"Mask",initialize:function(a){a=a||{};this.mask=a.mask;this.channel=[0,1,2,3].indexOf(a.channel)>-1?a.channel:0},applyTo:function(r){if(!this.mask){return}var u=r.getContext("2d"),v=u.getImageData(0,0,r.width,r.height),q=v.data,i=this.mask.getElement(),b=d.util.createCanvasElement(),c=this.channel,p,s=v.width*v.height*4;b.width=i.width;b.height=i.height;b.getContext("2d").drawImage(i,0,0,i.width,i.height);var t=b.getContext("2d").getImageData(0,0,i.width,i.height),a=t.data;for(p=0;p<s;p+=4){q[p+3]=a[p+c]}u.putImageData(v,0,0)},toObject:function(){return f(this.callSuper("toObject"),{mask:this.mask.toObject(),channel:this.channel})}});d.Image.filters.Mask.fromObject=function(b,a){d.util.loadImage(b.mask.src,function(c){b.mask=new d.Image(c,b.mask);a&&a(new d.Image.filters.Mask(b))})};d.Image.filters.Mask.async=true})(typeof exports!=="undefined"?exports:this);(function(e){var d=e.fabric||(e.fabric={}),f=d.util.object.extend;d.Image.filters.Noise=d.util.createClass(d.Image.filters.BaseFilter,{type:"Noise",initialize:function(a){a=a||{};this.noise=a.noise||0},applyTo:function(i){var m=i.getContext("2d"),a=m.getImageData(0,0,i.width,i.height),b=a.data,o=this.noise,c;for(var n=0,p=b.length;n<p;n+=4){c=(0.5-Math.random())*o;b[n]+=c;b[n+1]+=c;b[n+2]+=c}m.putImageData(a,0,0)},toObject:function(){return f(this.callSuper("toObject"),{noise:this.noise})}});d.Image.filters.Noise.fromObject=function(a){return new d.Image.filters.Noise(a)}})(typeof exports!=="undefined"?exports:this);(function(e){var d=e.fabric||(e.fabric={}),f=d.util.object.extend;d.Image.filters.Pixelate=d.util.createClass(d.Image.filters.BaseFilter,{type:"Pixelate",initialize:function(a){a=a||{};this.blocksize=a.blocksize||4},applyTo:function(y){var z=y.getContext("2d"),A=z.getImageData(0,0,y.width,y.height),c=A.data,r=A.height,C=A.width,H,b,g,B,a,F,E;for(b=0;b<r;b+=this.blocksize){for(g=0;g<C;g+=this.blocksize){H=(b*4)*C+(g*4);B=c[H];a=c[H+1];F=c[H+2];E=c[H+3];for(var i=b,D=b+this.blocksize;i<D;i++){for(var j=g,G=g+this.blocksize;j<G;j++){H=(i*4)*C+(j*4);c[H]=B;c[H+1]=a;c[H+2]=F;c[H+3]=E}}}}z.putImageData(A,0,0)},toObject:function(){return f(this.callSuper("toObject"),{blocksize:this.blocksize})}});d.Image.filters.Pixelate.fromObject=function(a){return new d.Image.filters.Pixelate(a)}})(typeof exports!=="undefined"?exports:this);(function(e){var d=e.fabric||(e.fabric={}),f=d.util.object.extend;d.Image.filters.RemoveWhite=d.util.createClass(d.Image.filters.BaseFilter,{type:"RemoveWhite",initialize:function(a){a=a||{};this.threshold=a.threshold||30;this.distance=a.distance||20},applyTo:function(u){var v=u.getContext("2d"),x=v.getImageData(0,0,u.width,u.height),i=x.data,g=this.threshold,w=this.distance,t=255-g,z=Math.abs,y,c,a;for(var r=0,b=i.length;r<b;r+=4){y=i[r];c=i[r+1];a=i[r+2];if(y>t&&c>t&&a>t&&z(y-c)<w&&z(y-a)<w&&z(c-a)<w){i[r+3]=1}}v.putImageData(x,0,0)},toObject:function(){return f(this.callSuper("toObject"),{threshold:this.threshold,distance:this.distance})}});d.Image.filters.RemoveWhite.fromObject=function(a){return new d.Image.filters.RemoveWhite(a)}})(typeof exports!=="undefined"?exports:this);(function(d){var c=d.fabric||(d.fabric={});c.Image.filters.Sepia=c.util.createClass(c.Image.filters.BaseFilter,{type:"Sepia",applyTo:function(k){var l=k.getContext("2d"),a=l.getImageData(0,0,k.width,k.height),i=a.data,n=i.length,m,b;for(m=0;m<n;m+=4){b=0.3*i[m]+0.59*i[m+1]+0.11*i[m+2];i[m]=b+100;i[m+1]=b+50;i[m+2]=b+255}l.putImageData(a,0,0)}});c.Image.filters.Sepia.fromObject=function(){return new c.Image.filters.Sepia()}})(typeof exports!=="undefined"?exports:this);(function(d){var c=d.fabric||(d.fabric={});c.Image.filters.Sepia2=c.util.createClass(c.Image.filters.BaseFilter,{type:"Sepia2",applyTo:function(o){var p=o.getContext("2d"),r=p.getImageData(0,0,o.width,o.height),i=r.data,n=i.length,g,q,b,a;for(g=0;g<n;g+=4){q=i[g];b=i[g+1];a=i[g+2];i[g]=(q*0.393+b*0.769+a*0.189)/1.351;i[g+1]=(q*0.349+b*0.686+a*0.168)/1.203;i[g+2]=(q*0.272+b*0.534+a*0.131)/2.14}p.putImageData(r,0,0)}});c.Image.filters.Sepia2.fromObject=function(){return new c.Image.filters.Sepia2()}})(typeof exports!=="undefined"?exports:this);(function(e){var d=e.fabric||(e.fabric={}),f=d.util.object.extend;d.Image.filters.Tint=d.util.createClass(d.Image.filters.BaseFilter,{type:"Tint",initialize:function(a){a=a||{};this.color=a.color||"#000000";this.opacity=typeof a.opacity!=="undefined"?a.opacity:new d.Color(this.color).getAlpha()},applyTo:function(u){var w=u.getContext("2d"),x=w.getImageData(0,0,u.width,u.height),i=x.data,r=i.length,g,b,A,v,y,c,a,B,z;z=new d.Color(this.color).getSource();b=z[0]*this.opacity;A=z[1]*this.opacity;v=z[2]*this.opacity;B=1-this.opacity;for(g=0;g<r;g+=4){y=i[g];c=i[g+1];a=i[g+2];i[g]=b+y*B;i[g+1]=A+c*B;i[g+2]=v+a*B}w.putImageData(x,0,0)},toObject:function(){return f(this.callSuper("toObject"),{color:this.color,opacity:this.opacity})}});d.Image.filters.Tint.fromObject=function(a){return new d.Image.filters.Tint(a)}})(typeof exports!=="undefined"?exports:this);(function(e){var d=e.fabric||(e.fabric={}),f=d.util.object.extend;d.Image.filters.Multiply=d.util.createClass(d.Image.filters.BaseFilter,{type:"Multiply",initialize:function(a){a=a||{};this.color=a.color||"#000000"},applyTo:function(i){var l=i.getContext("2d"),a=l.getImageData(0,0,i.width,i.height),b=a.data,n=b.length,m,c;c=new d.Color(this.color).getSource();for(m=0;m<n;m+=4){b[m]*=c[0]/255;b[m+1]*=c[1]/255;b[m+2]*=c[2]/255}l.putImageData(a,0,0)},toObject:function(){return f(this.callSuper("toObject"),{color:this.color})}});d.Image.filters.Multiply.fromObject=function(a){return new d.Image.filters.Multiply(a)}})(typeof exports!=="undefined"?exports:this);(function(d){var c=d.fabric;c.Image.filters.Blend=c.util.createClass({type:"Blend",initialize:function(a){a=a||{};this.color=a.color||"#000";this.image=a.image||false;this.mode=a.mode||"multiply";this.alpha=a.alpha||1},applyTo:function(I){var L=I.getContext("2d"),i=L.getImageData(0,0,I.width,I.height),a=i.data,N,H,G,F,r,b,g,K,J,D,B=false;if(this.image){B=true;var E=c.util.createCanvasElement();E.width=this.image.width;E.height=this.image.height;var M=new c.StaticCanvas(E);M.add(this.image);var C=M.getContext("2d");D=C.getImageData(0,0,M.width,M.height).data}else{D=new c.Color(this.color).getSource();N=D[0]*this.alpha;H=D[1]*this.alpha;G=D[2]*this.alpha}for(var A=0,z=a.length;A<z;A+=4){F=a[A];r=a[A+1];b=a[A+2];if(B){N=D[A]*this.alpha;H=D[A+1]*this.alpha;G=D[A+2]*this.alpha}switch(this.mode){case"multiply":a[A]=F*N/255;a[A+1]=r*H/255;a[A+2]=b*G/255;break;case"screen":a[A]=1-(1-F)*(1-N);a[A+1]=1-(1-r)*(1-H);a[A+2]=1-(1-b)*(1-G);break;case"add":a[A]=Math.min(255,F+N);a[A+1]=Math.min(255,r+H);a[A+2]=Math.min(255,b+G);break;case"diff":case"difference":a[A]=Math.abs(F-N);a[A+1]=Math.abs(r-H);a[A+2]=Math.abs(b-G);break;case"subtract":g=F-N;K=r-H;J=b-G;a[A]=(g<0)?0:g;a[A+1]=(K<0)?0:K;a[A+2]=(J<0)?0:J;break;case"darken":a[A]=Math.min(F,N);a[A+1]=Math.min(r,H);a[A+2]=Math.min(b,G);break;case"lighten":a[A]=Math.max(F,N);a[A+1]=Math.max(r,H);a[A+2]=Math.max(b,G);break}}L.putImageData(i,0,0)},toObject:function(){return{color:this.color,image:this.image,mode:this.mode,alpha:this.alpha}}});c.Image.filters.Blend.fromObject=function(a){return new c.Image.filters.Blend(a)}})(typeof exports!=="undefined"?exports:this);(function(t){var s=t.fabric||(t.fabric={}),q=Math.pow,r=Math.floor,n=Math.sqrt,k=Math.abs,o=Math.max,l=Math.round,p=Math.sin,m=Math.ceil;s.Image.filters.Resize=s.util.createClass(s.Image.filters.BaseFilter,{type:"Resize",resizeType:"hermite",scaleX:0,scaleY:0,lanczosLobes:3,applyTo:function(g,h,a){this.rcpScaleX=1/h;this.rcpScaleY=1/a;var b=g.width,e=g.height,c=l(b*h),f=l(e*a),d;if(this.resizeType==="sliceHack"){d=this.sliceByTwo(g,b,e,c,f)}if(this.resizeType==="hermite"){d=this.hermiteFastResize(g,b,e,c,f)}if(this.resizeType==="bilinear"){d=this.bilinearFiltering(g,b,e,c,f)}if(this.resizeType==="lanczos"){d=this.lanczosResize(g,b,e,c,f)}g.width=c;g.height=f;g.getContext("2d").putImageData(d,0,0)},sliceByTwo:function(e,g,D,a,h){var f=e.getContext("2d"),i,b=0.5,d=0.5,B=1,G=1,c=false,j=false,C=g,H=D,F=s.util.createCanvasElement(),E=F.getContext("2d");a=r(a);h=r(h);F.width=o(a,g);F.height=o(h,D);if(a>g){b=2;B=-1}if(h>D){d=2;G=-1}i=f.getImageData(0,0,g,D);e.width=o(a,g);e.height=o(h,D);f.putImageData(i,0,0);while(!c||!j){g=C;D=H;if(a*B<r(C*b*B)){C=r(C*b)}else{C=a;c=true}if(h*G<r(H*d*G)){H=r(H*d)}else{H=h;j=true}i=f.getImageData(0,0,g,D);E.putImageData(i,0,0);f.clearRect(0,0,C,H);f.drawImage(F,0,0,g,D,0,0,C,H)}return f.getImageData(0,0,a,h)},lanczosResize:function(G,h,I,M,e){function c(u){return function(w){if(w>u){return 0}w*=Math.PI;if(k(w)<1e-16){return 1}var v=w/u;return p(w)*p(v)/w/v}}function b(u){var v,C,B,w,y,T,E,x,F,z,A;j.x=(u+0.5)*P;L.x=r(j.x);for(v=0;v<e;v++){j.y=(v+0.5)*Q;L.y=r(j.y);y=0,T=0,E=0,x=0,F=0;for(C=L.x-J;C<=L.x+J;C++){if(C<0||C>=h){continue}z=r(1000*k(C-j.x));if(!R[z]){R[z]={}}for(var D=L.y-N;D<=L.y+N;D++){if(D<0||D>=I){continue}A=r(1000*k(D-j.y));if(!R[z][A]){R[z][A]=i(n(q(z*a,2)+q(A*d,2))/1000)}B=R[z][A];if(B>0){w=(D*h+C)*4;y+=B;T+=B*H[w];E+=B*H[w+1];x+=B*H[w+2];F+=B*H[w+3]}}}w=(v*M+u)*4;K[w]=T/y;K[w+1]=E/y;K[w+2]=x/y;K[w+3]=F/y}if(++u<M){return b(u)}else{return f}}var O=G.getContext("2d"),g=O.getImageData(0,0,h,I),f=O.getImageData(0,0,M,e),H=g.data,K=f.data,i=c(this.lanczosLobes),P=this.rcpScaleX,Q=this.rcpScaleY,a=2/this.rcpScaleX,d=2/this.rcpScaleY,J=m(P*this.lanczosLobes/2),N=m(Q*this.lanczosLobes/2),R={},j={},L={};return b(0)},bilinearFiltering:function(X,S,h,T,U){var b,c,e,f,W,x,i,w,g,j,O,y,V=0,Q,Z=this.rcpScaleX,ab=this.rcpScaleY,aa=X.getContext("2d"),R=4*(S-1),a=aa.getImageData(0,0,S,h),P=a.data,Y=aa.getImageData(0,0,T,U),d=Y.data;for(i=0;i<U;i++){for(w=0;w<T;w++){W=r(Z*w);x=r(ab*i);g=Z*w-W;j=ab*i-x;Q=4*(x*S+W);for(O=0;O<4;O++){b=P[Q+O];c=P[Q+4+O];e=P[Q+R+O];f=P[Q+R+4+O];y=b*(1-g)*(1-j)+c*g*(1-j)+e*j*(1-g)+f*g*j;d[V++]=y}}}return Y},hermiteFastResize:function(ag,d,ah,ai,U){var aj=this.rcpScaleX,ad=this.rcpScaleY,R=m(aj/2),Y=m(ad/2),ak=ag.getContext("2d"),a=ak.getImageData(0,0,d,ah),b=a.data,c=ak.getImageData(0,0,ai,U),ae=c.data;for(var j=0;j<U;j++){for(var h=0;h<ai;h++){var f=(h+j*ai)*4,W=0,e=0,V=0,al=0,aa=0,w=0,i=0,X=(j+0.5)*ad;for(var S=r(j*ad);S<(j+1)*ad;S++){var af=k(X-(S+0.5))/Y,T=(h+0.5)*aj,Z=af*af;for(var ac=r(h*aj);ac<(h+1)*aj;ac++){var ab=k(T-(ac+0.5))/R,g=n(Z+ab*ab);if(g>1&&g<-1){continue}W=2*g*g*g-3*g*g+1;if(W>0){ab=4*(ac+S*d);i+=W*b[ab+3];V+=W;if(b[ab+3]<255){W=W*b[ab+3]/250}al+=W*b[ab];aa+=W*b[ab+1];w+=W*b[ab+2];e+=W}}}ae[f]=al/e;ae[f+1]=aa/e;ae[f+2]=w/e;ae[f+3]=i/V}}return c},toObject:function(){return{type:this.type,scaleX:this.scaleX,scaley:this.scaleY,resizeType:this.resizeType,lanczosLobes:this.lanczosLobes}}});s.Image.filters.Resize.fromObject=function(){return new s.Image.filters.Resize()}})(typeof exports!=="undefined"?exports:this);(function(h){var n=h.fabric||(h.fabric={}),j=n.util.object.extend,k=n.util.object.clone,i=n.util.toFixed,m=n.StaticCanvas.supports("setLineDash");if(n.Text){n.warn("fabric.Text is already defined");return}var l=n.Object.prototype.stateProperties.concat();l.push("fontFamily","fontWeight","fontSize","text","textDecoration","textAlign","fontStyle","lineHeight","textBackgroundColor");n.Text=n.util.createClass(n.Object,{_dimensionAffectingProps:{fontSize:true,fontWeight:true,fontFamily:true,fontStyle:true,lineHeight:true,stroke:true,strokeWidth:true,text:true,textAlign:true},_reNewline:/\r?\n/,type:"text",fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",textDecoration:"",textAlign:"left",fontStyle:"",lineHeight:1.16,textBackgroundColor:"",stateProperties:l,stroke:null,shadow:null,_fontSizeFraction:0.25,_fontSizeMult:1.13,initialize:function(a,b){b=b||{};this.text=a;this.__skipDimension=true;this.setOptions(b);this.__skipDimension=false;this._initDimensions()},_initDimensions:function(b){if(this.__skipDimension){return}if(!b){b=n.util.createCanvasElement().getContext("2d");this._setTextStyles(b)}this._textLines=this.text.split(this._reNewline);this._clearCache();var a=this.textAlign;this.textAlign="left";this.width=this._getTextWidth(b);this.textAlign=a;this.height=this._getTextHeight(b)},toString:function(){return"#<fabric.Text ("+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }>'},_render:function(a){this.clipTo&&n.util.clipContext(this,a);this._renderTextBackground(a);this._renderText(a);this._renderTextDecoration(a);this.clipTo&&a.restore()},_renderText:function(a){a.save();this._translateForTextAlign(a);this._setOpacity(a);this._setShadow(a);this._setupCompositeOperation(a);this._renderTextFill(a);this._renderTextStroke(a);this._restoreCompositeOperation(a);this._removeShadow(a);a.restore()},_translateForTextAlign:function(a){if(this.textAlign!=="left"&&this.textAlign!=="justify"){a.translate(this.textAlign==="center"?(this.width/2):this.width,0)}},_setTextStyles:function(a){a.textBaseline="alphabetic";if(!this.skipTextAlign){a.textAlign=this.textAlign}a.font=this._getFontDeclaration()},_getTextHeight:function(){return this._textLines.length*this._getHeightOfLine()},_getTextWidth:function(d){var b=this._getLineWidth(d,0);for(var c=1,e=this._textLines.length;c<e;c++){var a=this._getLineWidth(d,c);if(a>b){b=a}}return b},_renderChars:function(a,e,d,b,c){e[a](d,b,c)},_renderTextLine:function(A,D,B,y,G,E){G-=this.fontSize*this._fontSizeFraction;if(this.textAlign!=="justify"){this._renderChars(A,D,B,y,G,E);return}var c=this._getLineWidth(D,E),d=this.width;if(d>=c){var a=B.split(/\s+/),C=this._getWidthOfWords(D,B,E),e=d-C,f=a.length-1,F=e/f,z=0;for(var g=0,b=a.length;g<b;g++){this._renderChars(A,D,a[g],y+z,G,E);z+=D.measureText(a[g]).width+F}}else{this._renderChars(A,D,B,y,G,E)}},_getWidthOfWords:function(a,b){return a.measureText(b.replace(/\s+/g,"")).width},_getLeftOffset:function(){return -this.width/2},_getTopOffset:function(){return -this.height/2},_renderTextFill:function(d){if(!this.fill&&!this._skipFillStrokeCheck){return}var f=0;for(var c=0,e=this._textLines.length;c<e;c++){var b=this._getHeightOfLine(d,c),a=b/this.lineHeight;this._renderTextLine("fillText",d,this._textLines[c],this._getLeftOffset(),this._getTopOffset()+f+a,c);f+=b}if(this.shadow&&!this.shadow.affectStroke){this._removeShadow(d)}},_renderTextStroke:function(d){if((!this.stroke||this.strokeWidth===0)&&!this._skipFillStrokeCheck){return}var f=0;d.save();if(this.strokeDashArray){if(1&this.strokeDashArray.length){this.strokeDashArray.push.apply(this.strokeDashArray,this.strokeDashArray)}m&&d.setLineDash(this.strokeDashArray)}d.beginPath();for(var c=0,e=this._textLines.length;c<e;c++){var b=this._getHeightOfLine(d,c),a=b/this.lineHeight;this._renderTextLine("strokeText",d,this._textLines[c],this._getLeftOffset(),this._getTopOffset()+f+a,c);f+=b}d.closePath();d.restore()},_getHeightOfLine:function(){return this.fontSize*this._fontSizeMult*this.lineHeight},_renderTextBackground:function(a){this._renderTextBoxBackground(a);this._renderTextLinesBackground(a)},_renderTextBoxBackground:function(a){if(!this.backgroundColor){return}a.save();a.fillStyle=this.backgroundColor;a.fillRect(this._getLeftOffset(),this._getTopOffset(),this.width,this.height);a.restore()},_renderTextLinesBackground:function(c){var g=0,a=this._getHeightOfLine();if(!this.textBackgroundColor){return}c.save();c.fillStyle=this.textBackgroundColor;for(var b=0,d=this._textLines.length;b<d;b++){if(this._textLines[b]!==""){var e=this._getLineWidth(c,b),f=this._getLineLeftOffset(e);c.fillRect(this._getLeftOffset()+f,this._getTopOffset()+g,e,this.fontSize*this._fontSizeMult)}g+=a}c.restore()},_getLineLeftOffset:function(a){if(this.textAlign==="center"){return(this.width-a)/2}if(this.textAlign==="right"){return this.width-a}return 0},_clearCache:function(){this.__lineWidths=[];this.__lineHeights=[];this.__lineOffsets=[]},_shouldClearCache:function(){var a=false;for(var b in this._dimensionAffectingProps){if(this["__"+b]!==this[b]){this["__"+b]=this[b];a=true}}return a},_getLineWidth:function(b,a){if(this.__lineWidths[a]){return this.__lineWidths[a]}this.__lineWidths[a]=b.measureText(this._textLines[a]).width;return this.__lineWidths[a]},_renderTextDecoration:function(d){if(!this.textDecoration){return}var b=this.height/2,a=this,c=[];function e(x){var v,z=0,B,w,A;for(v=0,B=a._textLines.length;v<B;v++){var f=a._getLineWidth(d,v),g=a._getLineLeftOffset(f),y=a._getHeightOfLine(d,v);for(w=0,A=x.length;w<A;w++){d.fillRect(a._getLeftOffset()+g,z+(a._fontSizeMult-1+x[w])*a.fontSize-b,f,a.fontSize/15)}z+=y}}if(this.textDecoration.indexOf("underline")>-1){c.push(0.85)}if(this.textDecoration.indexOf("line-through")>-1){c.push(0.43)}if(this.textDecoration.indexOf("overline")>-1){c.push(-0.12)}if(c.length>0){e(c)}},_getFontDeclaration:function(){return[(n.isLikelyNode?this.fontWeight:this.fontStyle),(n.isLikelyNode?this.fontStyle:this.fontWeight),this.fontSize+"px",(n.isLikelyNode?('"'+this.fontFamily+'"'):this.fontFamily)].join(" ")},render:function(b,a){if(!this.visible){return}b.save();this._setTextStyles(b);if(this._shouldClearCache()){this._initDimensions(b)}if(!a){this.transform(b)}this._setStrokeStyles(b);this._setFillStyles(b);if(this.transformMatrix){b.transform.apply(b,this.transformMatrix)}if(this.group&&this.group.type==="path-group"){b.translate(this.left,this.top)}this._render(b);b.restore()},toObject:function(a){var b=j(this.callSuper("toObject",a),{text:this.text,fontSize:this.fontSize,fontWeight:this.fontWeight,fontFamily:this.fontFamily,fontStyle:this.fontStyle,lineHeight:this.lineHeight,textDecoration:this.textDecoration,textAlign:this.textAlign,textBackgroundColor:this.textBackgroundColor});if(!this.includeDefaultValues){this._removeDefaultValues(b)}return b},toSVG:function(d){var c=this._createBaseSVGMarkup(),a=this._getSVGLeftTopOffsets(this.ctx),b=this._getSVGTextAndBg(a.textTop,a.textLeft);this._wrapSVGTextAndBg(c,b);return d?d(c.join("")):c.join("")},_getSVGLeftTopOffsets:function(b){var a=this._getHeightOfLine(b,0),c=-this.width/2,d=0;return{textLeft:c+(this.group&&this.group.type==="path-group"?this.left:0),textTop:d+(this.group&&this.group.type==="path-group"?-this.top:0),lineTop:a}},_wrapSVGTextAndBg:function(b,a){b.push('\t<g transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'">\n',a.textBgRects.join(""),"\t\t<text ",(this.fontFamily?'font-family="'+this.fontFamily.replace(/"/g,"'")+'" ':""),(this.fontSize?'font-size="'+this.fontSize+'" ':""),(this.fontStyle?'font-style="'+this.fontStyle+'" ':""),(this.fontWeight?'font-weight="'+this.fontWeight+'" ':""),(this.textDecoration?'text-decoration="'+this.textDecoration+'" ':""),'style="',this.getSvgStyles(),'" >',a.textSpans.join(""),"</text>\n","\t</g>\n")},_getSVGTextAndBg:function(c,b){var f=[],g=[],d=0;this._setSVGBg(g);for(var a=0,e=this._textLines.length;a<e;a++){if(this.textBackgroundColor){this._setSVGTextLineBg(g,a,b,c,d)}this._setSVGTextLineText(a,f,d,b,c,g);d+=this._getHeightOfLine(this.ctx,a)}return{textSpans:f,textBgRects:g}},_setSVGTextLineText:function(b,f,d,c,e){var a=this.fontSize*(this._fontSizeMult-this._fontSizeFraction)-e+d-this.height/2;f.push('<tspan x="',i(c+this._getLineLeftOffset(this.__lineWidths[b]),4),'" ','y="',i(a,4),'" ',this._getFillAttributes(this.fill),">",n.util.string.escapeXml(this._textLines[b]),"</tspan>")},_setSVGTextLineBg:function(a,b,c,d,e){a.push("\t\t<rect ",this._getFillAttributes(this.textBackgroundColor),' x="',i(c+this._getLineLeftOffset(this.__lineWidths[b]),4),'" y="',i(e-this.height/2,4),'" width="',i(this.__lineWidths[b],4),'" height="',i(this._getHeightOfLine(this.ctx,b)/this.lineHeight,4),'"></rect>\n')},_setSVGBg:function(a){if(this.backgroundColor){a.push("\t\t<rect ",this._getFillAttributes(this.backgroundColor),' x="',i(-this.width/2,4),'" y="',i(-this.height/2,4),'" width="',i(this.width,4),'" height="',i(this.height,4),'"></rect>\n')}},_getFillAttributes:function(b){var a=(b&&typeof b==="string")?new n.Color(b):"";if(!a||!a.getSource()||a.getAlpha()===1){return'fill="'+b+'"'}return'opacity="'+a.getAlpha()+'" fill="'+a.setAlpha(1).toRgb()+'"'},_set:function(b,a){this.callSuper("_set",b,a);if(b in this._dimensionAffectingProps){this._initDimensions();this.setCoords()}},complexity:function(){return 1}});n.Text.ATTRIBUTE_NAMES=n.SHARED_ATTRIBUTES.concat("x y dx dy font-family font-style font-weight font-size text-decoration text-anchor".split(" "));n.Text.DEFAULT_SVG_FONT_SIZE=16;n.Text.fromElement=function(d,e){if(!d){return null}var b=n.parseAttributes(d,n.Text.ATTRIBUTE_NAMES);e=n.util.object.extend((e?n.util.object.clone(e):{}),b);e.top=e.top||0;e.left=e.left||0;if("dx" in b){e.left+=b.dx}if("dy" in b){e.top+=b.dy}if(!("fontSize" in e)){e.fontSize=n.Text.DEFAULT_SVG_FONT_SIZE}if(!e.originX){e.originX="left"}var c=d.textContent.replace(/^\s+|\s+$|\n+/g,"").replace(/\s+/g," "),a=new n.Text(c,e),f=0;if(a.originX==="left"){f=a.getWidth()/2}if(a.originX==="right"){f=-a.getWidth()/2}a.set({left:a.getLeft()+f,top:a.getTop()-a.getHeight()/2+a.fontSize*(0.18+a._fontSizeFraction)});return a};n.Text.fromObject=function(a){return new n.Text(a.text,k(a))};n.util.createAccessors(n.Text)})(typeof exports!=="undefined"?exports:this);(function(){var b=fabric.util.object.clone;fabric.IText=fabric.util.createClass(fabric.Text,fabric.Observable,{type:"i-text",selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:false,editable:true,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"#333",cursorDelay:1000,cursorDuration:600,styles:null,caching:true,_skipFillStrokeCheck:false,_reSpace:/\s|\n/,_currentCursorOpacity:0,_selectionDirection:null,_abortCursorAnimation:false,_charWidthsCache:{},initialize:function(d,a){this.styles=a?(a.styles||{}):{};this.callSuper("initialize",d,a);this.initBehavior()},_clearCache:function(){this.callSuper("_clearCache");this.__maxFontHeights=[];this.__widthOfSpace=[]},isEmptyStyles:function(){if(!this.styles){return true}var g=this.styles;for(var f in g){for(var h in g[f]){for(var a in g[f][h]){return false}}}return true},setSelectionStart:function(a){a=Math.max(a,0);if(this.selectionStart!==a){this.fire("selection:changed");this.canvas&&this.canvas.fire("text:selection:changed",{target:this});this.selectionStart=a}this._updateTextarea()},setSelectionEnd:function(a){a=Math.min(a,this.text.length);if(this.selectionEnd!==a){this.fire("selection:changed");this.canvas&&this.canvas.fire("text:selection:changed",{target:this});this.selectionEnd=a}this._updateTextarea()},getSelectionStyles:function(g,i){if(arguments.length===2){var j=[];for(var a=g;a<i;a++){j.push(this.getSelectionStyles(a))}return j}var h=this.get2DCursorLocation(g);if(this.styles[h.lineIndex]){return this.styles[h.lineIndex][h.charIndex]||{}}return{}},setSelectionStyles:function(d){if(this.selectionStart===this.selectionEnd){this._extendStyles(this.selectionStart,d)}else{for(var a=this.selectionStart;a<this.selectionEnd;a++){this._extendStyles(a,d)}}this._clearCache();return this},_extendStyles:function(a,f){var e=this.get2DCursorLocation(a);if(!this.styles[e.lineIndex]){this.styles[e.lineIndex]={}}if(!this.styles[e.lineIndex][e.charIndex]){this.styles[e.lineIndex][e.charIndex]={}}fabric.util.object.extend(this.styles[e.lineIndex][e.charIndex],f)},_render:function(a){this.callSuper("_render",a);this.ctx=a;this.isEditing&&this.renderCursorOrSelection()},renderCursorOrSelection:function(){if(!this.active){return}var e=this.text.split(""),f,a;if(this.canvas.contextTop){a=this.canvas.contextTop;a.save();a.transform.apply(a,this.canvas.viewportTransform);this.transform(a)}else{a=this.ctx;a.save()}if(this.selectionStart===this.selectionEnd){f=this._getCursorBoundaries(e,"cursor");this.renderCursor(f,a)}else{f=this._getCursorBoundaries(e,"selection");this.renderSelection(e,f,a)}a.restore()},get2DCursorLocation:function(f){if(typeof f==="undefined"){f=this.selectionStart}var e=this.text.slice(0,f),a=e.split(this._reNewline);return{lineIndex:a.length-1,charIndex:a[a.length-1].length}},getCurrentCharStyle:function(e,f){var a=this.styles[e]&&this.styles[e][f===0?0:(f-1)];return{fontSize:a&&a.fontSize||this.fontSize,fill:a&&a.fill||this.fill,textBackgroundColor:a&&a.textBackgroundColor||this.textBackgroundColor,textDecoration:a&&a.textDecoration||this.textDecoration,fontFamily:a&&a.fontFamily||this.fontFamily,fontWeight:a&&a.fontWeight||this.fontWeight,fontStyle:a&&a.fontStyle||this.fontStyle,stroke:a&&a.stroke||this.stroke,strokeWidth:a&&a.strokeWidth||this.strokeWidth}},getCurrentCharFontSize:function(d,a){return(this.styles[d]&&this.styles[d][a===0?0:(a-1)]&&this.styles[d][a===0?0:(a-1)].fontSize)||this.fontSize},getCurrentCharColor:function(d,a){return(this.styles[d]&&this.styles[d][a===0?0:(a-1)]&&this.styles[d][a===0?0:(a-1)].fill)||this.cursorColor},_getCursorBoundaries:function(i,a){var g=Math.round(this._getLeftOffset()),h=this._getTopOffset(),j=this._getCursorBoundariesOffsets(i,a);return{left:g,top:h,leftOffset:j.left+j.lineLeft,topOffset:j.top}},_getCursorBoundariesOffsets:function(n,a){var l=0,i=0,k=0,o=0,m=0;for(var p=0;p<this.selectionStart;p++){if(n[p]==="\n"){m=0;o+=this._getHeightOfLine(this.ctx,i);i++;k=0}else{m+=this._getWidthOfChar(this.ctx,n[p],i,k);k++}l=this._getCachedLineOffset(i)}if(a==="cursor"){o+=(1-this._fontSizeFraction)*this._getHeightOfLine(this.ctx,i)/this.lineHeight-this.getCurrentCharFontSize(i,k)*(1-this._fontSizeFraction)}return{top:o,left:m,lineLeft:l}},_getCachedLineOffset:function(d){var a=this._getLineWidth(this.ctx,d);return this.__lineOffsets[d]||(this.__lineOffsets[d]=this._getLineLeftOffset(a))},renderCursor:function(n,a){var m=this.get2DCursorLocation(),i=m.lineIndex,j=m.charIndex,k=this.getCurrentCharFontSize(i,j),l=(i===0&&j===0)?this._getCachedLineOffset(i):n.leftOffset;a.fillStyle=this.getCurrentCharColor(i,j);a.globalAlpha=this.__isMousedown?1:this._currentCursorOpacity;a.fillRect(n.left+l,n.top+n.topOffset,this.cursorWidth/this.scaleX,k)},renderSelection:function(u,D,a){a.fillStyle=this.selectionColor;var E=this.get2DCursorLocation(this.selectionStart),z=this.get2DCursorLocation(this.selectionEnd),j=E.lineIndex,C=z.lineIndex;for(var x=j;x<=C;x++){var A=this._getCachedLineOffset(x)||0,t=this._getHeightOfLine(this.ctx,x),w=0,F=this._textLines[x];if(x===j){for(var y=0,v=F.length;y<v;y++){if(y>=E.charIndex&&(x!==C||y<z.charIndex)){w+=this._getWidthOfChar(a,F[y],x,y)}if(y<E.charIndex){A+=this._getWidthOfChar(a,F[y],x,y)}}}else{if(x>j&&x<C){w+=this._getLineWidth(a,x)||5}else{if(x===C){for(var i=0,B=z.charIndex;i<B;i++){w+=this._getWidthOfChar(a,F[i],x,i)}}}}a.fillRect(D.left+A,D.top+D.topOffset,w,t);D.topOffset+=t}},_renderChars:function(B,i,a,A,t,q){if(this.isEmptyStyles()){return this._renderCharsFast(B,i,a,A,t)}this.skipTextAlign=true;A-=this.textAlign==="center"?(this.width/2):(this.textAlign==="right")?this.width:0;var r=this._getHeightOfLine(i,q),y=this._getCachedLineOffset(q),u=a.split(""),s,x="";A+=y||0;i.save();t-=r/this.lineHeight*this._fontSizeFraction;for(var z=0,v=u.length;z<=v;z++){s=s||this.getCurrentCharStyle(q,z);var w=this.getCurrentCharStyle(q,z+1);if(this._hasStyleChanged(s,w)||z===v){this._renderChar(B,i,q,z-1,x,A,t,r);x="";s=w}x+=u[z]}i.restore()},_renderCharsFast:function(g,j,a,h,i){this.skipTextAlign=false;if(g==="fillText"&&this.fill){this.callSuper("_renderChars",g,j,a,h,i)}if(g==="strokeText"&&((this.stroke&&this.strokeWidth>0)||this.skipFillStrokeCheck)){this.callSuper("_renderChars",g,j,a,h,i)}},_renderChar:function(B,a,i,w,q,z,t,r){var u,v,A,y=this._fontSizeFraction*r/this.lineHeight;if(this.styles&&this.styles[i]&&(u=this.styles[i][w])){var s=u.stroke||this.stroke,x=u.fill||this.fill;a.save();v=this._applyCharStylesGetWidth(a,q,i,w,u);A=this._getHeightOfChar(a,q,i,w);if(x){a.fillText(q,z,t)}if(s){a.strokeText(q,z,t)}this._renderCharDecoration(a,u,z,t,y,v,A);a.restore();a.translate(v,0)}else{if(B==="strokeText"&&this.stroke){a[B](q,z,t)}if(B==="fillText"&&this.fill){a[B](q,z,t)}v=this._applyCharStylesGetWidth(a,q,i,w);this._renderCharDecoration(a,null,z,t,y,v,this.fontSize);a.translate(a.measureText(q).width,0)}},_hasStyleChanged:function(a,d){return(a.fill!==d.fill||a.fontSize!==d.fontSize||a.textBackgroundColor!==d.textBackgroundColor||a.textDecoration!==d.textDecoration||a.fontFamily!==d.fontFamily||a.fontWeight!==d.fontWeight||a.fontStyle!==d.fontStyle||a.stroke!==d.stroke||a.strokeWidth!==d.strokeWidth)},_renderCharDecoration:function(p,o,k,l,j,a,m){var n=o?(o.textDecoration||this.textDecoration):this.textDecoration;if(!n){return}if(n.indexOf("underline")>-1){p.fillRect(k,l+m/10,a,m/15)}if(n.indexOf("line-through")>-1){p.fillRect(k,l-m*(this._fontSizeFraction+this._fontSizeMult-1)+m/15,a,m/15)}if(n.indexOf("overline")>-1){p.fillRect(k,l-(this._fontSizeMult-this._fontSizeFraction)*m,a,m/15)}},_renderTextLine:function(h,l,a,j,k,i){if(!this.isEmptyStyles()){k+=this.fontSize*(this._fontSizeFraction+0.03)}this.callSuper("_renderTextLine",h,l,a,j,k,i)},_renderTextDecoration:function(a){if(this.isEmptyStyles()){return this.callSuper("_renderTextDecoration",a)}},_renderTextLinesBackground:function(a){if(!this.textBackgroundColor&&!this.styles){return}a.save();if(this.textBackgroundColor){a.fillStyle=this.textBackgroundColor}var n=0;for(var r=0,o=this._textLines.length;r<o;r++){var t=this._getHeightOfLine(a,r);if(this._textLines[r]===""){n+=t;continue}var p=this._getLineWidth(a,r),q=this._getCachedLineOffset(r);if(this.textBackgroundColor){a.fillStyle=this.textBackgroundColor;a.fillRect(this._getLeftOffset()+q,this._getTopOffset()+n,p,t/this.lineHeight)}if(this.styles[r]){for(var s=0,i=this._textLines[r].length;s<i;s++){if(this.styles[r]&&this.styles[r][s]&&this.styles[r][s].textBackgroundColor){var j=this._textLines[r][s];a.fillStyle=this.styles[r][s].textBackgroundColor;a.fillRect(this._getLeftOffset()+q+this._getWidthOfCharsAt(a,r,s),this._getTopOffset()+n,this._getWidthOfChar(a,j,r,s)+1,t/this.lineHeight)}}}n+=t}a.restore()},_getCacheProp:function(a,d){return a+d.fontFamily+d.fontSize+d.fontWeight+d.fontStyle+d.shadow},_applyCharStylesGetWidth:function(p,o,j,k,a){var m=a||(this.styles[j]&&this.styles[j][k]);if(m){m=b(m)}else{m={}}this._applyFontStyles(m);var n=this._getCacheProp(o,m);if(this.isEmptyStyles()&&this._charWidthsCache[n]&&this.caching){return this._charWidthsCache[n]}if(typeof m.shadow==="string"){m.shadow=new fabric.Shadow(m.shadow)}var l=m.fill||this.fill;p.fillStyle=l.toLive?l.toLive(p,this):l;if(m.stroke){p.strokeStyle=(m.stroke&&m.stroke.toLive)?m.stroke.toLive(p,this):m.stroke}p.lineWidth=m.strokeWidth||this.strokeWidth;p.font=this._getFontDeclaration.call(m);this._setShadow.call(m,p);if(!this.caching){return p.measureText(o).width}if(!this._charWidthsCache[n]){this._charWidthsCache[n]=p.measureText(o).width}return this._charWidthsCache[n]},_applyFontStyles:function(a){if(!a.fontFamily){a.fontFamily=this.fontFamily}if(!a.fontSize){a.fontSize=this.fontSize}if(!a.fontWeight){a.fontWeight=this.fontWeight}if(!a.fontStyle){a.fontStyle=this.fontStyle}},_getStyleDeclaration:function(d,a){return(this.styles[d]&&this.styles[d][a])?b(this.styles[d][a]):{}},_getWidthOfChar:function(a,n,i,j){if(this.textAlign==="justify"&&/\s/.test(n)){return this._getWidthOfSpace(a,i)}var k=this._getStyleDeclaration(i,j);this._applyFontStyles(k);var m=this._getCacheProp(n,k);if(this._charWidthsCache[m]&&this.caching){return this._charWidthsCache[m]}else{if(a){a.save();var l=this._applyCharStylesGetWidth(a,n,i,j);a.restore();return l}}},_getHeightOfChar:function(a,h,f,g){if(this.styles[f]&&this.styles[f][g]){return this.styles[f][g].fontSize||this.fontSize}return this.fontSize},_getHeightOfCharAt:function(a,f,g){var h=this._textLines[f][g];return this._getHeightOfChar(a,h,f,g)},_getWidthOfCharsAt:function(a,h,i){var j=0,k,l;for(k=0;k<i;k++){l=this._textLines[h][k];j+=this._getWidthOfChar(a,l,h,k)}return j},_getLineWidth:function(a,d){if(this.__lineWidths[d]){return this.__lineWidths[d]}this.__lineWidths[d]=this._getWidthOfCharsAt(a,d,this._textLines[d].length);return this.__lineWidths[d]},_getWidthOfSpace:function(n,i){if(this.__widthOfSpace[i]){return this.__widthOfSpace[i]}var a=this._textLines[i],j=this._getWidthOfWords(n,a,i),k=this.width-j,m=a.length-a.replace(/\s+/g,"").length,l=k/m;this.__widthOfSpace[i]=l;return l},_getWidthOfWords:function(l,a,h){var j=0;for(var i=0;i<a.length;i++){var k=a[i];if(!k.match(/\s/)){j+=this._getWidthOfChar(l,k,h,i)}}return j},_getHeightOfLine:function(m,i){if(this.__lineHeights[i]){return this.__lineHeights[i]}var n=this._textLines[i],k=this._getHeightOfChar(m,n[0],i,0);for(var l=1,a=n.length;l<a;l++){var j=this._getHeightOfChar(m,n[l],i,l);if(j>k){k=j}}this.__maxFontHeights[i]=k;this.__lineHeights[i]=k*this.lineHeight*this._fontSizeMult;return this.__lineHeights[i]},_getTextHeight:function(g){var h=0;for(var f=0,a=this._textLines.length;f<a;f++){h+=this._getHeightOfLine(g,f)}return h},_renderTextBoxBackground:function(a){if(!this.backgroundColor){return}a.save();a.fillStyle=this.backgroundColor;a.fillRect(this._getLeftOffset(),this._getTopOffset(),this.width,this.height);a.restore()},toObject:function(a){return fabric.util.object.extend(this.callSuper("toObject",a),{styles:b(this.styles)})}});fabric.IText.fromObject=function(a){return new fabric.IText(a.text,b(a))}})();(function(){var b=fabric.util.object.clone;fabric.util.object.extend(fabric.IText.prototype,{initBehavior:function(){this.initAddedHandler();this.initRemovedHandler();this.initCursorSelectionHandlers();this.initDoubleClickSimulation()},initSelectedHandler:function(){this.on("selected",function(){var a=this;setTimeout(function(){a.selected=true},100)})},initAddedHandler:function(){var a=this;this.on("added",function(){if(this.canvas&&!this.canvas._hasITextHandlers){this.canvas._hasITextHandlers=true;this._initCanvasHandlers()}if(a.canvas){a.canvas._iTextInstances=a.canvas._iTextInstances||[];a.canvas._iTextInstances.push(a)}})},initRemovedHandler:function(){var a=this;this.on("removed",function(){if(a.canvas){a.canvas._iTextInstances=a.canvas._iTextInstances||[];fabric.util.removeFromArray(a.canvas._iTextInstances,a)}})},_initCanvasHandlers:function(){var a=this;this.canvas.on("selection:cleared",function(){fabric.IText.prototype.exitEditingOnOthers(a.canvas)});this.canvas.on("mouse:up",function(){if(a.canvas._iTextInstances){a.canvas._iTextInstances.forEach(function(d){d.__isMousedown=false})}});this.canvas.on("object:selected",function(){fabric.IText.prototype.exitEditingOnOthers(a.canvas)})},_tick:function(){this._currentTickState=this._animateCursor(this,1,this.cursorDuration,"_onTickComplete")},_animateCursor:function(h,j,i,g){var a;a={isAborted:false,abort:function(){this.isAborted=true},};h.animate("_currentCursorOpacity",j,{duration:i,onComplete:function(){if(!a.isAborted){h[g]()}},onChange:function(){if(h.canvas){h.canvas.clearContext(h.canvas.contextTop||h.ctx);h.renderCursorOrSelection()}},abort:function(){return a.isAborted}});return a},_onTickComplete:function(){var a=this;if(this._cursorTimeout1){clearTimeout(this._cursorTimeout1)}this._cursorTimeout1=setTimeout(function(){a._currentTickCompleteState=a._animateCursor(a,0,this.cursorDuration/2,"_tick")},100)},initDelayedCursor:function(a){var e=this,f=a?0:this.cursorDelay;this._currentTickState&&this._currentTickState.abort();this._currentTickCompleteState&&this._currentTickCompleteState.abort();clearTimeout(this._cursorTimeout1);this._currentCursorOpacity=1;if(this.canvas){this.canvas.clearContext(this.canvas.contextTop||this.ctx);this.renderCursorOrSelection()}if(this._cursorTimeout2){clearTimeout(this._cursorTimeout2)}this._cursorTimeout2=setTimeout(function(){e._tick()},f)},abortCursorAnimation:function(){this._currentTickState&&this._currentTickState.abort();this._currentTickCompleteState&&this._currentTickCompleteState.abort();clearTimeout(this._cursorTimeout1);clearTimeout(this._cursorTimeout2);this._currentCursorOpacity=0;this.canvas&&this.canvas.clearContext(this.canvas.contextTop||this.ctx)},selectAll:function(){this.setSelectionStart(0);this.setSelectionEnd(this.text.length)},getSelectedText:function(){return this.text.slice(this.selectionStart,this.selectionEnd)},findWordBoundaryLeft:function(f){var e=0,a=f-1;if(this._reSpace.test(this.text.charAt(a))){while(this._reSpace.test(this.text.charAt(a))){e++;a--}}while(/\S/.test(this.text.charAt(a))&&a>-1){e++;a--}return f-e},findWordBoundaryRight:function(f){var e=0,a=f;if(this._reSpace.test(this.text.charAt(a))){while(this._reSpace.test(this.text.charAt(a))){e++;a++}}while(/\S/.test(this.text.charAt(a))&&a<this.text.length){e++;a++}return f+e},findLineBoundaryLeft:function(f){var e=0,a=f-1;while(!/\n/.test(this.text.charAt(a))&&a>-1){e++;a--}return f-e},findLineBoundaryRight:function(f){var e=0,a=f;while(!/\n/.test(this.text.charAt(a))&&a<this.text.length){e++;a++}return f+e},getNumNewLinesInSelectedText:function(){var g=this.getSelectedText(),h=0;for(var j=0,i=g.split(""),a=i.length;j<a;j++){if(i[j]==="\n"){h++}}return h},searchWordBoundary:function(h,g){var i=this._reSpace.test(this.text.charAt(h))?h-1:h,j=this.text.charAt(i),a=/[ \n\.,;!\?\-]/;while(!a.test(j)&&i>0&&i<this.text.length){i+=g;j=this.text.charAt(i)}if(a.test(j)&&j!=="\n"){i+=g===1?0:1}return i},selectWord:function(e){var a=this.searchWordBoundary(e,-1),f=this.searchWordBoundary(e,1);this.setSelectionStart(a);this.setSelectionEnd(f)},selectLine:function(e){var a=this.findLineBoundaryLeft(e),f=this.findLineBoundaryRight(e);this.setSelectionStart(a);this.setSelectionEnd(f)},enterEditing:function(){if(this.isEditing||!this.editable){return}if(this.canvas){this.exitEditingOnOthers(this.canvas)}this.isEditing=true;this.initHiddenTextarea();this.hiddenTextarea.focus();this._updateTextarea();this._saveEditingProps();this._setEditingProps();this._tick();this.fire("editing:entered");if(!this.canvas){return this}this.canvas.renderAll();this.canvas.fire("text:editing:entered",{target:this});this.initMouseMoveHandler();return this},exitEditingOnOthers:function(a){if(a._iTextInstances){a._iTextInstances.forEach(function(d){d.selected=false;if(d.isEditing){d.exitEditing()}})}},initMouseMoveHandler:function(){var a=this;this.canvas.on("mouse:move",function(e){if(!a.__isMousedown||!a.isEditing){return}var f=a.getSelectionStartFromPointer(e.e);if(f>=a.__selectionStartOnMouseDown){a.setSelectionStart(a.__selectionStartOnMouseDown);a.setSelectionEnd(f)}else{a.setSelectionStart(f);a.setSelectionEnd(a.__selectionStartOnMouseDown)}})},_setEditingProps:function(){this.hoverCursor="text";if(this.canvas){this.canvas.defaultCursor=this.canvas.moveCursor="text"}this.borderColor=this.editingBorderColor;this.hasControls=this.selectable=false;this.lockMovementX=this.lockMovementY=true},_updateTextarea:function(){if(!this.hiddenTextarea){return}this.hiddenTextarea.value=this.text;this.hiddenTextarea.selectionStart=this.selectionStart;this.hiddenTextarea.selectionEnd=this.selectionEnd},_saveEditingProps:function(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}},_restoreEditingProps:function(){if(!this._savedProps){return}this.hoverCursor=this._savedProps.overCursor;this.hasControls=this._savedProps.hasControls;this.borderColor=this._savedProps.borderColor;this.lockMovementX=this._savedProps.lockMovementX;this.lockMovementY=this._savedProps.lockMovementY;if(this.canvas){this.canvas.defaultCursor=this._savedProps.defaultCursor;this.canvas.moveCursor=this._savedProps.moveCursor}},exitEditing:function(){this.selected=false;this.isEditing=false;this.selectable=true;this.selectionEnd=this.selectionStart;this.hiddenTextarea&&this.canvas&&this.hiddenTextarea.parentNode.removeChild(this.hiddenTextarea);this.hiddenTextarea=null;this.abortCursorAnimation();this._restoreEditingProps();this._currentCursorOpacity=0;this.fire("editing:exited");this.canvas&&this.canvas.fire("text:editing:exited",{target:this});return this},_removeExtraneousStyles:function(){for(var a in this.styles){if(!this._textLines[a]){delete this.styles[a]}}},_removeCharsFromTo:function(h,a){var j=a;while(j!==h){var k=this.get2DCursorLocation(j).charIndex;j--;var l=this.get2DCursorLocation(j).charIndex,i=l>k;if(i){this.removeStyleObject(i,j+1)}else{this.removeStyleObject(this.get2DCursorLocation(j).charIndex===0,j)}}this.text=this.text.slice(0,h)+this.text.slice(a);this._clearCache()},insertChars:function(f,a){var e=this.text.slice(this.selectionStart,this.selectionStart+1)==="\n";this.text=this.text.slice(0,this.selectionStart)+f+this.text.slice(this.selectionEnd);if(this.selectionStart===this.selectionEnd){this.insertStyleObjects(f,e,a)}this.setSelectionStart(this.selectionStart+f.length);this.setSelectionEnd(this.selectionStart);this._clearCache();this.canvas&&this.canvas.renderAll();this.setCoords();this.fire("changed");this.canvas&&this.canvas.fire("text:changed",{target:this})},insertNewlineStyleObject:function(h,i,k){this.shiftLineStyles(h,+1);if(!this.styles[h+1]){this.styles[h+1]={}}var a=this.styles[h][i-1],j={};if(k){j[0]=b(a);this.styles[h+1]=j}else{for(var l in this.styles[h]){if(parseInt(l,10)>=i){j[parseInt(l,10)-i]=this.styles[h][l];delete this.styles[h][l]}}this.styles[h+1]=j}this._clearCache()},insertCharStyleObject:function(i,j,l){var n=this.styles[i],k=b(n);if(j===0&&!l){j=1}for(var a in k){var m=parseInt(a,10);if(m>=j){n[m+1]=k[m]}}this.styles[i][j]=l||b(n[j-1]);this._clearCache()},insertStyleObjects:function(l,j,a){var k=this.get2DCursorLocation(),h=k.lineIndex,i=k.charIndex;if(!this.styles[h]){this.styles[h]={}}if(l==="\n"){this.insertNewlineStyleObject(h,i,j)}else{if(a){this._insertStyles(this.copiedStyles)}else{this.insertCharStyleObject(h,i)}}},_insertStyles:function(j){for(var k=0,a=j.length;k<a;k++){var l=this.get2DCursorLocation(this.selectionStart+k),h=l.lineIndex,i=l.charIndex;this.insertCharStyleObject(h,i,j[k])}},shiftLineStyles:function(g,h){var i=b(this.styles);for(var a in this.styles){var j=parseInt(a,10);if(j>g){this.styles[j+h]=i[j]}}},removeStyleObject:function(v,p){var o=this.get2DCursorLocation(p),a=o.lineIndex,x=o.charIndex;if(v){var r=this._textLines[a-1],i=r?r.length:0;if(!this.styles[a-1]){this.styles[a-1]={}}for(x in this.styles[a]){this.styles[a-1][parseInt(x,10)+i]=this.styles[a][x]}this.shiftLineStyles(a,-1)}else{var q=this.styles[a];if(q){var t=this.selectionStart===this.selectionEnd?-1:0;delete q[x+t]}var w=b(q);for(var s in w){var u=parseInt(s,10);if(u>=x&&u!==0){q[u-1]=w[u];delete q[u]}}}},insertNewline:function(){this.insertChars("\n")}})})();fabric.util.object.extend(fabric.IText.prototype,{initDoubleClickSimulation:function(){this.__lastClickTime=+new Date();this.__lastLastClickTime=+new Date();this.__lastPointer={};this.on("mousedown",this.onMouseDown.bind(this))},onMouseDown:function(d){this.__newClickTime=+new Date();var c=this.canvas.getPointer(d.e);if(this.isTripleClick(c)){this.fire("tripleclick",d);this._stopEvent(d.e)}else{if(this.isDoubleClick(c)){this.fire("dblclick",d);this._stopEvent(d.e)}}this.__lastLastClickTime=this.__lastClickTime;this.__lastClickTime=this.__newClickTime;this.__lastPointer=c;this.__lastIsEditing=this.isEditing;this.__lastSelected=this.selected},isDoubleClick:function(b){return this.__newClickTime-this.__lastClickTime<500&&this.__lastPointer.x===b.x&&this.__lastPointer.y===b.y&&this.__lastIsEditing},isTripleClick:function(b){return this.__newClickTime-this.__lastClickTime<500&&this.__lastClickTime-this.__lastLastClickTime<500&&this.__lastPointer.x===b.x&&this.__lastPointer.y===b.y},_stopEvent:function(b){b.preventDefault&&b.preventDefault();b.stopPropagation&&b.stopPropagation()},initCursorSelectionHandlers:function(){this.initSelectedHandler();this.initMousedownHandler();this.initMouseupHandler();this.initClicks()},initClicks:function(){this.on("dblclick",function(b){this.selectWord(this.getSelectionStartFromPointer(b.e))});this.on("tripleclick",function(b){this.selectLine(this.getSelectionStartFromPointer(b.e))})},initMousedownHandler:function(){this.on("mousedown",function(d){var c=this.canvas.getPointer(d.e);this.__mousedownX=c.x;this.__mousedownY=c.y;this.__isMousedown=true;if(this.hiddenTextarea&&this.canvas){this.canvas.wrapperEl.appendChild(this.hiddenTextarea)}if(this.selected){this.setCursorByClick(d.e)}if(this.isEditing){this.__selectionStartOnMouseDown=this.selectionStart;this.initDelayedCursor(true)}})},_isObjectMoved:function(d){var c=this.canvas.getPointer(d);return this.__mousedownX!==c.x||this.__mousedownY!==c.y},initMouseupHandler:function(){this.on("mouseup",function(b){this.__isMousedown=false;if(this._isObjectMoved(b.e)){return}if(this.__lastSelected){this.enterEditing();this.initDelayedCursor(true)}this.selected=true})},setCursorByClick:function(c){var d=this.getSelectionStartFromPointer(c);if(c.shiftKey){if(d<this.selectionStart){this.setSelectionEnd(this.selectionStart);this.setSelectionStart(d)}else{this.setSelectionEnd(d)}}else{this.setSelectionStart(d);this.setSelectionEnd(d)}},_getLocalRotatedPointer:function(i){var h=this.canvas.getPointer(i),j=new fabric.Point(h.x,h.y),g=new fabric.Point(this.left,this.top),e=fabric.util.rotatePoint(j,g,fabric.util.degreesToRadians(-this.angle));return this.getLocalPointer(i,e)},getSelectionStartFromPointer:function(u){var x=this._getLocalRotatedPointer(u),s=0,C=0,i=0,D=0,B,e;for(var y=0,v=this._textLines.length;y<v;y++){e=this._textLines[y].split("");i+=this._getHeightOfLine(this.ctx,y)*this.scaleY;var z=this._getLineWidth(this.ctx,y),w=this._getLineLeftOffset(z);C=w*this.scaleX;if(this.flipX){this._textLines[y]=e.reverse().join("")}for(var A=0,j=e.length;A<j;A++){var t=e[A];s=C;C+=this._getWidthOfChar(this.ctx,t,y,this.flipX?j-A:A)*this.scaleX;if(i<=x.y||C<=x.x){D++;continue}return this._getNewSelectionStartFromOffset(x,s,C,D+y,j)}if(x.y<i){return this._getNewSelectionStartFromOffset(x,s,C,D+y,j)}}if(typeof B==="undefined"){return this.text.length}},_getNewSelectionStartFromOffset:function(o,l,r,m,j){var n=o.x-l,k=r-o.x,p=k>n?0:1,q=m+p;if(this.flipX){q=j-q}if(q>this.text.length){q=this.text.length}return q}});fabric.util.object.extend(fabric.IText.prototype,{initHiddenTextarea:function(){this.hiddenTextarea=fabric.document.createElement("textarea");this.hiddenTextarea.setAttribute("autocapitalize","off");this.hiddenTextarea.style.cssText="position: fixed; bottom: 20px; left: 0px; opacity: 0; width: 0px; height: 0px; z-index: -999;";fabric.document.body.appendChild(this.hiddenTextarea);fabric.util.addListener(this.hiddenTextarea,"keydown",this.onKeyDown.bind(this));fabric.util.addListener(this.hiddenTextarea,"keypress",this.onKeyPress.bind(this));fabric.util.addListener(this.hiddenTextarea,"copy",this.copy.bind(this));fabric.util.addListener(this.hiddenTextarea,"paste",this.paste.bind(this));if(!this._clickHandlerInitialized&&this.canvas){fabric.util.addListener(this.canvas.upperCanvasEl,"click",this.onClick.bind(this));this._clickHandlerInitialized=true}},_keysMap:{8:"removeChars",9:"exitEditing",27:"exitEditing",13:"insertNewline",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorRight",36:"moveCursorLeft",37:"moveCursorLeft",38:"moveCursorUp",39:"moveCursorRight",40:"moveCursorDown",46:"forwardDelete"},_ctrlKeysMap:{65:"selectAll",88:"cut"},onClick:function(){this.hiddenTextarea&&this.hiddenTextarea.focus()},onKeyDown:function(b){if(!this.isEditing){return}if(b.keyCode in this._keysMap){this[this._keysMap[b.keyCode]](b)}else{if((b.keyCode in this._ctrlKeysMap)&&(b.ctrlKey||b.metaKey)){this[this._ctrlKeysMap[b.keyCode]](b)}else{return}}b.stopImmediatePropagation();b.preventDefault();this.canvas&&this.canvas.renderAll()},forwardDelete:function(b){if(this.selectionStart===this.selectionEnd){this.moveCursorRight(b)}this.removeChars(b)},copy:function(e){var f=this.getSelectedText(),d=this._getClipboardData(e);if(d){d.setData("text",f)}this.copiedText=f;this.copiedStyles=this.getSelectionStyles(this.selectionStart,this.selectionEnd)},paste:function(d){var e=null,f=this._getClipboardData(d);if(f){e=f.getData("text")}else{e=this.copiedText}if(e){this.insertChars(e,true)}},cut:function(b){if(this.selectionStart===this.selectionEnd){return}this.copy();this.removeChars(b)},_getClipboardData:function(b){return b&&(b.clipboardData||fabric.window.clipboardData)},onKeyPress:function(b){if(!this.isEditing||b.metaKey||b.ctrlKey){return}if(b.which!==0){this.insertChars(String.fromCharCode(b.which))}b.stopPropagation()},getDownCursorOffset:function(y,u){var B=u?this.selectionEnd:this.selectionStart,i,A,D=this.text.slice(0,B),t=this.text.slice(B),x=D.slice(D.lastIndexOf("\n")+1),v=t.match(/(.*)\n?/)[1],F=(t.match(/.*\n(.*)\n?/)||{})[1]||"",w=this.get2DCursorLocation(B);if(w.lineIndex===this._textLines.length-1||y.metaKey||y.keyCode===34){return this.text.length-B}var G=this._getLineWidth(this.ctx,w.lineIndex);A=this._getLineLeftOffset(G);var E=A,H=w.lineIndex;for(var C=0,z=x.length;C<z;C++){i=x[C];E+=this._getWidthOfChar(this.ctx,i,H,C)}var e=this._getIndexOnNextLine(w,F,E);return v.length+1+e},_getIndexOnNextLine:function(w,G,E){var j=w.lineIndex+1,C=this._getLineWidth(this.ctx,j),z=this._getLineLeftOffset(C),D=z,s=0,x;for(var B=0,t=G.length;B<t;B++){var u=G[B],y=this._getWidthOfChar(this.ctx,u,j,B);D+=y;if(D>E){x=true;var H=D-y,v=D,A=Math.abs(H-E),F=Math.abs(v-E);s=F<A?B+1:B;break}}if(!x){s=G.length}return s},moveCursorDown:function(d){this.abortCursorAnimation();this._currentCursorOpacity=1;var c=this.getDownCursorOffset(d,this._selectionDirection==="right");if(d.shiftKey){this.moveCursorDownWithShift(c)}else{this.moveCursorDownWithoutShift(c)}this.initDelayedCursor()},moveCursorDownWithoutShift:function(b){this._selectionDirection="right";this.setSelectionStart(this.selectionStart+b);this.setSelectionEnd(this.selectionStart)},swapSelectionPoints:function(){var b=this.selectionEnd;this.setSelectionEnd(this.selectionStart);this.setSelectionStart(b)},moveCursorDownWithShift:function(b){if(this.selectionEnd===this.selectionStart){this._selectionDirection="right"}if(this._selectionDirection==="right"){this.setSelectionEnd(this.selectionEnd+b)}else{this.setSelectionStart(this.selectionStart+b)}if(this.selectionEnd<this.selectionStart&&this._selectionDirection==="left"){this.swapSelectionPoints();this._selectionDirection="right"}if(this.selectionEnd>this.text.length){this.setSelectionEnd(this.text.length)}},getUpCursorOffset:function(v,r){var z=r?this.selectionEnd:this.selectionStart,s=this.get2DCursorLocation(z);if(s.lineIndex===0||v.metaKey||v.keyCode===33){return z}var B=this.text.slice(0,z),u=B.slice(B.lastIndexOf("\n")+1),y=(B.match(/\n?(.*)\n.*$/)||{})[1]||"",i,D=this._getLineWidth(this.ctx,s.lineIndex),x=this._getLineLeftOffset(D),C=x,e=s.lineIndex;for(var A=0,w=u.length;A<w;A++){i=u[A];C+=this._getWidthOfChar(this.ctx,i,e,A)}var t=this._getIndexOnPrevLine(s,y,C);return y.length-t+u.length},_getIndexOnPrevLine:function(x,B,E){var j=x.lineIndex-1,s=this._getLineWidth(this.ctx,j),A=this._getLineLeftOffset(s),G=A,w=0,y;for(var D=0,t=B.length;D<t;D++){var u=B[D],z=this._getWidthOfChar(this.ctx,u,j,D);G+=z;if(G>E){y=true;var H=G-z,v=G,C=Math.abs(H-E),F=Math.abs(v-E);w=F<C?D:(D-1);break}}if(!y){w=B.length-1}return w},moveCursorUp:function(d){this.abortCursorAnimation();this._currentCursorOpacity=1;var c=this.getUpCursorOffset(d,this._selectionDirection==="right");if(d.shiftKey){this.moveCursorUpWithShift(c)}else{this.moveCursorUpWithoutShift(c)}this.initDelayedCursor()},moveCursorUpWithShift:function(b){if(this.selectionEnd===this.selectionStart){this._selectionDirection="left"}if(this._selectionDirection==="right"){this.setSelectionEnd(this.selectionEnd-b)}else{this.setSelectionStart(this.selectionStart-b)}if(this.selectionEnd<this.selectionStart&&this._selectionDirection==="right"){this.swapSelectionPoints();this._selectionDirection="left"}},moveCursorUpWithoutShift:function(b){if(this.selectionStart===this.selectionEnd){this.setSelectionStart(this.selectionStart-b)}this.setSelectionEnd(this.selectionStart);this._selectionDirection="left"},moveCursorLeft:function(b){if(this.selectionStart===0&&this.selectionEnd===0){return}this.abortCursorAnimation();this._currentCursorOpacity=1;if(b.shiftKey){this.moveCursorLeftWithShift(b)}else{this.moveCursorLeftWithoutShift(b)}this.initDelayedCursor()},_move:function(h,g,e){var f=(g==="selectionStart"?"setSelectionStart":"setSelectionEnd");if(h.altKey){this[f](this["findWordBoundary"+e](this[g]))}else{if(h.metaKey||h.keyCode===35||h.keyCode===36){this[f](this["findLineBoundary"+e](this[g]))}else{this[f](this[g]+(e==="Left"?-1:1))}}},_moveLeft:function(d,c){this._move(d,c,"Left")},_moveRight:function(d,c){this._move(d,c,"Right")},moveCursorLeftWithoutShift:function(b){this._selectionDirection="left";if(this.selectionEnd===this.selectionStart){this._moveLeft(b,"selectionStart")}this.setSelectionEnd(this.selectionStart)},moveCursorLeftWithShift:function(b){if(this._selectionDirection==="right"&&this.selectionStart!==this.selectionEnd){this._moveLeft(b,"selectionEnd")}else{this._selectionDirection="left";this._moveLeft(b,"selectionStart");if(this.text.charAt(this.selectionStart)==="\n"){this.setSelectionStart(this.selectionStart-1)}}},moveCursorRight:function(b){if(this.selectionStart>=this.text.length&&this.selectionEnd>=this.text.length){return}this.abortCursorAnimation();this._currentCursorOpacity=1;if(b.shiftKey){this.moveCursorRightWithShift(b)}else{this.moveCursorRightWithoutShift(b)}this.initDelayedCursor()},moveCursorRightWithShift:function(b){if(this._selectionDirection==="left"&&this.selectionStart!==this.selectionEnd){this._moveRight(b,"selectionStart")}else{this._selectionDirection="right";this._moveRight(b,"selectionEnd");if(this.text.charAt(this.selectionEnd-1)==="\n"){this.setSelectionEnd(this.selectionEnd+1)}}},moveCursorRightWithoutShift:function(b){this._selectionDirection="right";if(this.selectionStart===this.selectionEnd){this._moveRight(b,"selectionStart");this.setSelectionEnd(this.selectionStart)}else{this.setSelectionEnd(this.selectionEnd+this.getNumNewLinesInSelectedText());this.setSelectionStart(this.selectionEnd)}},removeChars:function(b){if(this.selectionStart===this.selectionEnd){this._removeCharsNearCursor(b)}else{this._removeCharsFromTo(this.selectionStart,this.selectionEnd)}this.setSelectionEnd(this.selectionStart);this._removeExtraneousStyles();this._clearCache();this.canvas&&this.canvas.renderAll();this.setCoords();this.fire("changed");this.canvas&&this.canvas.fire("text:changed",{target:this})},_removeCharsNearCursor:function(g){if(this.selectionStart!==0){if(g.metaKey){var f=this.findLineBoundaryLeft(this.selectionStart);this._removeCharsFromTo(f,this.selectionStart);this.setSelectionStart(f)}else{if(g.altKey){var h=this.findWordBoundaryLeft(this.selectionStart);this._removeCharsFromTo(h,this.selectionStart);this.setSelectionStart(h)}else{var e=this.text.slice(this.selectionStart-1,this.selectionStart)==="\n";this.removeStyleObject(e);this.setSelectionStart(this.selectionStart-1);this.text=this.text.slice(0,this.selectionStart)+this.text.slice(this.selectionStart+1)}}}}});fabric.util.object.extend(fabric.IText.prototype,{_setSVGTextLineText:function(i,j,g,l,h,k){if(!this.styles[i]){this.callSuper("_setSVGTextLineText",i,j,g,l,h)}else{this._setSVGTextLineChars(i,j,g,l,k)}},_setSVGTextLineChars:function(i,B,p,z,x){var s=this._textLines[i].split(""),r=0,v=this._getSVGLineLeftOffset(i)-this.width/2,y=this._getSVGLineTopOffset(i),A=this._getHeightOfLine(this.ctx,i);for(var w=0,u=s.length;w<u;w++){var q=this.styles[i][w]||{};B.push(this._createTextCharSpan(s[w],q,v,y.lineTop+y.offset,r));var t=this._getWidthOfChar(this.ctx,s[w],i,w);if(q.textBackgroundColor){x.push(this._createTextCharBg(q,v,y.lineTop,A,t,r))}r+=t}},_getSVGLineLeftOffset:function(b){return fabric.util.toFixed(this._getLineLeftOffset(this.__lineWidths[b]),2)},_getSVGLineTopOffset:function(g){var h=0,e=0;for(var f=0;f<g;f++){h+=this._getHeightOfLine(this.ctx,f)}e=this._getHeightOfLine(this.ctx,f);return{lineTop:h,offset:(this._fontSizeMult-this._fontSizeFraction)*e/(this.lineHeight*this._fontSizeMult)}},_createTextCharBg:function(g,i,j,l,h,k){return['<rect fill="',g.textBackgroundColor,'" x="',i+k,'" y="',j-this.height/2,'" width="',h,'" height="',l/this.lineHeight,'"></rect>'].join("")},_createTextCharSpan:function(g,h,i,j,k){var l=this.getSvgStyles.call(fabric.util.object.extend({visible:true,fill:this.fill,stroke:this.stroke,type:"text"},h));return['<tspan x="',i+k,'" y="',j-this.height/2,'" ',(h.fontFamily?'font-family="'+h.fontFamily.replace(/"/g,"'")+'" ':""),(h.fontSize?'font-size="'+h.fontSize+'" ':""),(h.fontStyle?'font-style="'+h.fontStyle+'" ':""),(h.fontWeight?'font-weight="'+h.fontWeight+'" ':""),(h.textDecoration?'text-decoration="'+h.textDecoration+'" ':""),'style="',l,'">',fabric.util.string.escapeXml(g),"</tspan>"].join("")}});(function(){if(typeof document!=="undefined"&&typeof window!=="undefined"){return}var DOMParser=require("xmldom").DOMParser,URL=require("url"),HTTP=require("http"),HTTPS=require("https"),Canvas=require("canvas"),Image=require("canvas").Image;function request(url,encoding,callback){var oURL=URL.parse(url);if(!oURL.port){oURL.port=(oURL.protocol.indexOf("https:")===0)?443:80}var reqHandler=(oURL.protocol.indexOf("https:")===0)?HTTPS:HTTP,req=reqHandler.request({hostname:oURL.hostname,port:oURL.port,path:oURL.path,method:"GET"},function(response){var body="";if(encoding){response.setEncoding(encoding)}response.on("end",function(){callback(body)});response.on("data",function(chunk){if(response.statusCode===200){body+=chunk}})});req.on("error",function(err){if(err.errno===process.ECONNREFUSED){fabric.log("ECONNREFUSED: connection refused to "+oURL.hostname+":"+oURL.port)}else{fabric.log(err.message)}});req.end()}function requestFs(path,callback){var fs=require("fs");fs.readFile(path,function(err,data){if(err){fabric.log(err);throw err}else{callback(data)}})}fabric.util.loadImage=function(url,callback,context){function createImageAndCallBack(data){img.src=new Buffer(data,"binary");img._src=url;callback&&callback.call(context,img)}var img=new Image();if(url&&(url instanceof Buffer||url.indexOf("data")===0)){img.src=img._src=url;callback&&callback.call(context,img)}else{if(url&&url.indexOf("http")!==0){requestFs(url,createImageAndCallBack)}else{if(url){request(url,"binary",createImageAndCallBack)}else{callback&&callback.call(context,url)}}}};fabric.loadSVGFromURL=function(url,callback,reviver){url=url.replace(/^\n\s*/,"").replace(/\?.*$/,"").trim();if(url.indexOf("http")!==0){requestFs(url,function(body){fabric.loadSVGFromString(body.toString(),callback,reviver)})}else{request(url,"",function(body){fabric.loadSVGFromString(body,callback,reviver)})}};fabric.loadSVGFromString=function(string,callback,reviver){var doc=new DOMParser().parseFromString(string);fabric.parseSVGDocument(doc.documentElement,function(results,options){callback&&callback(results,options)},reviver)};fabric.util.getScript=function(url,callback){request(url,"",function(body){eval(body);callback&&callback()})};fabric.Image.fromObject=function(object,callback){fabric.util.loadImage(object.src,function(img){var oImg=new fabric.Image(img);oImg._initConfig(object);oImg._initFilters(object,function(filters){oImg.filters=filters||[];callback&&callback(oImg)})})};fabric.createCanvasForNode=function(width,height,options,nodeCanvasOptions){nodeCanvasOptions=nodeCanvasOptions||options;var canvasEl=fabric.document.createElement("canvas"),nodeCanvas=new Canvas(width||600,height||600,nodeCanvasOptions);canvasEl.style={};canvasEl.width=nodeCanvas.width;canvasEl.height=nodeCanvas.height;var FabricCanvas=fabric.Canvas||fabric.StaticCanvas,fabricCanvas=new FabricCanvas(canvasEl,options);fabricCanvas.contextContainer=nodeCanvas.getContext("2d");fabricCanvas.nodeCanvas=nodeCanvas;fabricCanvas.Font=Canvas.Font;return fabricCanvas};fabric.StaticCanvas.prototype.createPNGStream=function(){return this.nodeCanvas.createPNGStream()};fabric.StaticCanvas.prototype.createJPEGStream=function(opts){return this.nodeCanvas.createJPEGStream(opts)};var origSetWidth=fabric.StaticCanvas.prototype.setWidth;fabric.StaticCanvas.prototype.setWidth=function(width,options){origSetWidth.call(this,width,options);this.nodeCanvas.width=width;return this};if(fabric.Canvas){fabric.Canvas.prototype.setWidth=fabric.StaticCanvas.prototype.setWidth}var origSetHeight=fabric.StaticCanvas.prototype.setHeight;fabric.StaticCanvas.prototype.setHeight=function(height,options){origSetHeight.call(this,height,options);this.nodeCanvas.height=height;return this};if(fabric.Canvas){fabric.Canvas.prototype.setHeight=fabric.StaticCanvas.prototype.setHeight}})();