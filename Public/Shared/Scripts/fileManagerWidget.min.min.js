(function(){var j,l,g,h,k,i=function(b,a){return function(){return b.apply(a,arguments)}};k=window;j=k.jQuery;g=k.Dropzone;l=k.App;l.FileManager=h=(function(){a.prototype.status={dropzone:null,jsTree:null};a.prototype.htmlBindings={modal_ProjectFiles:"#project-files-modal",dropzone:"#projectFilesDropzone",dropzone_previews:".dz-preview",jsTree:"#project-files-jstree",jsTree_SearchControl:"#tree-search"};function a(b,f,r,p,c,d,e,q){this.urlGetNode=b;this.urlGetContent=f;this.urlCreate=r;this.urlDelete=p;this.urlRename=c;this.urlMove=d;this.urlCopy=e;this.urlDeleteFile=q;this.deleteDir=i(this.deleteDir,this);this.renameDir=i(this.renameDir,this);this.createDir=i(this.createDir,this);this.loadFileTree=i(this.loadFileTree,this);this.bindJsTreeSearching=i(this.bindJsTreeSearching,this);this.dropzoneReset=i(this.dropzoneReset,this);this.init=i(this.init,this)}a.prototype.init=function(){var b;b=this;g.options.projectFilesDropzone=false;console.log(g.options);return this.status.dropzone=new g(this.htmlBindings.dropzone,{paramName:"file",maxFilesize:1024,maxThumbnailFilesize:1,addRemoveLinks:true,accept:function(c,d){if(c.name==="Alex.jpg"){return d("Hi creator!")}else{return d}},init:function(){this.on("sending",function(e,c,d){var f,n;console.log("sending event triggered");f=b.status.jsTree.jstree(true);n=f.get_selected();e.ready4Remove=true;e.uploadPath=b.currentId+"/"+n;if(b.currentId){d.append("rootDir",b.currentId);return d.append("selectedDir",n)}});this.on("removedfile",function(d){var c,e;console.log("removing event triggered");e=b.status.jsTree.jstree(true).get_selected();c={rootDir:b.currentId,selectedDir:e[0],fileName:d.name};if(d.ready4Remove){j(".loading").show();j.post(b.urlDeleteFile,c).done(function(){return j(".loading").hide()}).fail(function(){return j(".loading").hide()})}return d.ready4Remove=true});return this}})};a.prototype.dropzoneReset=function(){var b;for(b in this.status.dropzone.files){b.ready4Remove=false}this.status.dropzone.removeAllFiles();j(this.htmlBindings.dropzone_previews).children(".dz-preview").remove();j(this.htmlBindings.dropzone).children(".dz-message.custom").css("opacity","1");return void 0};a.prototype.bindJsTreeSearching=function(){return j(this.htmlBindings.jsTree_SearchControl).on("keyup",(function(b){return function(){var c;if(c){clearTimeout(c)}return c=setTimeout(function(){var d;d=j(b.htmlBindings.jsTree_SearchControl).val();return b.status.jsTree.jstree(true).search(d)},250)}})(this))};a.prototype.loadFileTree=function(b){this.currentId=b;if(this.status.jsTree!=null){this.status.jsTree.jstree(true).destroy()}this.status.jsTree=j(this.htmlBindings.jsTree).jstree({id:this.htmlBindings.jsTree,plugins:["state","dnd","sort","types","contextmenu","unique","search"],searchControlId:this.htmlBindings.jsTree_SearchControl,core:{animation:true,themes:{name:"default",responsive:false,variant:"medium",stripes:false},data:{url:this.urlGetNode+"&rootDir="+b,data:function(c){return{id:c.id}}},check_callback:function(f,d,p,c,e){var o;o=true;if(e&&e.dnd&&e.pos!=="i"){o=false}if((f==="move_node")||(f==="copy_node")){if(this.get_node(d).parent===this.get_node(p).id){o=false}}return o},error:function(c){return console.log("Error callback:",c)}},sort:function(c,d){var e;e=-1;if(this.get_type(c)===this.get_type(d)){if(this.get_text(c)>this.get_text(d)){return e=1}}else{if(this.get_type(c)>=this.get_type(d)){return e=1}}},types:{"#":{max_children:1,valid_children:["default"],icon:"glyphicon glyphicon-folder-open"},"default":{valid_children:["default"],icon:"glyphicon glyphicon-folder-close"}},contextmenu:{items:function(c){var d;d=j.jstree.defaults.contextmenu.items();console.log(d);delete d.ccp;if(this.get_type(c)==="file"){delete d.create}return d}},unique:{duplicate:function(c,d){return c+" "+d}}}).on("delete_node.jstree",(function(c){return function(f,e){var d;d={rootDir:b,id:e.node.id};j(".loading").show();return j.get(c.urlDelete,d).done(function(){return j(".loading").hide()}).fail(function(){e.instance.refresh();return j(".loading").hide()})}})(this)).on("create_node.jstree",(function(c){return function(f,e){var d;d={rootDir:b,type:e.node.type,id:e.node.parent,text:e.node.text};j(".loading").show();return j.get(c.urlCreate,d).done(function(n){e.instance.set_id(e.node,n.id);return j(".loading").hide()}).fail(function(){e.instance.refresh();return j(".loading").hide()})}})(this)).on("rename_node.jstree",(function(c){return function(f,e){var d;d={rootDir:b,type:e.node.type,id:e.node.id,text:e.text};j(".loading").show();return j.get(c.urlRename,d).done(function(n){e.instance.set_id(e.node,n.id);return j(".loading").hide()}).fail(function(){e.instance.refresh();return j(".loading").hide()})}})(this)).on("move_node.jstree",(function(c){return function(f,e){var d;d={rootDir:b,id:e.node.id,parent:e.parent};j(".loading").show();return j.get(c.urlMove,d).done(function(){e.instance.refresh();return j(".loading").hide()}).fail(function(){e.instance.refresh();return j(".loading").hide()})}})(this)).on("copy_node.jstree",(function(c){return function(f,e){var d;d={rootDir:b,id:e.original.id,parent:e.parent};j(".loading").show();return j.get(c.urlCopy,d).done(function(){e.instance.load_node(e.parent);e.instance.refresh();return j(".loading").hide()}).fail(function(){e.instance.refresh();return j(".loading").hide()})}})(this)).on("changed_node.jstree",(function(c){return function(f,e){var d;console.log("changed");d={rootDir:b,id:e.original.id};j(".loading").show();return console.log("root: ",d.rootDir,"id: ",d.id)}})(this));this.bindJsTreeSearching(false);return this.status.jsTree.jstree(true).select_node(b)};a.prototype.createDir=function(){var b,c;b=this.status.jsTree.jstree(true);c=b.get_selected();if(!c.length){false}c=c[0];return b.create_node(c,{type:"default"},"last",function(d){return setTimeout(function(){return b.edit(d)},0)})};a.prototype.renameDir=function(){var b,c;b=this.status.jsTree.jstree(true);c=b.get_selected();if(!c.length){false}c=c[0];return b.edit(c)};a.prototype.deleteDir=function(){var b,c,d;c=true;b=this.status.jsTree.jstree(true);d=b.get_selected();if(!d.length){c=false}if(d[0]==="/"){c=false}b.delete_node(d);this.dropzoneReset();return c};return a})()}).call(this);