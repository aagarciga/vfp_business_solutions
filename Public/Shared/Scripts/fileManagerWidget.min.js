(function(){var e,c,b,a,d,f=function(g,h){return function(){return g.apply(h,arguments)}};d=window;e=d.jQuery;b=d.Dropzone;c=d.App;c.FileManager=a=(function(){g.prototype.status={dropzone:null,jsTree:null};g.prototype.htmlBindings={modal_ProjectFiles:"#project-files-modal",dropzone:"#projectFilesDropzone",dropzone_previews:".dz-preview",jsTree:"#project-files-jstree",jsTree_SearchControl:"#tree-search"};function g(m,i,n,h,l,k,j,o){this.urlGetNode=m;this.urlGetContent=i;this.urlCreate=n;this.urlDelete=h;this.urlRename=l;this.urlMove=k;this.urlCopy=j;this.urlDeleteFile=o;this.deleteDir=f(this.deleteDir,this);this.renameDir=f(this.renameDir,this);this.createDir=f(this.createDir,this);this.loadFileTree=f(this.loadFileTree,this);this.bindJsTreeSearching=f(this.bindJsTreeSearching,this);this.dropzoneReset=f(this.dropzoneReset,this);this.init=f(this.init,this)}g.prototype.init=function(){var h;h=this;b.options.projectFilesDropzone=false;console.log(b.options);return this.status.dropzone=new b(this.htmlBindings.dropzone,{paramName:"file",maxFilesize:1024,maxThumbnailFilesize:1,addRemoveLinks:true,accept:function(j,i){if(j.name==="Alex.jpg"){return i("Hi creator!")}else{return i}},init:function(){this.on("sending",function(k,m,l){var j,i;console.log("sending event triggered");j=h.status.jsTree.jstree(true);i=j.get_selected();k.ready4Remove=true;k.uploadPath=h.currentId+"/"+i;if(h.currentId){l.append("rootDir",h.currentId);return l.append("selectedDir",i)}});this.on("removedfile",function(j){var k,i;console.log("removing event triggered");i=h.status.jsTree.jstree(true).get_selected();k={rootDir:h.currentId,selectedDir:i[0],fileName:j.name};if(j.ready4Remove){e(".loading").show();e.post(h.urlDeleteFile,k).done(function(){return e(".loading").hide()}).fail(function(){return e(".loading").hide()})}return j.ready4Remove=true});return this}})};g.prototype.dropzoneReset=function(){var h;for(h in this.status.dropzone.files){h.ready4Remove=false}this.status.dropzone.removeAllFiles();e(this.htmlBindings.dropzone_previews).children(".dz-preview").remove();e(this.htmlBindings.dropzone).children(".dz-message.custom").css("opacity","1");return void 0};g.prototype.bindJsTreeSearching=function(){return e(this.htmlBindings.jsTree_SearchControl).on("keyup",(function(h){return function(){var i;if(i){clearTimeout(i)}return i=setTimeout(function(){var j;j=e(h.htmlBindings.jsTree_SearchControl).val();return h.status.jsTree.jstree(true).search(j)},250)}})(this))};g.prototype.loadFileTree=function(h){this.currentId=h;if(this.status.jsTree!=null){this.status.jsTree.jstree(true).destroy()}this.status.jsTree=e(this.htmlBindings.jsTree).jstree({id:this.htmlBindings.jsTree,plugins:["state","dnd","sort","types","contextmenu","unique","search"],searchControlId:this.htmlBindings.jsTree_SearchControl,core:{animation:true,themes:{name:"default",responsive:false,variant:"medium",stripes:false},data:{url:this.urlGetNode+"&rootDir="+h,data:function(i){return{id:i.id}}},check_callback:function(j,l,n,m,k){var i;i=true;if(k&&k.dnd&&k.pos!=="i"){i=false}if((j==="move_node")||(j==="copy_node")){if(this.get_node(l).parent===this.get_node(n).id){i=false}}return i},error:function(i){return console.log("Error callback:",i)}},sort:function(k,j){var i;i=-1;if(this.get_type(k)===this.get_type(j)){if(this.get_text(k)>this.get_text(j)){return i=1}}else{if(this.get_type(k)>=this.get_type(j)){return i=1}}},types:{"#":{max_children:1,valid_children:["default"],icon:"glyphicon glyphicon-folder-open"},"default":{valid_children:["default"],icon:"glyphicon glyphicon-folder-close"}},contextmenu:{items:function(j){var i;i=e.jstree.defaults.contextmenu.items();console.log(i);delete i.ccp;if(this.get_type(j)==="file"){delete i.create}return i}},unique:{duplicate:function(j,i){return j+" "+i}}}).on("delete_node.jstree",(function(i){return function(j,k){var l;l={rootDir:h,id:k.node.id};e(".loading").show();return e.get(i.urlDelete,l).done(function(){return e(".loading").hide()}).fail(function(){k.instance.refresh();return e(".loading").hide()})}})(this)).on("create_node.jstree",(function(i){return function(j,k){var l;l={rootDir:h,type:k.node.type,id:k.node.parent,text:k.node.text};e(".loading").show();return e.get(i.urlCreate,l).done(function(m){k.instance.set_id(k.node,m.id);return e(".loading").hide()}).fail(function(){k.instance.refresh();return e(".loading").hide()})}})(this)).on("rename_node.jstree",(function(i){return function(j,k){var l;l={rootDir:h,type:k.node.type,id:k.node.id,text:k.text};e(".loading").show();return e.get(i.urlRename,l).done(function(m){k.instance.set_id(k.node,m.id);return e(".loading").hide()}).fail(function(){k.instance.refresh();return e(".loading").hide()})}})(this)).on("move_node.jstree",(function(i){return function(j,k){var l;l={rootDir:h,id:k.node.id,parent:k.parent};e(".loading").show();return e.get(i.urlMove,l).done(function(){k.instance.refresh();return e(".loading").hide()}).fail(function(){k.instance.refresh();return e(".loading").hide()})}})(this)).on("copy_node.jstree",(function(i){return function(j,k){var l;l={rootDir:h,id:k.original.id,parent:k.parent};e(".loading").show();return e.get(i.urlCopy,l).done(function(){k.instance.load_node(k.parent);k.instance.refresh();return e(".loading").hide()}).fail(function(){k.instance.refresh();return e(".loading").hide()})}})(this)).on("changed_node.jstree",(function(i){return function(j,k){var l;console.log("changed");l={rootDir:h,id:k.original.id};e(".loading").show();return console.log("root: ",l.rootDir,"id: ",l.id)}})(this));this.bindJsTreeSearching(false);return this.status.jsTree.jstree(true).select_node(h)};g.prototype.createDir=function(){var i,h;i=this.status.jsTree.jstree(true);h=i.get_selected();if(!h.length){false}h=h[0];return i.create_node(h,{type:"default"},"last",function(j){return setTimeout(function(){return i.edit(j)},0)})};g.prototype.renameDir=function(){var i,h;i=this.status.jsTree.jstree(true);h=i.get_selected();if(!h.length){false}h=h[0];return i.edit(h)};g.prototype.deleteDir=function(){var j,i,h;i=true;j=this.status.jsTree.jstree(true);h=j.get_selected();if(!h.length){i=false}if(h[0]==="/"){i=false}j.delete_node(h);this.dropzoneReset();return i};return g})()}).call(this);